
(function(){if(window.jQuery){window.jQuery.noConflict();}
if(!window.$||(window.$.fn&&window.jQuery&&window.$.fn.jquery!=window.jQuery.fn.jquery)){window.$=window.jQuery;}!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jWS requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){var c=[],d=c.slice,e=c.concat,f=c.push,g=c.indexOf,h={},i=h.toString,j=h.hasOwnProperty,k={},l=a.document,m="2.1.4",n=function(a,b){return new n.fn.init(a,b)},o=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,p=/^-ms-/,q=/-([\da-z])/gi,r=function(a,b){return b.toUpperCase()};n.fn=n.prototype={jws:m,constructor:n,selector:"",length:0,toArray:function(){return d.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:d.call(this)},pushStack:function(a){var b=n.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return n.each(this,a,b)},map:function(a){return this.pushStack(n.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:c.sort,splice:c.splice},n.extend=n.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||n.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(n.isPlainObject(d)||(e=n.isArray(d)))?(e?(e=!1,f=c&&n.isArray(c)?c:[]):f=c&&n.isPlainObject(c)?c:{},g[b]=n.extend(j,f,d)):void 0!==d&&(g[b]=d));return g},n.extend({expando:"jWS"+(m+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===n.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){return!n.isArray(a)&&a-parseFloat(a)+1>=0},isPlainObject:function(a){return"object"!==n.type(a)||a.nodeType||n.isWindow(a)?!1:a.constructor&&!j.call(a.constructor.prototype,"isPrototypeOf")?!1:!0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?h[i.call(a)]||"object":typeof a},globalEval:function(a){var b,c=eval;a=n.trim(a),a&&(1===a.indexOf("use strict")?(b=l.createElement("script"),b.text=a,l.head.appendChild(b).parentNode.removeChild(b)):c(a))},camelCase:function(a){return a.replace(p,"ms-").replace(q,r)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,c){var d,e=0,f=a.length,g=s(a);if(c){if(g){for(;f>e;e++)if(d=b.apply(a[e],c),d===!1)break}else for(e in a)if(d=b.apply(a[e],c),d===!1)break}else if(g){for(;f>e;e++)if(d=b.call(a[e],e,a[e]),d===!1)break}else for(e in a)if(d=b.call(a[e],e,a[e]),d===!1)break;return a},trim:function(a){return null==a?"":(a+"").replace(o,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(s(Object(a))?n.merge(c,"string"==typeof a?[a]:a):f.call(c,a)),c},inArray:function(a,b,c){return null==b?-1:g.call(b,a,c)},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;c>d;d++)a[e++]=b[d];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,f=0,g=a.length,h=s(a),i=[];if(h)for(;g>f;f++)d=b(a[f],f,c),null!=d&&i.push(d);else for(f in a)d=b(a[f],f,c),null!=d&&i.push(d);return e.apply([],i)},guid:1,proxy:function(a,b){var c,e,f;return"string"==typeof b&&(c=a[b],b=a,a=c),n.isFunction(a)?(e=d.call(arguments,2),f=function(){return a.apply(b||this,e.concat(d.call(arguments)))},f.guid=a.guid=a.guid||n.guid++,f):void 0},now:Date.now,support:k}),n.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){h["[object "+b+"]"]=b.toLowerCase()});function s(a){var b="length"in a&&a.length,c=n.type(a);return"function"===c||n.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}var t=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u="sizzle"+1*new Date,v=a.document,w=0,x=0,y=ha(),z=ha(),A=ha(),B=function(a,b){return a===b&&(l=!0),0},C=1<<31,D={}.hasOwnProperty,E=[],F=E.pop,G=E.push,H=E.push,I=E.slice,J=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},K="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",L="[\\x20\\t\\r\\n\\f]",M="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",N=M.replace("w","w#"),O="\\["+L+"*("+M+")(?:"+L+"*([*^$|!~]?=)"+L+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+N+"))|)"+L+"*\\]",P=":("+M+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+O+")*)|.*)\\)|)",Q=new RegExp(L+"+","g"),R=new RegExp("^"+L+"+|((?:^|[^\\\\])(?:\\\\.)*)"+L+"+$","g"),S=new RegExp("^"+L+"*,"+L+"*"),T=new RegExp("^"+L+"*([>+~]|"+L+")"+L+"*"),U=new RegExp("="+L+"*([^\\]'\"]*?)"+L+"*\\]","g"),V=new RegExp(P),W=new RegExp("^"+N+"$"),X={ID:new RegExp("^#("+M+")"),CLASS:new RegExp("^\\.("+M+")"),TAG:new RegExp("^("+M.replace("w","w*")+")"),ATTR:new RegExp("^"+O),PSEUDO:new RegExp("^"+P),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+L+"*(even|odd|(([+-]|)(\\d*)n|)"+L+"*(?:([+-]|)"+L+"*(\\d+)|))"+L+"*\\)|)","i"),bool:new RegExp("^(?:"+K+")$","i"),needsContext:new RegExp("^"+L+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+L+"*((?:-\\d)?\\d*)"+L+"*\\)|)(?=[^-]|$)","i")},Y=/^(?:input|select|textarea|button)$/i,Z=/^h\d$/i,$=/^[^{]+\{\s*\[native \w/,_=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,aa=/[+~]/,ba=/'|\\/g,ca=new RegExp("\\\\([\\da-f]{1,6}"+L+"?|("+L+")|.)","ig"),da=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)},ea=function(){m()};try{H.apply(E=I.call(v.childNodes),v.childNodes),E[v.childNodes.length].nodeType}catch(fa){H={apply:E.length?function(a,b){G.apply(a,I.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]);a.length=c-1}}}function ga(a,b,d,e){var f,h,j,k,l,o,r,s,w,x;if((b?b.ownerDocument||b:v)!==n&&m(b),b=b||n,d=d||[],k=b.nodeType,"string"!=typeof a||!a||1!==k&&9!==k&&11!==k)return d;if(!e&&p){if(11!==k&&(f=_.exec(a)))if(j=f[1]){if(9===k){if(h=b.getElementById(j),!h||!h.parentNode)return d;if(h.id===j)return d.push(h),d}else if(b.ownerDocument&&(h=b.ownerDocument.getElementById(j))&&t(b,h)&&h.id===j)return d.push(h),d}else{if(f[2])return H.apply(d,b.getElementsByTagName(a)),d;if((j=f[3])&&c.getElementsByClassName)return H.apply(d,b.getElementsByClassName(j)),d}if(c.qsa&&(!q||!q.test(a))){if(s=r=u,w=b,x=1!==k&&a,1===k&&"object"!==b.nodeName.toLowerCase()){o=g(a),(r=b.getAttribute("id"))?s=r.replace(ba,"\\$&"):b.setAttribute("id",s),s="[id='"+s+"'] ",l=o.length;while(l--)o[l]=s+ra(o[l]);w=aa.test(a)&&pa(b.parentNode)||b,x=o.join(",")}if(x)try{return H.apply(d,w.querySelectorAll(x)),d}catch(y){}finally{r||b.removeAttribute("id")}}}return i(a.replace(R,"$1"),b,d,e)}function ha(){var a=[];function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}return b}function ia(a){return a[u]=!0,a}function ja(a){var b=n.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function ka(a,b){var c=a.split("|"),e=a.length;while(e--)d.attrHandle[c[e]]=b}function la(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||C)-(~a.sourceIndex||C);if(d)return d;if(c)while(c=c.nextSibling)if(c===b)return-1;return a?1:-1}function ma(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function na(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function oa(a){return ia(function(b){return b=+b,ia(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function pa(a){return a&&"undefined"!=typeof a.getElementsByTagName&&a}c=ga.support={},f=ga.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},m=ga.setDocument=function(a){var b,e,g=a?a.ownerDocument||a:v;return g!==n&&9===g.nodeType&&g.documentElement?(n=g,o=g.documentElement,e=g.defaultView,e&&e!==e.top&&(e.addEventListener?e.addEventListener("unload",ea,!1):e.attachEvent&&e.attachEvent("onunload",ea)),p=!f(g),c.attributes=ja(function(a){return a.className="i",!a.getAttribute("className")}),c.getElementsByTagName=ja(function(a){return a.appendChild(g.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=$.test(g.getElementsByClassName),c.getById=ja(function(a){return o.appendChild(a).id=u,!g.getElementsByName||!g.getElementsByName(u).length}),c.getById?(d.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&p){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},d.filter.ID=function(a){var b=a.replace(ca,da);return function(a){return a.getAttribute("id")===b}}):(delete d.find.ID,d.filter.ID=function(a){var b=a.replace(ca,da);return function(a){var c="undefined"!=typeof a.getAttributeNode&&a.getAttributeNode("id");return c&&c.value===b}}),d.find.TAG=c.getElementsByTagName?function(a,b){return"undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName(a):c.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){while(c=f[e++])1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){return p?b.getElementsByClassName(a):void 0},r=[],q=[],(c.qsa=$.test(g.querySelectorAll))&&(ja(function(a){o.appendChild(a).innerHTML="<a id='"+u+"'></a><select id='"+u+"-\f]' msallowcapture=''><option selected=''></option></select>",a.querySelectorAll("[msallowcapture^='']").length&&q.push("[*^$]="+L+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||q.push("\\["+L+"*(?:value|"+K+")"),a.querySelectorAll("[id~="+u+"-]").length||q.push("~="),a.querySelectorAll(":checked").length||q.push(":checked"),a.querySelectorAll("a#"+u+"+*").length||q.push(".#.+[+~]")}),ja(function(a){var b=g.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&q.push("name"+L+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||q.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),q.push(",.*:")})),(c.matchesSelector=$.test(s=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector))&&ja(function(a){c.disconnectedMatch=s.call(a,"div"),s.call(a,"[s!='']:x"),r.push("!=",P)}),q=q.length&&new RegExp(q.join("|")),r=r.length&&new RegExp(r.join("|")),b=$.test(o.compareDocumentPosition),t=b||$.test(o.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)while(b=b.parentNode)if(b===a)return!0;return!1},B=b?function(a,b){if(a===b)return l=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===g||a.ownerDocument===v&&t(v,a)?-1:b===g||b.ownerDocument===v&&t(v,b)?1:k?J(k,a)-J(k,b):0:4&d?-1:1)}:function(a,b){if(a===b)return l=!0,0;var c,d=0,e=a.parentNode,f=b.parentNode,h=[a],i=[b];if(!e||!f)return a===g?-1:b===g?1:e?-1:f?1:k?J(k,a)-J(k,b):0;if(e===f)return la(a,b);c=a;while(c=c.parentNode)h.unshift(c);c=b;while(c=c.parentNode)i.unshift(c);while(h[d]===i[d])d++;return d?la(h[d],i[d]):h[d]===v?-1:i[d]===v?1:0},g):n},ga.matches=function(a,b){return ga(a,null,null,b)},ga.matchesSelector=function(a,b){if((a.ownerDocument||a)!==n&&m(a),b=b.replace(U,"='$1']"),!(!c.matchesSelector||!p||r&&r.test(b)||q&&q.test(b)))try{var d=s.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return ga(b,n,null,[a]).length>0},ga.contains=function(a,b){return(a.ownerDocument||a)!==n&&m(a),t(a,b)},ga.attr=function(a,b){(a.ownerDocument||a)!==n&&m(a);var e=d.attrHandle[b.toLowerCase()],f=e&&D.call(d.attrHandle,b.toLowerCase())?e(a,b,!p):void 0;return void 0!==f?f:c.attributes||!p?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},ga.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},ga.uniqueSort=function(a){var b,d=[],e=0,f=0;if(l=!c.detectDuplicates,k=!c.sortStable&&a.slice(0),a.sort(B),l){while(b=a[f++])b===a[f]&&(e=d.push(f));while(e--)a.splice(d[e],1)}return k=null,a},e=ga.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else while(b=a[d++])c+=e(b);return c},d=ga.selectors={cacheLength:50,createPseudo:ia,match:X,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(ca,da),a[3]=(a[3]||a[4]||a[5]||"").replace(ca,da),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||ga.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&ga.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return X.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&V.test(c)&&(b=g(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(ca,da).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+" "];return b||(b=new RegExp("(^|"+L+")"+a+"("+L+"|$)"))&&y(a,function(a){return b.test("string"==typeof a.className&&a.className||"undefined"!=typeof a.getAttribute&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=ga.attr(d,a);return null==e?"!="===b:b?(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e.replace(Q," ")+" ").indexOf(c)>-1:"|="===b?e===c||e.slice(0,c.length+1)===c+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h;if(q){if(f){while(p){l=b;while(l=l[p])if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){k=q[u]||(q[u]={}),j=k[a]||[],n=j[0]===w&&j[1],m=j[0]===w&&j[2],l=n&&q.childNodes[n];while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if(1===l.nodeType&&++m&&l===b){k[a]=[w,n,m];break}}else if(s&&(j=(b[u]||(b[u]={}))[a])&&j[0]===w)m=j[1];else while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if((h?l.nodeName.toLowerCase()===r:1===l.nodeType)&&++m&&(s&&((l[u]||(l[u]={}))[a]=[w,m]),l===b))break;return m-=e,m===d||m%d===0&&m/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||ga.error("unsupported pseudo: "+a);return e[u]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?ia(function(a,c){var d,f=e(a,b),g=f.length;while(g--)d=J(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:ia(function(a){var b=[],c=[],d=h(a.replace(R,"$1"));return d[u]?ia(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),b[0]=null,!c.pop()}}),has:ia(function(a){return function(b){return ga(a,b).length>0}}),contains:ia(function(a){return a=a.replace(ca,da),function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:ia(function(a){return W.test(a||"")||ga.error("unsupported lang: "+a),a=a.replace(ca,da).toLowerCase(),function(b){var c;do if(c=p?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===o},focus:function(a){return a===n.activeElement&&(!n.hasFocus||n.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return Z.test(a.nodeName)},input:function(a){return Y.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:oa(function(){return[0]}),last:oa(function(a,b){return[b-1]}),eq:oa(function(a,b,c){return[0>c?c+b:c]}),even:oa(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:oa(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:oa(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:oa(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},d.pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=ma(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=na(b);function qa(){}qa.prototype=d.filters=d.pseudos,d.setFilters=new qa,g=ga.tokenize=function(a,b){var c,e,f,g,h,i,j,k=z[a+" "];if(k)return b?0:k.slice(0);h=a,i=[],j=d.preFilter;while(h){(!c||(e=S.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=T.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(R," ")}),h=h.slice(c.length));for(g in d.filter)!(e=X[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?ga.error(a):z(a,i).slice(0)};function ra(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function sa(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=x++;return b.first?function(b,c,f){while(b=b[d])if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j=[w,f];if(g){while(b=b[d])if((1===b.nodeType||e)&&a(b,c,g))return!0}else while(b=b[d])if(1===b.nodeType||e){if(i=b[u]||(b[u]={}),(h=i[d])&&h[0]===w&&h[1]===f)return j[2]=h[2];if(i[d]=j,j[2]=a(b,c,g))return!0}}}function ta(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function ua(a,b,c){for(var d=0,e=b.length;e>d;d++)ga(a,b[d],c);return c}function va(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function wa(a,b,c,d,e,f){return d&&!d[u]&&(d=wa(d)),e&&!e[u]&&(e=wa(e,f)),ia(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||ua(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:va(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d){j=va(r,n),d(j,[],h,i),k=j.length;while(k--)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l))}if(f){if(e||a){if(e){j=[],k=r.length;while(k--)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}k=r.length;while(k--)(l=r[k])&&(j=e?J(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=va(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):H.apply(g,r)})}function xa(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],h=g||d.relative[" "],i=g?1:0,k=sa(function(a){return a===b},h,!0),l=sa(function(a){return J(b,a)>-1},h,!0),m=[function(a,c,d){var e=!g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d));return b=null,e}];f>i;i++)if(c=d.relative[a[i].type])m=[sa(ta(m),c)];else{if(c=d.filter[a[i].type].apply(null,a[i].matches),c[u]){for(e=++i;f>e;e++)if(d.relative[a[e].type])break;return wa(i>1&&ta(m),i>1&&ra(a.slice(0,i-1).concat({value:" "===a[i-2].type?"*":""})).replace(R,"$1"),c,e>i&&xa(a.slice(i,e)),f>e&&xa(a=a.slice(e)),f>e&&ra(a))}m.push(c)}return ta(m)}function ya(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,h,i,k){var l,m,o,p=0,q="0",r=f&&[],s=[],t=j,u=f||e&&d.find.TAG("*",k),v=w+=null==t?1:Math.random()||.1,x=u.length;for(k&&(j=g!==n&&g);q!==x&&null!=(l=u[q]);q++){if(e&&l){m=0;while(o=a[m++])if(o(l,g,h)){i.push(l);break}k&&(w=v)}c&&((l=!o&&l)&&p--,f&&r.push(l))}if(p+=q,c&&q!==p){m=0;while(o=b[m++])o(r,s,g,h);if(f){if(p>0)while(q--)r[q]||s[q]||(s[q]=F.call(i));s=va(s)}H.apply(i,s),k&&!f&&s.length>0&&p+b.length>1&&ga.uniqueSort(i)}return k&&(w=v,j=t),r};return c?ia(f):f}return h=ga.compile=function(a,b){var c,d=[],e=[],f=A[a+" "];if(!f){b||(b=g(a)),c=b.length;while(c--)f=xa(b[c]),f[u]?d.push(f):e.push(f);f=A(a,ya(e,d)),f.selector=a}return f},i=ga.select=function(a,b,e,f){var i,j,k,l,m,n="function"==typeof a&&a,o=!f&&g(a=n.selector||a);if(e=e||[],1===o.length){if(j=o[0]=o[0].slice(0),j.length>2&&"ID"===(k=j[0]).type&&c.getById&&9===b.nodeType&&p&&d.relative[j[1].type]){if(b=(d.find.ID(k.matches[0].replace(ca,da),b)||[])[0],!b)return e;n&&(b=b.parentNode),a=a.slice(j.shift().value.length)}i=X.needsContext.test(a)?0:j.length;while(i--){if(k=j[i],d.relative[l=k.type])break;if((m=d.find[l])&&(f=m(k.matches[0].replace(ca,da),aa.test(j[0].type)&&pa(b.parentNode)||b))){if(j.splice(i,1),a=f.length&&ra(j),!a)return H.apply(e,f),e;break}}}return(n||h(a,o))(f,b,!p,e,aa.test(a)&&pa(b.parentNode)||b),e},c.sortStable=u.split("").sort(B).join("")===u,c.detectDuplicates=!!l,m(),c.sortDetached=ja(function(a){return 1&a.compareDocumentPosition(n.createElement("div"))}),ja(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||ka("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&ja(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||ka("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),ja(function(a){return null==a.getAttribute("disabled")})||ka(K,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),ga}(a);n.find=t,n.expr=t.selectors,n.expr[":"]=n.expr.pseudos,n.unique=t.uniqueSort,n.text=t.getText,n.isXMLDoc=t.isXML,n.contains=t.contains;var u=n.expr.match.needsContext,v=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,w=/^.[^:#\[\.,]*$/;function x(a,b,c){if(n.isFunction(b))return n.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return n.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(w.test(b))return n.filter(b,a,c);b=n.filter(b,a)}return n.grep(a,function(a){return g.call(b,a)>=0!==c})}n.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?n.find.matchesSelector(d,a)?[d]:[]:n.find.matches(a,n.grep(b,function(a){return 1===a.nodeType}))},n.fn.extend({find:function(a){var b,c=this.length,d=[],e=this;if("string"!=typeof a)return this.pushStack(n(a).filter(function(){for(b=0;c>b;b++)if(n.contains(e[b],this))return!0}));for(b=0;c>b;b++)n.find(a,e[b],d);return d=this.pushStack(c>1?n.unique(d):d),d.selector=this.selector?this.selector+" "+a:a,d},filter:function(a){return this.pushStack(x(this,a||[],!1))},not:function(a){return this.pushStack(x(this,a||[],!0))},is:function(a){return!!x(this,"string"==typeof a&&u.test(a)?n(a):a||[],!1).length}});var y,z=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,A=n.fn.init=function(a,b){var c,d;if(!a)return this;if("string"==typeof a){if(c="<"===a[0]&&">"===a[a.length-1]&&a.length>=3?[null,a,null]:z.exec(a),!c||!c[1]&&b)return!b||b.jws?(b||y).find(a):this.constructor(b).find(a);if(c[1]){if(b=b instanceof n?b[0]:b,n.merge(this,n.parseHTML(c[1],b&&b.nodeType?b.ownerDocument||b:l,!0)),v.test(c[1])&&n.isPlainObject(b))for(c in b)n.isFunction(this[c])?this[c](b[c]):this.attr(c,b[c]);return this}return d=l.getElementById(c[2]),d&&d.parentNode&&(this.length=1,this[0]=d),this.context=l,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):n.isFunction(a)?"undefined"!=typeof y.ready?y.ready(a):a(n):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),n.makeArray(a,this))};A.prototype=n.fn,y=n(l);var B=/^(?:parents|prev(?:Until|All))/,C={children:!0,contents:!0,next:!0,prev:!0};n.extend({dir:function(a,b,c){var d=[],e=void 0!==c;while((a=a[b])&&9!==a.nodeType)if(1===a.nodeType){if(e&&n(a).is(c))break;d.push(a)}return d},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}}),n.fn.extend({has:function(a){var b=n(a,this),c=b.length;return this.filter(function(){for(var a=0;c>a;a++)if(n.contains(this,b[a]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=u.test(a)||"string"!=typeof a?n(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&n.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?n.unique(f):f)},index:function(a){return a?"string"==typeof a?g.call(n(a),this[0]):g.call(this,a.jws?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(n.unique(n.merge(this.get(),n(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});function D(a,b){while((a=a[b])&&1!==a.nodeType);return a}n.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return n.dir(a,"parentNode")},parentsUntil:function(a,b,c){return n.dir(a,"parentNode",c)},next:function(a){return D(a,"nextSibling")},prev:function(a){return D(a,"previousSibling")},nextAll:function(a){return n.dir(a,"nextSibling")},prevAll:function(a){return n.dir(a,"previousSibling")},nextUntil:function(a,b,c){return n.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return n.dir(a,"previousSibling",c)},siblings:function(a){return n.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return n.sibling(a.firstChild)},contents:function(a){return a.contentDocument||n.merge([],a.childNodes)}},function(a,b){n.fn[a]=function(c,d){var e=n.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=n.filter(d,e)),this.length>1&&(C[a]||n.unique(e),B.test(a)&&e.reverse()),this.pushStack(e)}});var E=/\S+/g,F={};function G(a){var b=F[a]={};return n.each(a.match(E)||[],function(a,c){b[c]=!0}),b}n.Callbacks=function(a){a="string"==typeof a?F[a]||G(a):n.extend({},a);var b,c,d,e,f,g,h=[],i=!a.once&&[],j=function(l){for(b=a.memory&&l,c=!0,g=e||0,e=0,f=h.length,d=!0;h&&f>g;g++)if(h[g].apply(l[0],l[1])===!1&&a.stopOnFalse){b=!1;break}d=!1,h&&(i?i.length&&j(i.shift()):b?h=[]:k.disable())},k={add:function(){if(h){var c=h.length;!function g(b){n.each(b,function(b,c){var d=n.type(c);"function"===d?a.unique&&k.has(c)||h.push(c):c&&c.length&&"string"!==d&&g(c)})}(arguments),d?f=h.length:b&&(e=c,j(b))}return this},remove:function(){return h&&n.each(arguments,function(a,b){var c;while((c=n.inArray(b,h,c))>-1)h.splice(c,1),d&&(f>=c&&f--,g>=c&&g--)}),this},has:function(a){return a?n.inArray(a,h)>-1:!(!h||!h.length)},empty:function(){return h=[],f=0,this},disable:function(){return h=i=b=void 0,this},disabled:function(){return!h},lock:function(){return i=void 0,b||k.disable(),this},locked:function(){return!i},fireWith:function(a,b){return!h||c&&!i||(b=b||[],b=[a,b.slice?b.slice():b],d?i.push(b):j(b)),this},fire:function(){return k.fireWith(this,arguments),this},fired:function(){return!!c}};return k},n.extend({Deferred:function(a){var b=[["resolve","done",n.Callbacks("once memory"),"resolved"],["reject","fail",n.Callbacks("once memory"),"rejected"],["notify","progress",n.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return n.Deferred(function(c){n.each(b,function(b,f){var g=n.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&n.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?n.extend(a,d):d}},e={};return d.pipe=d.then,n.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=d.call(arguments),e=c.length,f=1!==e||a&&n.isFunction(a.promise)?e:0,g=1===f?a:n.Deferred(),h=function(a,b,c){return function(e){b[a]=this,c[a]=arguments.length>1?d.call(arguments):e,c===i?g.notifyWith(b,c):--f||g.resolveWith(b,c)}},i,j,k;if(e>1)for(i=new Array(e),j=new Array(e),k=new Array(e);e>b;b++)c[b]&&n.isFunction(c[b].promise)?c[b].promise().done(h(b,k,c)).fail(g.reject).progress(h(b,j,i)):--f;return f||g.resolveWith(k,c),g.promise()}});var H;n.fn.ready=function(a){return n.ready.promise().done(a),this},n.extend({isReady:!1,readyWait:1,holdReady:function(a){a?n.readyWait++:n.ready(!0)},ready:function(a){(a===!0?--n.readyWait:n.isReady)||(n.isReady=!0,a!==!0&&--n.readyWait>0||(H.resolveWith(l,[n]),n.fn.triggerHandler&&(n(l).triggerHandler("ready"),n(l).off("ready"))))}});function I(){l.removeEventListener("DOMContentLoaded",I,!1),a.removeEventListener("load",I,!1),n.ready()}n.ready.promise=function(b){return H||(H=n.Deferred(),"complete"===l.readyState?setTimeout(n.ready):(l.addEventListener("DOMContentLoaded",I,!1),a.addEventListener("load",I,!1))),H.promise(b)},n.ready.promise();var J=n.access=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===n.type(c)){e=!0;for(h in c)n.access(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,n.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(n(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f};n.acceptData=function(a){return 1===a.nodeType||9===a.nodeType||!+a.nodeType};function K(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=n.expando+K.uid++}K.uid=1,K.accepts=n.acceptData,K.prototype={key:function(a){if(!K.accepts(a))return 0;var b={},c=a[this.expando];if(!c){c=K.uid++;try{b[this.expando]={value:c},Object.defineProperties(a,b)}catch(d){b[this.expando]=c,n.extend(a,b)}}return this.cache[c]||(this.cache[c]={}),c},set:function(a,b,c){var d,e=this.key(a),f=this.cache[e];if("string"==typeof b)f[b]=c;else if(n.isEmptyObject(f))n.extend(this.cache[e],b);else for(d in b)f[d]=b[d];return f},get:function(a,b){var c=this.cache[this.key(a)];return void 0===b?c:c[b]},access:function(a,b,c){var d;return void 0===b||b&&"string"==typeof b&&void 0===c?(d=this.get(a,b),void 0!==d?d:this.get(a,n.camelCase(b))):(this.set(a,b,c),void 0!==c?c:b)},remove:function(a,b){var c,d,e,f=this.key(a),g=this.cache[f];if(void 0===b)this.cache[f]={};else{n.isArray(b)?d=b.concat(b.map(n.camelCase)):(e=n.camelCase(b),b in g?d=[b,e]:(d=e,d=d in g?[d]:d.match(E)||[])),c=d.length;while(c--)delete g[d[c]]}},hasData:function(a){return!n.isEmptyObject(this.cache[a[this.expando]]||{})},discard:function(a){a[this.expando]&&delete this.cache[a[this.expando]]}};var L=new K,M=new K,N=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,O=/([A-Z])/g;function P(a,b,c){var d;if(void 0===c&&1===a.nodeType)if(d="data-"+b.replace(O,"-$1").toLowerCase(),c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:N.test(c)?n.parseJSON(c):c}catch(e){}M.set(a,b,c)}else c=void 0;return c}n.extend({hasData:function(a){return M.hasData(a)||L.hasData(a)},data:function(a,b,c){return M.access(a,b,c)},removeData:function(a,b){M.remove(a,b)},_data:function(a,b,c){return L.access(a,b,c)},_removeData:function(a,b){L.remove(a,b)}}),n.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=M.get(f),1===f.nodeType&&!L.get(f,"hasDataAttrs"))){c=g.length;while(c--)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=n.camelCase(d.slice(5)),P(f,d,e[d])));L.set(f,"hasDataAttrs",!0)}return e}return"object"==typeof a?this.each(function(){M.set(this,a)}):J(this,function(b){var c,d=n.camelCase(a);if(f&&void 0===b){if(c=M.get(f,a),void 0!==c)return c;if(c=M.get(f,d),void 0!==c)return c;if(c=P(f,d,void 0),void 0!==c)return c}else this.each(function(){var c=M.get(this,d);M.set(this,d,b),-1!==a.indexOf("-")&&void 0!==c&&M.set(this,a,b)})},null,b,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){M.remove(this,a)})}}),n.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=L.get(a,b),c&&(!d||n.isArray(c)?d=L.access(a,b,n.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=n.queue(a,b),d=c.length,e=c.shift(),f=n._queueHooks(a,b),g=function(){n.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return L.get(a,c)||L.access(a,c,{empty:n.Callbacks("once memory").add(function(){L.remove(a,[b+"queue",c])})})}}),n.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?n.queue(this[0],a):void 0===b?this:this.each(function(){var c=n.queue(this,a,b);n._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&n.dequeue(this,a)})},dequeue:function(a){return this.each(function(){n.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=n.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};"string"!=typeof a&&(b=a,a=void 0),a=a||"fx";while(g--)c=L.get(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var Q=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,R=["Top","Right","Bottom","Left"],S=function(a,b){return a=b||a,"none"===n.css(a,"display")||!n.contains(a.ownerDocument,a)},T=/^(?:checkbox|radio)$/i;!function(){var a=l.createDocumentFragment(),b=a.appendChild(l.createElement("div")),c=l.createElement("input");c.setAttribute("type","radio"),c.setAttribute("checked","checked"),c.setAttribute("name","t"),b.appendChild(c),k.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,b.innerHTML="<textarea>x</textarea>",k.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue}();var U="undefined";k.focusinBubbles="onfocusin"in a;var V=/^key/,W=/^(?:mouse|pointer|contextmenu)|click/,X=/^(?:focusinfocus|focusoutblur)$/,Y=/^([^.]*)(?:\.(.+)|)$/;function Z(){return!0}function $(){return!1}function _(){try{return l.activeElement}catch(a){}}n.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=L.get(a);if(r){c.handler&&(f=c,c=f.handler,e=f.selector),c.guid||(c.guid=n.guid++),(i=r.events)||(i=r.events={}),(g=r.handle)||(g=r.handle=function(b){return typeof n!==U&&n.event.triggered!==b.type?n.event.dispatch.apply(a,arguments):void 0}),b=(b||"").match(E)||[""],j=b.length;while(j--)h=Y.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o&&(l=n.event.special[o]||{},o=(e?l.delegateType:l.bindType)||o,l=n.event.special[o]||{},k=n.extend({type:o,origType:q,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&n.expr.match.needsContext.test(e),namespace:p.join(".")},f),(m=i[o])||(m=i[o]=[],m.delegateCount=0,l.setup&&l.setup.call(a,d,p,g)!==!1||a.addEventListener&&a.addEventListener(o,g,!1)),l.add&&(l.add.call(a,k),k.handler.guid||(k.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,k):m.push(k),n.event.global[o]=!0)}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=L.hasData(a)&&L.get(a);if(r&&(i=r.events)){b=(b||"").match(E)||[""],j=b.length;while(j--)if(h=Y.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o){l=n.event.special[o]||{},o=(d?l.delegateType:l.bindType)||o,m=i[o]||[],h=h[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=f=m.length;while(f--)k=m[f],!e&&q!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&("**"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k));g&&!m.length&&(l.teardown&&l.teardown.call(a,p,r.handle)!==!1||n.removeEvent(a,o,r.handle),delete i[o])}else for(o in i)n.event.remove(a,o+b[j],c,d,!0);n.isEmptyObject(i)&&(delete r.handle,L.remove(a,"events"))}},trigger:function(b,c,d,e){var f,g,h,i,k,m,o,p=[d||l],q=j.call(b,"type")?b.type:b,r=j.call(b,"namespace")?b.namespace.split("."):[];if(g=h=d=d||l,3!==d.nodeType&&8!==d.nodeType&&!X.test(q+n.event.triggered)&&(q.indexOf(".")>=0&&(r=q.split("."),q=r.shift(),r.sort()),k=q.indexOf(":")<0&&"on"+q,b=b[n.expando]?b:new n.Event(q,"object"==typeof b&&b),b.isTrigger=e?2:3,b.namespace=r.join("."),b.namespace_re=b.namespace?new RegExp("(^|\\.)"+r.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=d),c=null==c?[b]:n.makeArray(c,[b]),o=n.event.special[q]||{},e||!o.trigger||o.trigger.apply(d,c)!==!1)){if(!e&&!o.noBubble&&!n.isWindow(d)){for(i=o.delegateType||q,X.test(i+q)||(g=g.parentNode);g;g=g.parentNode)p.push(g),h=g;h===(d.ownerDocument||l)&&p.push(h.defaultView||h.parentWindow||a)}f=0;while((g=p[f++])&&!b.isPropagationStopped())b.type=f>1?i:o.bindType||q,m=(L.get(g,"events")||{})[b.type]&&L.get(g,"handle"),m&&m.apply(g,c),m=k&&g[k],m&&m.apply&&n.acceptData(g)&&(b.result=m.apply(g,c),b.result===!1&&b.preventDefault());return b.type=q,e||b.isDefaultPrevented()||o._default&&o._default.apply(p.pop(),c)!==!1||!n.acceptData(d)||k&&n.isFunction(d[q])&&!n.isWindow(d)&&(h=d[k],h&&(d[k]=null),n.event.triggered=q,d[q](),n.event.triggered=void 0,h&&(d[k]=h)),b.result}},dispatch:function(a){a=n.event.fix(a);var b,c,e,f,g,h=[],i=d.call(arguments),j=(L.get(this,"events")||{})[a.type]||[],k=n.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){h=n.event.handlers.call(this,a,j),b=0;while((f=h[b++])&&!a.isPropagationStopped()){a.currentTarget=f.elem,c=0;while((g=f.handlers[c++])&&!a.isImmediatePropagationStopped())(!a.namespace_re||a.namespace_re.test(g.namespace))&&(a.handleObj=g,a.data=g.data,e=((n.event.special[g.origType]||{}).handle||g.handler).apply(f.elem,i),void 0!==e&&(a.result=e)===!1&&(a.preventDefault(),a.stopPropagation()))}return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&(!a.button||"click"!==a.type))for(;i!==this;i=i.parentNode||this)if(i.disabled!==!0||"click"!==a.type){for(d=[],c=0;h>c;c++)f=b[c],e=f.selector+" ",void 0===d[e]&&(d[e]=f.needsContext?n(e,this).index(i)>=0:n.find(e,this,null,[i]).length),d[e]&&d.push(f);d.length&&g.push({elem:i,handlers:d})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,d,e,f=b.button;return null==a.pageX&&null!=b.clientX&&(c=a.target.ownerDocument||l,d=c.documentElement,e=c.body,a.pageX=b.clientX+(d&&d.scrollLeft||e&&e.scrollLeft||0)-(d&&d.clientLeft||e&&e.clientLeft||0),a.pageY=b.clientY+(d&&d.scrollTop||e&&e.scrollTop||0)-(d&&d.clientTop||e&&e.clientTop||0)),a.which||void 0===f||(a.which=1&f?1:2&f?3:4&f?2:0),a}},fix:function(a){if(a[n.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];g||(this.fixHooks[e]=g=W.test(e)?this.mouseHooks:V.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new n.Event(f),b=d.length;while(b--)c=d[b],a[c]=f[c];return a.target||(a.target=l),3===a.target.nodeType&&(a.target=a.target.parentNode),g.filter?g.filter(a,f):a},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==_()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===_()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&n.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(a){return n.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=n.extend(new n.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?n.event.trigger(e,null,b):n.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},n.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)},n.Event=function(a,b){return this instanceof n.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?Z:$):this.type=a,b&&n.extend(this,b),this.timeStamp=a&&a.timeStamp||n.now(),void(this[n.expando]=!0)):new n.Event(a,b)},n.Event.prototype={isDefaultPrevented:$,isPropagationStopped:$,isImmediatePropagationStopped:$,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=Z,a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=Z,a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=Z,a&&a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},n.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){n.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!n.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),k.focusinBubbles||n.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){n.event.simulate(b,a.target,n.event.fix(a),!0)};n.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=L.access(d,b);e||d.addEventListener(a,c,!0),L.access(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=L.access(d,b)-1;e?L.access(d,b,e):(d.removeEventListener(a,c,!0),L.remove(d,b))}}}),n.fn.extend({on:function(a,b,c,d,e){var f,g;if("object"==typeof a){"string"!=typeof b&&(c=c||b,b=void 0);for(g in a)this.on(g,b,c,a[g],e);return this}if(null==c&&null==d?(d=b,c=b=void 0):null==d&&("string"==typeof b?(d=c,c=void 0):(d=c,c=b,b=void 0)),d===!1)d=$;else if(!d)return this;return 1===e&&(f=d,d=function(a){return n().off(a),f.apply(this,arguments)},d.guid=f.guid||(f.guid=n.guid++)),this.each(function(){n.event.add(this,a,d,c,b)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,n(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return(b===!1||"function"==typeof b)&&(c=b,b=void 0),c===!1&&(c=$),this.each(function(){n.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){n.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?n.event.trigger(a,b,c,!0):void 0}});var aa=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,ba=/<([\w:]+)/,ca=/<|&#?\w+;/,da=/<(?:script|style|link)/i,ea=/checked\s*(?:[^=]|=\s*.checked.)/i,fa=/^$|\/(?:java|ecma)script/i,ga=/^true\/(.*)/,ha=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,ia={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ia.optgroup=ia.option,ia.tbody=ia.tfoot=ia.colgroup=ia.caption=ia.thead,ia.th=ia.td;function ja(a,b){return n.nodeName(a,"table")&&n.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function ka(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function la(a){var b=ga.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function ma(a,b){for(var c=0,d=a.length;d>c;c++)L.set(a[c],"globalEval",!b||L.get(b[c],"globalEval"))}function na(a,b){var c,d,e,f,g,h,i,j;if(1===b.nodeType){if(L.hasData(a)&&(f=L.access(a),g=L.set(b,f),j=f.events)){delete g.handle,g.events={};for(e in j)for(c=0,d=j[e].length;d>c;c++)n.event.add(b,e,j[e][c])}M.hasData(a)&&(h=M.access(a),i=n.extend({},h),M.set(b,i))}}function oa(a,b){var c=a.getElementsByTagName?a.getElementsByTagName(b||"*"):a.querySelectorAll?a.querySelectorAll(b||"*"):[];return void 0===b||b&&n.nodeName(a,b)?n.merge([a],c):c}function pa(a,b){var c=b.nodeName.toLowerCase();"input"===c&&T.test(a.type)?b.checked=a.checked:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}n.extend({clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),i=n.contains(a.ownerDocument,a);if(!(k.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||n.isXMLDoc(a)))for(g=oa(h),f=oa(a),d=0,e=f.length;e>d;d++)pa(f[d],g[d]);if(b)if(c)for(f=f||oa(a),g=g||oa(h),d=0,e=f.length;e>d;d++)na(f[d],g[d]);else na(a,h);return g=oa(h,"script"),g.length>0&&ma(g,!i&&oa(a,"script")),h},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,k=b.createDocumentFragment(),l=[],m=0,o=a.length;o>m;m++)if(e=a[m],e||0===e)if("object"===n.type(e))n.merge(l,e.nodeType?[e]:e);else if(ca.test(e)){f=f||k.appendChild(b.createElement("div")),g=(ba.exec(e)||["",""])[1].toLowerCase(),h=ia[g]||ia._default,f.innerHTML=h[1]+e.replace(aa,"<$1></$2>")+h[2],j=h[0];while(j--)f=f.lastChild;n.merge(l,f.childNodes),f=k.firstChild,f.textContent=""}else l.push(b.createTextNode(e));k.textContent="",m=0;while(e=l[m++])if((!d||-1===n.inArray(e,d))&&(i=n.contains(e.ownerDocument,e),f=oa(k.appendChild(e),"script"),i&&ma(f),c)){j=0;while(e=f[j++])fa.test(e.type||"")&&c.push(e)}return k},cleanData:function(a){for(var b,c,d,e,f=n.event.special,g=0;void 0!==(c=a[g]);g++){if(n.acceptData(c)&&(e=c[L.expando],e&&(b=L.cache[e]))){if(b.events)for(d in b.events)f[d]?n.event.remove(c,d):n.removeEvent(c,d,b.handle);L.cache[e]&&delete L.cache[e]}delete M.cache[c[M.expando]]}}}),n.fn.extend({text:function(a){return J(this,function(a){return void 0===a?n.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=a)})},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=ja(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=ja(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?n.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||n.cleanData(oa(c)),c.parentNode&&(b&&n.contains(c.ownerDocument,c)&&ma(oa(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(n.cleanData(oa(a,!1)),a.textContent="");return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return n.clone(this,a,b)})},html:function(a){return J(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a&&1===b.nodeType)return b.innerHTML;if("string"==typeof a&&!da.test(a)&&!ia[(ba.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(aa,"<$1></$2>");try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(n.cleanData(oa(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=arguments[0];return this.domManip(arguments,function(b){a=this.parentNode,n.cleanData(oa(this)),a&&a.replaceChild(b,this)}),a&&(a.length||a.nodeType)?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b){a=e.apply([],a);var c,d,f,g,h,i,j=0,l=this.length,m=this,o=l-1,p=a[0],q=n.isFunction(p);if(q||l>1&&"string"==typeof p&&!k.checkClone&&ea.test(p))return this.each(function(c){var d=m.eq(c);q&&(a[0]=p.call(this,c,d.html())),d.domManip(a,b)});if(l&&(c=n.buildFragment(a,this[0].ownerDocument,!1,this),d=c.firstChild,1===c.childNodes.length&&(c=d),d)){for(f=n.map(oa(c,"script"),ka),g=f.length;l>j;j++)h=c,j!==o&&(h=n.clone(h,!0,!0),g&&n.merge(f,oa(h,"script"))),b.call(this[j],h,j);if(g)for(i=f[f.length-1].ownerDocument,n.map(f,la),j=0;g>j;j++)h=f[j],fa.test(h.type||"")&&!L.access(h,"globalEval")&&n.contains(i,h)&&(h.src?n._evalUrl&&n._evalUrl(h.src):n.globalEval(h.textContent.replace(ha,"")))}return this}}),n.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){n.fn[a]=function(a){for(var c,d=[],e=n(a),g=e.length-1,h=0;g>=h;h++)c=h===g?this:this.clone(!0),n(e[h])[b](c),f.apply(d,c.get());return this.pushStack(d)}});var qa,ra={};function sa(b,c){var d,e=n(c.createElement(b)).appendTo(c.body),f=a.getDefaultComputedStyle&&(d=a.getDefaultComputedStyle(e[0]))?d.display:n.css(e[0],"display");return e.detach(),f}function ta(a){var b=l,c=ra[a];return c||(c=sa(a,b),"none"!==c&&c||(qa=(qa||n("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=qa[0].contentDocument,b.write(),b.close(),c=sa(a,b),qa.detach()),ra[a]=c),c}var ua=/^margin/,va=new RegExp("^("+Q+")(?!px)[a-z%]+$","i"),wa=function(b){return b.ownerDocument.defaultView.opener?b.ownerDocument.defaultView.getComputedStyle(b,null):a.getComputedStyle(b,null)};function xa(a,b,c){var d,e,f,g,h=a.style;return c=c||wa(a),c&&(g=c.getPropertyValue(b)||c[b]),c&&(""!==g||n.contains(a.ownerDocument,a)||(g=n.style(a,b)),va.test(g)&&ua.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0!==g?g+"":g}function ya(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}!function(){var b,c,d=l.documentElement,e=l.createElement("div"),f=l.createElement("div");if(f.style){f.style.backgroundClip="content-box",f.cloneNode(!0).style.backgroundClip="",k.clearCloneStyle="content-box"===f.style.backgroundClip,e.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",e.appendChild(f);function g(){f.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",f.innerHTML="",d.appendChild(e);var g=a.getComputedStyle(f,null);b="1%"!==g.top,c="4px"===g.width,d.removeChild(e)}a.getComputedStyle&&n.extend(k,{pixelPosition:function(){return g(),b},boxSizingReliable:function(){return null==c&&g(),c},reliableMarginRight:function(){var b,c=f.appendChild(l.createElement("div"));return c.style.cssText=f.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",c.style.marginRight=c.style.width="0",f.style.width="1px",d.appendChild(e),b=!parseFloat(a.getComputedStyle(c,null).marginRight),d.removeChild(e),f.removeChild(c),b}})}}(),n.swap=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e};var za=/^(none|table(?!-c[ea]).+)/,Aa=new RegExp("^("+Q+")(.*)$","i"),Ba=new RegExp("^([+-])=("+Q+")","i"),Ca={position:"absolute",visibility:"hidden",display:"block"},Da={letterSpacing:"0",fontWeight:"400"},Ea=["Webkit","O","Moz","ms"];function Fa(a,b){if(b in a)return b;var c=b[0].toUpperCase()+b.slice(1),d=b,e=Ea.length;while(e--)if(b=Ea[e]+c,b in a)return b;return d}function Ga(a,b,c){var d=Aa.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function Ha(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=n.css(a,c+R[f],!0,e)),d?("content"===c&&(g-=n.css(a,"padding"+R[f],!0,e)),"margin"!==c&&(g-=n.css(a,"border"+R[f]+"Width",!0,e))):(g+=n.css(a,"padding"+R[f],!0,e),"padding"!==c&&(g+=n.css(a,"border"+R[f]+"Width",!0,e)));return g}function Ia(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=wa(a),g="border-box"===n.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=xa(a,b,f),(0>e||null==e)&&(e=a.style[b]),va.test(e))return e;d=g&&(k.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+Ha(a,b,c||(g?"border":"content"),d,f)+"px"}function Ja(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=L.get(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&S(d)&&(f[g]=L.access(d,"olddisplay",ta(d.nodeName)))):(e=S(d),"none"===c&&e||L.set(d,"olddisplay",e?c:n.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}n.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=xa(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=n.camelCase(b),i=a.style;return b=n.cssProps[h]||(n.cssProps[h]=Fa(i,h)),g=n.cssHooks[b]||n.cssHooks[h],void 0===c?g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b]:(f=typeof c,"string"===f&&(e=Ba.exec(c))&&(c=(e[1]+1)*e[2]+parseFloat(n.css(a,b)),f="number"),null!=c&&c===c&&("number"!==f||n.cssNumber[h]||(c+="px"),k.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),g&&"set"in g&&void 0===(c=g.set(a,c,d))||(i[b]=c)),void 0)}},css:function(a,b,c,d){var e,f,g,h=n.camelCase(b);return b=n.cssProps[h]||(n.cssProps[h]=Fa(a.style,h)),g=n.cssHooks[b]||n.cssHooks[h],g&&"get"in g&&(e=g.get(a,!0,c)),void 0===e&&(e=xa(a,b,d)),"normal"===e&&b in Da&&(e=Da[b]),""===c||c?(f=parseFloat(e),c===!0||n.isNumeric(f)?f||0:e):e}}),n.each(["height","width"],function(a,b){n.cssHooks[b]={get:function(a,c,d){return c?za.test(n.css(a,"display"))&&0===a.offsetWidth?n.swap(a,Ca,function(){return Ia(a,b,d)}):Ia(a,b,d):void 0},set:function(a,c,d){var e=d&&wa(a);return Ga(a,c,d?Ha(a,b,d,"border-box"===n.css(a,"boxSizing",!1,e),e):0)}}}),n.cssHooks.marginRight=ya(k.reliableMarginRight,function(a,b){return b?n.swap(a,{display:"inline-block"},xa,[a,"marginRight"]):void 0}),n.each({margin:"",padding:"",border:"Width"},function(a,b){n.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+R[d]+b]=f[d]||f[d-2]||f[0];return e}},ua.test(a)||(n.cssHooks[a+b].set=Ga)}),n.fn.extend({css:function(a,b){return J(this,function(a,b,c){var d,e,f={},g=0;if(n.isArray(b)){for(d=wa(a),e=b.length;e>g;g++)f[b[g]]=n.css(a,b[g],!1,d);return f}return void 0!==c?n.style(a,b,c):n.css(a,b)},a,b,arguments.length>1)},show:function(){return Ja(this,!0)},hide:function(){return Ja(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){S(this)?n(this).show():n(this).hide()})}});function Ka(a,b,c,d,e){return new Ka.prototype.init(a,b,c,d,e)}n.Tween=Ka,Ka.prototype={constructor:Ka,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(n.cssNumber[c]?"":"px")},cur:function(){var a=Ka.propHooks[this.prop];return a&&a.get?a.get(this):Ka.propHooks._default.get(this)},run:function(a){var b,c=Ka.propHooks[this.prop];return this.options.duration?this.pos=b=n.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):Ka.propHooks._default.set(this),this}},Ka.prototype.init.prototype=Ka.prototype,Ka.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=n.css(a.elem,a.prop,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){n.fx.step[a.prop]?n.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[n.cssProps[a.prop]]||n.cssHooks[a.prop])?n.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},Ka.propHooks.scrollTop=Ka.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},n.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},n.fx=Ka.prototype.init,n.fx.step={};var La,Ma,Na=/^(?:toggle|show|hide)$/,Oa=new RegExp("^(?:([+-])=|)("+Q+")([a-z%]*)$","i"),Pa=/queueHooks$/,Qa=[Va],Ra={"*":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=Oa.exec(b),f=e&&e[3]||(n.cssNumber[a]?"":"px"),g=(n.cssNumber[a]||"px"!==f&&+d)&&Oa.exec(n.css(c.elem,a)),h=1,i=20;if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do h=h||".5",g/=h,n.style(c.elem,a,g+f);while(h!==(h=c.cur()/d)&&1!==h&&--i)}return e&&(g=c.start=+g||+d||0,c.unit=f,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};function Sa(){return setTimeout(function(){La=void 0}),La=n.now()}function Ta(a,b){var c,d=0,e={height:a};for(b=b?1:0;4>d;d+=2-b)c=R[d],e["margin"+c]=e["padding"+c]=a;return b&&(e.opacity=e.width=a),e}function Ua(a,b,c){for(var d,e=(Ra[b]||[]).concat(Ra["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function Va(a,b,c){var d,e,f,g,h,i,j,k,l=this,m={},o=a.style,p=a.nodeType&&S(a),q=L.get(a,"fxshow");c.queue||(h=n._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,l.always(function(){l.always(function(){h.unqueued--,n.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[o.overflow,o.overflowX,o.overflowY],j=n.css(a,"display"),k="none"===j?L.get(a,"olddisplay")||ta(a.nodeName):j,"inline"===k&&"none"===n.css(a,"float")&&(o.display="inline-block")),c.overflow&&(o.overflow="hidden",l.always(function(){o.overflow=c.overflow[0],o.overflowX=c.overflow[1],o.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],Na.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(p?"hide":"show")){if("show"!==e||!q||void 0===q[d])continue;p=!0}m[d]=q&&q[d]||n.style(a,d)}else j=void 0;if(n.isEmptyObject(m))"inline"===("none"===j?ta(a.nodeName):j)&&(o.display=j);else{q?"hidden"in q&&(p=q.hidden):q=L.access(a,"fxshow",{}),f&&(q.hidden=!p),p?n(a).show():l.done(function(){n(a).hide()}),l.done(function(){var b;L.remove(a,"fxshow");for(b in m)n.style(a,b,m[b])});for(d in m)g=Ua(p?q[d]:0,d,l),d in q||(q[d]=g.start,p&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function Wa(a,b){var c,d,e,f,g;for(c in a)if(d=n.camelCase(c),e=b[d],f=a[c],n.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=n.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function Xa(a,b,c){var d,e,f=0,g=Qa.length,h=n.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=La||Sa(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:n.extend({},b),opts:n.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:La||Sa(),duration:c.duration,tweens:[],createTween:function(b,c){var d=n.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(Wa(k,j.opts.specialEasing);g>f;f++)if(d=Qa[f].call(j,a,k,j.opts))return d;return n.map(k,Ua,j),n.isFunction(j.opts.start)&&j.opts.start.call(a,j),n.fx.timer(n.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}n.Animation=n.extend(Xa,{tweener:function(a,b){n.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],Ra[c]=Ra[c]||[],Ra[c].unshift(b)},prefilter:function(a,b){b?Qa.unshift(a):Qa.push(a)}}),n.speed=function(a,b,c){var d=a&&"object"==typeof a?n.extend({},a):{complete:c||!c&&b||n.isFunction(a)&&a,duration:a,easing:c&&b||b&&!n.isFunction(b)&&b};return d.duration=n.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in n.fx.speeds?n.fx.speeds[d.duration]:n.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){n.isFunction(d.old)&&d.old.call(this),d.queue&&n.dequeue(this,d.queue)},d},n.fn.extend({fadeTo:function(a,b,c,d){return this.filter(S).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=n.isEmptyObject(a),f=n.speed(b,c,d),g=function(){var b=Xa(this,n.extend({},a),f);(e||L.get(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=n.timers,g=L.get(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&Pa.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));(b||!c)&&n.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=L.get(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=n.timers,g=d?d.length:0;for(c.finish=!0,n.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),n.each(["toggle","show","hide"],function(a,b){var c=n.fn[b];n.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(Ta(b,!0),a,d,e)}}),n.each({slideDown:Ta("show"),slideUp:Ta("hide"),slideToggle:Ta("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){n.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),n.timers=[],n.fx.tick=function(){var a,b=0,c=n.timers;for(La=n.now();b<c.length;b++)a=c[b],a()||c[b]!==a||c.splice(b--,1);c.length||n.fx.stop(),La=void 0},n.fx.timer=function(a){n.timers.push(a),a()?n.fx.start():n.timers.pop()},n.fx.interval=13,n.fx.start=function(){Ma||(Ma=setInterval(n.fx.tick,n.fx.interval))},n.fx.stop=function(){clearInterval(Ma),Ma=null},n.fx.speeds={slow:600,fast:200,_default:400},n.fn.delay=function(a,b){return a=n.fx?n.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},function(){var a=l.createElement("input"),b=l.createElement("select"),c=b.appendChild(l.createElement("option"));a.type="checkbox",k.checkOn=""!==a.value,k.optSelected=c.selected,b.disabled=!0,k.optDisabled=!c.disabled,a=l.createElement("input"),a.value="t",a.type="radio",k.radioValue="t"===a.value}();var Ya,Za,$a=n.expr.attrHandle;n.fn.extend({attr:function(a,b){return J(this,n.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){n.removeAttr(this,a)})}}),n.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(a&&3!==f&&8!==f&&2!==f)return typeof a.getAttribute===U?n.prop(a,b,c):(1===f&&n.isXMLDoc(a)||(b=b.toLowerCase(),d=n.attrHooks[b]||(n.expr.match.bool.test(b)?Za:Ya)),void 0===c?d&&"get"in d&&null!==(e=d.get(a,b))?e:(e=n.find.attr(a,b),null==e?void 0:e):null!==c?d&&"set"in d&&void 0!==(e=d.set(a,c,b))?e:(a.setAttribute(b,c+""),c):void n.removeAttr(a,b))},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(E);if(f&&1===a.nodeType)while(c=f[e++])d=n.propFix[c]||c,n.expr.match.bool.test(c)&&(a[d]=!1),a.removeAttribute(c)},attrHooks:{type:{set:function(a,b){if(!k.radioValue&&"radio"===b&&n.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}}}),Za={set:function(a,b,c){return b===!1?n.removeAttr(a,c):a.setAttribute(c,c),c}},n.each(n.expr.match.bool.source.match(/\w+/g),function(a,b){var c=$a[b]||n.find.attr;$a[b]=function(a,b,d){var e,f;return d||(f=$a[b],$a[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,$a[b]=f),e}});var _a=/^(?:input|select|textarea|button)$/i;n.fn.extend({prop:function(a,b){return J(this,n.prop,a,b,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[n.propFix[a]||a]})}}),n.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(a,b,c){var d,e,f,g=a.nodeType;if(a&&3!==g&&8!==g&&2!==g)return f=1!==g||!n.isXMLDoc(a),f&&(b=n.propFix[b]||b,e=n.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){return a.hasAttribute("tabindex")||_a.test(a.nodeName)||a.href?a.tabIndex:-1}}}}),k.optSelected||(n.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null}}),n.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){n.propFix[this.toLowerCase()]=this});var ab=/[\t\r\n\f]/g;n.fn.extend({addClass:function(a){var b,c,d,e,f,g,h="string"==typeof a&&a,i=0,j=this.length;if(n.isFunction(a))return this.each(function(b){n(this).addClass(a.call(this,b,this.className))});if(h)for(b=(a||"").match(E)||[];j>i;i++)if(c=this[i],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(ab," "):" ")){f=0;while(e=b[f++])d.indexOf(" "+e+" ")<0&&(d+=e+" ");g=n.trim(d),c.className!==g&&(c.className=g)}return this},removeClass:function(a){var b,c,d,e,f,g,h=0===arguments.length||"string"==typeof a&&a,i=0,j=this.length;if(n.isFunction(a))return this.each(function(b){n(this).removeClass(a.call(this,b,this.className))});if(h)for(b=(a||"").match(E)||[];j>i;i++)if(c=this[i],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(ab," "):"")){f=0;while(e=b[f++])while(d.indexOf(" "+e+" ")>=0)d=d.replace(" "+e+" "," ");g=a?n.trim(d):"",c.className!==g&&(c.className=g)}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):this.each(n.isFunction(a)?function(c){n(this).toggleClass(a.call(this,c,this.className,b),b)}:function(){if("string"===c){var b,d=0,e=n(this),f=a.match(E)||[];while(b=f[d++])e.hasClass(b)?e.removeClass(b):e.addClass(b)}else(c===U||"boolean"===c)&&(this.className&&L.set(this,"__className__",this.className),this.className=this.className||a===!1?"":L.get(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(ab," ").indexOf(b)>=0)return!0;return!1}});var bb=/\r/g;n.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=n.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,n(this).val()):a,null==e?e="":"number"==typeof e?e+="":n.isArray(e)&&(e=n.map(e,function(a){return null==a?"":a+""})),b=n.valHooks[this.type]||n.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=n.valHooks[e.type]||n.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(bb,""):null==c?"":c)}}}),n.extend({valHooks:{option:{get:function(a){var b=n.find.attr(a,"value");return null!=b?b:n.trim(n.text(a))}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],!(!c.selected&&i!==e||(k.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&n.nodeName(c.parentNode,"optgroup"))){if(b=n(c).val(),f)return b;g.push(b)}return g},set:function(a,b){var c,d,e=a.options,f=n.makeArray(b),g=e.length;while(g--)d=e[g],(d.selected=n.inArray(d.value,f)>=0)&&(c=!0);return c||(a.selectedIndex=-1),f}}}}),n.each(["radio","checkbox"],function(){n.valHooks[this]={set:function(a,b){return n.isArray(b)?a.checked=n.inArray(n(a).val(),b)>=0:void 0}},k.checkOn||(n.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})}),n.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){n.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),n.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var cb=n.now(),db=/\?/;n.parseJSON=function(a){return JSON.parse(a+"")},n.parseXML=function(a){var b,c;if(!a||"string"!=typeof a)return null;try{c=new DOMParser,b=c.parseFromString(a,"text/xml")}catch(d){b=void 0}return(!b||b.getElementsByTagName("parsererror").length)&&n.error("Invalid XML: "+a),b};var eb=/#.*$/,fb=/([?&])_=[^&]*/,gb=/^(.*?):[ \t]*([^\r\n]*)$/gm,hb=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,ib=/^(?:GET|HEAD)$/,jb=/^\/\//,kb=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,lb={},mb={},nb="*/".concat("*"),ob=a.location.href,pb=kb.exec(ob.toLowerCase())||[];function qb(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(E)||[];if(n.isFunction(c))while(d=f[e++])"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function rb(a,b,c,d){var e={},f=a===mb;function g(h){var i;return e[h]=!0,n.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}return g(b.dataTypes[0])||!e["*"]&&g("*")}function sb(a,b){var c,d,e=n.ajaxSettings.flatOptions||{};for(c in b)void 0!==b[c]&&((e[c]?a:d||(d={}))[c]=b[c]);return d&&n.extend(!0,a,d),a}function tb(a,b,c){var d,e,f,g,h=a.contents,i=a.dataTypes;while("*"===i[0])i.shift(),void 0===d&&(d=a.mimeType||b.getResponseHeader("Content-Type"));if(d)for(e in h)if(h[e]&&h[e].test(d)){i.unshift(e);break}if(i[0]in c)f=i[0];else{for(e in c){if(!i[0]||a.converters[e+" "+i[0]]){f=e;break}g||(g=e)}f=f||g}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function ub(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];f=k.shift();while(f)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}n.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ob,type:"GET",isLocal:hb.test(pb[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":nb,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":n.parseJSON,"text xml":n.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?sb(sb(a,n.ajaxSettings),b):sb(n.ajaxSettings,a)},ajaxPrefilter:qb(lb),ajaxTransport:qb(mb),ajax:function(a,b){"object"==typeof a&&(b=a,a=void 0),b=b||{};var c,d,e,f,g,h,i,j,k=n.ajaxSetup({},b),l=k.context||k,m=k.context&&(l.nodeType||l.jws)?n(l):n.event,o=n.Deferred(),p=n.Callbacks("once memory"),q=k.statusCode||{},r={},s={},t=0,u="canceled",v={readyState:0,getResponseHeader:function(a){var b;if(2===t){if(!f){f={};while(b=gb.exec(e))f[b[1].toLowerCase()]=b[2]}b=f[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===t?e:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return t||(a=s[c]=s[c]||a,r[a]=b),this},overrideMimeType:function(a){return t||(k.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>t)for(b in a)q[b]=[q[b],a[b]];else v.always(a[v.status]);return this},abort:function(a){var b=a||u;return c&&c.abort(b),x(0,b),this}};if(o.promise(v).complete=p.add,v.success=v.done,v.error=v.fail,k.url=((a||k.url||ob)+"").replace(eb,"").replace(jb,pb[1]+"//"),k.type=b.method||b.type||k.method||k.type,k.dataTypes=n.trim(k.dataType||"*").toLowerCase().match(E)||[""],null==k.crossDomain&&(h=kb.exec(k.url.toLowerCase()),k.crossDomain=!(!h||h[1]===pb[1]&&h[2]===pb[2]&&(h[3]||("http:"===h[1]?"80":"443"))===(pb[3]||("http:"===pb[1]?"80":"443")))),k.data&&k.processData&&"string"!=typeof k.data&&(k.data=n.param(k.data,k.traditional)),rb(lb,k,b,v),2===t)return v;i=n.event&&k.global,i&&0===n.active++&&n.event.trigger("ajaxStart"),k.type=k.type.toUpperCase(),k.hasContent=!ib.test(k.type),d=k.url,k.hasContent||(k.data&&(d=k.url+=(db.test(d)?"&":"?")+k.data,delete k.data),k.cache===!1&&(k.url=fb.test(d)?d.replace(fb,"$1_="+cb++):d+(db.test(d)?"&":"?")+"_="+cb++)),k.ifModified&&(n.lastModified[d]&&v.setRequestHeader("If-Modified-Since",n.lastModified[d]),n.etag[d]&&v.setRequestHeader("If-None-Match",n.etag[d])),(k.data&&k.hasContent&&k.contentType!==!1||b.contentType)&&v.setRequestHeader("Content-Type",k.contentType),v.setRequestHeader("Accept",k.dataTypes[0]&&k.accepts[k.dataTypes[0]]?k.accepts[k.dataTypes[0]]+("*"!==k.dataTypes[0]?", "+nb+"; q=0.01":""):k.accepts["*"]);for(j in k.headers)v.setRequestHeader(j,k.headers[j]);if(k.beforeSend&&(k.beforeSend.call(l,v,k)===!1||2===t))return v.abort();u="abort";for(j in{success:1,error:1,complete:1})v[j](k[j]);if(c=rb(mb,k,b,v)){v.readyState=1,i&&m.trigger("ajaxSend",[v,k]),k.async&&k.timeout>0&&(g=setTimeout(function(){v.abort("timeout")},k.timeout));try{t=1,c.send(r,x)}catch(w){if(!(2>t))throw w;x(-1,w)}}else x(-1,"No Transport");function x(a,b,f,h){var j,r,s,u,w,x=b;2!==t&&(t=2,g&&clearTimeout(g),c=void 0,e=h||"",v.readyState=a>0?4:0,j=a>=200&&300>a||304===a,f&&(u=tb(k,v,f)),u=ub(k,u,v,j),j?(k.ifModified&&(w=v.getResponseHeader("Last-Modified"),w&&(n.lastModified[d]=w),w=v.getResponseHeader("etag"),w&&(n.etag[d]=w)),204===a||"HEAD"===k.type?x="nocontent":304===a?x="notmodified":(x=u.state,r=u.data,s=u.error,j=!s)):(s=x,(a||!x)&&(x="error",0>a&&(a=0))),v.status=a,v.statusText=(b||x)+"",j?o.resolveWith(l,[r,x,v]):o.rejectWith(l,[v,x,s]),v.statusCode(q),q=void 0,i&&m.trigger(j?"ajaxSuccess":"ajaxError",[v,k,j?r:s]),p.fireWith(l,[v,x]),i&&(m.trigger("ajaxComplete",[v,k]),--n.active||n.event.trigger("ajaxStop")))}return v},getJSON:function(a,b,c){return n.get(a,b,c,"json")},getScript:function(a,b){return n.get(a,void 0,b,"script")}}),n.each(["get","post"],function(a,b){n[b]=function(a,c,d,e){return n.isFunction(c)&&(e=e||d,d=c,c=void 0),n.ajax({url:a,type:b,dataType:e,data:c,success:d})}}),n._evalUrl=function(a){return n.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},n.fn.extend({wrapAll:function(a){var b;return n.isFunction(a)?this.each(function(b){n(this).wrapAll(a.call(this,b))}):(this[0]&&(b=n(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstElementChild)a=a.firstElementChild;return a}).append(this)),this)},wrapInner:function(a){return this.each(n.isFunction(a)?function(b){n(this).wrapInner(a.call(this,b))}:function(){var b=n(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=n.isFunction(a);return this.each(function(c){n(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){n.nodeName(this,"body")||n(this).replaceWith(this.childNodes)}).end()}}),n.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0},n.expr.filters.visible=function(a){return!n.expr.filters.hidden(a)};var vb=/%20/g,wb=/\[\]$/,xb=/\r?\n/g,yb=/^(?:submit|button|image|reset|file)$/i,zb=/^(?:input|select|textarea|keygen)/i;function Ab(a,b,c,d){var e;if(n.isArray(b))n.each(b,function(b,e){c||wb.test(a)?d(a,e):Ab(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==n.type(b))d(a,b);else for(e in b)Ab(a+"["+e+"]",b[e],c,d)}n.param=function(a,b){var c,d=[],e=function(a,b){b=n.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=n.ajaxSettings&&n.ajaxSettings.traditional),n.isArray(a)||a.jws&&!n.isPlainObject(a))n.each(a,function(){e(this.name,this.value)});else for(c in a)Ab(c,a[c],b,e);return d.join("&").replace(vb,"+")},n.fn.extend({serialize:function(){return n.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=n.prop(this,"elements");return a?n.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!n(this).is(":disabled")&&zb.test(this.nodeName)&&!yb.test(a)&&(this.checked||!T.test(a))}).map(function(a,b){var c=n(this).val();return null==c?null:n.isArray(c)?n.map(c,function(a){return{name:b.name,value:a.replace(xb,"\r\n")}}):{name:b.name,value:c.replace(xb,"\r\n")}}).get()}}),n.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(a){}};var Bb=0,Cb={},Db={0:200,1223:204},Eb=n.ajaxSettings.xhr();a.attachEvent&&a.attachEvent("onunload",function(){for(var a in Cb)Cb[a]()}),k.cors=!!Eb&&"withCredentials"in Eb,k.ajax=Eb=!!Eb,n.ajaxTransport(function(a){var b;return k.cors||Eb&&!a.crossDomain?{send:function(c,d){var e,f=a.xhr(),g=++Bb;if(f.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(e in a.xhrFields)f[e]=a.xhrFields[e];a.mimeType&&f.overrideMimeType&&f.overrideMimeType(a.mimeType),a.crossDomain||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest");for(e in c)f.setRequestHeader(e,c[e]);b=function(a){return function(){b&&(delete Cb[g],b=f.onload=f.onerror=null,"abort"===a?f.abort():"error"===a?d(f.status,f.statusText):d(Db[f.status]||f.status,f.statusText,"string"==typeof f.responseText?{text:f.responseText}:void 0,f.getAllResponseHeaders()))}},f.onload=b(),f.onerror=b("error"),b=Cb[g]=b("abort");try{f.send(a.hasContent&&a.data||null)}catch(h){if(b)throw h}},abort:function(){b&&b()}}:void 0}),n.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return n.globalEval(a),a}}}),n.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET")}),n.ajaxTransport("script",function(a){if(a.crossDomain){var b,c;return{send:function(d,e){b=n("<script>").prop({async:!0,charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove(),c=null,a&&e("error"===a.type?404:200,a.type)}),l.head.appendChild(b[0])},abort:function(){c&&c()}}}});var Fb=[],Gb=/(=)\?(?=&|$)|\?\?/;n.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Fb.pop()||n.expando+"_"+cb++;return this[a]=!0,a}}),n.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(Gb.test(b.url)?"url":"string"==typeof b.data&&!(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&Gb.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=n.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(Gb,"$1"+e):b.jsonp!==!1&&(b.url+=(db.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||n.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,Fb.push(e)),g&&n.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),n.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||l;var d=v.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=n.buildFragment([a],b,e),e&&e.length&&n(e).remove(),n.merge([],d.childNodes))};var Hb=n.fn.load;n.fn.load=function(a,b,c){if("string"!=typeof a&&Hb)return Hb.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>=0&&(d=n.trim(a.slice(h)),a=a.slice(0,h)),n.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),g.length>0&&n.ajax({url:a,type:e,dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?n("<div>").append(n.parseHTML(a)).find(d):a)}).complete(c&&function(a,b){g.each(c,f||[a.responseText,b,a])}),this},n.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){n.fn[b]=function(a){return this.on(b,a)}}),n.expr.filters.animated=function(a){return n.grep(n.timers,function(b){return a===b.elem}).length};var Ib=a.document.documentElement;function Jb(a){return n.isWindow(a)?a:9===a.nodeType&&a.defaultView}n.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=n.css(a,"position"),l=n(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=n.css(a,"top"),i=n.css(a,"left"),j=("absolute"===k||"fixed"===k)&&(f+i).indexOf("auto")>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),n.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},n.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){n.offset.setOffset(this,a,b)});var b,c,d=this[0],e={top:0,left:0},f=d&&d.ownerDocument;if(f)return b=f.documentElement,n.contains(b,d)?(typeof d.getBoundingClientRect!==U&&(e=d.getBoundingClientRect()),c=Jb(f),{top:e.top+c.pageYOffset-b.clientTop,left:e.left+c.pageXOffset-b.clientLeft}):e},position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};return"fixed"===n.css(c,"position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),n.nodeName(a[0],"html")||(d=a.offset()),d.top+=n.css(a[0],"borderTopWidth",!0),d.left+=n.css(a[0],"borderLeftWidth",!0)),{top:b.top-d.top-n.css(c,"marginTop",!0),left:b.left-d.left-n.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||Ib;while(a&&!n.nodeName(a,"html")&&"static"===n.css(a,"position"))a=a.offsetParent;return a||Ib})}}),n.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(b,c){var d="pageYOffset"===c;n.fn[b]=function(e){return J(this,function(b,e,f){var g=Jb(b);return void 0===f?g?g[c]:b[e]:void(g?g.scrollTo(d?a.pageXOffset:f,d?f:a.pageYOffset):b[e]=f)},b,e,arguments.length,null)}}),n.each(["top","left"],function(a,b){n.cssHooks[b]=ya(k.pixelPosition,function(a,c){return c?(c=xa(a,b),va.test(c)?n(a).position()[b]+"px":c):void 0})}),n.each({Height:"height",Width:"width"},function(a,b){n.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){n.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return J(this,function(b,c,d){var e;return n.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?n.css(b,c,g):n.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),n.fn.size=function(){return this.length},n.fn.andSelf=n.fn.addBack,"function"==typeof define&&define.amd&&define("jws",[],function(){return n});var Kb=a.jWS,Lb=a.$;return n.noConflict=function(b){return a.$===n&&(a.$=Lb),b&&a.jWS===n&&(a.jWS=Kb),n},typeof b===U&&(a.jWS=n),n});(function($){if($.fn.inputmask==undefined){$.inputmask={defaults:{placeholder:"_",optionalmarker:{start:"[",end:"]"},escapeChar:"\\",mask:null,oncomplete:$.noop,onincomplete:$.noop,oncleared:$.noop,repeat:0,greedy:true,autoUnmask:false,clearMaskOnLostFocus:true,insertMode:true,clearIncomplete:false,aliases:{},onKeyUp:$.noop,onKeyDown:$.noop,showMaskOnHover:true,numericInput:false,radixPoint:".",definitions:{'9':{validator:"[0-9]",cardinality:1},'a':{validator:"[A-Za-z\u0410-\u044F\u0401\u0451]",cardinality:1},'*':{validator:"[A-Za-z\u0410-\u044F\u0401\u04510-9]",cardinality:1}},keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91},ignorables:[8,9,13,16,17,18,20,27,33,34,35,36,37,38,39,40,46,91,93,108]},val:$.fn.val};$.fn.inputmask=function(fn,options){var opts=$.extend(true,{},$.inputmask.defaults,options);var pasteEvent=isInputEventSupported('paste')?'paste':'input';var iphone=navigator.userAgent.match(/iphone/i)!=null;var android=navigator.userAgent.match(/android.*mobile safari.*/i)!=null;if(android){var browser=navigator.userAgent.match(/mobile safari.*/i);var version=parseInt(new RegExp(/[0-9]+/).exec(browser));android=version<=533;}
var caretposCorrection=null;if(typeof fn=="string"){switch(fn){case"mask":var _buffer=getMaskTemplate();var tests=getTestingChain();return this.each(function(){mask(this);});break;case"unmaskedvalue":var tests=this.data('inputmask')['tests'];var _buffer=this.data('inputmask')['_buffer'];opts.greedy=this.data('inputmask')['greedy'];opts.repeat=this.data('inputmask')['repeat'];opts.definitions=this.data('inputmask')['definitions'];return unmaskedvalue(this);break;case"remove":var tests,_buffer;return this.each(function(){var $input=$(this),input=this;setTimeout(function(){if($input.data('inputmask')){tests=$input.data('inputmask')['tests'];_buffer=$input.data('inputmask')['_buffer'];opts.greedy=$input.data('inputmask')['greedy'];opts.repeat=$input.data('inputmask')['repeat'];opts.definitions=$input.data('inputmask')['definitions'];input._valueSet(unmaskedvalue($input,true));$input.removeData('inputmask');$input.unbind(".inputmask");$input.removeClass('focus.inputmask');var valueProperty;if(Object.getOwnPropertyDescriptor)
valueProperty=Object.getOwnPropertyDescriptor(input,"value");if(valueProperty&&valueProperty.get){if(input._valueGet){Object.defineProperty(input,"value",{get:input._valueGet,set:input._valueSet});}}else if(document.__lookupGetter__&&input.__lookupGetter__("value")){if(input._valueGet){input.__defineGetter__("value",input._valueGet);input.__defineSetter__("value",input._valueSet);}}
delete input._valueGet;delete input._valueSet;}},0);});break;case"getemptymask":if(this.data('inputmask'))
return this.data('inputmask')['_buffer'].join('');else return"";case"hasMaskedValue":return this.data('inputmask')?!this.data('inputmask')['autoUnmask']:false;default:if(!resolveAlias(fn)){opts.mask=fn;}
var _buffer=getMaskTemplate();var tests=getTestingChain();return this.each(function(){mask(this);});break;}}
if(typeof fn=="object"){opts=$.extend(true,{},$.inputmask.defaults,fn);resolveAlias(opts.alias);var _buffer=getMaskTemplate();var tests=getTestingChain();return this.each(function(){mask(this);});}
function isInputEventSupported(eventName){var el=document.createElement('input'),eventName='on'+eventName,isSupported=(eventName in el);if(!isSupported){el.setAttribute(eventName,'return;');isSupported=typeof el[eventName]=='function';}
el=null;return isSupported;}
function resolveAlias(aliasStr){var aliasDefinition=opts.aliases[aliasStr];if(aliasDefinition){if(aliasDefinition.alias)resolveAlias(aliasDefinition.alias);$.extend(true,opts,aliasDefinition);$.extend(true,opts,options);return true;}
return false;}
function getMaskTemplate(){var escaped=false,outCount=0;if(opts.mask.length==1&&opts.greedy==false){opts.placeholder="";}
var singleMask=$.map(opts.mask.split(""),function(element,index){var outElem=[];if(element==opts.escapeChar){escaped=true;}
else if((element!=opts.optionalmarker.start&&element!=opts.optionalmarker.end)||escaped){var maskdef=opts.definitions[element];if(maskdef&&!escaped){for(var i=0;i<maskdef.cardinality;i++){outElem.push(getPlaceHolder(outCount+i));}}else{outElem.push(element);escaped=false;}
outCount+=outElem.length;return outElem;}});var repeatedMask=singleMask.slice();for(var i=1;i<opts.repeat&&opts.greedy;i++){repeatedMask=repeatedMask.concat(singleMask.slice());}
return repeatedMask;}
function getTestingChain(){var isOptional=false,escaped=false;var newBlockMarker=false;return $.map(opts.mask.split(""),function(element,index){var outElem=[];if(element==opts.escapeChar){escaped=true;}else if(element==opts.optionalmarker.start&&!escaped){isOptional=true;newBlockMarker=true;}
else if(element==opts.optionalmarker.end&&!escaped){isOptional=false;newBlockMarker=true;}
else{var maskdef=opts.definitions[element];if(maskdef&&!escaped){var prevalidators=maskdef["prevalidator"],prevalidatorsL=prevalidators?prevalidators.length:0;for(var i=1;i<maskdef.cardinality;i++){var prevalidator=prevalidatorsL>=i?prevalidators[i-1]:[],validator=prevalidator["validator"],cardinality=prevalidator["cardinality"];outElem.push({fn:validator?typeof validator=='string'?new RegExp(validator):new function(){this.test=validator;}:new RegExp("."),cardinality:cardinality?cardinality:1,optionality:isOptional,newBlockMarker:isOptional==true?newBlockMarker:false,offset:0,casing:maskdef["casing"],def:element});if(isOptional==true)
newBlockMarker=false;}
outElem.push({fn:maskdef.validator?typeof maskdef.validator=='string'?new RegExp(maskdef.validator):new function(){this.test=maskdef.validator;}:new RegExp("."),cardinality:maskdef.cardinality,optionality:isOptional,newBlockMarker:newBlockMarker,offset:0,casing:maskdef["casing"],def:element});}else{outElem.push({fn:null,cardinality:0,optionality:isOptional,newBlockMarker:newBlockMarker,offset:0,casing:null,def:element});escaped=false;}
newBlockMarker=false;return outElem;}});}
function isValid(pos,c,buffer,strict){if(pos<0||pos>=getMaskLength())return false;var testPos=determineTestPosition(pos),loopend=c?1:0,chrs='';for(var i=tests[testPos].cardinality;i>loopend;i--){chrs+=getBufferElement(buffer,testPos-(i-1));}
if(c){chrs+=c;}
return tests[testPos].fn!=null?tests[testPos].fn.test(chrs,buffer,pos,strict,opts):false;}
function isMask(pos){var testPos=determineTestPosition(pos);var test=tests[testPos];return test!=undefined?test.fn:false;}
function determineTestPosition(pos){return pos%tests.length;}
function getPlaceHolder(pos){return opts.placeholder.charAt(pos%opts.placeholder.length);}
function getMaskLength(){var calculatedLength=_buffer.length;if(!opts.greedy&&opts.repeat>1){calculatedLength+=(_buffer.length*(opts.repeat-1));}
return calculatedLength;}
function seekNext(buffer,pos){var maskL=getMaskLength();if(pos>=maskL)return maskL;var position=pos;while(++position<maskL&&!isMask(position)){};return position;}
function seekPrevious(buffer,pos){var position=pos;if(position<=0)return 0;while(--position>0&&!isMask(position)){};return position;}
function setBufferElement(buffer,position,element){var test=tests[determineTestPosition(position)];var elem=element;if(elem!=undefined){switch(test.casing){case"upper":elem=element.toUpperCase();break;case"lower":elem=element.toLowerCase();break;}}
buffer[position]=elem;}
function getBufferElement(buffer,position,autoPrepare){if(autoPrepare)position=prepareBuffer(buffer,position);return buffer[position];}
function prepareBuffer(buffer,position,isRTL){var j;if(isRTL){while(position<0&&buffer.length<getMaskLength()){j=_buffer.length-1;position=_buffer.length;while(_buffer[j]!==undefined){buffer.unshift(_buffer[j--]);}}}else{while(buffer[position]==undefined&&buffer.length<getMaskLength()){j=0;while(_buffer[j]!==undefined){buffer.push(_buffer[j++]);}}}
return position;}
function writeBuffer(input,buffer,caretPos){input._valueSet(buffer.join(''));if(caretPos!=undefined){if(android){setTimeout(function(){caret(input,caretPos);},100);}
else caret(input,caretPos);}};function clearBuffer(buffer,start,end){for(var i=start,maskL=getMaskLength();i<end&&i<maskL;i++){setBufferElement(buffer,i,getBufferElement(_buffer.slice(),i));}};function setReTargetPlaceHolder(buffer,pos){var testPos=determineTestPosition(pos);setBufferElement(buffer,pos,getBufferElement(_buffer,testPos));}
function checkVal(input,buffer,clearInvalid,skipRadixHandling){var isRTL=$(input).data('inputmask')['isRTL'],inputValue=truncateInput(input._valueGet(),isRTL).split('');if(isRTL){var maskL=getMaskLength();var inputValueRev=inputValue.reverse();inputValueRev.length=maskL;for(var i=0;i<maskL;i++){var targetPosition=determineTestPosition(maskL-(i+1));if(tests[targetPosition].fn==null&&inputValueRev[i]!=getBufferElement(_buffer,targetPosition)){inputValueRev.splice(i,0,getBufferElement(_buffer,targetPosition));inputValueRev.length=maskL;}else{inputValueRev[i]=inputValueRev[i]||getBufferElement(_buffer,targetPosition);}}
inputValue=inputValueRev.reverse();}
clearBuffer(buffer,0,buffer.length);buffer.length=_buffer.length;var lastMatch=-1,checkPosition=-1,np,maskL=getMaskLength(),ivl=inputValue.length,rtlMatch=ivl==0?maskL:-1;for(var i=0;i<ivl;i++){for(var pos=checkPosition+1;pos<maskL;pos++){if(isMask(pos)){var c=inputValue[i];if((np=isValid(pos,c,buffer,!clearInvalid))!==false){if(np!==true){pos=np.pos||pos;c=np.c||c;}
setBufferElement(buffer,pos,c);lastMatch=checkPosition=pos;}else{setReTargetPlaceHolder(buffer,pos);if(c==getPlaceHolder(pos)){checkPosition=pos;rtlMatch=pos;}}
break;}else{setReTargetPlaceHolder(buffer,pos);if(lastMatch==checkPosition)
lastMatch=pos;checkPosition=pos;if(inputValue[i]==getBufferElement(buffer,pos))
break;}}}
if(opts.greedy==false){var newBuffer=truncateInput(buffer.join(''),isRTL).split('');while(buffer.length!=newBuffer.length){isRTL?buffer.shift():buffer.pop();}}
if(clearInvalid){writeBuffer(input,buffer);}
return isRTL?(opts.numericInput?($.inArray(opts.radixPoint,buffer)!=-1&&skipRadixHandling!==true?$.inArray(opts.radixPoint,buffer):seekNext(buffer,maskL)):seekNext(buffer,rtlMatch)):seekNext(buffer,lastMatch);}
function escapeRegex(str){var specials=['/','.','*','+','?','|','(',')','[',']','{','}','\\'];return str.replace(new RegExp('(\\'+specials.join('|\\')+')','gim'),'\\$1');}
function truncateInput(inputValue,rtl){return rtl?inputValue.replace(new RegExp("^("+escapeRegex(_buffer.join(''))+")*"),""):inputValue.replace(new RegExp("("+escapeRegex(_buffer.join(''))+")*$"),"");}
function clearOptionalTail(input,buffer){checkVal(input,buffer,false);var tmpBuffer=buffer.slice();if($(input).data('inputmask')['isRTL']){for(var pos=0;pos<=tmpBuffer.length-1;pos++){var testPos=determineTestPosition(pos);if(tests[testPos].optionality){if(getPlaceHolder(pos)==buffer[pos]||!isMask(pos))
tmpBuffer.splice(0,1);else break;}else break;}}else{for(var pos=tmpBuffer.length-1;pos>=0;pos--){var testPos=determineTestPosition(pos);if(tests[testPos].optionality){if(getPlaceHolder(pos)==buffer[pos]||!isMask(pos))
tmpBuffer.pop();else break;}else break;}}
writeBuffer(input,tmpBuffer);}
function unmaskedvalue($input,skipDatepickerCheck){var input=$input[0];if(tests&&(skipDatepickerCheck===true||!$input.hasClass('hasDatepicker'))){var buffer=_buffer.slice();checkVal(input,buffer);return $.map(buffer,function(element,index){return isMask(index)&&element!=getBufferElement(_buffer.slice(),index)?element:null;}).join('');}
else{return input._valueGet();}}
function caret(input,begin,end){var npt=input.jws&&input.length>0?input[0]:input;if(typeof begin=='number'){end=(typeof end=='number')?end:begin;if(opts.insertMode==false&&begin==end)end++;if(npt.setSelectionRange){npt.setSelectionRange(begin,end);}else if(npt.createTextRange){var range=npt.createTextRange();range.collapse(true);range.moveEnd('character',end);range.moveStart('character',begin);range.select();}
npt.focus();if(android&&end!=npt.selectionEnd)caretposCorrection={begin:begin,end:end};}else{var caretpos=android?caretposCorrection:null,caretposCorrection=null;if(caretpos==null){if(npt.setSelectionRange){begin=npt.selectionStart;end=npt.selectionEnd;}else if(document.selection&&document.selection.createRange){var range=document.selection.createRange();begin=0-range.duplicate().moveStart('character',-100000);end=begin+range.text.length;}
caretpos={begin:begin,end:end};}
return caretpos;}};function mask(el){var $input=$(el);if(!$input.is(":input"))return;opts.greedy=opts.greedy?opts.greedy:opts.repeat==0;var maxLength=$input.prop('maxLength');if(getMaskLength()>maxLength&&maxLength>-1){if(maxLength<_buffer.length)_buffer.length=maxLength;if(opts.greedy==false){opts.repeat=Math.round(maxLength/_buffer.length);}}
$input.prop('maxLength',getMaskLength()*2);$input.data('inputmask',{'tests':tests,'_buffer':_buffer,'greedy':opts.greedy,'repeat':opts.repeat,'autoUnmask':opts.autoUnmask,'definitions':opts.definitions,'isRTL':false});patchValueProperty(el);var buffer=_buffer.slice(),undoBuffer=el._valueGet(),skipKeyPressEvent=false,ignorable=false,lastPosition=-1,firstMaskPos=seekNext(buffer,-1),lastMaskPos=seekPrevious(buffer,getMaskLength()),isRTL=false;if(el.dir=="rtl"||opts.numericInput){el.dir="ltr"
$input.css("text-align","right");$input.removeAttr("dir");var inputData=$input.data('inputmask');inputData['isRTL']=true;$input.data('inputmask',inputData);isRTL=true;}
$input.unbind(".inputmask");$input.removeClass('focus.inputmask');$input.bind("mouseenter.inputmask",function(){var $input=$(this),input=this;if(!$input.hasClass('focus.inputmask')&&opts.showMaskOnHover){var nptL=input._valueGet().length;if(nptL<buffer.length){if(nptL==0)
buffer=_buffer.slice();writeBuffer(input,buffer);}}}).bind("blur.inputmask",function(){var $input=$(this),input=this,nptValue=input._valueGet();$input.removeClass('focus.inputmask');if(nptValue!=undoBuffer){$input.change();}
if(opts.clearMaskOnLostFocus){if(nptValue==_buffer.join(''))
input._valueSet('');else{clearOptionalTail(input,buffer);}}
if(!isComplete(input)){$input.trigger("incomplete");if(opts.clearIncomplete){if(opts.clearMaskOnLostFocus)
input._valueSet('');else{buffer=_buffer.slice();writeBuffer(input,buffer);}}}}).bind("focus.inputmask",function(){var $input=$(this),input=this;if(!$input.hasClass('focus.inputmask')&&!opts.showMaskOnHover){var nptL=input._valueGet().length;if(nptL<buffer.length){if(nptL==0)
buffer=_buffer.slice();caret(input,checkVal(input,buffer,true));}}
$input.addClass('focus.inputmask');undoBuffer=input._valueGet();}).bind("mouseleave.inputmask",function(){var $input=$(this),input=this;if(opts.clearMaskOnLostFocus){if(!$input.hasClass('focus.inputmask')){if(input._valueGet()==_buffer.join('')||input._valueGet()=='')
input._valueSet('');else{clearOptionalTail(input,buffer);}}}}).bind("click.inputmask",function(){var input=this;setTimeout(function(){var selectedCaret=caret(input);if(selectedCaret.begin==selectedCaret.end){var clickPosition=selectedCaret.begin;lastPosition=checkVal(input,buffer,false);if(isRTL)
caret(input,clickPosition>lastPosition&&(isValid(clickPosition,buffer[clickPosition],buffer,true)!==false||!isMask(clickPosition))?clickPosition:lastPosition);else
caret(input,clickPosition<lastPosition&&(isValid(clickPosition,buffer[clickPosition],buffer,true)!==false||!isMask(clickPosition))?clickPosition:lastPosition);}},0);}).bind('dblclick.inputmask',function(){var input=this;setTimeout(function(){caret(input,0,lastPosition);},0);}).bind("keydown.inputmask",keydownEvent).bind("keypress.inputmask",keypressEvent).bind("keyup.inputmask",keyupEvent).bind(pasteEvent+".inputmask, dragdrop.inputmask, drop.inputmask",function(){var input=this;setTimeout(function(){caret(input,checkVal(input,buffer,true));},0);}).bind('setvalue.inputmask',function(){var input=this;undoBuffer=input._valueGet();checkVal(input,buffer,true);if(input._valueGet()==_buffer.join(''))
input._valueSet('');}).bind('complete.inputmask',opts.oncomplete).bind('incomplete.inputmask',opts.onincomplete).bind('cleared.inputmask',opts.oncleared);lastPosition=checkVal(el,buffer,true);var activeElement;try{activeElement=document.activeElement;}catch(e){}
if(activeElement===el){$input.addClass('focus.inputmask');caret(el,lastPosition);}else if(opts.clearMaskOnLostFocus){if(el._valueGet()==_buffer.join('')){el._valueSet('');}else{clearOptionalTail(el,buffer);}}
installEventRuler(el);function isComplete(npt){var complete=true,nptValue=npt._valueGet(),ml=nptValue.length;for(var i=0;i<ml;i++){if(isMask(i)&&nptValue.charAt(i)==getPlaceHolder(i)){complete=false;break;}}
return complete;}
function installEventRuler(npt){var events=$._data(npt).events;$.each(events,function(eventType,eventHandlers){$(npt).bind(eventType+".inputmask",function(event){if(this.readOnly||this.disabled){event.stopPropagation();event.stopImmediatePropagation();event.preventDefault();return false;}});var ourHandler=eventHandlers[eventHandlers.length-1];for(var i=eventHandlers.length-1;i>0;i--){eventHandlers[i]=eventHandlers[i-1];}
eventHandlers[0]=ourHandler;});}
function patchValueProperty(npt){var valueProperty;if(Object.getOwnPropertyDescriptor)
valueProperty=Object.getOwnPropertyDescriptor(npt,"value");if(valueProperty&&valueProperty.get){if(!npt._valueGet){npt._valueGet=valueProperty.get;npt._valueSet=valueProperty.set;Object.defineProperty(npt,"value",{get:function(){var $self=$(this),inputData=$(this).data('inputmask');return inputData&&inputData['autoUnmask']?$self.inputmask('unmaskedvalue'):this._valueGet()!=inputData['_buffer'].join('')?this._valueGet():'';},set:function(value){this._valueSet(value);$(this).triggerHandler('setvalue.inputmask');}});}}else if(document.__lookupGetter__&&npt.__lookupGetter__("value")){if(!npt._valueGet){npt._valueGet=npt.__lookupGetter__("value");npt._valueSet=npt.__lookupSetter__("value");npt.__defineGetter__("value",function(){var $self=$(this),inputData=$(this).data('inputmask');return inputData&&inputData['autoUnmask']?$self.inputmask('unmaskedvalue'):this._valueGet()!=inputData['_buffer'].join('')?this._valueGet():'';});npt.__defineSetter__("value",function(value){this._valueSet(value);$(this).triggerHandler('setvalue.inputmask');});}}else{if(!npt._valueGet){npt._valueGet=function(){return this.value;}
npt._valueSet=function(value){this.value=value;}}
if($.fn.val.inputmaskpatch!=true){$.fn.val=function(){if(arguments.length==0){var $self=$(this);if($self.data('inputmask')){if($self.data('inputmask')['autoUnmask'])
return $self.inputmask('unmaskedvalue');else{var result=$.inputmask.val.apply($self);return result!=$self.data('inputmask')['_buffer'].join('')?result:'';}}else return $.inputmask.val.apply($self);}else{var args=arguments;return this.each(function(){var $self=$(this);var result=$.inputmask.val.apply($self,args);if($self.data('inputmask'))$self.triggerHandler('setvalue.inputmask');return result;});}};$.extend($.fn.val,{inputmaskpatch:true});}}}
function shiftL(start,end,c){while(!isMask(start)&&start-1>=0)start--;for(var i=start;i<end&&i<getMaskLength();i++){if(isMask(i)){setReTargetPlaceHolder(buffer,i);var j=seekNext(buffer,i);var p=getBufferElement(buffer,j);if(p!=getPlaceHolder(j)){if(j<getMaskLength()&&isValid(i,p,buffer,true)!==false&&tests[determineTestPosition(i)].def==tests[determineTestPosition(j)].def){setBufferElement(buffer,i,getBufferElement(buffer,j));setReTargetPlaceHolder(buffer,j);}else{if(isMask(i))
break;}}else if(c==undefined)break;}else{setReTargetPlaceHolder(buffer,i);}}
if(c!=undefined)
setBufferElement(buffer,isRTL?end:seekPrevious(buffer,end),c);buffer=truncateInput(buffer.join(''),isRTL).split('');if(buffer.length==0)buffer=_buffer.slice();return start;}
function shiftR(start,end,c,full){for(var i=start;i<=end&&i<getMaskLength();i++){if(isMask(i)){var t=getBufferElement(buffer,i);setBufferElement(buffer,i,c);if(t!=getPlaceHolder(i)){var j=seekNext(buffer,i);if(j<getMaskLength()){if(isValid(j,t,buffer,true)!==false&&tests[determineTestPosition(i)].def==tests[determineTestPosition(j)].def)
c=t;else{if(isMask(j))
break;else c=t;}}else break;}else if(full!==true)break;}else
setReTargetPlaceHolder(buffer,i);}
var lengthBefore=buffer.length;buffer=truncateInput(buffer.join(''),isRTL).split('');if(buffer.length==0)buffer=_buffer.slice();return end-(lengthBefore-buffer.length);};function keydownEvent(e){skipKeyPressEvent=false;var input=this,k=e.keyCode,pos=caret(input);if(opts.numericInput){var nptStr=input._valueGet();var radixPosition=nptStr.indexOf(opts.radixPoint);if(radixPosition!=-1){isRTL=pos.begin<=radixPosition||pos.end<=radixPosition;}}
if(k==opts.keyCode.BACKSPACE||k==opts.keyCode.DELETE||(iphone&&k==127)){var maskL=getMaskLength();if(pos.begin==0&&pos.end==maskL){buffer=_buffer.slice();writeBuffer(input,buffer);caret(input,checkVal(input,buffer,false));}else if((pos.end-pos.begin)>1||((pos.end-pos.begin)==1&&opts.insertMode)){clearBuffer(buffer,pos.begin,pos.end);writeBuffer(input,buffer,isRTL?checkVal(input,buffer,false):pos.begin);}else{var beginPos=pos.begin-(k==opts.keyCode.DELETE?0:1);if(beginPos<firstMaskPos&&k==opts.keyCode.DELETE){beginPos=firstMaskPos;}
if(beginPos>=firstMaskPos){if(opts.numericInput&&opts.greedy&&k==opts.keyCode.DELETE&&buffer[beginPos]==opts.radixPoint){beginPos=seekNext(buffer,beginPos);isRTL=false;}
if(isRTL){beginPos=shiftR(firstMaskPos,beginPos,getPlaceHolder(beginPos),true);beginPos=(opts.numericInput&&opts.greedy&&k==opts.keyCode.BACKSPACE&&buffer[beginPos+1]==opts.radixPoint)?beginPos+1:seekNext(buffer,beginPos);}else beginPos=shiftL(beginPos,maskL);writeBuffer(input,buffer,beginPos);}}
if(input._valueGet()==_buffer.join(''))
$(input).trigger('cleared');return false;}else if(k==opts.keyCode.END||k==opts.keyCode.PAGE_DOWN){setTimeout(function(){var caretPos=checkVal(input,buffer,false,true);if(!opts.insertMode&&caretPos==getMaskLength()&&!e.shiftKey)caretPos--;caret(input,e.shiftKey?pos.begin:caretPos,caretPos);},0);return false;}else if(k==opts.keyCode.HOME||k==opts.keyCode.PAGE_UP){caret(input,0,e.shiftKey?pos.begin:0);return false;}
else if(k==opts.keyCode.ESCAPE){input._valueSet(undoBuffer);caret(input,0,checkVal(input,buffer));return false;}else if(k==opts.keyCode.INSERT){opts.insertMode=!opts.insertMode;caret(input,!opts.insertMode&&pos.begin==getMaskLength()?pos.begin-1:pos.begin);return false;}else if(e.ctrlKey&&k==88){setTimeout(function(){caret(input,checkVal(input,buffer,true));},0);}else if(!opts.insertMode){if(k==opts.keyCode.RIGHT){var caretPos=pos.begin==pos.end?pos.end+1:pos.end;caretPos=caretPos<getMaskLength()?caretPos:pos.end;caret(input,e.shiftKey?pos.begin:caretPos,e.shiftKey?caretPos+1:caretPos);return false;}else if(k==opts.keyCode.LEFT){var caretPos=pos.begin-1;caretPos=caretPos>0?caretPos:0;caret(input,caretPos,e.shiftKey?pos.end:caretPos);return false;}}
opts.onKeyDown.call(this,e,opts);ignorable=$.inArray(k,opts.ignorables)!=-1;}
function keypressEvent(e){if(skipKeyPressEvent)return false;skipKeyPressEvent=true;var input=this,$input=$(input);e=e||window.event;var k=e.which||e.charCode||e.keyCode;if(opts.numericInput&&k==opts.radixPoint.charCodeAt(opts.radixPoint.length-1)){var nptStr=input._valueGet();var radixPosition=nptStr.indexOf(opts.radixPoint);caret(input,seekNext(buffer,radixPosition!=-1?radixPosition:getMaskLength()));}
if(e.ctrlKey||e.altKey||e.metaKey||ignorable){return true;}else{if(k){$input.trigger('input');var pos=caret(input),c=String.fromCharCode(k),maskL=getMaskLength();clearBuffer(buffer,pos.begin,pos.end);if(isRTL){var p=opts.numericInput?pos.end:seekPrevious(buffer,pos.end),np;if((np=isValid(p==maskL||getBufferElement(buffer,p)==opts.radixPoint?seekPrevious(buffer,p):p,c,buffer,false))!==false){if(np!==true){p=np.pos||pos;c=np.c||c;}
var firstUnmaskedPosition=firstMaskPos;if(opts.insertMode==true){if(opts.greedy==true){var bfrClone=buffer.slice();while(getBufferElement(bfrClone,firstUnmaskedPosition,true)!=getPlaceHolder(firstUnmaskedPosition)&&firstUnmaskedPosition<=p){firstUnmaskedPosition=firstUnmaskedPosition==maskL?(maskL+1):seekNext(buffer,firstUnmaskedPosition);}}
if(firstUnmaskedPosition<=p&&(opts.greedy||buffer.length<maskL)){if(buffer[firstMaskPos]!=getPlaceHolder(firstMaskPos)&&buffer.length<maskL){var offset=prepareBuffer(buffer,-1,isRTL);if(pos.end!=0)p=p+offset;maskL=buffer.length;}
shiftL(firstUnmaskedPosition,opts.numericInput?seekPrevious(buffer,p):p,c);}else return false;}else setBufferElement(buffer,opts.numericInput?seekPrevious(buffer,p):p,c);writeBuffer(input,buffer,opts.numericInput&&p==0?seekNext(buffer,p):p);setTimeout(function(){if(isComplete(input))
$input.trigger("complete");},0);}else if(android)writeBuffer(input,buffer,pos.begin);}
else{var p=seekNext(buffer,pos.begin-1),np;prepareBuffer(buffer,p,isRTL);if((np=isValid(p,c,buffer,false))!==false){if(np!==true){p=np.pos||p;c=np.c||c;}
if(opts.insertMode==true){var lastUnmaskedPosition=getMaskLength();var bfrClone=buffer.slice();while(getBufferElement(bfrClone,lastUnmaskedPosition,true)!=getPlaceHolder(lastUnmaskedPosition)&&lastUnmaskedPosition>=p){lastUnmaskedPosition=lastUnmaskedPosition==0?-1:seekPrevious(buffer,lastUnmaskedPosition);}
if(lastUnmaskedPosition>=p)
shiftR(p,buffer.length,c);else return false;}
else setBufferElement(buffer,p,c);var next=seekNext(buffer,p);writeBuffer(input,buffer,next);setTimeout(function(){if(isComplete(input))
$input.trigger("complete");},0);}else if(android)writeBuffer(input,buffer,pos.begin);}
return false;}}}
function keyupEvent(e){var $input=$(this),input=this;var k=e.keyCode;opts.onKeyUp.call(this,e,opts);if(k==opts.keyCode.TAB&&$input.hasClass('focus.inputmask')&&input._valueGet().length==0){buffer=_buffer.slice();writeBuffer(input,buffer);if(!isRTL)caret(input,0);undoBuffer=input._valueGet();}}}};}})(jWS);(function(t){function e(e){return u?e.data("events"):t._data(e[0]).events}function n(t,n,r){var i=e(t),a=i[n];if(!u){var s=r?a.splice(a.delegateCount-1,1)[0]:a.pop();return a.splice(r?0:a.delegateCount||0,0,s),void 0}r?i.live.unshift(i.live.pop()):a.unshift(a.pop())}function r(e,r,i){var a=r.split(/\s+/);e.each(function(){for(var e=0;a.length>e;++e){var r=t.trim(a[e]).match(/[^\.]+/i)[0];n(t(this),r,i)}})}function i(e){t.fn[e+"First"]=function(){var n=t.makeArray(arguments),i=n.shift();return i&&(t.fn[e].apply(this,arguments),r(this,i)),this}}var a=t.fn.jws.split("."),s=parseInt(a[0]),f=parseInt(a[1]),u=1>s||1==s&&7>f;i("bind"),i("one"),t.fn.delegateFirst=function(){var e=t.makeArray(arguments),n=e[1];return n&&(e.splice(0,2),t.fn.delegate.apply(this,arguments),r(this,n,!0)),this},t.fn.liveFirst=function(){var e=t.makeArray(arguments);return e.unshift(this.selector),t.fn.delegateFirst.apply(t(document),e),this},u||(t.fn.onFirst=function(e,n){var i=t(this),a="string"==typeof n;if(t.fn.on.apply(i,arguments),"object"==typeof e)for(type in e)e.hasOwnProperty(type)&&r(i,type,a);else"string"==typeof e&&r(i,e,a);return i})})(jWS);(function($){$.masksLoad=function(url){var maskList;$.ajax({url:url,async:false,dataType:'json',success:function(response){maskList=response;}});return maskList;}
$.masksSort=function(maskList,defs,match,key){maskList.sort(function(a,b){var ia=0,ib=0;for(;(ia<a[key].length&&ib<b[key].length);){var cha=a[key].charAt(ia);var chb=b[key].charAt(ib);if(!match.test(cha)){ia++;continue;}
if(!match.test(chb)){ib++;continue;}
if($.inArray(cha,defs)!=-1&&$.inArray(chb,defs)==-1){return 1;}
if($.inArray(cha,defs)==-1&&$.inArray(chb,defs)!=-1){return-1;}
if($.inArray(cha,defs)==-1&&$.inArray(chb,defs)==-1){if(cha!=chb){return cha<chb?-1:1;}}
ia++;ib++;}
for(;(ia<a[key].length||ib<b[key].length);){if(ia<a[key].length&&!match.test(a[key].charAt(ia))){ia++;continue;}
if(ib<b[key].length&&!match.test(b[key].charAt(ib))){ib++;continue;}
if(ia<a[key].length){return 1;}
if(ib<b[key].length){return-1;}}
return 0;});return maskList;}
$.fn.inputmasks=function(maskOpts,mode){var caret=function(begin,end){if(typeof begin=='number'){end=(typeof end=='number')?end:begin;if(this.setSelectionRange){this.setSelectionRange(begin,end);}else if(this.createTextRange){var range=this.createTextRange();range.collapse(true);range.moveEnd('character',end);range.moveStart('character',begin);range.select();}}else{if(this.setSelectionRange){begin=this.selectionStart;end=this.selectionEnd;}else if(document.selection&&document.selection.createRange){var range=document.selection.createRange();begin=0-range.duplicate().moveStart('character',-100000);end=begin+range.text.length;}
return{begin:begin,end:end};}};var keys=Object.keys||function(obj){if(obj!==Object(obj)){throw new TypeError('Invalid object');}
var keys=[];for(var key in obj){keys[keys.length]=key;}
return keys;};maskOpts=$.extend(true,{onMaskChange:$.noop},maskOpts);var defs={};for(var def in maskOpts.inputmask.definitions){var validator=maskOpts.inputmask.definitions[def].validator;switch(typeof validator){case"string":defs[def]=new RegExp(validator);break;case"object":if("test"in maskOpts.definitions[def].validator){defs[def]=validator;}
break;case"function":defs[def]={test:validator};break;}}
maskOpts.inputmask.definitions[maskOpts.replace]={validator:maskOpts.match.source,cardinality:1};var iphone=navigator.userAgent.match(/iphone/i)!=null;var oldmatch=false;var placeholder=$.extend(true,{},$.inputmask.defaults,maskOpts.inputmask).placeholder;var insertMode=$.extend(true,{},$.inputmask.defaults,maskOpts.inputmask).insertMode;var maskMatch=function(text){var mtxt="";for(var i=0;i<text.length;i++){var ch=text.charAt(i);if(ch==placeholder){break;}
if(maskOpts.match.test(ch)){mtxt+=ch;}}
for(var mid in maskOpts.list){var mask=maskOpts.list[mid][maskOpts.listKey];var pass=true;if(typeof(mask)!='string'){return false;}
for(var it=0,im=0;(it<mtxt.length&&im<mask.length);){var chm=mask.charAt(im);var cht=mtxt.charAt(it);if(!maskOpts.match.test(chm)&&!(chm in defs)){im++;continue;}
if(((chm in defs)&&defs[chm].test(cht))||(cht==chm)){it++;im++;}else{pass=false;break;}}
if(pass&&it==mtxt.length){var determined=mask.substr(im).search(maskOpts.match)==-1;mask=mask.replace(new RegExp([maskOpts.match.source].concat(keys(defs)).join('|'),'g'),maskOpts.replace);var completed=mask.substr(im).search(maskOpts.replace)==-1;return{mask:mask,obj:maskOpts.list[mid],determined:determined,completed:completed};}}
return false;}
var caretApply=function(oldMask,newMask,oldPos){if(!oldMask){return 0;}
var pos=0,startPos=0;for(;pos<oldPos.begin;pos++){if(oldMask.charAt(pos)==maskOpts.replace){startPos++;}}
var endPos=0;for(;pos<oldPos.end;pos++){if(oldMask.charAt(pos)==maskOpts.replace){endPos++;}}
for(pos=0;(pos<newMask.length&&(startPos>0||newMask.charAt(pos)!=maskOpts.replace));pos++){if(newMask.charAt(pos)==maskOpts.replace){startPos--;}}
startPos=pos;for(;(pos<newMask.length&&endPos>0);pos++){if(newMask.charAt(pos)==maskOpts.replace){endPos--;}}
endPos=pos;return{begin:startPos,end:endPos};}
var maskUnbind=function(){$(this).unbind("keypress.inputmask",masksKeyPress).unbind("input.inputmask",masksPaste).unbind("paste.inputmask",masksPaste).unbind("dragdrop.inputmask",masksPaste).unbind("drop.inputmask",masksPaste).unbind("keydown.inputmask",masksKeyDown).unbind("setvalue.inputmask",masksSetValue).unbind("blur.inputmask",masksChange);}
var maskRebind=function(){maskUnbind.call(this);$(this).bindFirst("keypress.inputmask",masksKeyPress).bindFirst("input.inputmask",masksPaste).bindFirst("paste.inputmask",masksPaste).bindFirst("dragdrop.inputmask",masksPaste).bindFirst("drop.inputmask",masksPaste).bindFirst("keydown.inputmask",masksKeyDown).bindFirst("setvalue.inputmask",masksSetValue).bind("blur.inputmask",masksChange);}
var maskApply=function(match,newtext){if(match&&(newtext||match.mask!=oldmatch.mask)){var caretPos;if(!newtext){caretPos=caretApply(oldmatch.mask,match.mask,caret.call(this));}
if(newtext){if(this._valueSet){this._valueSet(newtext);}else{this.value=newtext;}}
$(this).inputmask(match.mask,$.extend(true,maskOpts.inputmask,{insertMode:insertMode}));if(!newtext){caret.call(this,caretPos.begin,caretPos.end);}}
oldmatch=match;maskOpts.onMaskChange.call(this,match.obj,match.determined);return true;}
var keyboardApply=function(e,text,insert){var match=maskMatch(text);if(!match||match.obj!=oldmatch.obj||match.determined!=oldmatch.determined){if(match){maskUnbind.call(this);if(insert){maskApply.call(this,match);$(this).trigger(e);}else{$(this).trigger(e);maskApply.call(this,match);}
maskRebind.call(this);}
e.stopImmediatePropagation();return false;}
return true;}
var masksKeyDown=function(e){e=e||window.event;var k=e.which||e.charCode||e.keyCode;if(k==8||k==46||(iphone&&k==127)){var text=this._valueGet();var caretPos=caret.call(this);if(caretPos.begin==caretPos.end||(!insertMode&&caretPos.begin==caretPos.end-1)){var pos=caretPos.begin;do{if(k!=46){pos--;}
var chr=text.charAt(pos);text=text.substring(0,pos)+text.substring(pos+1);}while(pos>0&&pos<text.length&&chr!=placeholder&&!maskOpts.match.test(chr));}else{var test=text.substring(0,caretPos.begin)+text.substring(caretPos.end);if(test.search(maskOpts.match)==-1){text=test;}}
return keyboardApply.call(this,e,text,false);}
if(k==45){insertMode=!insertMode;}
return true;}
var masksKeyPress=function(e){var text=this._valueGet();e=e||window.event;var k=e.which||e.charCode||e.keyCode,c=String.fromCharCode(k);caretPos=caret.call(this);text=text.substring(0,caretPos.begin)+c+text.substring(caretPos.end);return keyboardApply.call(this,e,text,true);}
var masksChange=function(e){var match=maskMatch(this._valueGet());maskApply.call(this,match);maskRebind.call(this);return true;}
var masksSetValue=function(e){maskInit.call(this);e.stopImmediatePropagation();return true;}
var maskInit=function(){var text;if(this._valueGet){text=this._valueGet();}else{text=this.value;}
var match=maskMatch(text);while(!match&&text.length>0){text=text.substr(0,text.length-1);match=maskMatch(text);}
maskApply.call(this,match,text);maskRebind.call(this);}
var masksPaste=function(e){var input=this;setTimeout(function(){maskInit.call(input);},0);e.stopImmediatePropagation();return true;}
switch(mode){case"isCompleted":var res=maskMatch((this[0]._valueGet&&this[0]._valueGet())||this[0].value);return(res&&res.completed);default:this.each(function(){maskInit.call(this);});return this;}}})(jWS);(function(factory){return factory(jWS,window,document);})(function($,window,document){"use strict";var BROWSER_IS_IE7,BROWSER_SCROLLBAR_WIDTH,DOMSCROLL,DOWN,DRAG,ENTER,KEYDOWN,KEYUP,MOUSEDOWN,MOUSEENTER,MOUSEMOVE,MOUSEUP,MOUSEWHEEL,NanoScroll,PANEDOWN,RESIZE,SCROLL,SCROLLBAR,TOUCHMOVE,UP,WHEEL,cAF,defaults,getBrowserScrollbarWidth,hasTransform,isFFWithBuggyScrollbar,rAF,transform,_elementStyle,_prefixStyle,_vendor;defaults={paneClass:'nano-pane',sliderClass:'nano-slider',contentClass:'nano-content',iOSNativeScrolling:false,preventPageScrolling:false,disableResize:false,alwaysVisible:false,flashDelay:1500,sliderMinHeight:20,sliderMaxHeight:null,documentContext:null,windowContext:null};SCROLLBAR='scrollbar';SCROLL='scroll';MOUSEDOWN='mousedown';MOUSEENTER='mouseenter';MOUSEMOVE='mousemove';MOUSEWHEEL='mousewheel';MOUSEUP='mouseup';RESIZE='resize';DRAG='drag';ENTER='enter';UP='up';PANEDOWN='panedown';DOMSCROLL='DOMMouseScroll';DOWN='down';WHEEL='wheel';KEYDOWN='keydown';KEYUP='keyup';TOUCHMOVE='touchmove';BROWSER_IS_IE7=window.navigator.appName==='Microsoft Internet Explorer'&&/msie 7./i.test(window.navigator.appVersion)&&window.ActiveXObject;BROWSER_SCROLLBAR_WIDTH=null;rAF=window.requestAnimationFrame;cAF=window.cancelAnimationFrame;_elementStyle=document.createElement('div').style;_vendor=(function(){var i,transform,vendor,vendors,_i,_len;vendors=['t','webkitT','MozT','msT','OT'];for(i=_i=0,_len=vendors.length;_i<_len;i=++_i){vendor=vendors[i];transform=vendors[i]+'ransform';if(transform in _elementStyle){return vendors[i].substr(0,vendors[i].length-1);}}
return false;})();_prefixStyle=function(style){if(_vendor===false){return false;}
if(_vendor===''){return style;}
return _vendor+style.charAt(0).toUpperCase()+style.substr(1);};transform=_prefixStyle('transform');hasTransform=transform!==false;getBrowserScrollbarWidth=function(){var outer,outerStyle,scrollbarWidth;outer=document.createElement('div');outerStyle=outer.style;outerStyle.position='absolute';outerStyle.width='100px';outerStyle.height='100px';outerStyle.overflow=SCROLL;outerStyle.top='-9999px';document.body.appendChild(outer);scrollbarWidth=outer.offsetWidth-outer.clientWidth;document.body.removeChild(outer);return scrollbarWidth;};isFFWithBuggyScrollbar=function(){var isOSXFF,ua,version;ua=window.navigator.userAgent;isOSXFF=/(?=.+Mac OS X)(?=.+Firefox)/.test(ua);if(!isOSXFF){return false;}
version=/Firefox\/\d{2}\./.exec(ua);if(version){version=version[0].replace(/\D+/g,'');}
return isOSXFF&&+version>23;};NanoScroll=(function(){function NanoScroll(el,options){this.el=el;this.options=options;BROWSER_SCROLLBAR_WIDTH||(BROWSER_SCROLLBAR_WIDTH=getBrowserScrollbarWidth());this.$el=$(this.el);this.doc=$(this.options.documentContext||document);this.win=$(this.options.windowContext||window);this.body=this.doc.find('body');this.$content=this.$el.children("."+options.contentClass);this.$content.attr('tabindex',this.options.tabIndex||0);this.content=this.$content[0];this.previousPosition=0;if(this.options.iOSNativeScrolling&&(this.el.style.WebkitOverflowScrolling!=null)){this.nativeScrolling();}else{this.generate();}
this.createEvents();this.addEvents();this.reset();}
NanoScroll.prototype.preventScrolling=function(e,direction){if(!this.isActive){return;}
if(e.type===DOMSCROLL){if(direction===DOWN&&e.originalEvent.detail>0||direction===UP&&e.originalEvent.detail<0){e.preventDefault();}}else if(e.type===MOUSEWHEEL){if(!e.originalEvent||!e.originalEvent.wheelDelta){return;}
if(direction===DOWN&&e.originalEvent.wheelDelta<0||direction===UP&&e.originalEvent.wheelDelta>0){e.preventDefault();}}};NanoScroll.prototype.nativeScrolling=function(){this.$content.css({WebkitOverflowScrolling:'touch'});this.iOSNativeScrolling=true;this.isActive=true;};NanoScroll.prototype.updateScrollValues=function(){var content,direction;content=this.content;this.maxScrollTop=content.scrollHeight-content.clientHeight;this.prevScrollTop=this.contentScrollTop||0;this.contentScrollTop=content.scrollTop;direction=this.contentScrollTop>this.previousPosition?"down":this.contentScrollTop<this.previousPosition?"up":"same";this.previousPosition=this.contentScrollTop;if(direction!=="same"){this.$el.triggerHandler('update',{position:this.contentScrollTop,maximum:this.maxScrollTop,direction:direction});}
if(!this.iOSNativeScrolling){this.maxSliderTop=this.paneHeight-this.sliderHeight;this.sliderTop=this.maxScrollTop===0?0:this.contentScrollTop*this.maxSliderTop/this.maxScrollTop;}};NanoScroll.prototype.setOnScrollStyles=function(){var cssValue;if(hasTransform){cssValue={};cssValue[transform]="translate(0, "+this.sliderTop+"px)";}else{cssValue={top:this.sliderTop};}
if(rAF){if(cAF&&this.scrollRAF){cAF(this.scrollRAF);}
this.scrollRAF=rAF((function(_this){return function(){_this.scrollRAF=null;return _this.slider.css(cssValue);};})(this));}else{this.slider.css(cssValue);}};NanoScroll.prototype.createEvents=function(){this.events={down:(function(_this){return function(e){_this.isBeingDragged=true;_this.offsetY=e.pageY-_this.slider.offset().top;if(!_this.slider.is(e.target)){_this.offsetY=0;}
_this.pane.addClass('active');_this.doc.bind(MOUSEMOVE,_this.events[DRAG]).bind(MOUSEUP,_this.events[UP]);_this.body.bind(MOUSEENTER,_this.events[ENTER]);return false;};})(this),drag:(function(_this){return function(e){_this.sliderY=e.pageY-_this.$el.offset().top-_this.paneTop-(_this.offsetY||_this.sliderHeight*0.5);_this.scroll();if(_this.contentScrollTop>=_this.maxScrollTop&&_this.prevScrollTop!==_this.maxScrollTop){_this.$el.triggerHandler('scrollend');}else if(_this.contentScrollTop===0&&_this.prevScrollTop!==0){_this.$el.triggerHandler('scrolltop');}
return false;};})(this),up:(function(_this){return function(e){_this.isBeingDragged=false;_this.pane.removeClass('active');_this.doc.unbind(MOUSEMOVE,_this.events[DRAG]).unbind(MOUSEUP,_this.events[UP]);_this.body.unbind(MOUSEENTER,_this.events[ENTER]);return false;};})(this),resize:(function(_this){return function(e){_this.reset();};})(this),panedown:(function(_this){return function(e){_this.sliderY=(e.offsetY||e.originalEvent.layerY)-(_this.sliderHeight*0.5);_this.scroll();_this.events.down(e);return false;};})(this),scroll:(function(_this){return function(e){_this.updateScrollValues();if(_this.isBeingDragged){return;}
if(!_this.iOSNativeScrolling){_this.sliderY=_this.sliderTop;_this.setOnScrollStyles();}
if(e==null){return;}
if(_this.contentScrollTop>=_this.maxScrollTop){if(_this.options.preventPageScrolling){_this.preventScrolling(e,DOWN);}
if(_this.prevScrollTop!==_this.maxScrollTop){_this.$el.triggerHandler('scrollend');}}else if(_this.contentScrollTop===0){if(_this.options.preventPageScrolling){_this.preventScrolling(e,UP);}
if(_this.prevScrollTop!==0){_this.$el.triggerHandler('scrolltop');}}};})(this),wheel:(function(_this){return function(e){var delta;if(e==null){return;}
delta=e.delta||e.wheelDelta||(e.originalEvent&&e.originalEvent.wheelDelta)||-e.detail||(e.originalEvent&&-e.originalEvent.detail);if(delta){_this.sliderY+=-delta/3;}
_this.scroll();return false;};})(this),enter:(function(_this){return function(e){var _ref;if(!_this.isBeingDragged){return;}
if((e.buttons||e.which)!==1){return(_ref=_this.events)[UP].apply(_ref,arguments);}};})(this)};};NanoScroll.prototype.addEvents=function(){var events;this.removeEvents();events=this.events;if(!this.options.disableResize){this.win.bind(RESIZE,events[RESIZE]);}
if(!this.iOSNativeScrolling){this.slider.bind(MOUSEDOWN,events[DOWN]);this.pane.bind(MOUSEDOWN,events[PANEDOWN]).bind(""+MOUSEWHEEL+" "+DOMSCROLL,events[WHEEL]);}
this.$content.bind(""+SCROLL+" "+MOUSEWHEEL+" "+DOMSCROLL+" "+TOUCHMOVE,events[SCROLL]);};NanoScroll.prototype.removeEvents=function(){var events;events=this.events;this.win.unbind(RESIZE,events[RESIZE]);if(!this.iOSNativeScrolling){this.slider.unbind();this.pane.unbind();}
this.$content.unbind(""+SCROLL+" "+MOUSEWHEEL+" "+DOMSCROLL+" "+TOUCHMOVE,events[SCROLL]);};NanoScroll.prototype.generate=function(){var contentClass,cssRule,currentPadding,options,pane,paneClass,sliderClass;options=this.options;paneClass=options.paneClass,sliderClass=options.sliderClass,contentClass=options.contentClass;if(!(pane=this.$el.children("."+paneClass)).length&&!pane.children("."+sliderClass).length){this.$el.append("<div class=\""+paneClass+"\"><div class=\""+sliderClass+"\" /></div>");}
this.pane=this.$el.children("."+paneClass);this.slider=this.pane.find("."+sliderClass);if(BROWSER_SCROLLBAR_WIDTH===0&&isFFWithBuggyScrollbar()){currentPadding=window.getComputedStyle(this.content,null).getPropertyValue('padding-right').replace(/[^0-9.]+/g,'');cssRule={right:-14,paddingRight:+currentPadding+14};}else if(BROWSER_SCROLLBAR_WIDTH){cssRule={right:-BROWSER_SCROLLBAR_WIDTH};this.$el.addClass('has-scrollbar');}
if(cssRule!=null){this.$content.css(cssRule);}
return this;};NanoScroll.prototype.restore=function(){this.stopped=false;if(!this.iOSNativeScrolling){this.pane.show();}
this.addEvents();};NanoScroll.prototype.reset=function(){var content,contentHeight,contentPosition,contentStyle,contentStyleOverflowY,paneBottom,paneHeight,paneOuterHeight,paneTop,parentMaxHeight,right,sliderHeight;if(this.iOSNativeScrolling){this.contentHeight=this.content.scrollHeight;return;}
if(!this.$el.find("."+this.options.paneClass).length){this.generate().stop();}
if(this.stopped){this.restore();}
content=this.content;contentStyle=content.style;contentStyleOverflowY=contentStyle.overflowY;if(BROWSER_IS_IE7){this.$content.css({height:this.$content.height()});}
contentHeight=content.scrollHeight+BROWSER_SCROLLBAR_WIDTH;parentMaxHeight=parseInt(this.$el.css("max-height"),10);if(parentMaxHeight>0){this.$el.height("");this.$el.height(content.scrollHeight>parentMaxHeight?parentMaxHeight:content.scrollHeight);}
paneHeight=this.pane.outerHeight(false);paneTop=parseInt(this.pane.css('top'),10);paneBottom=parseInt(this.pane.css('bottom'),10);paneOuterHeight=paneHeight+paneTop+paneBottom;sliderHeight=Math.round(paneOuterHeight/contentHeight*paneOuterHeight);if(sliderHeight<this.options.sliderMinHeight){sliderHeight=this.options.sliderMinHeight;}else if((this.options.sliderMaxHeight!=null)&&sliderHeight>this.options.sliderMaxHeight){sliderHeight=this.options.sliderMaxHeight;}
if(contentStyleOverflowY===SCROLL&&contentStyle.overflowX!==SCROLL){sliderHeight+=BROWSER_SCROLLBAR_WIDTH;}
this.maxSliderTop=paneOuterHeight-sliderHeight;this.contentHeight=contentHeight;this.paneHeight=paneHeight;this.paneOuterHeight=paneOuterHeight;this.sliderHeight=sliderHeight;this.paneTop=paneTop;this.slider.height(sliderHeight);this.events.scroll();this.pane.show();this.isActive=true;if((content.scrollHeight===content.clientHeight)||(this.pane.outerHeight(true)>=content.scrollHeight&&contentStyleOverflowY!==SCROLL)){this.pane.hide();this.isActive=false;}else if(this.el.clientHeight===content.scrollHeight&&contentStyleOverflowY===SCROLL){this.slider.hide();}else{this.slider.show();}
this.pane.css({opacity:(this.options.alwaysVisible?1:''),visibility:(this.options.alwaysVisible?'visible':'')});contentPosition=this.$content.css('position');if(contentPosition==='static'||contentPosition==='relative'){right=parseInt(this.$content.css('right'),10);if(right){this.$content.css({right:'',marginRight:right});}}
return this;};NanoScroll.prototype.scroll=function(){if(!this.isActive){return;}
this.sliderY=Math.max(0,this.sliderY);this.sliderY=Math.min(this.maxSliderTop,this.sliderY);this.$content.scrollTop(this.maxScrollTop*this.sliderY/this.maxSliderTop);if(!this.iOSNativeScrolling){this.updateScrollValues();this.setOnScrollStyles();}
return this;};NanoScroll.prototype.scrollBottom=function(offsetY){if(!this.isActive){return;}
this.$content.scrollTop(this.contentHeight-this.$content.height()-offsetY).triggerHandler(MOUSEWHEEL);this.stop().restore();return this;};NanoScroll.prototype.scrollTop=function(offsetY){if(!this.isActive){return;}
this.$content.scrollTop(+offsetY).triggerHandler(MOUSEWHEEL);this.stop().restore();return this;};NanoScroll.prototype.scrollTo=function(node){if(!this.isActive){return;}
this.scrollTop(this.$el.find(node).get(0).offsetTop);return this;};NanoScroll.prototype.stop=function(){if(cAF&&this.scrollRAF){cAF(this.scrollRAF);this.scrollRAF=null;}
this.stopped=true;this.removeEvents();if(!this.iOSNativeScrolling){this.pane.hide();}
return this;};NanoScroll.prototype.destroy=function(){if(!this.stopped){this.stop();}
if(!this.iOSNativeScrolling&&this.pane.length){this.pane.remove();}
if(BROWSER_IS_IE7){this.$content.height('');}
this.$content.removeAttr('tabindex');if(this.$el.hasClass('has-scrollbar')){this.$el.removeClass('has-scrollbar');this.$content.css({right:''});}
return this;};NanoScroll.prototype.flash=function(){if(this.iOSNativeScrolling){return;}
if(!this.isActive){return;}
this.reset();this.pane.addClass('flashed');setTimeout((function(_this){return function(){_this.pane.removeClass('flashed');};})(this),this.options.flashDelay);return this;};return NanoScroll;})();$.fn.nanoScroller=function(settings){return this.each(function(){var options,scrollbar;if(!(scrollbar=this.nanoscroller)){options=$.extend({},defaults,settings);this.nanoscroller=scrollbar=new NanoScroll(this,options);}
if(settings&&typeof settings==="object"){$.extend(scrollbar.options,settings);if(settings.scrollBottom!=null){return scrollbar.scrollBottom(settings.scrollBottom);}
if(settings.scrollTop!=null){return scrollbar.scrollTop(settings.scrollTop);}
if(settings.scrollTo){return scrollbar.scrollTo(settings.scrollTo);}
if(settings.scroll==='bottom'){return scrollbar.scrollBottom(0);}
if(settings.scroll==='top'){return scrollbar.scrollTop(0);}
if(settings.scroll&&settings.scroll instanceof $){return scrollbar.scrollTo(settings.scroll);}
if(settings.stop){return scrollbar.stop();}
if(settings.destroy){return scrollbar.destroy();}
if(settings.flash){return scrollbar.flash();}}
return scrollbar.reset();});};$.fn.nanoScroller.Constructor=NanoScroll;});"use_strict";wsUtil=(function($){var _this=this;return{specialChars:function(text){return $('<div></div>').html(text).text();},giveGetParams:function(){aGetStr=location.search||'';aGetStr=aGetStr.replace('?','');var ret={};var getArr=aGetStr.split('&');if(getArr.length===0)
return ret;$.each(getArr,function(key,value){if(value){n=value.split('=');if(n.length===2)
ret[n[0]]=n[1];}});return ret;},setCookie:function(name,value,expires,path,domain,secure){if(!name||!value)
return false;if(!path)
path='/';var str=name+'='+encodeURIComponent(value);if(expires)
str+='; expires='+expires.toGMTString();if(path)
str+='; path='+path;if(domain)
str+='; domain='+domain;if(secure)
str+='; secure';document.cookie=str;return true;},getCookie:function(name){var pattern="(?:; )?"+name+"=([^;]*);?";var regexp=new RegExp(pattern);if(regexp.test(document.cookie))
return decodeURIComponent(RegExp["$1"]);return false;},deleteCookie:function(name,path,domain){if(!path){path='/';}
this.setCookie(name,'0',new Date(0),path,domain);return true;},isLocalStorageNameSupported:function(){var test='test_localstorage';try{window.localStorage.setItem(test,1);window.localStorage.removeItem(test);return true;}catch(error){this.log('localStorage недоступен');return false;}},setStorage:function(name,value){if(this.isLocalStorageNameSupported()){localStorage.setItem(name,value);}else{var d=new Date();d.setFullYear(d.getFullYear()+2);this.setCookie(name,value,d);}},getStorage:function(name){if(this.isLocalStorageNameSupported()){return localStorage.getItem(name);}else{return this.getCookie(name);}},deleteStorage:function(name){if(this.isLocalStorageNameSupported()){localStorage.removeItem(name);}else{this.deleteCookie(name);}},checkStorageTime:function(items){if(items.length==0){return;}
var now=new Date().getTime();$.each(items,function(index,value){var time=wsUtil.getStorage(value)?wsUtil.getStorage(value):0;if(time!=0&&time<now){wsUtil.deleteStorage(value);}});},doEnding:function(number,end1,end2,end3){number=''+number+'';if(number.charAt(number.length-2)&&number.charAt(number.length-2)==1){return end3;}
if(number.charAt(number.length-1)==1){return end1;}
if(number.charAt(number.length-1)>1&&number.charAt(number.length-1)<5){return end2;}
return end3;},array2json:function(arr){var parts=[];var is_list=(Object.prototype.toString.apply(arr)==='[object Array]');for(var key in arr){var value=arr[key];if(typeof value=="object"){if(is_list){parts.push(this.array2json(value));}
else
parts[key]=this.array2json(value);}else{var str="";if(!is_list)
str='"'+key+'":';if(typeof value=="number")
str+=value;else if(value===false)
str+='false';else if(value===true)
str+='true';else
str+='"'+value+'"';parts.push(str);}}
var json=parts.join(",");if(is_list)
return'['+json+']';return'{'+json+'}';},getRandomArbitrary:function(min,max){return Math.round(Math.random()*(max-min)+min);},initTimeouts:function(){if(this.hasOwnProperty('_timeouts')&&this._timeouts.length>0){this.deleteAllTimeouts();}
this._timeouts=[];},setTimeout:function(name,callback,timeout){if(this._timeouts.hasOwnProperty(name)){this.deleteTimeout(name);}
this._timeouts[name]=setTimeout(callback,timeout);},getTimeout:function(name){return this._timeouts[name];},deleteTimeout:function(name){if(typeof this._timeouts[name]!=='undefined'){clearTimeout(this._timeouts[name]);delete this._timeouts[name];}},deleteAllTimeouts:function(){for(var name in this._timeouts){if(this._timeouts.hasOwnProperty(name)){this.deleteTimeout(name);}}},initIntervals:function(){if(this.hasOwnProperty('_intervals')&&this._intervals.length>0){this.deleteAllIntervals();}
this._intervals=[];},setInterval:function(name,callback,interval){if(this._intervals.hasOwnProperty(name)){this.deleteInterval(name);}
this._intervals[name]=setInterval(callback,interval);},getInterval:function(name){return this._intervals[name];},deleteInterval:function(name){if(typeof this._intervals[name]!=='undefined'){clearInterval(this._intervals[name]);delete this._intervals[name];}},deleteAllIntervals:function(){for(var name in this._intervals){if(this._intervals.hasOwnProperty(name)){this.deleteInterval(name);}}},setCaretPosition:function(input,begin,end){var npt=input.jws&&input.length>0?input[0]:input;if(typeof begin=='number'){end=(typeof end=='number')?end:begin;if(npt.setSelectionRange){if(navigator.userAgent.search(/Edge/)===-1){npt.setSelectionRange(begin,end);}}else if(npt.createTextRange){var range=npt.createTextRange();range.collapse(true);range.moveEnd('character',end);range.moveStart('character',begin);range.select();}
npt.focus();}else{if(npt.setSelectionRange){begin=npt.selectionStart;end=npt.selectionEnd;}else if(document.selection&&document.selection.createRange){var range=document.selection.createRange();begin=0-range.duplicate().moveStart('character',-100000);end=begin+range.text.length;}}},getRoistatPromo:function(){var roistatPromo=this.getCookie('roistat_visit');if(!roistatPromo){if($('.roistat-promo').length){roistatPromo=parseInt($('.roistat-promo').text());}}
return roistatPromo;},getAdvertiseId:function(){return this.getCookie('adv_uid');},getCalltrackingId:function(){return this.getCookie('cbk_calltracking.ru_id');},sendYaMetrika:function(goal){for(var el in window){if("string"==typeof el&&el.match(/yaCounter\d+/)&&"undefined"!=typeof window[el]&&window[el].reachGoal){try{window[el].reachGoal(goal);}catch(e){}}}
return;},sendMailCounter:function(goal){if(typeof(_tmr)!=="undefined"){try{var re=/mail.ru\/counter\?id=(\d+)/i;var mailCounter=$('html').html().match(re);if(typeof(_tmr)!=="undefined"&&mailCounter[1]){_tmr.push({id:mailCounter[1],type:"reachGoal",goal:goal});}}catch(e){}}},sendGoal:function(yaGoal,gaGoal,gaCategory,yagla){if($.fn._frameCheck()&&typeof WBK==='undefined'){WBK=document.WBK;}
wsUtil.sendYaMetrika(yaGoal);wsUtil.sendMailCounter(gaGoal);if(typeof(_gaq)!=="undefined"){_gaq.push(['_trackEvent',gaCategory,gaGoal,(WBK.settings.visitorName?WBK.settings.visitorName:'')+' '+(WBK.settings.visitorPhone?WBK.settings.visitorPhone:'')]);}
if(typeof(ga)!=="undefined"&&typeof(ga)==="function"){ga('send','event',gaCategory,gaGoal,(WBK.settings.visitorName?WBK.settings.visitorName:'')+' '+(WBK.settings.visitorPhone?WBK.settings.visitorPhone:''));}
if(typeof(dataLayer)!=="undefined"){dataLayer.push({'event':'GAEvent','eventCategory':gaCategory,'eventAction':gaGoal});dataLayer.push({'event':gaGoal});}
if(yagla){if(typeof(yaglametrika)!=="undefined"){if(typeof(yaglaservice)!=="undefined"&&yaglametrika.id){yaglaservice("wbkNewLead");}}}},log:function(text){console.log('%c '+text+' ','background: #222; color: #bada55');},validateEmail:function(email){var re=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return re.test(email);},getGoogleClientId:function(){var googleClientId='';if(typeof(ga)!=="undefined"&&typeof(ga)==="function"){if(typeof(ga.getAll)!=="undefined"&&typeof(ga.getAll)==="function"&&ga.getAll().length){googleClientId=ga.getAll()[0].get('clientId');}}
return googleClientId;},humanizeNumber:function(number,delimeter){if(typeof delimeter=="undefined")
delimeter='&nbsp;';if(number==0){return 0;}
if(!number){return'';}
var numb=number.toString();var r='';var d=0;if(numb.charAt(numb.length-2)==","||numb.charAt(numb.length-2)=="."){d=2;}
if(numb.charAt(numb.length-3)==","||numb.charAt(numb.length-3)=="."){d=3;}
if(numb.charAt(numb.length-4)==","||numb.charAt(numb.length-4)=="."){d=4;}
for(var i=0,l=numb.length-d;i<l;i++){r=r+(((((l-i)%3)==0)&&(i!=0))?delimeter:'')+numb.charAt(i);}
for(i=numb.length-d,l=numb.length;i<l;i++){r=r+numb.charAt(i);}
return r;}}})(jWS);"use_strict";wsInvader=(function($){var _this;var s;var t;var w;var _debug;return{settings:{},templates:{},widget:{},init:function(data){_this=this;s=this.settings;t=this.templates;w=this.widget;if($.fn._frameCheck()&&typeof WBK==='undefined'){WBK=document.WBK;}
_debug=WBK.checkDebug();_this.loader(data);},loader:function(res){var data=res.Data.invader;if(WBK.settings.device==='tablet'){if(parseInt(data.hide_tablet)){if(_debug)_this.log('Виджет скрыт на планшетах');return;}
if(data.widget.action=='go_callback'||!WBK.settings.killerId){if(_debug)_this.log('Не установлен killerId');return;}}
_this.setDefaultText();_this.setDefaultSettings();_this.setTemplate();WBK.settings.invaderId=parseInt(res.Settings.invaderId);if(data.widget.text_hello){s.hello=data.widget.text_hello;}
if(data.widget.manager_name){s.name=data.widget.manager_name;}
if(data.widget.text_message){s.message=data.widget.text_message;}
if(data.widget.text_action_view){s.action=data.widget.text_action_view;}
if(res.Settings.serviceDomain){s.partnerLink='http://'+WBK.settings.servicedomain+'?utm_source=widget&utm_medium=self&utm_campaign='+location.hostname+'&utm_content=invader&utm_term=';if(WBK.settings.thisIsCallbackKILLER){s.partnerLink='http://cb-killer.ru/invader/?utm_source=widget&utm_medium=self&utm_campaign='+location.hostname+'&utm_content=invader&utm_term=';}}
if(data.partnerLink){s.partnerLink=data.partnerLink;}
if(data.click_type){s.clickType=data.click_type;}
if(data.widget.img){s.avatar=data.widget.img;}
if(data.paused_seconds){s.pausedSeconds=parseInt(data.paused_seconds);}
if(data.repeat_show_time){s.repeatShowTime=parseInt(data.repeat_show_time);}
if(data.repeat_show_type){s.repeatShowType=data.repeat_show_type;}
if(data.repeat_show_time_after){s.repeatShowTimeAfter=parseInt(data.repeat_show_time_after);}
if(data.repeat_show_type_after){s.repeatShowTypeAfter=data.repeat_show_type_after;}
if(data.show_enter){s.showEnter=data.show_enter;}
if(data.show_finish){s.showFinish=data.show_finish;}
if(data.show_scroll_value){s.showScrollValue=parseInt(data.show_scroll_value);}
if(data.widget.action){s.actionType=data.widget.action;}
if(data.widget.action_value){s.actionValue=data.widget.action_value;}
if(data.widget.callback_show){s.callbackShow=parseInt(data.widget.callback_show);}
if(data.widget.url_open_type){s.openThisWindow=data.widget.url_open_type;}
if(data.sound){s.sound=parseInt(data.sound);}
if(data.position){s.position=data.position;}
if(data.position_value){s.positionValue=parseInt(data.position_value);}
if(data.color_background){s.colorBackground=data.color_background;}
if(data.color_background_text){s.colorBackgroundText=data.color_background_text;}
WBK.addStyles('.cbk-support-new-message{background-color: '+s.colorBackground+' !important;}'+'.invader_view .load_info, .cbk-support-new-message-typing, .cbk-support-new-message-close, .cbk-support-new-message-name, .cbk-support-new-message-text, .cbk-support-new-message-text a, .cbk-support-new-message-copyright a, .cbk-support-new-message-copyright a:hover{color:  '+s.colorBackgroundText+' !important;}');_this.start();},setDefaultText:function(){var texts={partnerLinkText:"Работает на <span class='invader-service-name'></span>",};$.extend(true,s,texts);},setDefaultSettings:function(){var defaultSettings={avatar:false,apperanceTimeout:1,pausedSeconds:false,repeatShowTime:false,repeatShowType:false,repeatShowTimeAfter:false,repeatShowTypeAfter:false,showEnter:false,showFinish:'after_show',showScrollValue:0,name:'Менеджер Алексей',hello:'Здравствуйте!',message:'У меня для Вас есть специальное предложение. Успейте воспользоваться им',action:'Чтобы узнать подробнее нажмите на [ссылку]',actionType:false,actionValue:false,callbackShow:2,openThisWindow:false,sound:false,position:'left',pinvaderPositionValue:1,partnerLink:false,clickType:'body',colorBackground:"rgba(58, 58, 58, 1)",colorBackgroundText:"rgba(255, 255, 255, 1)"};$.extend(true,s,defaultSettings);},setTemplate:function(){t='<div class="cbk-support-new-message">'+'<div class="cbk-support-new-message-avatar"></div>'+'<div class="cbk-support-new-message-close">×</div>'+'<div class="cbk-support-new-message-name"></div>'+'<div class="cbk-support-new-message-copyright">'+'<a href="#" class="cbk-support-new-message-copyright-url" target="_blank" data-widget="invader">'+s.partnerLinkText+'</a>'+'</div>'+'</div>';},start:function(){w.window=$(t).hide().find('.cbk-support-new-message-close').click(function(e){_this.sendEvents('close',s.actionType,s.actionValue);_this.closeWidget();_this.sendGoal('close');e.preventDefault();return false;}).end().appendTo('body');if(s.avatar){w.window.find('.cbk-support-new-message-avatar').html($('<img/>').attr('src',WBK.settings.serverUrl+'/uploaded/invaders/'+WBK.settings.invaderId+'/'+s.avatar));}
else{w.window.find('.cbk-support-new-message-avatar').remove();w.window.addClass('cbk-support-new-message-no-avatar');}
var click_type="body";if(s.clickType=='body'){click_type='.cbk-support-new-message, .cbk-support-new-message a';}else{click_type='.cbk-support-new-message a';w.window.css('cursor','auto');}
$('body').on('click',click_type,function(e){if($(e.target).hasClass('cbk-support-new-message-copyright-url')||$(e.target).hasClass('invader-service-name')){return;}
var d=new Date();switch(s.actionType){case'go_callback':d.setMinutes(d.getMinutes()+60*24*100);wsUtil.setCookie('WhiteCallback_shownOn','onsm',d);wsKiller.showWindow('sm');break;case'go_generator':wsGenerator.showWidget('invader');break;case'go_chat':wsChat.showWidget();break;case'go_url':if(s.openThisWindow=='true'){window.location.href=wsUtil.specialChars(s.actionValue);}else{window.open(wsUtil.specialChars(s.actionValue),'_blank');}
break;case'go_javascript':case'go_other_widget':window.top.eval(s.actionValue);break;}
_this.sendEvents('click',s.actionType,s.actionValue);_this.sendGoal('click');_this.closeWidget();e.preventDefault();return false;});w.window.find('.cbk-support-new-message-name').html(s.name);$('.cbk-support-new-message-copyright-url').attr('href',s.partnerLink);$('body').on('click','.cbk-support-new-message-copyright-url',function(e){WBK.sendAdvertLinkStat($(this).data('widget'),$(this).attr('href'),$(this).text(),WBK.settings.invaderId);});w.window.find('span.invader-service-name').html(WBK.settings.servicename);if(s.position=='left'){w.window.css({'left':s.positionValue+'%','right':'inherit'});}else{w.window.css({'right':s.positionValue+'%','left':'inherit'});}
_this.initTimer();},sendEvents:function(type,widget,value){var url=WBK.settings.serverUrl+"/api?action=invaderEvent&callback=?";$.getJSON(url,{event:type,widget:widget,value:parseInt(value)?parseInt(value):0,invaderId:WBK.settings.invaderId,invaderStatId:WBK.settings.invaderStatId,code:WBK.settings.whiteSaasCode,visitId:WBK.settings.visitId,visitorId:WBK.settings.visitorId},function(result){if(typeof result.Data.id!="undefined"){if(type==='click'){switch(widget){case'go_callback':WBK.settings.invaderCallbackStatId=result.Data.id;break;case'go_generator':WBK.settings.invaderGeneratorStatId=result.Data.id;break;}}
if(type==='show'){WBK.settings.invaderStatId=result.Data.id;}}});},closeWidget:function(){WBK.animateFastOnce(w.window,'cbk-fadeOutDown',function(){w.window.hide();});WBK.settings.windowInvaderOpened=false;var date=new Date();if(s.repeatShowType=='minutes'){date.setMinutes(date.getMinutes()+parseInt(s.repeatShowTime));}else if(s.repeatShowType=='days'){date.setDate(date.getDate()+parseInt(s.repeatShowTime));}
wsUtil.setCookie('WhiteInvader_closed_'+WBK.settings.invaderId,true,date);},initTimer:function(){var open_seconds=1;if(s.showEnter=='paused'){open_seconds=s.pausedSeconds;}
if(s.showEnter=='scroll'){open_seconds=1;}
if(s.showEnter=='behavioral'){open_seconds=wsUtil.getRandomArbitrary(3,27);}
wsUtil.setInterval('WidgetInvaderTimeout',function(){if(s.showEnter=='scroll'){var scroll=$(window).scrollTop();var scrollH=$(document).height()-$(window).height();var scrolled=scroll/scrollH*100;if(scrolled<s.showScrollValue){return;}}
if(!WBK.settings.windowInvaderOpened&&!WBK.settings.windowGeneratorOpened&&!WBK.settings.windowOpened&&!WBK.settings.chatWindowOpened&&!WBK.settings.chatInvitationOpened&&!wsUtil.getCookie('WhiteInvader_closed_'+WBK.settings.invaderId)){if(s.actionType=='go_callback'){wsKiller.checkWorkTime();if(s.callbackShow==1){_this.showWidget();}else if(s.callbackShow==3&&!wsKiller.settings.killerWorking){_this.showWidget();}else{if(wsKiller.settings.killerWorking){_this.showWidget();}}}else{_this.showWidget();}}},open_seconds*1000);},showWidget:function(){WBK.settings.windowInvaderOpened=true;_this.sendEvents('show',s.actionType,s.actionValue);if(s.showFinish=='after_show'){_this.setShowCookie();}
w.window.find('.cbk-support-new-message-text').remove();w.window.find('.cbk-support-new-message-typing').remove();w.window.find('.cbk-support-new-message-copyright').before($('<div>').addClass('cbk-support-new-message-text').html(s.hello));w.window.show();if(s.sound){WBK.Sound('invader');}
var typingMessage=' печатает ...';if(WBK.settings.siteId==22480||WBK.settings.siteId==30957){typingMessage=' typing ...';}
WBK.animateFastOnce(w.window,'cbk-fadeInUp');w.window.find('.cbk-support-new-message-copyright').before($('<div>').addClass('cbk-support-new-message-typing').html(s.name+typingMessage).hide().fadeIn());wsUtil.setTimeout('supportMessageOnTimer',function(){w.window.find('.cbk-support-new-message-typing').fadeOut(function(){$(this).remove();w.window.find('.cbk-support-new-message-copyright').before($('<div>').addClass('cbk-support-new-message-text').html(s.message));wsUtil.setTimeout('supportMessageOnTimer',function(){w.window.find('.cbk-support-new-message-copyright').before($('<div>').addClass('cbk-support-new-message-typing').html(s.name+typingMessage).hide().fadeIn());wsUtil.setTimeout('supportMessageOnTimer',function(){w.window.find('.cbk-support-new-message-typing').fadeOut(function(){$(this).remove();w.window.find('.cbk-support-new-message-copyright').before($('<div>').addClass('cbk-support-new-message-text').html(s.action));});if(s.showFinish=='before_messages'){_this.setShowCookie();}
wsUtil.setTimeout('supportMessageOnTimer',function(){if(!WBK.settings.hideCopyright){w.window.find('.cbk-support-new-message-copyright').show(400);}},1000);},s.action.length*50);},1000);});},s.message.length*75);},setShowCookie:function(){if(!wsUtil.getCookie('WhiteInvader_closed_'+WBK.settings.invaderId)){var date=new Date();if(s.repeatShowTypeAfter=='minutes'){date.setMinutes(date.getMinutes()+parseInt(s.repeatShowTime));}else if(s.repeatShowTypeAfter=='days'){date.setDate(date.getDate()+parseInt(s.repeatShowTime));}
wsUtil.setCookie('WhiteInvader_closed_'+WBK.settings.invaderId,true,date);}},sendGoal:function(type){var yaGoal,gaGoal;var gaCategory='Invader';switch(type){case'click':yaGoal='INV_CLICK';gaGoal='ClickInvader';break;case'close':yaGoal='INV_CANCEL';gaGoal='CancelInvader';break;}
wsUtil.sendGoal(yaGoal,gaGoal,gaCategory);},log:function(mess){wsUtil.log('INVADER : '+mess);}}})(jWS);"use_strict";wsGenerator=(function($){var _this;var s;var t;var w;var _debug;return{settings:{},templates:{},widget:{},init:function(data){_this=this;s=this.settings;t=this.templates;w=this.widget;_debug=WBK.checkDebug();if($.fn._frameCheck()&&typeof WBK==='undefined'){WBK=document.WBK;}
_this.loader(data);},loader:function(res){var data=res.Data.generator;if(WBK.settings.device==='tablet'){if(parseInt(data.hide_tablet)){if(_debug)_this.log('Виджет скрыт на планшетах');return;}}
_this.setDefaultSettings();WBK.settings.generatorId=res.Settings.generatorId;s.langText=data.lang_text;if(data.text_general!=undefined){s.langText.text_general=_this.decorateUrl(data.text_general);}
if(data.text_sub!=undefined){s.langText.text_sub=_this.decorateUrl(data.text_sub);}
if(data.text_success!=undefined){s.langText.text_success=_this.decorateUrl(data.text_success);}
if(data.text_counter_title!=undefined){s.langText.text_counter_title=data.text_counter_title;}
if(data.btn_success_text!=undefined){s.langText.btn_success_text=data.btn_success_text;}
if(data.btn_cancel_text!=undefined){s.langText.btn_cancel_text=data.btn_cancel_text;}
if(data.email_agreement_text!=undefined){s.langText.email_agreement_text=data.email_agreement_text;}
if(data.text_general_color_background){s.textGeneralColorBackground=data.text_general_color_background;}
if(data.text_general_color_text){s.textGeneralColorText=data.text_general_color_text;}
if(data.btn_success_color){s.btnSuccessColor=data.btn_success_color;}
if(data.btn_cancel_color){s.btnCancelColor=data.btn_cancel_color;}
if(data.counter_time){s.counterTime=data.counter_time;}
if(data.date_end){s.dateEnd=data.date_end;}
if(data.date_end_time){s.dateEndTime=data.date_end_time;}
if(data.date_end_weekday){s.dateEndWeekday=parseInt(data.date_end_weekday);}
if(data.date_hours){s.dateHours=data.date_hours;}
if(data.date_hours_type){s.dateHoursType=data.date_hours_type;}
if(data.get_email){s.getEmail=data.get_email;}
if(data.get_name){s.getName=data.get_name;}
if(data.get_phone){s.getPhone=data.get_phone;}
if(data.img_background){s.imgBackground=parseInt(data.img_background);}
if(data.img_background_service){s.imgBackgroundService=parseInt(data.img_background_service);}
if(data.paused_seconds){s.pausedSeconds=data.paused_seconds;}
if(data.repeat_show_time){s.repeatShowTime=data.repeat_show_time;}
if(data.repeat_show_type){s.repeatShowType=data.repeat_show_type;}
if(data.show_enter){s.showEnter=data.show_enter;}
if(data.show_scroll_value){s.showScrollValue=parseInt(data.show_scroll_value);}
if(data.show_behavioral_value){s.showBehavioralValue=parseInt(data.show_behavioral_value);}
if(data.send_action){s.sendAction=data.send_action;}
if(data.send_action_url){s.sendActionUrl=data.send_action_url;}
if(data.show_exit){s.showExit=data.show_exit;}
if(data.timer_enable){s.timerEnable=parseInt(data.timer_enable);}
if(data.auto_call){s.autoCall=parseInt(data.auto_call);}
if(data.auto_call_text){s.autoCallText=data.auto_call_text;}
if(data.ispayed){s.isPayed=data.ispayed;}
if(data.hasMoneyForLead){s.hasMoneyForLead=data.hasMoneyForLead;}
if(data.close_click_bgr){s.closeClickBgr=parseInt(data.close_click_bgr);}
if(data.counter_bgr_color){s.counterBgrColor=data.counter_bgr_color;}
if(data.counter_number_color){s.counterNumberColor=data.counter_number_color;}
if(data.container_shadow){s.containerShadow=data.container_shadow;}
if(res.Settings.serviceDomain){s.partnerLink='http://'+WBK.settings.servicedomain+'?utm_source=widget&utm_medium=self&utm_campaign='+location.hostname+'&utm_content=generator&utm_term=';if(WBK.settings.thisIsCallbackKILLER){s.partnerLink='http://cb-killer.ru/generator/?utm_source=widget&utm_medium=self&utm_campaign='+location.hostname+'&utm_content=generator&utm_term=';}}
if(data.partnerLink){s.partnerLink=data.partnerLink;}
if(data.format_general_text){s.textGeneralFormat=data.format_general_text;}
if(data.position_gorizontal_general_text){s.textGeneralPositionGorizontal=data.position_gorizontal_general_text;}
if(data.position_vertical_general_text){s.textGeneralPositionVertical=data.position_vertical_general_text;}
if(data.font_family_general_text){s.textGeneralFontFamily=data.font_family_general_text;}
if(data.font_size_general_text){s.textGeneralFontSize=parseInt(data.font_size_general_text);}
if(data.email_service){s.emailService=data.email_service;}
if(data.email_agreement){s.emailAgreement=parseInt(data.email_agreement);}
if(data.no_show_timeout){s.noShowTimeout=parseInt(data.no_show_timeout);}
if(data.hide_background_site){s.hideBackgroundSite=parseInt(data.hide_background_site);}
_this.setTemplate();_this.start();},start:function(){var _this=this;w.window=$(t.window).hide().appendTo('body');w.windowbgr=$(t.windowBgr).hide().click(function(e){if(s.closeClickBgr){_this.closeWidget();}
e.preventDefault();return false;}).appendTo('body');if(s.hideBackgroundSite==2){w.windowbgr.addClass('cbk-window-bgr-transparent');}
$('.white-saas-generator-copyright-url').attr('href',s.partnerLink);if(WBK.settings.visitorPhone){$('.white-saas-generator-userphone').val(WBK.settings.visitorPhone);}
if(WBK.settings.visitorEmail){$('.white-saas-generator-useremail').val(WBK.settings.visitorEmail);}
if(WBK.settings.visitorName){$('.white-saas-generator-username').val(WBK.settings.visitorName);}
if(WBK.settings.hideCopyright){$('.white-saas-generator-copyright-url').remove();}else{$('body').on('click','.white-saas-generator-copyright-url',function(e){WBK.sendAdvertLinkStat($(this).data('widget'),$(this).attr('href'),$(this).text(),WBK.settings.generatorId);});}
if(parseInt(s.showExit)){$('body').mouseleave(function(e){var pos={x:e.pageX,y:e.pageY-$(document).scrollTop()};if(pos.y<=10){if(!s.noShow&&!WBK.settings.windowOpened&&!WBK.settings.chatWindowOpened&&!wsUtil.getCookie('WhiteGenerator_closed_'+WBK.settings.generatorId)&&!wsUtil.getCookie('WhiteGenerator_success_closed_'+WBK.settings.generatorId)&&!WBK.settings.called){if(WBK.settings.windowInvaderOpened){wsInvader.widget.window.find('.cbk-support-new-message-copyright').hide();wsInvader.widget.window.hide();}
var d=new Date();d.setMinutes(d.getMinutes()+60*24*100);wsUtil.setCookie('WhiteGenerator_show_'+WBK.settings.generatorId,'onexit',d);_this.showWidget('exit');}}});}
if(!s.langText.text_general){w.window.find('.white-saas-generator-text-general-span').hide();}
w.window.find('.white-saas-generator-text-general-span').html(s.langText.text_general);w.window.find('.white-saas-generator-text-sub').html(s.langText.text_sub);w.window.find('.white-saas-generator-success-text').html(s.langText.text_success);if(s.emailService=='off'||!s.emailAgreement){w.window.find('.white-saas-generator-label-agreement').hide();}
if(s.imgBackgroundService){var d=new Date();w.window.find('.white-saas-generator-image').attr('src',WBK.settings.staticServerUrl+'/uploaded/callback_generators/'+WBK.settings.serviceid+'/logo.png?'+d.getTime());}
if(s.showEnter=='scroll'){$(window).on('scroll.white-saas-generator',function(){var scroll=$(window).scrollTop();var scrollH=$(document).height()-$(window).height();var scrolled=scroll/scrollH*100;if(s.showScrollValue<=scrolled&&!s.noShow&&!WBK.settings.windowGeneratorOpened&&!WBK.settings.windowOpened&&!WBK.settings.windowInvaderOpened&&!WBK.settings.chatWindowOpened&&!WBK.settings.chatInvitationOpened){if(!wsUtil.getCookie('WhiteGenerator_closed_'+WBK.settings.generatorId)&&!wsUtil.getCookie('WhiteGenerator_success_closed_'+WBK.settings.generatorId)&&!WBK.settings.called){_this.showWidget('auto');}}});}
if(s.isPayed){w.window.find('.white-saas-generator-btn-success').text(s.langText.btn_success_text);w.window.find('.white-saas-generator-btn-cancel').text(s.langText.btn_cancel_text);if(s.imgBackground){var d=new Date();w.window.find('.white-saas-generator-image').attr('src',WBK.settings.staticServerUrl+'/uploaded/generators/'+WBK.settings.generatorId+'/logo.png?'+d.getTime());}
if(s.textGeneralColorBackground){w.window.find('.white-saas-generator-text-general-span').css('background-color',s.textGeneralColorBackground);}
if(s.textGeneralColorText){w.window.find('.white-saas-generator-text-general-span').css('color',s.textGeneralColorText);}
if(s.btnSuccessColor){w.window.find('.white-saas-generator-btn-success').css('background-color',s.btnSuccessColor);w.window.find('.white-saas-generator-btn-yes').css('background-color',s.btnSuccessColor);}
if(s.btnCancelColor){w.window.find('.white-saas-generator-btn-cancel').css('background-color',s.btnCancelColor);}
if(s.counterBgrColor){w.window.find('.white-saas-generator-block-min, .white-saas-generator-counter-dz-block').css('background-color',s.counterBgrColor);}
if(s.counterNumberColor){w.window.find('.white-saas-generator-counter-number').css('color',s.counterNumberColor);}
if(s.containerShadow){switch(s.containerShadow){case'none':w.window.css('box-shadow','none');break;case'easy':w.window.css('box-shadow','0 3px 12px rgba(0, 0, 0, 0.15)');break;case'heavy':w.window.css('box-shadow','0 3px 12px rgba(0, 0, 0, 0.45)');break;}}
if(s.textGeneralFormat){w.window.find('.white-saas-generator-text-general').css('text-align',s.textGeneralFormat);}
if(s.textGeneralPositionGorizontal){w.window.find('.white-saas-generator-text-general').css('left',s.textGeneralPositionGorizontal+'px');}
if(s.textGeneralPositionVertical){w.window.find('.white-saas-generator-text-general').css('top',s.textGeneralPositionVertical+'px');}
if(s.textGeneralFontFamily){WBK.addStyles(".white-saas-generator-text-general-span {font-family: "+s.textGeneralFontFamily+"!important;}");}
if(s.textGeneralFontSize){w.window.find('.white-saas-generator-text-general-span ').css('font-size',s.textGeneralFontSize+'px');}
if(s.timerEnable==0){w.window.find('.white-saas-generator-counter').hide();}
if(s.getName=='hide'){w.window.find('.white-saas-generator-username').hide();}
if(s.getPhone=='hide'){w.window.find('.white-saas-generator-userphone').hide();}
if(s.getEmail=='hide'){w.window.find('.white-saas-generator-useremail').hide();}}else{s.getPhone="yes";w.window.find('.white-saas-generator-username').hide();s.getName="hide";w.window.find('.white-saas-generator-useremail').hide();s.getEmail="hide";}
w.window.find('.white-saas-generator-btn-cancel').click(function(e){e.preventDefault();_this.closeWidget();return false;});if(WBK.settings.phoneMasks){var listRU=$.masksSort(WBK.settings.phoneMasks,['#'],/[0-9]|#/,"mask");var optsRU={inputmask:{definitions:{'#':{validator:"[0-9]",cardinality:1}},clearIncomplete:false,showMaskOnHover:false,autoUnmask:true},match:/[0-9]/,replace:'#',list:listRU,listKey:"mask",onMaskChange:function(){$(this).attr("placeholder",$(this).inputmask("getemptymask"));}};$('.white-saas-generator-userphone').inputmasks(optsRU);$('.cbk-phone-checker').inputmasks(optsRU);}
w.window.find('.white-saas-generator-btn-success').on('click',function(e){e.preventDefault();_this.sendLead();});w.window.find('.white-saas-generator-btn-yes').on('click',function(e){e.preventDefault();_this.hideWidget();});if(s.timerEnable){_this.initCountDown();}
_this.initTimer();if(window.top.location.hash==='#showgenerator'){_this.showWidget('url');}
if(!$.fn._frameCheck()||typeof WBK!=='undefined'){$('body').on('click','a[href="#showgenerator"], a[href="'+window.top.location.origin+'#showgenerator"], a[href="'+window.top.location.origin+'/#showgenerator"]',function(e){_this.showWidget('url');e.preventDefault();return false;});}},initTimer:function(){if(s.showEnter=='disabled'||s.showEnter=='scroll'){return;}
var open_seconds=1;if(s.showEnter=='paused'){open_seconds=s.pausedSeconds;}
if(s.showEnter=='behavioral'){var start=3;var end=27;if(s.showBehavioralValue){start+=s.showBehavioralValue;end+=s.showBehavioralValue;}
open_seconds=wsUtil.getRandomArbitrary(start,end);}
wsUtil.setInterval('WidgetGeneratorTimer',function(){if(!s.noShow&&!WBK.settings.windowGeneratorOpened&&!WBK.settings.windowOpened&&!WBK.settings.windowInvaderOpened&&!WBK.settings.chatWindowOpened){wsUtil.deleteInterval('WidgetGeneratorTimer');if(!wsUtil.getCookie('WhiteGenerator_closed_'+WBK.settings.generatorId)&&!wsUtil.getCookie('WhiteGenerator_success_closed_'+WBK.settings.generatorId)&&!WBK.settings.called){_this.showWidget('auto');}}},open_seconds*1000);},initCountDown:function(){var date=new Date();date=_this.getDate(date);var genData=wsUtil.getCookie('WhiteGenerator_'+WBK.settings.generatorId+'_counter');if(genData&&genData!="false"){genData=JSON.parse(genData);}else{genData=false;}
if(s.counterTime=='fixed'){if(genData&&genData.counterTime==s.counterTime&&genData.dateHours==s.dateHours&&genData.dateHoursType==s.dateHoursType&&wsUtil.getCookie('WhiteGenerator_'+WBK.settings.generatorId+'_countEnd')){date=new Date(wsUtil.getCookie('WhiteGenerator_'+WBK.settings.generatorId+'_countEnd'));}else{wsUtil.setCookie('WhiteGenerator_'+WBK.settings.generatorId+'_countEnd',date,date);var genData={dateHours:s.dateHours,dateHoursType:s.dateHoursType,counterTime:"fixed"};wsUtil.setCookie('WhiteGenerator_'+WBK.settings.generatorId+'_counter',JSON.stringify(genData),date);}}else{if(genData){genData.counterTime=s.counterTime;}
var cookieDate=new Date();cookieDate.setMinutes(cookieDate.getMinutes()+60*24*100);wsUtil.setCookie('WhiteGenerator_'+WBK.settings.generatorId+'_counter',JSON.stringify(genData),cookieDate);}
s.endTime=date;wsUtil.setInterval('WidgetGeneratorCountDown',function(){var days=60*60*24,hours=60*60,minutes=60;var left,d,h,m,sec;left=Math.floor((s.endTime-(new Date()))/1000);if(left<0){if(s.noShowTimeout){s.noShow=1;}
_this.stopCountDown();d='00';h='00';m='00';sec='00';}
else{d=Math.floor(left/days);left-=d*days;h=Math.floor(left/hours);left-=h*hours;m=Math.floor(left/minutes);left-=m*minutes;sec=left;}
var oldType=s.counterTypeInTimer;if(d>0){s.counterTypeInTimer=1;}else{s.counterTypeInTimer=0;}
if(oldType!=s.counterTypeInTimer){if(s.counterTypeInTimer==1){$('.white-saas-generator-counter-number-hours').next().text(s.langText.text_counter_days);$('.white-saas-generator-counter-number-minutes').next().text(s.langText.text_counter_hours);$('.white-saas-generator-counter-number-seconds').next().text(s.langText.text_counter_minutes);}else{$('.white-saas-generator-counter-number-hours').next().text(s.langText.text_counter_hours);$('.white-saas-generator-counter-number-minutes').next().text(s.langText.text_counter_minutes);$('.white-saas-generator-counter-number-seconds').next().text(s.langText.text_counter_seconds);}}
if(s.counterTypeInTimer==1){sec=m;m=h;h=d;}
_this.updateGeneratorDigits(h,'.white-saas-generator-counter-number-hours');_this.updateGeneratorDigits(m,'.white-saas-generator-counter-number-minutes');_this.updateGeneratorDigits(sec,'.white-saas-generator-counter-number-seconds');},1*1000);},stopCountDown:function(){wsUtil.deleteInterval('WidgetGeneratorCountDown');},updateGeneratorDigits:function(counter,className){var one=Math.floor(counter/10)%10+'';var two=counter%10+'';var count=one+two;w.window.find(className).text(count);},getDate:function(date){switch(s.counterTime){case'fixed':if(s.dateHoursType=='hours'){date.setHours(date.getHours()+parseInt(s.dateHours));}else if(s.dateHoursType=='minutes'){date.setMinutes(date.getMinutes()+parseInt(s.dateHours));}
break;case'todate':var d=s.dateEnd.split(".");var time=s.dateEndTime.split(":");date=new Date(parseInt(d[2]),(parseInt(d[1])-1),parseInt(d[0]),time[0],time[1]);break;case'toweekday':var dayNow=(new Date()).getDay();var dayGen=parseInt(s.dateEndWeekday);var dayCount;if(dayNow<dayGen){dayCount=dayGen-dayNow;}else if(dayNow==dayGen){dayCount=7;}else{dayCount=7-dayGen;}
date=new Date(new Date(date).setHours(0,0,0,0));date=date.setDate(date.getDate()+dayCount);break;}
return date;},decorateUrl:function(text){text=text.replace(/\[(.+?)\|(.+?)\]/gi,"<a href='$1' target='_blank'>$2</a>");return text;},sendLead:function(){if(s.sendingLead){return;}
s.sendingLead=true;var name,email,phone,phoneMask,emailAgreement;name=$('.white-saas-generator-username').val();email=$('.white-saas-generator-useremail').val();phone=$('.white-saas-generator-userphone').val();phoneMask=$('.white-saas-generator-userphone').attr('placeholder');emailAgreement=$('.white-saas-generator-email-agreement').is(':checked')?1:0;phone=WBK.checkPhone(phone);$('.white-saas-generator-userphone-error, .white-saas-generator-username-error, .white-saas-generator-useremail-error').addClass('white-saas-generator-error-hidden');var errors_class='';if(s.getName=='yes'&&name==''){errors_class='.white-saas-generator-username-error';}
if(s.getPhone=='yes'&&phone==''){if(errors_class){errors_class+=', .white-saas-generator-userphone-error';}else{errors_class='.white-saas-generator-userphone-error';}}
if(s.getEmail=='yes'&&(email==''||!wsUtil.validateEmail(email))){if(errors_class){errors_class+=', .white-saas-generator-useremail-error';}else{errors_class='.white-saas-generator-useremail-error';}}
if(errors_class){w.window.find(errors_class).removeClass('white-saas-generator-error-hidden');s.sendingLead=false;return;}
var url=WBK.settings.serverUrl+"/api?action=genLeadAdd&callback=?";jWS.getJSON(url,{code:WBK.settings.whiteSaasCode,name:name,email:email,phone:phone,visitId:WBK.settings.visitId,generatorId:WBK.settings.generatorId,generatorStatId:WBK.settings.generatorStatId,phoneMask:phoneMask,emailAgreement:emailAgreement,url:(typeof document.URL==="string")?document.URL:'',visitorId:WBK.settings.visitorId,invader_id:WBK.settings.invaderId,invaderStatId:WBK.settings.invaderGeneratorStatId,instinct_id:WBK.settings.instinctId,instinctStatId:WBK.settings.instinctGeneratorStatId,roistatPromo:wsUtil.getRoistatPromo(),advertiseId:wsUtil.getAdvertiseId(),calltrackingId:wsUtil.getCalltrackingId()},function(result){if(result.Success==true){var date=new Date();date.setMinutes(date.getMinutes()+60*24*100);wsUtil.setCookie('WhiteGenerator_success_closed_'+WBK.settings.generatorId,true,date);if(typeof result.Data.leadId!="undefined"){WBK.settings.genLeadId=result.Data.leadId;if(phone&&s.autoCall&&WBK.settings.callbackEnabled&&s.isPayed&&s.hasMoneyForLead){wsKiller.settings.callingGenerator=true;var d=new Date();d.setMinutes(d.getMinutes()+60*24*100);wsUtil.setCookie('WhiteCallback_shownOn','ongen',d);WBK.settings.phoneMask=$('.white-saas-generator-userphone').attr('placeholder');wsKiller.newCall(phone);}}
_this.sendGoal('lead');if(s.sendAction=='go_url'&&s.sendActionUrl){window.location.href=s.sendActionUrl;}else{w.window.find('.white-saas-generator-right-block').children().hide();w.window.find('.white-saas-generator-success').show();}
s.sendingLead=false;}});},hideWidget:function(){WBK.settings.windowGeneratorOpened=false;w.windowbgr.hide();w.window.hide();if(WBK.settings.callbackEnabled&&wsKiller.settings.hideBtn!=1&&wsKiller.settings.btnShow){wsKiller.widget.btn.show();}
if(WBK.settings.chatBtnOpened){wsChat.widget.btn.show();}
WBK.settings.invaderGeneratorStatId=false;},showWidget:function(type_open){WBK.settings.windowGeneratorOpened=true;var pos=window.innerHeight/2-w.window.height()/2;if(pos<0){pos=0;}
pos=(pos<0?0:pos)+w.window.scrollTop();w.window.css('top',pos+'px');if(WBK.settings.callbackEnabled){wsKiller.widget.btn.hide();}
if(WBK.settings.chatBtnOpened){wsChat.widget.btn.hide();}
if(WBK.settings.chatInvitationOpened){wsChat.hideInvitation();}
if(!WBK.settings.windowOpened){w.windowbgr.show();w.window.show();WBK.setPhoneInputFocusForm($('.white-saas-generator-userphone'));}
_this.sendEvents('show',type_open);},closeWidget:function(){var date=new Date();if(s.repeatShowType=='minutes'){date.setMinutes(date.getMinutes()+parseInt(s.repeatShowTime));}else if(s.repeatShowType=='days'){date.setDate(date.getDate()+parseInt(s.repeatShowTime));}
wsUtil.setCookie('WhiteGenerator_closed_'+WBK.settings.generatorId,true,date);_this.hideWidget();_this.sendEvents('close');_this.sendGoal('close');},sendEvents:function(type,type_open){var url=WBK.settings.serverUrl+"/api?action=genEvent&callback=?";$.getJSON(url,{event:type,openType:type_open,invaderId:type_open=='invader'?WBK.settings.invaderId:false,instinctId:type_open=='instinct'?WBK.settings.instinctId:false,generatorStatId:WBK.settings.generatorStatId,generatorId:WBK.settings.generatorId,code:WBK.settings.whiteSaasCode,visitId:WBK.settings.visitId,visitorId:WBK.settings.visitorId},function(result){if(typeof result.Data.genStatId!="undefined"){if(type==='show'){WBK.settings.generatorStatId=result.Data.genStatId;}else{WBK.settings.generatorStatId=false;}}});},sendGoal:function(type){var yaGoal,gaGoal;var yagla=false;var gaCategory='Generator';switch(type){case'lead':yaGoal='GEN_LEAD';gaGoal='NewLead';yagla=true;break;case'close':yaGoal='GEN_CANCEL';gaGoal='CancelLead';break;}
wsUtil.sendGoal(yaGoal,gaGoal,gaCategory,yagla);},setDefaultSettings:function(){var defaultSettings={firstApperance:3,reapperance:60,textGeneralColorBackground:false,textGeneralColorText:false,btnSuccessColor:false,btnCancelColor:false,counterTime:false,counterTypeInTimer:0,dateEnd:false,dateEndTime:false,dateEndWeekday:false,dateHours:false,getEmail:false,getName:false,getPhone:false,imgBackground:0,imgBackgrouundService:0,pausedSeconds:false,repeatShowTime:false,repeatShowType:false,showEnter:false,showScrollValue:0,showBehavioralValue:0,sendAction:false,sendActionUrl:false,showExit:false,timerEnable:false,autoCall:0,autoCallText:'0',isPayed:false,hasMoneyForLead:false,closeClickBgr:0,counterBgrColor:false,counterNumberColor:false,leadId:false,partnerLink:false,textGeneralFormat:false,textGeneralPositionGorizontal:false,textGeneralPositionVertical:false,textGeneralFontFamily:false,textGeneralFontSize:false,emailService:'off',emailAgreement:0,langText:{},noShowTimeout:0,noShow:0,containerShadow:false,sendingLead:false,hideTablet:false,hideBackgroundSite:1,};$.extend(true,s,defaultSettings);},setTemplate:function(){t={windowBgr:'<div class="cbk-window-bgr"></div>',window:'<div class="white-saas-generator">'+'<div class="white-saas-generator-container">'+'<div class="white-saas-generator-left-block">'+'<img class="white-saas-generator-image" src="//saas-support.com/widget/img/background.jpg">'+'<div class="white-saas-generator-text-general"><span class="white-saas-generator-text-general-span">'+s.langText.text_general+'</span></div>'+'</div>'+'<div class="white-saas-generator-right-block">'+'<div class="white-saas-generator-success">'+'<span class="white-saas-generator-success-text">'+s.langText.text_success+'</span>'+'<div class="white-saas-generator-buttons"><a href="#" class="white-saas-generator-btn-yes">'+s.langText.text_btn_yes+'</a></div>'+'</div>'+'<div class="white-saas-generator-text-sub">'+s.langText.text_sub+'</div>'+'<div class="white-saas-generator-counter">'+'<div class="white-saas-generator-counter-title">'+s.langText.text_counter_title+'</div>'+'<div class="white-saas-generator-counter-clock">'+'<div class="white-saas-generator-counter-dig">'+'<div class="white-saas-generator-counter-block">'+'<div class="white-saas-generator-block-min"></div>'+'<div class="white-saas-generator-block-min"></div>'+'<div class="white-saas-generator-block-min"></div>'+'<div class="white-saas-generator-block-min"></div>'+'</div>'+'<div class="white-saas-generator-counter-number white-saas-generator-counter-number-hours">00</div>'+'<div class="white-saas-generator-counter-name">'+s.langText.text_counter_hours+'</div>'+'</div>'+'<div class="white-saas-generator-counter-dz">'+'<div class="white-saas-generator-counter-dz-block"></div>'+'<div class="white-saas-generator-counter-dz-block"></div>'+'</div>'+'<div class="white-saas-generator-counter-dig">'+'<div class="white-saas-generator-counter-block">'+'<div class="white-saas-generator-block-min"></div>'+'<div class="white-saas-generator-block-min"></div>'+'<div class="white-saas-generator-block-min"></div>'+'<div class="white-saas-generator-block-min"></div>'+'</div>'+'<div class="white-saas-generator-counter-number white-saas-generator-counter-number-minutes">00</div>'+'<div class="white-saas-generator-counter-name">'+s.langText.text_counter_minutes+'</div>'+'</div>'+'<div class="white-saas-generator-counter-dz">'+'<div class="white-saas-generator-counter-dz-block"></div>'+'<div class="white-saas-generator-counter-dz-block"></div>'+'</div>'+'<div class="white-saas-generator-counter-dig">'+'<div class="white-saas-generator-counter-block">'+'<div class="white-saas-generator-block-min"></div>'+'<div class="white-saas-generator-block-min"></div>'+'<div class="white-saas-generator-block-min"></div>'+'<div class="white-saas-generator-block-min"></div>'+'</div>'+'<div class="white-saas-generator-counter-number white-saas-generator-counter-number-seconds">00</div>'+'<div class="white-saas-generator-counter-name">'+s.langText.text_counter_seconds+'</div>'+'</div>'+'</div>'+'</div>'+'<div class="white-saas-generator-group">'+'<input type="text" class="white-saas-generator-group-input white-saas-generator-username" placeholder="'+s.langText.text_placeholder_username+'">'+'<small class="white-saas-generator-username-error white-saas-generator-error-hidden">'+s.langText.error_name+'</small>'+'</div>'+'<div class="white-saas-generator-group">'+'<input type="text" class="white-saas-generator-group-input white-saas-generator-userphone" placeholder="'+s.langText.text_placeholder_userphone+'">'+'<input type="text" class="cbk-phone-checker white-saas-generator-input-hidden"/>'+'<small class="white-saas-generator-userphone-error white-saas-generator-error-hidden">'+s.langText.error_phone+'</small>'+'</div>'+'<div class="white-saas-generator-group">'+'<input type="email" class="white-saas-generator-group-input white-saas-generator-useremail" placeholder="name@example.com">'+'<small class="white-saas-generator-useremail-error white-saas-generator-error-hidden">'+s.langText.error_email+'</small>'+'</div>'+'<div class="white-saas-generator-group">'+'<label class="white-saas-generator-label-agreement">'+'<input type="checkbox" class="white-saas-generator-email-agreement" checked>'+'<span class="white-saas-generator-email-agreement-text">'+s.langText.email_agreement_text+'</span>'+'</label>'+'</div>'+'<div class="white-saas-generator-buttons">'+'<a href="javascript:void(0)" class="white-saas-generator-btn-success">'+s.langText.btn_success_text+'</a>'+'<a href="javascript:void(0)" class="white-saas-generator-btn-cancel">'+s.langText.btn_cancel_text+'</a>'+'</div>'+'<div class="white-saas-generator-copyright">'+'<a href="#" class="white-saas-generator-copyright-url" target="_blank" data-widget="generator">'+s.langText.text_link+'</a>'+'</div>'+'</div>'+'</div>'+'</div>'};},log:function(mess){wsUtil.log('GENERATOR : '+mess);}}})(jWS);"use_strict";wsChat=(function($){var _this;var s;var t;var w;var _debug;return{settings:{},templates:{},widget:{},init:function(data){_this=this;s=this.settings;t=this.templates;w=this.widget;if($.fn._frameCheck()&&typeof WBK==='undefined'){WBK=document.WBK;}
_debug=WBK.checkDebug();_this.loader(data);},loader:function(res){var data=res.Data.chat;_this.setSettings(data);if(parseInt(s.hide_mobile)&&WBK.settings.device!=='pc'){return;}
WBK.settings.chatEnabled=true;WBK.settings.chatWidgetId=parseInt(res.Settings.chatWidgetId);WBK.settings.chatId=data.chatId?parseInt(data.chatId):false;s.all_operators=data.users?data.users:{};s.chat_operators=data.chatUsers?data.chatUsers:{};s.free_chat_widget=parseInt(s.free_chat_widget);if(s.free_chat_widget){if(_debug)_this.log('Бесплатная версия чата');}
if(parseInt(s.always_online)&&!s.free_chat_widget){$.each(s.all_operators,function(index,value){s.all_operators[index].status=1;});}
s.chat_is_online=_this.operatorsIsOnline();if(!s.partnerLink){s.partnerLink='http://'+WBK.settings.servicedomain+'?utm_source=widget&utm_medium=self&utm_campaign='+location.hostname+'&utm_content=chat&utm_term=';if(WBK.settings.thisIsCallbackKILLER){s.partnerLink='http://cb-killer.ru/chat/?utm_source=widget&utm_medium=self&utm_campaign='+location.hostname+'&utm_content=chat&utm_term=';}}
s.widget_logo=parseInt(data.img_logo);s.img_robot_logo=parseInt(data.img_robot_logo);s.img_robot_logo_service=parseInt(data.img_robot_logo_service);s.chat_widget_logo=WBK.settings.staticServerUrl+'/widget/img/chat_robot.png';s.chat_widget_logo_robot=s.chat_widget_logo;if(s.img_robot_logo_service){var d=new Date();s.chat_widget_logo_robot=WBK.settings.staticServerUrl+'/uploaded/chat_widgets_service/'+WBK.settings.serviceid+'/logo_robot.png?'+d.getTime();}
if(s.img_robot_logo){var d=new Date();s.chat_widget_logo_robot=WBK.settings.staticServerUrl+'/uploaded/chat_widgets/'+WBK.settings.chatWidgetId+'/logo_robot.png?'+d.getTime();}
if(s.widget_logo){var d=new Date();s.chat_widget_logo=WBK.settings.staticServerUrl+'/uploaded/chat_widgets/'+WBK.settings.chatWidgetId+'/logo.png?'+d.getTime();}
s.btn_corner_class='';switch(s.corner_type){case'smooth':s.btn_corner_class='ws-chat-btn-mini-round';break;case'flat':s.btn_corner_class='';break;case'round':s.btn_corner_class='ws-chat-btn-round';break;}
_this.updateUser();_this.setTemplate();_this.initWidget();},initWidget:function(){WBK.loadFont();WBK.addStyles(".ws-chat-message-manager .ws-chat-message, .ws-chat-message-robot .ws-chat-message, .ws-chat-message-manager:before, .ws-chat-message-robot:before{background-color: "+s.color_background_message_operator+" !important;}"+".ws-chat-message-user .ws-chat-message, .ws-chat-message-user:before{background-color: "+s.color_background_message_user+" !important;}"+".ws-chat-message-manager .ws-chat-message-source, .ws-chat-message-manager .ws-chat-message-date, .ws-chat-message-robot .ws-chat-message-source, .ws-chat-message-robot .ws-chat-message-date{color: "+s.color_text_message_operator+" !important;}"+".ws-chat-message-user .ws-chat-message-source, .ws-chat-message-user .ws-chat-message-date{color: "+s.color_text_message_user+" !important;}"+".ws-chat .ws-chat-invitation-container{background-color: "+s.color_background_invitation+" !important;}"+".ws-chat .ws-chat-invitation-text{background-color: "+s.color_background_invitation_message+" !important;}.ws-chat .ws-chat-invitation-body-text:before{background-color: "+s.color_background_invitation_message+" !important;}"+".ws-chat .ws-chat-invitation-input{background-color: "+s.color_background_invitation_input+" !important;}"+".ws-chat .ws-chat-invitation-name{color: "+s.color_text_invitation+" !important;}.ws-chat .ws-chat-invitation-position{color: "+s.color_text_invitation+" !important;}"+".ws-chat .ws-chat-invitation-container .ws-icon-close{color: "+s.color_text_invitation+" !important;}.ws-chat .ws-chat-invitation-typing{color: "+s.color_text_invitation+" !important;}"+".ws-chat .ws-chat-invitation-container .ws-chat-invitation-body .ws-chat-invitation-body-el .ws-chat-invitation-text{color: "+s.color_text_invitation_message+" !important;}");w.container=$(t);w.window=w.container.find('.ws-chat-container').hide();w.btn=w.container.find('.ws-chat-btn-container').hide();w.btn_el=w.container.find('.ws-chat-btn-el-container');w.invitation=w.container.find('.ws-chat-invitation-container').hide();w.container.appendTo('body');var title=s.text_button_online;if(WBK.settings.device!='pc'){w.container.addClass('ws-chat-mobile');title=s.mobile_text_button_online;WBK.addStyles(".ws-chat .ws-chat-btn-container{background: "+s.mobile_color_background_button+"!important;}"+".ws-chat .ws-chat-btn-container .ws-btn-title{color: "+s.mobile_color_background_button_text+"!important;}");}else{w.btn.addClass(s.btn_corner_class);WBK.addStyles(".ws-chat .ws-chat-btn-container{background: "+s.color_background_button+"!important;}"+".ws-chat .ws-chat-btn-container .ws-btn-title{color: "+s.color_background_button_text+"!important;}");}
w.btn.find('.ws-btn-title').html(title);if(s.widget_logo){w.window.addClass('ws-chat-logo-yes');w.btn.addClass('ws-chat-btn-logo-yes');}
if(s.img_robot_logo||s.img_robot_logo_service){w.window.addClass('ws-chat-logo-robot-yes');}
var sound=wsUtil.getCookie('WidgetChat_sound_'+WBK.settings.chatWidgetId);if(sound){s.sound=sound;if(s.sound=='off'){w.window.find('.ws-chat-sound').attr('title',s.lang_text.sound_on);w.window.find('.ws-chat-sound i').removeClass('ws-icon-sound-on').addClass('ws-icon-sound-off');}else{w.window.find('.ws-chat-sound').attr('title',s.lang_text.sound_off);w.window.find('.ws-chat-sound i').removeClass('ws-icon-sound-off').addClass('ws-icon-sound-on');}}else{if(s.sound=='off'){w.window.find('.ws-chat-sound').attr('title',s.lang_text.sound_on);w.window.find('.ws-chat-sound i').removeClass('ws-icon-sound-on').addClass('ws-icon-sound-off');}}
if(WBK.settings.hideCopyright){$('.ws-chat-copyright').hide();}else{$('body').on('click','.ws-chat-copyright-url',function(e){WBK.sendAdvertLinkStat($(this).data('widget'),$(this).attr('href'),$(this).text(),WBK.settings.chatWidgetId);});}
_this.loadBtnEvents();_this.loadWindowEvents();s.messages_quant_to_rate=0;if(s.chat_is_online){if(WBK.settings.chatId&&s.messages){_this.addOldMessages();_this.operatorsUpdate();_this.start();}else{if(s.operators_array.length){_this.showHelloMessageOperators();}else{_this.showHelloMessage();}
s.is_first_message=true;s.send_autoreply_first=true;}
_this.initRating();_this.checkRatingSettings();}else{if(s.operator_offline_action=='hide'){return;}else{_this.showOffline();}}
_this.initBtnPosition();_this.smilesInit();if(WBK.settings.device=='pc'&&!WBK.settings.chatId&&s.button_location!='hide'){_this.checkInvitation();}
var _h;if(!$.fn._frameCheck()||typeof WBK!=='undefined'){try{_h=window.top.location.hash;}catch(error){}}
if(wsUtil.getCookie('WidgetChat_opened_'+WBK.settings.chatWidgetId)&&wsUtil.getCookie('WidgetChat_settings_'+WBK.settings.chatWidgetId)&&s.chat_is_online){_this.showWidget();}else if(_h==='#showchat'){_this.initWindowPosition();_this.showWidget();_this.sendGoal('open');}else{w.btn.show();WBK.settings.chatBtnOpened=true;WBK.animateFastOnce(w.btn,'cbk-zoomIn',function(){if(wsUtil.getCookie('WidgetChat_opened_'+WBK.settings.chatWidgetId)){wsUtil.deleteCookie('WidgetChat_opened_'+WBK.settings.chatWidgetId);}
_this.initWindowPosition();});if(s.button_location=='hide'){w.btn.hide();WBK.settings.chatBtnOpened=false;}}
WBK.Sound('no_sound');},showBtn:function(){w.btn.show();if(s.button_location=='horizontal'){WBK.animateFastOnce(w.btn,'cbk-zoomIn');}
WBK.settings.chatBtnOpened=true;},hideBtn:function(){w.btn.hide();WBK.animateFastOnce(w.btn,'cbk-zoomOut');WBK.settings.chatBtnOpened=false;},showWidget:function(){_this.hideBtn();if(WBK.settings.chatInvitationOpened){_this.hideInvitation();}
if(WBK.settings.windowInvaderOpened){wsInvader.widget.window.find('.cbk-support-new-message-copyright').hide();wsInvader.widget.window.hide();}
var d=new Date();d.setMinutes(d.getMinutes()+60*24);wsUtil.setCookie('WidgetChat_opened_'+WBK.settings.chatWidgetId,true,d);if(s.chat_is_online&&WBK.settings.device=='pc'){if(wsUtil.getCookie('WidgetChat_settings_'+WBK.settings.chatWidgetId)){var data=JSON.parse(wsUtil.getCookie('WidgetChat_settings_'+WBK.settings.chatWidgetId));w.window.css({top:data.top,left:data.left,width:data.width,height:data.height});}}
if(WBK.settings.device!='pc'){s.scroll_left=$(window).scrollLeft();s.scroll_top=$(window).scrollTop();if(!$("meta[name=viewport]").length){w.window.data('noViewport',1);}
else{w.window.data('oldViewport',$("meta[name=viewport]").attr('content'));$("meta[name=viewport]").remove();}
$('head').append($('<meta>').attr('name','viewport').attr('content','width=device-width, user-scalable=0, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0'));$('body').addClass('cbk-body-mobile');}
w.window.show();if(WBK.settings.device=='pc'){WBK.animateFastOnce(w.window,'cbk-zoomIn');}
WBK.settings.chatWindowOpened=true;if(s.chat_is_online&&WBK.settings.device=='pc'){w.window.find('.ws-textarea').focus();}
if(s.chatId&&s.chat_created){var hash=new Date().getTime();_this.sendNode(JSON.stringify(''),hash,'open_window');}
else{var lastInvitationId=wsUtil.getStorage('WidgetChat_last_shown_invitation_id');if(!WBK.settings.chatInvitationShown&&lastInvitationId){WBK.settings.chatInvitationShown=true;var invitation_id=false;$.each(s.invitations,function(k,val){if(s.invitations[k].id==lastInvitationId){invitation_id=k;}});if(invitation_id){s.invitation_operator_id=_this.getOperatorIdForInvitation(invitation_id);s.invitations[invitation_id]=_this.formatInvitation(s.invitations[invitation_id]);if(s.chat_is_online&&parseInt(s.invitations[invitation_id].invitation_always)){var operator_arr=s.invitation_operator_id.split('_');s.invitation_show_data={user_id:operator_arr[0],employee_id:operator_arr[1],invitation_id:s.invitations[invitation_id].id,hello_text:s.invitations[invitation_id].hello_text,text1:s.invitations[invitation_id].text1,text2:s.invitations[invitation_id].text2};var data={hash:false,message:'',date:'',user:s.invitation_operator_id,is_read:true,message_type:'text',type:'manager',scroll:false};w.window.find('.ws-chat-robot-hello, .ws-chat-manager-hello, .ws-chat-message-block').remove();if(s.invitations[invitation_id].hello_text){data.message={text:s.invitations[invitation_id].hello_text};_this.addMessage(data);}
if(s.invitations[invitation_id].text1){data.message={text:s.invitations[invitation_id].text1};data.date='';_this.addMessage(data);}
if(s.invitations[invitation_id].text2){data.message={text:s.invitations[invitation_id].text2};data.date='';_this.addMessage(data);}}}}}
w.window.find(".ws-chat-body").nanoScroller({scroll:'bottom',contentClass:'ws-chat-body-content',paneClass:'ws-chat-body-pane',sliderClass:'ws-chat-body-slider ',preventPageScrolling:true});w.window.find(".ws-textarea-group").nanoScroller({scroll:'bottom',contentClass:'ws-textarea',paneClass:'ws-textarea-pane',sliderClass:'ws-textarea-slider ',preventPageScrolling:true});},hideWidget:function(){w.window.hide();WBK.animateFastOnce(w.window,'cbk-zoomOut');WBK.settings.chatWindowOpened=false;var d=new Date();d.setMinutes(d.getMinutes()+60*24*100);wsUtil.deleteCookie('WidgetChat_opened_'+WBK.settings.chatWidgetId);if(WBK.settings.device!='pc'){if(w.window.data('noViewport')){w.window.data('noViewport',0);$("meta[name=viewport]").attr('content','');}
else{$("meta[name=viewport]").attr('content',w.window.data('oldViewport'));}
$('body').removeClass('cbk-body-mobile');$(window).scrollTop(s.scroll_top);$(window).scrollLeft(s.scroll_left);}
if(s.button_location!='hide'){_this.showBtn();}
if(s.chat_created){var hash=new Date().getTime();_this.sendNode(JSON.stringify(''),hash,'close_window');}
if(!s.chat_is_online){var body_offline=w.window.find('.ws-chat-body-offline');body_offline.children().not('.ws-hide').show();body_offline.find('.ws-chat-offline-text-success').hide();wsUtil.deleteTimeout("chatOfflineHide");}},checkInvitation:function(){if(!s.invitations||s.free_chat_widget){if(_debug)_this.log('Нет автоприглашении или бесплатная версия');return;}
if(_debug)_this.log('Проверяем автоприглашения');for(var key=0;key<s.invitations.length;key++){if(wsUtil.getCookie('WidgetChat_invitation_'+s.invitations[key].id)){if(_debug)_this.log('автоприглашения № '+s.invitations[key].id+' уже было показано');continue;}
if(s.invitations[key].rules.length){var count_false=0;var count_true=0;var count_time_true=0;var timeout=1;var timeouts=[];var url=decodeURIComponent(window.location.toString());if(!url){url=window.location.toString();}
$.each(s.invitations[key].rules,function(k,val){switch(val.name){case'rule_url':switch(parseInt(val.type)){case 0:if(url.indexOf(val.value)+1){count_true++;}else{count_false++;}
break;case 1:if(url.indexOf(val.value)+1==0){count_true++;}else{count_false++;}
break;case 2:if(url==val.value){count_true++;}else{count_false++;}
break;case 3:var regex=new RegExp(val.value,'gi');if(regex.test(url)){count_true++;}else{count_false++;}
break;}
break;case'rule_time':timeouts.push(parseInt(val.value));count_time_true++;break;case'rule_time_site':var time_site=wsUtil.getCookie('WhiteCallback_timeAll')?parseInt(wsUtil.getCookie('WhiteCallback_timeAll')):1;var timeout_site=parseInt(val.value)-time_site;timeouts.push(timeout_site>1?timeout_site:1);count_time_true++;break;case'rule_time_close_chat':var time_close=_this.getTimeClosedChat();if(time_close){time_close=new Date().setTime(time_close);time_close=parseInt(val.value)-((new Date().getTime()-time_close)/1000);timeouts.push(time_close>1?time_close:1);}else{timeouts.push(1);}
count_time_true++;break;case'rule_operator':if(s.chat_is_online){if(val.value=='offline'){count_false++;}else{count_true++;}}else{if(val.value=='online'){count_false++;}else{count_true++;}}
break;case'rule_visit_count':var visit_count=WBK.getVisitCount();switch(parseInt(val.type)){case 0:if(parseInt(val.value)==visit_count){count_true++;}else{count_false++;}
break;case 1:if(parseInt(val.value)<visit_count){count_true++;}else{count_false++;}
break;case 2:if(parseInt(val.value)>visit_count){count_true++;}else{count_false++;}
break;}
break;case'rule_page_show_count':var page_show_count=WBK.getPageShowCount();switch(parseInt(val.type)){case 0:if(parseInt(val.value)==page_show_count){count_true++;}else{count_false++;}
break;case 1:if(parseInt(val.value)<page_show_count){count_true++;}else{count_false++;}
break;case 2:if(parseInt(val.value)>page_show_count){count_true++;}else{count_false++;}
break;}
break;}});if(count_false&&_debug)_this.log('Не выполнены условия показа автоприглашения № '+s.invitations[key].id);if(s.invitations[key].check=='all'&&count_false==0){if(_debug)_this.log('Выполнены все правила показа автоприглашения № '+s.invitations[key].id);if(timeouts.length>0){timeout=Math.max.apply(null,timeouts);}
if(_debug)_this.log('Показ автоприглашения через: '+timeout);_this.showInvitation(key,timeout);}
if(s.invitations[key].check=='one'&&(count_true>0||count_time_true>0)){if(_debug)_this.log('Выполнено 1 правило показа автоприглашения № '+s.invitations[key].id);if(count_true>0){timeout=1;}else if(timeouts.length>0){timeout=Math.min.apply(null,timeouts);}
if(_debug)_this.log('Показ автоприглашения через: '+timeout);_this.showInvitation(key,timeout);}}else{_this.showInvitation(key,1);}}},hideInvitation:function(){WBK.settings.chatInvitationOpened=false;w.invitation.hide();},getOperatorIdForInvitation:function(invitation_id){var operator_id=false;var saved_operator_id=wsUtil.getStorage('WidgetChat_invitation_operator_id');var invitation_operators=s.operators_id;if(s.chat_is_online){invitation_operators=s.operators_online_id;}
if(saved_operator_id){if(!s.all_operators.hasOwnProperty(saved_operator_id)){saved_operator_id=false;}}
if(s.invitations[invitation_id].operator_type=='operator'){operator_id=s.invitations[invitation_id].operator_id;if(!s.all_operators.hasOwnProperty(operator_id)){if(saved_operator_id){operator_id=saved_operator_id;}
else{operator_id=invitation_operators[wsUtil.getRandomArbitrary(0,invitation_operators.length-1)];}}}else{if(saved_operator_id){operator_id=saved_operator_id;}
else{operator_id=invitation_operators[wsUtil.getRandomArbitrary(0,invitation_operators.length-1)];}}
wsUtil.setStorage('WidgetChat_invitation_operator_id',operator_id);return operator_id;},showInvitation:function(invitation_id,timeout){if(!WBK.settings.chatId&&!WBK.settings.chatWindowOpened&&!s.show_one_invitation){wsUtil.setInterval('invitationShow_'+invitation_id,function(){if(!WBK.settings.chatInvitationOpened&&!WBK.settings.windowGeneratorOpened&&!WBK.settings.windowInvaderOpened&&!WBK.settings.windowOpened&&!WBK.settings.chatId&&!WBK.settings.chatWindowOpened&&!s.show_one_invitation){wsUtil.setStorage('WidgetChat_last_shown_invitation_id',s.invitations[invitation_id].id);WBK.settings.chatInvitationOpened=true;WBK.settings.chatInvitationShown=true;s.show_one_invitation=true;for(var key=0;key<s.invitations.length;key++){wsUtil.deleteInterval('invitationShow_'+key);}
var d=new Date();if(s.invitations[invitation_id].repeat_type=='minutes'){d.setMinutes(d.getMinutes()+parseInt(s.invitations[invitation_id].repeat_time));}else if(s.invitations[invitation_id].repeat_type=='days'){d.setDate(d.getDate()+parseInt(s.invitations[invitation_id].repeat_time));}
wsUtil.setCookie('WidgetChat_invitation_'+s.invitations[invitation_id].id,'true',d);s.invitation_operator_id=_this.getOperatorIdForInvitation(invitation_id);var operator_id=s.invitation_operator_id;s.invitations[invitation_id]=_this.formatInvitation(s.invitations[invitation_id]);if(s.chat_is_online){var operator_arr=operator_id.split('_');s.invitation_show_data={user_id:operator_arr[0],employee_id:operator_arr[1],invitation_id:s.invitations[invitation_id].id,hello_text:s.invitations[invitation_id].hello_text,text1:s.invitations[invitation_id].text1,text2:s.invitations[invitation_id].text2};var data={hash:false,message:'',date:'',user:operator_id,is_read:true,message_type:'text',type:'manager',scroll:false};w.window.find('.ws-chat-robot-hello, .ws-chat-manager-hello, .ws-chat-message-block').remove();if(s.invitations[invitation_id].hello_text){data.message={text:s.invitations[invitation_id].hello_text};_this.addMessage(data);}
if(s.invitations[invitation_id].text1){data.message={text:s.invitations[invitation_id].text1};data.date='';_this.addMessage(data);}
if(s.invitations[invitation_id].text2){data.message={text:s.invitations[invitation_id].text2};data.date='';_this.addMessage(data);}}
if(s.invitations[invitation_id].action=='open_chat'){_this.showWidget();return;}
w.invitation.find('.ws-chat-invitation-logo').append('<img class="ws-chat-invitation-img" src="'+WBK.settings.staticServerUrl+s.users[operator_id].img+'">');var name=s.users[operator_id].name+(s.users[operator_id].surname?' '+s.users[operator_id].surname:'');var profession=(s.users[operator_id].profession)?s.users[operator_id].profession:'';w.invitation.find('.ws-chat-invitation-body-text').before('<div class="ws-chat-invitation-name">'+name+'</div><div class="ws-chat-invitation-position">'+profession+'</div>');w.invitation.find('.ws-chat-invitation-body-text').append('<div class="ws-chat-invitation-text">'+s.invitations[invitation_id].hello_text+'</div>');var typing=$('<div class="ws-chat-invitation-typing"><span class="ws-chat-typing-action"><i class="ws-icon-typing"></i></span><span class="ws-chat-invitation-typing-name">'+name+'</span> '+s.lang_text.typing+'...</div>');w.invitation.find('.ws-chat-invitation-body-text').append(typing.fadeIn());w.invitation.show();WBK.animateFastOnce(w.invitation,'cbk-zoomIn');wsUtil.setTimeout('invitationMessageTimer',function(){w.invitation.find('.ws-chat-invitation-typing').fadeOut(function(){if(s.invitations[invitation_id].text1){$(this).remove();w.invitation.find('.ws-chat-invitation-body-text').append('<div class="ws-chat-invitation-text">'+s.invitations[invitation_id].text1+'</div>');}
wsUtil.setTimeout('invitationMessageTimer',function(){w.invitation.find('.ws-chat-invitation-body-text').append(typing.fadeIn());wsUtil.setTimeout('invitationMessageTimer',function(){w.invitation.find('.ws-chat-invitation-typing').fadeOut(function(){$(this).remove();if(s.invitations[invitation_id].text2){w.invitation.find('.ws-chat-invitation-body-text').append('<div class="ws-chat-invitation-text">'+s.invitations[invitation_id].text2+'</div>');}});},wsUtil.specialChars(s.invitations[invitation_id].text2).length*110);},1000);});},wsUtil.specialChars(s.invitations[invitation_id].text1).length*110);}},timeout*1000);}},formatInvitation:function(invitation){invitation.hello_text=WBK.formatText(invitation.hello_text);invitation.text1=WBK.formatText(invitation.text1);invitation.text2=WBK.formatText(invitation.text2);if(s.geo_city){if(!s.geo_city['name']){s.geo_city['name']=s.geo_city['ip_city'];}
invitation.hello_text=invitation.hello_text.replace(/\[geocity1\]/g,s.geo_city['name']);invitation.hello_text=invitation.hello_text.replace(/\[geocity2\]/g,s.geo_city['name_rod']);invitation.hello_text=invitation.hello_text.replace(/\[geocity3\]/g,s.geo_city['name_mes']);invitation.text1=invitation.text1.replace(/\[geocity1\]/g,s.geo_city['name']);invitation.text1=invitation.text1.replace(/\[geocity2\]/g,s.geo_city['name_rod']);invitation.text1=invitation.text1.replace(/\[geocity3\]/g,s.geo_city['name_mes']);invitation.text2=invitation.text2.replace(/\[geocity1\]/g,s.geo_city['name']);invitation.text2=invitation.text2.replace(/\[geocity2\]/g,s.geo_city['name_rod']);invitation.text2=invitation.text2.replace(/\[geocity3\]/g,s.geo_city['name_mes']);}
return invitation;},smilesInit:function(){var smiles_count=32;var smile_container=w.window.find('.ws-smile-container');var px=0;for(var i=0;i<smiles_count;i++){smile_container.append('<a class="ws-emoji-el" href="#"><img src="'+WBK.settings.staticServerUrl+'/widget/img/blank.gif" class="ws-emoji" style="background-position: 0px -'+px+'px;"></a>');px+=17;}
w.window.find('.ws-emoji-el').on('click',function(e){e.preventDefault();if(!s.chat_is_online){w.window.find('.ws-offline-textarea').append($(this).html());}else{w.window.find('.ws-textarea').focus();_this.insertHTML($(this).html());}
w.window.find('.ws-textarea-send-btn').show();});},showOffline:function(){w.window.addClass('ws-chat-offline');w.btn.find(".ws-chat-status-online").removeClass("ws-chat-status-online");if(WBK.settings.device!='pc'){w.btn.find(".ws-btn-title").html(s.mobile_text_button_offline);}else{w.btn.find(".ws-btn-title").html(s.text_button_offline);}
w.window.find(".ws-chat-title").html(s.text_button_offline);w.window.find(".ws-chat-body").hide();w.window.find(".ws-chat-footer").hide();w.window.find(".ws-chat-status-online").removeClass("ws-chat-status-online");w.window.find(".ws-chat-body-offline").show();WBK.setPhoneInputFocusForm($('.ws-offline-phone'));},sendOfflineMessage:function(){if(s.offline_message_sending){return;}
s.offline_message_sending=true;var offline_body=w.window.find('.ws-chat-body-offline');offline_body.find('.ws-offline-textarea').removeClass('ws-input-error');offline_body.find('.ws-offline-input').removeClass('ws-input-error');var errors=[];var name=offline_body.find('.ws-offline-name').val();var email=offline_body.find('.ws-offline-email').val();var phone=offline_body.find('.ws-offline-phone').val();phone=WBK.checkPhone(phone)?phone:'';var phoneMask=offline_body.find('.ws-offline-phone').attr('placeholder');var emailAgreement=$('.ws-offline-email-agreement').is(':checked')?1:0;var message=_this.cleanMessage(offline_body.find('.ws-offline-textarea'));var errors_class='';if(s.get_contact_offline_name=='yes'&&name==''){errors_class='.ws-offline-name';}
if(s.get_contact_offline_phone=='yes'&&phone==''){if(errors_class){errors_class+=', .ws-offline-phone';}else{errors_class='.ws-offline-phone';}}
if(s.get_contact_offline_email=='yes'&&(email==''||!wsUtil.validateEmail(email))){if(errors_class){errors_class+=', .ws-offline-email';}else{errors_class='.ws-offline-email';}}
if(s.get_contact_offline_message=='yes'&&message==''){if(errors_class){errors_class+=', .ws-offline-textarea';}else{errors_class='.ws-offline-textarea';}}
if(errors_class){w.window.find(errors_class).addClass('ws-input-error');return;}
var url=WBK.settings.serverUrl+"/api?action=chatOfflineMessage&callback=?";jWS.getJSON(url,{code:WBK.settings.whiteSaasCode,name:name,email:email,phone:phone,message:message,emailAgreement:emailAgreement,visitId:WBK.settings.visitId,chatWidgetId:WBK.settings.chatWidgetId,chatId:WBK.settings.chatId,url:(typeof document.URL==="string")?document.URL:'',visitorId:WBK.settings.visitorId,phoneMask:phoneMask,googleClientId:wsUtil.getGoogleClientId(),roistatPromo:wsUtil.getRoistatPromo(),advertiseId:wsUtil.getAdvertiseId(),calltrackingId:wsUtil.getCalltrackingId()},function(result){if(result.Success==true){var offline_body=w.window.find('.ws-chat-body-offline');offline_body.children().not('.ws-hide').hide();offline_body.find('.ws-offline-textarea').text('')
offline_body.find('.ws-chat-offline-text-success').show();wsUtil.setTimeout('chatOfflineHide',function(){_this.hideWidget();},3000);s.offline_message_sending=false;}});_this.sendGoal('offline_message');},showHelloMessage:function(){var hello_message='<div class="ws-chat-manager-join ws-chat-robot-hello">'+'<img src="'+s.chat_widget_logo_robot+'" alt="" class="ws-manager-img">'+'<div class="ws-manager-event">'+s.hello_message+'</div>'+'</div>';w.window.find('.ws-chat-typing').before(hello_message);},showHelloMessageOperators:function(){s.operators_array.sort(function(a,b){a=_this.formatTextToDate(a.connected_at);b=_this.formatTextToDate(b.connected_at);return a<b?1:a>b?-1:0;});var operators_el='';for(var i=0;i<s.operators_array.length;i++){var key=s.operators_array[i].user_id+'_'+s.operators_array[i].employee_id;var name=s.all_operators[key].name+(s.all_operators[key].surname?'<br>'+s.all_operators[key].surname:'');operators_el+='<div class="ws-chat-manager-hello-el">'+'<img src="'+WBK.settings.staticServerUrl+s.all_operators[key].img+'" class="ws-manager-hello-img">'+'<div class="ws-manager-name">'+name+'</div>'+'</div>';if(i==2){break;}}
var hello_message='<div class="ws-chat-manager-join ws-chat-manager-hello">'+'<div class="ws-chat-manager-hello-body">'+
operators_el+'</div>'+'<div class="ws-manager-event">'+s.hello_message+'</div>'+'</div>';w.window.find('.ws-chat-typing').before(hello_message);},operatorsUpdate:function(data){var operators_online='';if(data){var user=data.user_id+'_'+data.employee_id;if(s.all_operators.hasOwnProperty(user)){s.all_operators[user].status=data.status;}}
w.window.removeClass('ws-chat-ico-bottom');w.window.find('.ws-chat-ico-container').empty();if(s.chat_operators){for(var key in s.chat_operators){if(s.chat_operators.hasOwnProperty(key)){if(typeof s.all_operators[key]!='undefined'){var name=s.all_operators[key].name+(s.all_operators[key].surname?' '+s.all_operators[key].surname:'');if(parseInt(s.all_operators[key].status)){if(operators_online){operators_online+=', '+name;}else{operators_online+=name;}}
_this.addIco(s.all_operators[key].user_id+'_'+s.all_operators[key].employee_id,s.all_operators[key].img,name,parseInt(s.all_operators[key].status));}}}}
if(operators_online){w.window.find('.ws-chat-title').text(operators_online);}else{w.window.find('.ws-chat-title').text(s.text_button_online);}},addIco:function(user,img_url,name,status){if(!w.window.hasClass('.ws-chat-ico-bottom')){w.window.addClass('ws-chat-ico-bottom');if(w.window.offset().left<100){w.window.addClass('ws-chat-ico-bottom-right');}else{w.window.removeClass('ws-chat-ico-bottom-right');}}
var online_class='';if(status){online_class='ws-chat-status-online';}
var tpl_ico='<div class="ws-chat-ico" id="ico_'+user+'" style="background-color: '+s.color_background_chat_header+';">'+'<div class="ws-chat-logo" data-name="'+name+'"><i class="ws-icon-chat"></i>'+'<img src="'+WBK.settings.staticServerUrl+img_url+'" class="ws-chat-logo-img" title="'+name+'">'+'<div class="ws-chat-status-round '+online_class+'"></div>'+'</div>'+'</div>';w.window.find('.ws-chat-ico-container').append(tpl_ico);},updateIcoBottom:function(user){var container=w.window.find('.ws-chat-ico-container');var el=container.find('#ico_'+user).appendTo(container);},addOldMessages:function(){for(var i=0;i<s.messages.length;i++){s.messages[i].message=JSON.parse(s.messages[i].message);if(s.messages[i].type=='auto_reply'&&!s.messages[i].user_id){var res={message:s.messages[i].message.text,type:'auto_reply'};_this.addMessageRobot(res);continue;}
else if(s.messages[i].type=='rating'){_this.addMessageRobot(s.messages[i]);continue;}
var type=s.messages[i].user_id?'manager':'user';var user=(type=='manager')?s.messages[i].user_id+'_'+s.messages[i].employee_id:false;_this.addMessage({id:s.messages[i].id,hash:s.messages[i].hash,type:type,message:s.messages[i].message,date:s.messages[i].created_at,user:user,is_read:parseInt(s.messages[i].is_read)?true:false,message_type:s.messages[i].type,scroll:false});if(!parseInt(s.messages[i].is_read)){s.unread_messages[s.messages[i].hash]={id:s.messages[i].id,hash:s.messages[i].hash};}
if(type=='manager'){s.last_operator_data={user_id:s.messages[i].user_id,employee_id:s.messages[i].employee_id};s.send_autoreply=true;}}},addMessageRobot:function(data){if(!data){return;}
var message_block='';switch(data.type){case'text':case'auto_reply':data.message=wsUtil.specialChars(data.message);if(data.auto_reply_get_contact){var text_btn=s.autoreplies[data.auto_reply_index]['text_btn']?s.autoreplies[data.auto_reply_index]['text_btn']:s.lang_text.autoreply_link;data.message=data.message+'<br><div class="ws-chat-autoreply-link"><a data-index="'+data.auto_reply_index+'" class="ws-chat-autoreply-btn" href="#">'+text_btn+'</a></div>';var cookieDate=new Date();cookieDate.setMinutes(cookieDate.getMinutes()+60*24*30);wsUtil.setCookie('WidgetChat_autoreply_getcontact_'+WBK.settings.chatId,true,cookieDate);}
message_block='<div class="ws-chat-message-source">'+data.message+'</div>';break;case'preform':message_block='<div class="ws-chat-message-source">'+s.lang_text.preform_text+'</div>'+'<input class="ws-chat-message-input" placeholder="'+s.lang_text.form_name+'">';break;case'load':message_block='<div class="ws-chat-message-source">'+s.lang_text.loading+' ...</div>'+'<div class="ws-chat-progress">'+'<div class="ws-chat-progress-bar"></div>'+'</div>';break;case'rating':_this.hideRating();var rating_block='<img class="ws-chat-message-rating-el ws-chat-message-rating-el-1" src="'+WBK.settings.staticServerUrl+'/widget/img/blank.gif" alt="">'+'<img class="ws-chat-message-rating-el ws-chat-message-rating-el-2" src="'+WBK.settings.staticServerUrl+'/widget/img/blank.gif" alt="">'+'<img class="ws-chat-message-rating-el ws-chat-message-rating-el-3" src="'+WBK.settings.staticServerUrl+'/widget/img/blank.gif" alt="">'+'<img class="ws-chat-message-rating-el ws-chat-message-rating-el-4" src="'+WBK.settings.staticServerUrl+'/widget/img/blank.gif" alt="">'+'<img class="ws-chat-message-rating-el ws-chat-message-rating-el-5" src="'+WBK.settings.staticServerUrl+'/widget/img/blank.gif" alt="">';if(s.rate_chat_view=='smiles'){rating_block='<img class="ws-chat-message-rating-el" src="'+WBK.settings.staticServerUrl+'/widget/img/blank.gif" alt="">';}
var rateText='';switch(parseInt(data.message.rate)){case 1:rateText=s.lang_text.rate_text_1;break;case 2:rateText=s.lang_text.rate_text_2;break;case 3:rateText=s.lang_text.rate_text_3;break;case 4:rateText=s.lang_text.rate_text_4;break;case 5:rateText=s.lang_text.rate_text_5;break;default:break;}
message_block='<div class="ws-chat-message-source">'+s.lang_text.rate_result+'</div></div><div class="ws-chat-message">'+'<div class="ws-chat-message-source">'+'<div class="ws-chat-message-rating ws-chat-message-rating-'+s.rate_chat_view+' ws-chat-message-rating-rate-'+data.message.rate+'">'+
rating_block+'</div>'+
rateText+'</div>';break;}
var new_block='<div class="ws-chat-message-block ws-chat-message-robot">'+'<div class="ws-chat-message-logo"><img class="ws-chat-message-logo-img" src="'+s.chat_widget_logo_robot+'"></div>'+'<div class="ws-chat-message-name"><span class="ws-chat-message-name-text" data-name="">'+s.robot_name+'</span></div>'+'<div class="ws-chat-message">'+
message_block+'</div>'+'</div>';w.window.find('.ws-chat-typing').before(new_block);if(data.type=='load'){w.window.find('.ws-chat-body-content .ws-chat-message-robot').last().find('.ws-chat-progress-bar').animate({width:'70%'},4000);}
if(WBK.settings.chatWindowOpened){_this.scroll();}},sendGoal:function(type){if(s.free_chat_widget){return;}
var yaGoal,gaGoal,mailGoal;var gaCategory='ChatService';var yagla=false;switch(type){case'open':yaGoal='CHAT_SHOW_ON_BTN';gaGoal=mailGoal='ChatShowOnBtn';yagla=true;break;case'first_message':yaGoal='CHAT_FIRST_MESSAGE';gaGoal=mailGoal='ChatFirstMessage';yagla=true;break;case'offline_message':yaGoal='CHAT_OFFLINE_MESSAGE';gaGoal=mailGoal='ChatOfflineMessage';yagla=true;break;case'visitor_introduced':yaGoal='CHAT_VISITOR_INTRODUCED';gaGoal=mailGoal='ChatVisitorIntroduced';yagla=true;break;case'operator_connect':yaGoal='CHAT_OPERATOR_CONNECT';gaGoal=mailGoal='ChatOperatorConnect';yagla=true;break;}
wsUtil.sendGoal(yaGoal,gaGoal,gaCategory,yagla);},checkAutoReply:function(type,data){for(var i=0;i<s.autoreplies.length;i++){if(type==s.autoreplies[i]['action']){_this.startAutoReply(i,data);}}},stopAutoReply:function(type){wsUtil.deleteTimeout('chatTypingAutoreply');for(var i=0;i<s.autoreplies.length;i++){if(type=='all'){wsUtil.deleteTimeout('auto_reply_'+s.autoreplies[i]['id']);}else{if(type==s.autoreplies[i]['action']){wsUtil.deleteTimeout('auto_reply_'+s.autoreplies[i]['id']);}}}},startAutoReply:function(index,data){wsUtil.setTimeout('auto_reply_'+s.autoreplies[index]['id'],function(){if(s.autoreplies[index]['action']=='not_connected'&&!s.send_autoreply_first){return false;}
var mess={text:s.autoreplies[index]['message']};if(s.autoreplies[index]['action']=='not_connected'){var res={message:s.autoreplies[index]['message'],type:'auto_reply',auto_reply_get_contact:parseInt(s.autoreplies[index]['get_contact'])&&!wsUtil.getCookie('WidgetChat_autoreply_getcontact_'+WBK.settings.chatId)?1:0,auto_reply_index:index};_this.addMessageRobot(res);var hash=new Date().getTime();if(mess){_this.sendNode(JSON.stringify(mess),hash,'auto_reply');}}
if(s.autoreplies[index]['action']=='not_answer_operator'){_this.typing(data,s.autoreplies[index]['message'].length*50);wsUtil.setTimeout('chatTypingAutoreply',function(){var res={hash:false,message:{text:s.autoreplies[index]['message']},date:'',user:data.user_id+'_'+data.employee_id,is_read:true,message_type:'auto_reply',type:'manager',scroll:true,auto_reply_get_contact:parseInt(s.autoreplies[index]['get_contact'])&&!wsUtil.getCookie('WidgetChat_autoreply_getcontact_'+WBK.settings.chatId)?1:0,auto_reply_index:index};_this.addMessage(res);mess.user_id=data.user_id;mess.employee_id=data.employee_id;var hash=new Date().getTime();if(mess){_this.sendNode(JSON.stringify(mess),hash,'auto_reply');}},s.autoreplies[index]['message'].length*50);}},parseInt(s.autoreplies[index]['time'])*1000);},initRating:function(){w.container.find('.ws-chat-rating-btns a').on('mouseenter.wbk_chat',function(){if(s.rate_chat_view=='stars'){var value=$(this).data('value');for(var i=1;i<=value;i++){w.container.find('a.ws-chat-rating-el-'+i).addClass('ws-chat-rating-el-marked');}}
else{$(this).addClass('ws-chat-rating-el-marked');}}).on('mouseleave.wbk_chat',function(){w.container.find('a.ws-chat-rating-el').removeClass('ws-chat-rating-el-marked');});},checkRatingSettings:function(){if(WBK.settings.chatId&&parseInt(s.rate_chat)&&!parseInt(s.chatRate)&&!this.ratingIsVisible()){if(s.messages_quant_to_rate>=parseInt(s.rate_chat_messages_quant)){for(var i=1;i<=5;i++){$(new Image()).attr('src',WBK.settings.staticServerUrl+'/widget/img/rating/24/smile_'+i+'.png').load(function(){});$(new Image()).attr('src',WBK.settings.staticServerUrl+'/widget/img/rating/32/smile_'+i+'.png').load(function(){});}
wsUtil.setTimeout('showRating',function(){_this.showRating();},500);w.container.find('.ws-chat-rating-btns a').unbind('click').on('click',function(){s.chatRate=$(this).data('value');_this.hideRating();_this.send({message:{rate:$(this).data('value')},type:'rating',scroll:true});});}}},ratingIsVisible:function(){return w.container.hasClass('ws-chat-has-rating');},showRating:function(){w.container.addClass('ws-chat-has-rating');WBK.animateFastOnce(w.container.find('.ws-chat-rating'),'cbk-fadeIn');},hideRating:function(){w.container.removeClass('ws-chat-has-rating');},sendNode:function(message,hash,type){googleRegistrationIds=[];var o_id=0;if(!s.chat_created){for(o_id in s.all_operators){if(s.all_operators[o_id].gcm_registration_id){googleRegistrationIds.push(s.all_operators[o_id].gcm_registration_id);}}
if(s.invitation_show_data){message=JSON.parse(message);message.invitation=true;message.invitation_data=s.invitation_show_data;s.invitation_show_data=false;message=JSON.stringify(message);}
_this.create(message,hash,type,googleRegistrationIds);}else{if(jWS.isEmptyObject(s.chat_operators)){for(o_id in s.all_operators){if(s.all_operators[o_id].gcm_registration_id){googleRegistrationIds.push(s.all_operators[o_id].gcm_registration_id);}}}else{for(o_id in s.chat_operators){if(s.chat_operators[o_id].gcm_registration_id){googleRegistrationIds.push(s.chat_operators[o_id].gcm_registration_id);}}}
_this.message(message,hash,type,googleRegistrationIds);}
if(type!='auto_reply'&&type!='open_window'&&type!='close_window'){_this.getAutoReply();}
s.is_first_message=false;},getAutoReply:function(){if(!s.free_chat_widget&&s.autoreplies){if(!jWS.isEmptyObject(s.chat_operators)){if(s.last_operator_data&&s.send_autoreply){_this.checkAutoReply('not_answer_operator',s.last_operator_data);s.send_autoreply=false;}}
else{if(s.is_first_message){_this.checkAutoReply('not_connected');}}}},send:function(data){var mess_to_node='';var hash=new Date().getTime();mess_to_node=JSON.stringify(data.message);if(data.type=='rating'){_this.addMessageRobot(data);}
else{_this.addMessage({hash:hash,type:'user',message:data.message,date:false,user:false,is_read:false,message_type:data.type,scroll:data.scroll});}
if(s.is_first_message){_this.sendGoal('first_message');}
if(s.is_first_message&&parseInt(s.get_contact)){if(s.user_name||s.user_email||s.user_phone){var error=false;if(s.get_contact_name=='yes'&&s.user_name==''){error=true;}
if(s.get_contact_email=='yes'&&s.user_email==''){error=true;}
if(s.get_contact_phone=='yes'&&s.user_phone==''){error=true;}
if(error){s.first_message={message:mess_to_node,hash:hash,type:data.type};_this.getContactRobot();}else{w.window.find('.ws-textarea').html('');_this.sendNode(mess_to_node,hash,data.type);}}else{s.first_message={message:mess_to_node,hash:hash,type:data.type};_this.getContactRobot();}}else{if(data.type!='rating'){w.window.find('.ws-textarea').html('');}
_this.sendNode(mess_to_node,hash,data.type);}
_this.inputScroll();},getContactRobot:function(){_this.addMessageRobot({type:'preform'});if(s.get_contact_can_refuse=='no'){w.window.find('.ws-textarea').html(s.lang_text.block_input).attr('contenteditable',false);w.window.find('.ws-textarea-group').addClass('ws-textarea-group-hide');}else{_this.sendNode(s.first_message.message,s.first_message.hash,s.first_message.type);s.first_message=false;}},sendMessage:function(){var messages=[];messages=_this.formatMessage($('.ws-textarea'));if(!messages){return;}
for(var i=0;i<messages.length;i++){if(messages[i].message.text!=''){_this.send({message:messages[i].message,type:messages[i].type,data:messages[i].data,scroll:true});}}
if(!s.is_first_message){w.window.find('.ws-textarea').html('');}
this.checkRatingSettings();},inputScroll:function(){if(w.window.find('.ws-textarea')[0].scrollHeight>92&&!s.input_scroll){s.input_scroll=true;}else if(w.window.find('.ws-textarea')[0].scrollHeight<=92&&s.input_scroll){s.input_scroll=false;}
var height_input=w.window.find('.ws-textarea').outerHeight();if(s.height_input!=height_input){var bottom_body=62;if(height_input==56){bottom_body=76;}else if(height_input==74){bottom_body=94;}else if(height_input>=92){bottom_body=112;}
w.window.find(".ws-chat-body").css('bottom',bottom_body);s.height_input=height_input;_this.scroll();}
w.window.find(".ws-textarea-group").nanoScroller();w.window.find(".ws-textarea-group").nanoScroller({scrollBottom:0});},insertHTML:function(html){if(navigator.appName.indexOf("Internet Explorer")!=-1){if(document.selection){var r=document.selection.createRange();if(r.pasteHTML){r.pasteHTML(html);}}else{var r=document.getSelection().getRangeAt(0);var n=document.createElement("span");r.surroundContents(n);n.innerHTML=html;r.collapse(false);}}else{if(html){document.execCommand('insertHtml',false,html);}}},uploadFile:function(type){if(s.fileUploadedCount<5){var form=new FormData;var el;switch(type){case'doc':el=$(".ws-file-doc-upload")[0].files[0];break;case'img':el=$(".ws-file-img-upload")[0].files[0];form.append("image_type",'image');break;}
if(!el){return;}
form.append(type,el);form.append("type",type);form.append("chat_id",WBK.settings.chatId);_this.uploadFileServer(form,type);}},uploadFileServer:function(form,type){_this.addMessageRobot({type:'load'});$.ajax({type:"POST",url:WBK.settings.serverUrl+"/chat/api/?action=uploadFile",processData:false,contentType:false,crossDomain:true,data:form,dataType:"json",success:function(response){switch(type){case'doc':$(".ws-file-doc-upload").val('');break;case'img':$(".ws-file-img-upload").val('');break;}
w.window.find('.ws-chat-body-content .ws-chat-message-robot').last().find('.ws-chat-progress-bar').stop().animate({width:'100%'},500,function(){w.window.find('.ws-chat-body-content .ws-chat-message-robot').last().remove();if(response.status==='success'){switch(type){case'doc':var data={message:{file_ico_url:'widget/img/'+response.ico+'.png',file_name:response.original_name,file_name_upload:response.save_name,file_size:response.size,file_size_type:response.size_type},type:'attach_file',scroll:true};_this.addFileUploaded(data);break;case'img':var data={message:{img_url:WBK.settings.staticServerUrl+"/"+response.path,file_name:response.original_name,file_name_upload:response.save_name,img_type:'uploaded'},type:'attach_image',scroll:true};_this.addFileUploaded(data);break;}}else{_this.addMessageRobot({type:'text',message:response.message});}});}})},addFileUploaded:function(data){if(!data){return;}
s.fileUploaded[new Date().getTime()]=data;_this.updateFilesUploaded();},updateFilesUploaded:function(){var _this=this;$('.ws-chat-uploaded-files').empty();var fileCount=0;if(!$.isEmptyObject(s.fileUploaded)){$.each(s.fileUploaded,function(index,value){var img_url,link,type='';switch(value.type){case'attach_image':type='img';img_url=value.message.img_url;link=WBK.settings.serverUrl+'/chat/download/?type=image&file='+value.message.file_name_upload+'&filename='+value.message.file_name;break;case'attach_file':type='file';img_url=WBK.settings.staticServerUrl+"/"+value.message.file_ico_url;link=WBK.settings.serverUrl+'/chat/download/?type=doc&file='+value.message.file_name_upload+'&filename='+value.message.file_name;break;}
var block='<div class="ws-chat-uploaded-el" data-index="'+index+'">'+'<div class="ws-chat-uploaded-el-close"><i class="ws-icon-close"></i></div>'+'<a class="ws-chat-uploaded-url" href="'+link+'" target="_blank"><img class="ws-chat-uploaded-'+type+'" src="'+img_url+'"></a>'+'</div>';$('.ws-chat-uploaded-files').append(block);fileCount++;});}
if(fileCount>0){w.window.find('.ws-textarea-send-btn').show();}else if($('.ws-textarea').html()==''){w.window.find('.ws-textarea-send-btn').hide();}
_this.typingPositionUpdate();s.fileUploadedCount=fileCount;},showPreform:function(type,index){if(index==undefined){index=false;}
w.window.find('.ws-chat-body').hide();w.window.find('.ws-chat-footer').hide();w.window.find('.ws-preform-name').closest('.ws-preform-input-group').removeClass('ws-hide');w.window.find('.ws-preform-email').closest('.ws-preform-input-group').removeClass('ws-hide');w.window.find('.ws-preform-phone').closest('.ws-preform-input-group').removeClass('ws-hide');var get_name='hide';var get_email='hide';var get_phone='hide';switch(type){case'preform':get_name=s.get_contact_name;get_phone=s.get_contact_phone;get_email=s.get_contact_email;break;case'lead':get_name=s.autoreplies[index]['get_name'];get_phone=s.autoreplies[index]['get_phone'];get_email=s.autoreplies[index]['get_email'];break;}
w.window.find('.ws-chat-preform-text').text(s.lang_text.preform_text);if(get_name=='hide'){w.window.find('.ws-preform-name').closest('.ws-preform-input-group').addClass('ws-hide');}else{w.window.find('.ws-preform-name').closest('.ws-preform-input-group').find('.ws-preform-input-label').html(s.lang_text.form_name+'<span class="ws-input-required">'+(get_name=='yes'?' *':''+'</span>'));}
if(get_phone=='hide'){w.window.find('.ws-preform-phone').closest('.ws-preform-input-group').addClass('ws-hide');}else{w.window.find('.ws-preform-phone').closest('.ws-preform-input-group').find('.ws-preform-input-label').html(s.lang_text.form_phone+'<span class="ws-input-required">'+(get_phone=='yes'?' *':''+'</span>'));}
if(get_email=='hide'){w.window.find('.ws-preform-email').closest('.ws-preform-input-group').addClass('ws-hide');w.window.find('.ws-preform-email-text').closest('.ws-preform-input-group').addClass('ws-hide');}else{w.window.find('.ws-preform-email').closest('.ws-preform-input-group').find('.ws-preform-input-label').html(s.lang_text.form_email+'<span class="ws-input-required">'+(get_email=='yes'?' *':''+'</span>'));if(type=='lead'){w.window.find('.ws-preform-email-text').closest('.ws-preform-input-group').addClass('ws-hide');}}
if(get_email=='hide'||s.email_service=='off'||!parseInt(s.email_agreement)){w.window.find('.ws-preform-label-agreement').closest('.ws-preform-input-group').addClass('ws-hide');}
w.window.find('.ws-preform-btn-save').data('type',type).data('index',index);w.window.find('.ws-chat-body-preform').show();WBK.setPhoneInputFocusForm($('.ws-preform-phone'));if(get_name=='yes'&&$('.ws-preform-name').val()==''){$('.ws-preform-name').focus();}else if(get_phone=='yes'&&($('.ws-preform-phone').val()==''||$('.ws-preform-phone').val()==WBK.settings.phoneBase)){$('.ws-preform-phone').focus();}else if(get_email=='yes'&&$('.ws-preform-email').val()==''){$('.ws-preform-email').focus();}else{wsUtil.setCaretPosition($('.ws-preform-name'),$('.ws-preform-name').val().length)}},hidePreform:function(){if(s.is_first_message&&s.first_message){_this.addMessageRobot({type:'preform'});}
w.window.find('.ws-chat-body').show();w.window.find('.ws-chat-footer').show();w.window.find('.ws-chat-body-preform').hide();_this.scroll();},savePreform:function(type,index){if(type==undefined){type='preform';}
if(index==undefined){index=false;}
var get_name='hide';var get_email='hide';var get_phone='hide';switch(type){case'preform':get_name=s.get_contact_name;get_phone=s.get_contact_phone;get_email=s.get_contact_email;break;case'lead':_this.stopAutoReply('all');get_name=s.autoreplies[index]['get_name'];get_phone=s.autoreplies[index]['get_phone'];get_email=s.autoreplies[index]['get_email'];break;}
w.window.find('.ws-preform-name, .ws-preform-phone, .ws-preform-email').removeClass('ws-input-error');var name=w.window.find('.ws-preform-name').val();var phone=w.window.find('.ws-preform-phone').val();phone=WBK.checkPhone(phone)?phone:'';var email=w.window.find('.ws-preform-email').val();var emailAgreement=$('.ws-preform-email-agreement').is(':checked')?1:0;var phoneMask=w.window.find('.ws-preform-phone').attr('placeholder');var errors_class='';if(get_name=='yes'&&name==''){errors_class='.ws-preform-name';}
if(get_phone=='yes'&&phone==''){if(errors_class){errors_class+=', .ws-preform-phone';}else{errors_class='.ws-preform-phone';}}
if(get_email=='yes'&&email==''){if(errors_class){errors_class+=', .ws-preform-email';}else{errors_class='.ws-preform-email';}}
if(errors_class){w.window.find(errors_class).addClass('ws-input-error');return;}
if(type=='lead'){$('.ws-chat-autoreply-link').remove();}
if(name){WBK.settings.visitorName=name;}
if(email){WBK.settings.visitorEmail=email;}
if(phone){WBK.settings.visitorPhone=phone;}
_this.updateUser();var message='';console.log(name)
if(type=='preform'&&name){message=s.user_name+', '+s.lang_text.preform_text_success;}else if(type=='preform'){message=s.lang_text.preform_text_success;message=message.charAt(0).toUpperCase()+message.substr(1);}else if(type=='lead'&&name){message=s.user_name+', '+s.lang_text.preform_lead_text_success;}else if(type=='lead'){message=s.lang_text.preform_lead_text_success;message=message.charAt(0).toUpperCase()+message.substr(1);}
console.log(message);_this.addMessageRobot({type:'text',message:message});if(s.is_first_message&&s.first_message){_this.sendNode(s.first_message.message,s.first_message.hash,s.first_message.type);s.first_message=false;w.window.find('.ws-textarea').attr('contenteditable',true).html('');w.window.find('.ws-textarea-group').removeClass('ws-textarea-group-hide');}
_this.hidePreform();var siteUrl='';if(document.URL){siteUrl=encodeURIComponent(document.URL);}
var url=WBK.settings.serverUrl+"/api?action=chatSavePreform&callback=?";$.getJSON(url,{code:WBK.settings.whiteSaasCode,url:siteUrl,name:name,email:email,phone:phone,emailAgreement:emailAgreement,type_preform:type,type:s.auth_type,image_url:s.logo_visitor,vk_id:s.visitor_vk_id,fb_id:s.visitor_fb_id,fb_token:s.visitor_fb_token,visitId:WBK.settings.visitId,visitorId:WBK.settings.visitorId,chatWidgetId:WBK.settings.chatWidgetId,chatId:WBK.settings.chatId,phoneMask:phoneMask,googleClientId:wsUtil.getGoogleClientId(),roistatPromo:wsUtil.getRoistatPromo(),advertiseId:wsUtil.getAdvertiseId(),calltrackingId:wsUtil.getCalltrackingId()});_this.sendGoal('visitor_introduced');},formatTextToDate:function(date){var result=new Date();if(date){var t=date.split(/[- :]/);result=new Date(t[0],t[1]-1,t[2],t[3],t[4],t[5]);var tz=result.getTimezoneOffset();tz=(tz<0?'+':'-')+Math.abs(tz);result.setTime(result.getTime()+tz*60*1000-s.chat_timezone*60*60*1000);}
return result;},dateFormat:function(date){var res={new_block:false,date_line:false};var result=_this.formatTextToDate(date);var now_time=new Date(),format=function(num){return((num+'').length<2)?('0'+num):num;};var minLeft=false;if(s.chat_old_time){minLeft=s.chat_old_time<result?Math.ceil((result-s.chat_old_time)/(1000*60)):false;if(s.chat_old_time.getFullYear()!=result.getFullYear()||s.chat_old_time.getMonth()!=result.getMonth()||s.chat_old_time.getDate()!=result.getDate()){if(s.chat_old_time.getFullYear()!=result.getFullYear()){res.date_line=s.lang_text.dayNames[result.getDay()]+', '+result.getDate()+' '+s.lang_text.monthNames[result.getMonth()]+' '+result.getFullYear();}
else{res.date_line=s.lang_text.dayNames[result.getDay()]+', '+result.getDate()+' '+s.lang_text.monthNames[result.getMonth()];}}}else{minLeft=now_time>result?Math.ceil((now_time-result)/(1000*60)):false;if(now_time.getFullYear()!=result.getFullYear()||now_time.getMonth()!=result.getMonth()||now_time.getDate()!=result.getDate()){if(now_time.getFullYear()!=result.getFullYear()){res.date_line=s.lang_text.dayNames[result.getDay()]+', '+result.getDate()+' '+s.lang_text.monthNames[result.getMonth()]+' '+result.getFullYear();}
else{res.date_line=s.lang_text.dayNames[result.getDay()]+', '+result.getDate()+' '+s.lang_text.monthNames[result.getMonth()];}}}
s.chat_old_time=result;if(minLeft&&minLeft>5){res.new_block=true;}
if(result.getDay()==now_time.getDay()){res.time=format(result.getHours())+':'+format(result.getMinutes());return res;}
res.time=format(result.getDate())+'.'+format(result.getMonth()+1)+'.'+(result.getFullYear()+'').substr(2);return res;},formatMessage:function(el){if(!el)return'';var message=_this.cleanMessage(el);var messages_arr=[];if(!$.isEmptyObject(s.fileUploaded)){$.each(s.fileUploaded,function(index,value){messages_arr.push(value);});s.fileUploaded={};_this.updateFilesUploaded();}
var matches=message.match(/(?!(http(s)?:\/\/)([^\.]+)\.([^\s]+blank.gif))(https?:\/\/[\w\-\.]+\.[a-zA-Z]{2,6}(?:\/\S*)?(?:[\w])+\.(?:jpg|png|gif|jpeg|bmp))/ig);if(!matches){messages_arr.push({message:{text:_this.textUrlFormat(message)},type:'text'});}else{for(var i=0;i<matches.length;i++){var pos=message.indexOf(matches[i]);messages_arr.push({message:{text:_this.textUrlFormat(message.slice(0,pos))},type:'text'});messages_arr.push({message:{img_url:matches[i],file_name:'',file_name_upload:'',img_type:'link',},type:'attach_image'});message=message.slice(pos,message.length).replace(matches[i],'');}
if(message){messages_arr.push({message:{text:_this.textUrlFormat(message)},type:'text'});}}
return messages_arr;},textUrlFormat:function(text){var urlsFound=false;var emailIsFound=false;text=(text||'').replace(/(^|[^A-Za-z0-9А-Яа-яёЁ\-\_])(https?:\/\/)?((?:[A-Za-z\$0-9А-Яа-яёЁ](?:[A-Za-z\$0-9\-\_А-Яа-яёЁ]*[A-Za-z\$0-9А-Яа-яёЁ])?\.){1,5}[A-Za-z\$рфуконлайнстРФУКОНЛАЙНСТ\-\d]{2,22}(?::\d{2,5})?)((?:\/(?:(?:\&amp;|\&#33;|,[_%]|[A-Za-z0-9А-Яа-яёЁ\-\_#%?+\/\$.~=;:]+|\[[A-Za-z0-9А-Яа-яёЁ\-\_#%?+\/\$.,~=;:]*\]|\([A-Za-z0-9А-Яа-яёЁ\-\_#%?+\/\$.,~=;:]*\))*(?:,[_%]|[A-Za-z0-9А-Яа-яёЁ\-\_#%?+\/\$.~=;:]*[A-Za-z0-9А-Яа-яёЁ\_#%?+\/\$~=]|\[[A-Za-z0-9А-Яа-яёЁ\-\_#%?+\/\$.,~=;:]*\]|\([A-Za-z0-9А-Яа-яёЁ\-\_#%?+\/\$.,~=;:]*\)))?)?)/ig,function(){var matches=Array.prototype.slice.apply(arguments),prefix=matches[1]||'',protocol=matches[2]||'http://',domain=matches[3]||'',url=domain+(matches[4]||''),full=(matches[2]||'')+matches[3]+matches[4];if(domain.indexOf('.')==-1||domain.indexOf('..')!=-1)return matches[0];var topDomain=domain.split('.').pop();var gDomains='info,name,academy,aero,arpa,coop,media,museum,mobi,travel,xxx,asia,biz,com,net,org,gov,mil,edu,int,tel,ac,ad,ae,af,ag,ai,al,am,an,ao,aq,ar,as,at,au,aw,ax,az,ba,bb,bd,be,bf,bg,bh,bi,bj,bm,bn,bo,br,bs,bt,bv,bw,by,bz,ca,cc,cd,cf,cg,ch,ci,ck,cl,cm,cn,co,cr,cu,cv,cx,cy,cz,de,dj,dk,dm,do,dz,ec,ee,eg,eh,er,es,et,eu,fi,fj,fk,fm,fo,fr,ga,gd,ge,gf,gg,gh,gi,gl,gm,gn,gp,gq,gr,gs,gt,gu,gw,gy,hk,hm,hn,hr,ht,hu,id,ie,il,im,in,io,iq,ir,is,it,je,jm,jo,jp,ke,kg,kh,ki,km,kn,kp,kr,kw,ky,kz,la,lb,lc,li,lk,lr,ls,lt,lu,lv,ly,ma,mc,md,me,mg,mh,mk,ml,mm,mn,mo,mp,mq,mr,ms,mt,mu,mv,mw,mx,my,mz,na,nc,ne,nf,ng,ni,nl,no,np,nr,nu,nz,om,pa,pe,pf,pg,ph,pk,pl,pm,pn,pr,ps,pt,pw,py,qa,re,ro,ru,rs,rw,sa,sb,sc,sd,se,sg,sh,si,sj,sk,sl,sm,sn,so,sr,ss,st,su,sv,sx,sy,sz,tc,td,tf,tg,th,tj,tk,tl,tm,tn,to,tp,tr,tt,tv,tw,tz,ua,ug,uk,um,us,uy,uz,va,vc,ve,vg,vi,vn,vu,wf,ws,ye,yt,yu,za,zm,zw,рф,укр,сайт,онлайн,срб,cat,pro,local';if(url.indexOf('blank.gif')+1>0||matches[0].indexOf('@')!=-1){return matches[0];}
if(topDomain.length>7||gDomains.split(',').indexOf(topDomain)==-1){if(!/^[a-zA-Z]+$/.test(topDomain)||!matches[2]){return matches[0];}}
try{full=decodeURIComponent(full);}catch(e){}
urlsFound=true;return prefix+'<a class="ws-chat-message-link" href="'+protocol+url+'" target="_blank">'+full+'</a>';});text=text.replace(/([a-zA-ZА-Яа-яёЁ\-_\.0-9]+@[a-zA-ZА-Яа-яёЁ\-_0-9]+\.[a-zA-ZА-Яа-яёЁ\-_\.0-9]+[a-zA-ZА-Яа-яёЁ\-_0-9]+)/g,function(email){emailIsFound=true;return'<a class="ws-chat-message-link ws-chat-message-email ws-chat-message-email-from-user" href="mailto:'+email+'" target="_blank">'+email+'</a>'});if(!emailIsFound&&!urlsFound){text=text.replace(/\+?\d+((\d+|-+| +|\(+|\)+){6,})\d+/g,function(phone){return'<a class="ws-chat-message-link ws-chat-message-phone ws-chat-message-phone-from-user" href="javascript:void(0)" target="_blank">'+phone+'</a>'});}
return text;},cleanMessage:function(el){if(!el)return'';if(el instanceof $){el=el[0].firstChild;}else{el=el.firstChild;}
var v='';var contTag=new RegExp('^(DIV|P|LI|OL|TR|TD|BLOCKQUOTE|SCRIPT)$');while(el){switch(el.nodeType){case 3:var str=el.data.replace(/^\n|\n$/g,' ').replace(/[\n\xa0]/g,' ').replace(/[ ]+/g,' ');str=str?str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#039;'):'';v+=str;break;case 1:var str=_this.cleanMessage(el);if(el.tagName&&el.tagName.match(contTag)&&str){if(str.substr(-1)!='\n'){str+='\n';}
var prev=el.previousSibling;while(prev&&prev.nodeType==3&&trim(prev.nodeValue)==''){prev=prev.previousSibling;}
if(prev&&!(prev.tagName&&prev.tagName.match(contTag))){str='\n'+str;}}else if(el.tagName=='IMG'){str+='<img src="https://saas-support.com/widget/img/blank.gif" class="ws-emoji" style="'+el.getAttribute('style')+'">';}else if(el.tagName=='BR'){str+='\n';}
v+=str;break;}
el=el.nextSibling;}
return $.trim(v);},create:function(message,hash,type,googleRegistrationIds){var that=this;if(!s.chatCreating){s.chatCreating=true;var url=WBK.settings.serverUrl+"/api?action=chatCreate&callback=?";jWS.getJSON(url,{code:WBK.settings.whiteSaasCode,visitorName:WBK.settings.visitorName?WBK.settings.visitorName:'',message:message,type:type,hash:hash,visitorId:WBK.settings.visitorId,chatWidgetId:WBK.settings.chatWidgetId},function(result){if(result.Success&&result.Data&&result.Data.chat){for(var key=0;key<s.invitations.length;key++){wsUtil.deleteInterval('invitationShow_'+key);}
WBK.settings.chatId=result.Data.chat.id;s.chat_visitor_color=result.Data.chat.color;s.chat_visitor_name=result.Data.chat.visitor_name;s.chat_visitor_img=result.Data.chat.img;s.chat_introduced=result.Data.chat.introduced;if(!WBK.settings.socket){WBK.initSocket(function(){if(!s.chat_created){WBK.settings.socket.emit('chatCreated',{chat_id:WBK.settings.chatId,chat_widget_id:result.Data.chat.chat_widget_id,visitor_name:WBK.settings.visitorName?WBK.settings.visitorName:result.Data.chat.visitor_name,color:result.Data.chat.color,img:result.Data.chat.img,created_at:result.Data.chat.created_at,message_id:result.Data.messageId,hash:hash,message:message,type:type,googleRegistrationIds:googleRegistrationIds,fcmData:that.getFcmData(message,true),introduced:result.Data.chat.introduced,introduce_type:result.Data.chat.introduce_type,users_to_notification:result.Data.chat.users_to_notification});s.chat_created=true;}});}
else{if(!s.chat_created){WBK.settings.socket.emit('chatCreated',{chat_id:WBK.settings.chatId,chat_widget_id:result.Data.chat.chat_widget_id,visitor_name:WBK.settings.visitorName?WBK.settings.visitorName:result.Data.chat.visitor_name,color:result.Data.chat.color,img:result.Data.chat.img,created_at:result.Data.chat.created_at,message_id:result.Data.messageId,hash:hash,message:message,type:type,googleRegistrationIds:googleRegistrationIds,fcmData:that.getFcmDatagcm_registration_id(message,true),introduced:result.Data.chat.introduced,introduce_type:result.Data.chat.introduce_type,users_to_notification:result.Data.chat.users_to_notification});s.chat_created=true;}}
s.chatCreating=false;}});}else{wsUtil.setInterval('chatCreating_'+hash,function(e){if(!s.chatCreating){wsUtil.deleteInterval('chatCreating_'+hash);_this.message(message,hash,type,googleRegistrationIds);}},1000);}},start:function(){if(WBK.settings.chatId){var siteUrl='';if(document.URL){siteUrl=encodeURIComponent(document.URL);}
if(!WBK.settings.socket){WBK.initSocket(function(){WBK.settings.socket.emit('chatStarted',{chat_id:WBK.settings.chatId,visitor_name:WBK.settings.visitorName,url:siteUrl});s.chat_created=true;});}
else{WBK.settings.socket.emit('chatStarted',{chat_id:WBK.settings.chatId,visitor_name:WBK.settings.visitorName,url:siteUrl});s.chat_created=true;}}},printing:function(message){if(WBK.settings.socket&&WBK.settings.chatId){WBK.settings.socket.emit('printing',{chat_id:WBK.settings.chatId,message:message});}},message:function(message,hash,type,googleRegistrationIds){var messageData={message:JSON.parse(message)};messageData.message_type=type;if(WBK.settings.socket&&WBK.settings.chatId){WBK.settings.socket.emit('message',{chat_id:WBK.settings.chatId,message:message,hash:hash,type:type,googleRegistrationIds:googleRegistrationIds,fcmData:this.getFcmData(messageData,false)});}},getFcmData:function(message,isFirstMessage){var name=WBK.settings.visitorName?WBK.settings.visitorName:(s.user_name?s.user_name:s.chat_visitor_name);var text='Новое сообщение';var img_url='';if(s.auth_type!='default'){img_url=s.logo_visitor;}
else{if(s.chat_visitor_img){img_url=s.chat_visitor_img;}
else{img_url=WBK.settings.serverUrl+'/firstletter/?name='+name.substr(0,1)+'&color='+s.chat_visitor_color;}}
switch(message.message_type){case'show_invitation':case'text':text=message.message.text.replace(/(?:\r\n|\r|\n)/g,'<br />');break;case'attach_image':text='Посетитель отправил изображение';break;case'attach_file':text='Посетитель отправил документ';break;case'rating':text='Посетитель оценил работу оператора';break;case'introduced':text='Посетитель представился';break;default:break;}
var fcmData={is_first:isFirstMessage,chat_id:WBK.settings.chatId,name:name,message:text,color:s.chat_visitor_color,introduced:s.chat_introduced,auth_type:s.auth_type,image:img_url,vk_id:s.visitor_vk_id,fb_id:s.visitor_fb_id};return fcmData;},messageReceived:function(data){if(WBK.settings.socket){WBK.settings.socket.emit('messageReceived',data);}},messageRead:function(data){if(WBK.settings.socket){WBK.settings.socket.emit('messageRead',data);}},messageReadVisitor:function(sync){for(var index in s.unread_messages){if(!sync){_this.messageRead(s.unread_messages[index]);}
delete s.unread_messages[index];}
_this.setUnreadMessages(0);},messageReadOperator:function(hash){var mess=w.window.find('.ws-chat-body-content').find('#mess_'+hash);mess.data('read',true);var el=mess.closest('.ws-chat-message-block');var messages=el.find('.ws-chat-message');if(messages.length){var res=true;messages.each(function(key,value){if($(value).data('read')==false){res=false;}});if(res){el.find('.ws-chat-message-status').text(s.lang_text.is_read);}}},setUnreadMessages:function(count){var favicon_el=$('link[rel="shortcut icon"], link[rel="icon"]');if(count>99){count=99;}
wsUtil.deleteInterval('unreadMessages');if(count==0){w.btn.find('.ws-btn-badge').text('').hide();s.unread_messages_count=0;document.title=s.document_title;s.new_favicon_href='';if(s.document_favicon_href){favicon_el.attr('href',s.document_favicon_href);}
return;}
w.btn.find('.ws-btn-badge').text(count).show();if(s.document_favicon_href){var img=$('<img crossOrigin="anonymous" src="'+s.document_favicon_href+'"/>');img.load(function(){s.new_favicon_href=_this.generateFavicon(img,count);wsUtil.setInterval('unreadMessages',function(){if(s.document_title==document.title){document.title=wsUtil.doEnding(count,s.lang_text.one_new_mess,s.lang_text.two_new_mess,s.lang_text.five_new_mess);if(s.new_favicon_href){favicon_el.attr('href',s.new_favicon_href);}}else{document.title=s.document_title;if(s.document_favicon_href){favicon_el.attr('href',s.document_favicon_href)}}},1000);}).error(function(){wsUtil.setInterval('unreadMessages',function(){if(s.document_title==document.title){document.title=count+' '+wsUtil.doEnding(count,s.lang_text.one_new_mess,s.lang_text.two_new_mess,s.lang_text.five_new_mess);}else{document.title=s.document_title;}},1000);});}else{wsUtil.setInterval('unreadMessages',function(){if(s.document_title==document.title){document.title=count+' '+wsUtil.doEnding(count,s.lang_text.one_new_mess,s.lang_text.two_new_mess,s.lang_text.five_new_mess);}else{document.title=s.document_title;}},1000);}},generateFavicon:function(img,count){if(!s.document_favicon_href){return;}
var canvas=$('<canvas/>'),ctx,link=$('link[rel="shortcut icon"], link[rel="icon"]');if(canvas[0].getContext('2d')){canvas[0].height=canvas[0].width=img[0].width;ctx=canvas[0].getContext('2d');if(count){ctx.globalAlpha=0.4;if(count<10){count=' '+count;}else if(count>100){count=99;}}
var multiplier=img[0].width/16;var fontSize=multiplier*11;var xOffset=multiplier;var yOffset=multiplier*11;var border=multiplier;var shadow=multiplier*2;ctx.drawImage(img[0],0,0);ctx.globalAlpha=1.0;ctx.font='bold '+fontSize+'px "helvetica", sans-serif';ctx.shadowColor='#FFF';ctx.shadowBlur=shadow;ctx.shadowOffsetX=0;ctx.shadowOffsetY=0;ctx.fillStyle='#FFF';ctx.fillText(count,xOffset,yOffset);ctx.fillText(count,xOffset+border,yOffset);ctx.fillText(count,xOffset,yOffset+border);ctx.fillText(count,xOffset+border,yOffset+border);ctx.fillStyle='#000';ctx.fillText(count,xOffset+(border/2.0),yOffset+(border/2.0));return canvas[0].toDataURL('image/png');}},scroll:function(){w.window.find(".ws-chat-body").nanoScroller();w.window.find(".ws-chat-body").nanoScroller({scrollBottom:0});},initBtnPosition:function(){var css={};var css_invitation={};w.btn.show();if(WBK.settings.device!='pc'){_this.updateBtnPositionMobile();}else{switch(s.button_location){case'horizontal':switch(s.position_x){case'left':css.left=s.position_x_value+'%';css.right='auto';w.invitation.addClass('ws-chat-invitation-left');break;case'right':css.right=s.position_x_value+'%';css.left='auto';break;}
switch(s.position_y){case'bottom':css.bottom=s.position_y_value+'%';css.top='auto';if(s.position_y_value==0){w.btn.addClass('ws-chat-btn-attach')}
WBK.addStyles(".ws-chat .ws-chat-invitation-container:after{border-top-color: "+s.color_background_invitation+" !important;}");break;case'top':css.top=s.position_y_value+'%';css.bottom='auto';if(s.position_y_value==0){w.btn.addClass('ws-chat-btn-attach-top');w.btn.find('.ws-btn-badge').css('top','32px');}
w.invitation.addClass('ws-chat-invitation-bottom');WBK.addStyles(".ws-chat .ws-chat-invitation-container:after{border-bottom-color: "+s.color_background_invitation+" !important;}");break;}
break;case'vertical_left':w.btn.addClass('ws-chat-btn-rotate').addClass('ws-chat-btn-attach-top');w.btn.find('.ws-btn-badge').css('top','32px');css.left=-(w.btn.outerWidth()-w.btn.outerHeight())/2+'px';css.right='auto';css_invitation.left=w.btn.outerWidth()/2+w.btn.outerHeight()+'px';css_invitation.right='auto';w.invitation.addClass('ws-chat-invitation-rotate-right');WBK.addStyles(".ws-chat .ws-chat-invitation-container:after{border-right-color: "+s.color_background_invitation+" !important;}");break;case'vertical_right':w.btn.addClass('ws-chat-btn-rotate').addClass('ws-chat-btn-attach');css.right=-(w.btn.outerWidth()-w.btn.outerHeight())/2+'px';css.left='auto';css_invitation.right=w.btn.outerWidth()/2+w.btn.outerHeight()+'px';css_invitation.left='auto';w.invitation.addClass('ws-chat-invitation-rotate-left');WBK.addStyles(".ws-chat .ws-chat-invitation-container:after{border-left-color: "+s.color_background_invitation+" !important;}");break;}
if(s.button_location=='vertical_left'||s.button_location=='vertical_right'){switch(s.position_y){case'bottom':css.bottom=(w.btn.outerWidth()-w.btn.outerHeight())/2+$(window).height()/100*s.position_y_value+'px';css.top='auto';break;case'top':css.top=(w.btn.outerWidth()-w.btn.outerHeight())/2+$(window).height()/100*s.position_y_value+'px';css.bottom='auto';break;}
w.invitation.css({top:-(w.btn.outerWidth()-w.btn.outerHeight())/2+'px',bottom:'auto',left:css_invitation.left,right:css_invitation.right});}
w.btn_el.css(css);}
w.btn.hide();},updateBtnPositionMobile:function(){var _this=this;var ratio_screen=(window.innerWidth/WBK.getDeviceWidth());if(ratio_screen!=1){s.scallingMobile=true;}else{s.scallingMobile=false;}
if(!s.scallingMobile){w.btn_el.addClass('ws-chat-not-scalling');var position={'transform':'scale(1)'};if(s.mobile_position_x==='right'){position.right=s.mobile_position_x_value+'%';position.left='auto';}else{position.left=s.mobile_position_x_value+'%';position.right='auto';}
if(s.mobile_position_y==='bottom'){position.bottom=s.mobile_position_y_value+'%';position.top='auto';}else{position.top=s.mobile_position_y_value+'%';position.bottom='auto';}
w.btn_el.css(position);w.btn_el.show();}else{w.btn_el.removeClass('ws-chat-not-scalling');var el_width=w.btn_el.outerWidth();var el_height=w.btn_el.outerHeight();var rat_w=(el_width-(el_width*ratio_screen))/2;var rat_h=(el_height-(el_height*ratio_screen))/2;var positionLeft;if(s.mobile_position_x==='right'){positionLeft=$(window).scrollLeft()+window.innerWidth*((100-s.mobile_position_x_value)/100)-(ratio_screen*el_width)-rat_w;}else{positionLeft=$(window).scrollLeft()+window.innerWidth*(s.mobile_position_x_value/100)-rat_w;}
var positionTop;if(s.mobile_position_y==='bottom'){positionTop=$(window).scrollTop()+window.innerHeight*((100-s.mobile_position_y_value)/100)-(ratio_screen*el_height)-rat_h;}else{positionTop=$(window).scrollTop()+window.innerHeight*(s.mobile_position_y_value/100)-rat_h;}
w.btn_el.css({'top':positionTop+'px','bottom':'auto','left':positionLeft+'px','right':'auto','-webkit-transform':'scale('+ratio_screen+')','-khtml-transform':'scale('+ratio_screen+')','-moz-transform':'scale('+ratio_screen+')','-ms-transform':'scale('+ratio_screen+')','-o-transform':'scale('+ratio_screen+')','transform':'scale('+ratio_screen+')','z-index':'inherit'});wsUtil.setTimeout('zIndex',function(){w.btn_el.css('z-index',2147483645);if(parseInt(s.hide_zoom)){wsUtil.setTimeout('btnElShow',function(){w.btn_el.show();},150);}},50);}},initWindowPosition:function(){if(WBK.settings.device=='pc'){var top_btn=w.btn_el.position().top;var left_btn=w.btn_el.position().left;var h_window=w.window.outerHeight();var w_window=w.window.width();var h_btn=w.btn.outerHeight();var doc_w=$(window).width();var doc_h=window.innerHeight;var ico_left=0;if(w.window.hasClass('ws-chat-ico-bottom')){ico_left=64;}
if(left_btn+w_window>doc_w){ico_left=0;left_btn=doc_w-w_window;}
top_btn=top_btn-h_window+h_btn;if(top_btn<0){top_btn=0;}
if(left_btn<0){left_btn=0;}
if(top_btn+h_window>doc_h){top_btn=doc_h-h_window;}
w.window.css({top:top_btn/(doc_h/100)+'%',left:(left_btn+ico_left)/(doc_w/100)+'%'});WBK.animateFastOnce(w.window,'cbk-zoomIn');}},updateWindowPosition:function(){var top_window=w.window.position().top;var left_window=w.window.position().left;var h_window=w.window.height();var w_window=w.window.width();var doc_w=$(window).width();var doc_h=window.innerHeight;var ico_left=0;if(w.window.hasClass('ws-chat-ico-bottom')){ico_left=64;}
if(left_window+w_window+ico_left>doc_w-15){left_window=doc_w-w_window-ico_left-15;}
w.window.css({left:(left_window+ico_left)/(doc_w/100)+'%'});WBK.animateFastOnce(w.window,'cbk-zoomIn');},loadBtnEvents:function(){w.btn.on('click',function(){if(WBK.settings.chatInvitationOpened==true){_this.hideInvitation();}
_this.showWidget();_this.sendGoal('open');});w.invitation.on('click',function(e){_this.hideInvitation();if($(e.target).hasClass('ws-chat-invitation-close')||$(e.target).hasClass('ws-icon-close')){return;}
_this.showWidget();_this.sendGoal('open');});},loadWindowEvents:function(){if(!$.fn._frameCheck()||typeof WBK!=='undefined'){try{$('body').on('click','a[href="#showchat"], a[href="'+window.top.location.origin+'#showchat"], a[href="'+window.top.location.origin+'/#showchat"]',function(e){_this.showWidget();_this.sendGoal('open');e.preventDefault();return false;});}catch(error){}}
w.window.find('.ws-chat-close').on('click',function(){_this.hideWidget();});$(document).on('click','.ws-chat-message-element-file',function(){if(s.chat_created){var hash=new Date().getTime();var data={file_name:$(this).data('fileName'),file_name_upload:$(this).data('fileNameUpload')};_this.sendNode(JSON.stringify(data),hash,'start_download');}});$(document).on('click','.ws-chat-uploaded-el-close',function(){var index=$(this).parent().data('index');if(index){delete s.fileUploaded[index];_this.updateFilesUploaded();}});w.window.find('.ws-chat-sound').on('click',function(){if(s.sound=='on'){s.sound='off';w.window.find('.ws-chat-sound').attr('title',s.lang_text.sound_on);w.window.find('.ws-chat-sound i').removeClass('ws-icon-sound-on').addClass('ws-icon-sound-off');}else{s.sound='on';w.window.find('.ws-chat-sound').attr('title',s.lang_text.sound_off);w.window.find('.ws-chat-sound i').removeClass('ws-icon-sound-off').addClass('ws-icon-sound-on');}
var d=new Date();d.setMinutes(d.getMinutes()+60*24*30);wsUtil.setCookie('WidgetChat_sound_'+WBK.settings.chatWidgetId,s.sound,d);});w.window.find('.ws-textarea').bind('keypress',function(e){var code=e.keyCode||e.which;if(code==13){e.preventDefault();_this.sendMessage();w.window.find('.ws-textarea-send-btn').hide();}});w.window.find('.ws-textarea').bind('keyup',function(e){var code=e.keyCode||e.which;if(code!=37&&code!=38&&code!=39&&code!=40&&code!=37&&code!=33&&code!=34){_this.inputScroll();}});w.window.find('.ws-textarea').bind('keydown',function(e){var code=e.keyCode||e.which;if(code==8){_this.inputScroll();}});w.window.find('.ws-textarea').on('paste',function(e){e.preventDefault();var text='';if(e.originalEvent||e.originalEvent.clipboardData.getData('text/plain')){text=e.originalEvent.clipboardData.getData('text/plain');}
if(text){text=text.replace(/^\n|\n$/g,'<br>').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#039;');_this.insertHTML(text);}
var blob,items=(e.clipboardData||e.originalEvent.clipboardData);if(!items){return;}else{items=items.items;}
if(!items){return;}
var image=false;for(var i=0;i<items.length;i++){if(items[i].type.indexOf("image")==0){image=items[i].getAsFile();}}
if(image){image.name=image.filename='image_'+new Date().getTime()+'.png';var file=new File([image],image.filename);var form=new FormData();form.append("img",file);form.append("type","img");form.append("image_type","screen");form.append("chat_id",WBK.settings.chatId);_this.uploadFileServer(form,'img');}});w.window.find('.ws-textarea-send-btn').on('click',function(e){_this.sendMessage();w.window.find('.ws-textarea-send-btn').hide();w.window.find('.ws-textarea').focus();});$(document).on('click','.ws-chat-message-user .ws-chat-message-name-text',function(){_this.showPreform('preform');});$(document).on('click','.ws-chat-message-robot .ws-chat-message-input',function(){_this.showPreform('preform');$(this).closest('.ws-chat-message-robot').remove();});$(document).on('click','.ws-chat-autoreply-btn',function(){_this.showPreform('lead',$(this).data('index'));});$(document).on('click','.ws-chat-message-manager .ws-chat-message-name-text, .ws-chat-ico .ws-chat-logo',function(){var text=' '+$(this).data('name')+',&nbsp;';if(!w.window.find('.ws-textarea').is(':focus')){w.window.find('.ws-textarea').focus();}
_this.insertHTML(text);});w.window.find('.ws-textarea').bind('keyup',function(e){var code=e.keyCode||e.which;if(code!=13){if($('.ws-textarea').html()!=''){w.window.find('.ws-textarea-send-btn').show();var message=_this.cleanMessage($('.ws-textarea'));_this.printing(message);}else{if(s.fileUploadedCount==0){w.window.find('.ws-textarea-send-btn').hide();}}}});w.window.find('.ws-textarea').on('focus',function(){_this.messageReadVisitor(false);});w.window.find('.ws-btn-smile, .ws-smile-container').mouseenter(function(){wsUtil.deleteTimeout('hideSmileContainer');w.window.find('.ws-file-container').hide();w.window.find('.ws-smile-container').show();}).mouseleave(function(){wsUtil.setTimeout('hideSmileContainer',function(){w.window.find('.ws-smile-container').hide();},300);});w.window.find('.ws-btn-file, .ws-file-container').mouseenter(function(){wsUtil.deleteTimeout('hideFileContainer');w.window.find('.ws-smile-container').hide();w.window.find('.ws-file-container').show();}).mouseleave(function(){wsUtil.setTimeout('hideFileContainer',function(){w.window.find('.ws-file-container').hide();},300);});$(window).on('resize.ws-chat',function(){wsUtil.setTimeout('resizeChat',function(){if(WBK.settings.device!='pc'){_this.updateBtnPositionMobile();}else{if(!WBK.settings.chatWindowOpened){_this.initWindowPosition();}else{_this.updateWindowPosition();}}},500);});if(WBK.settings.device=='pc'){w.window.find('.ws-chat-header').on('mousedown',function(e){if(e.which!==1||$(e.target).hasClass('ws-chat-close')||$(e.target).hasClass('ws-icon-close')||$(e.target).hasClass('ws-chat-sound')||$(e.target).hasClass('ws-icon-sound-on')||$(e.target).hasClass('ws-icon-sound-off')){return;}
w.window.addClass('ws-chat-drag');s.dragChatObject.elem=w.window;s.dragChatObject.downX=e.pageX;s.dragChatObject.downY=e.pageY;});$(document).on('mouseup.ws-chat-header',function(e){if(s.dragChatObject.dragStarted){s.dragChatObject.dragStarted=false;var d=new Date();d.setMinutes(d.getMinutes()+60*24);var data=JSON.stringify({top:w.window.css('top'),left:w.window.css('left'),width:w.window.css('width'),height:w.window.css('height')});wsUtil.setCookie('WidgetChat_settings_'+WBK.settings.chatWidgetId,data,d);}
w.window.removeClass('ws-chat-drag');s.dragChatObject={};});$(document).on('mousemove.ws-chat-header',function(e){if(s.dragChatObject.elem){var moveX=e.pageX-s.dragChatObject.downX;var moveY=e.pageY-s.dragChatObject.downY;if(Math.abs(moveX)<3&&Math.abs(moveY)<3){return;}
if(!s.dragChatObject.dragStarted){s.dragChatObject.oldPosition={left:s.dragChatObject.elem.position().left||'',top:s.dragChatObject.elem.position().top||''};s.dragChatObject.shiftX=s.dragChatObject.downX-s.dragChatObject.elem.position().left;s.dragChatObject.shiftY=s.dragChatObject.downY-s.dragChatObject.elem.position().top;s.dragChatObject.dragStarted=true;}
var pos_left=e.pageX-s.dragChatObject.shiftX;var pos_top=e.pageY-s.dragChatObject.shiftY;var doc_w=$(window).width();var doc_h=window.innerHeight;if(s.dragChatObject.elem.outerHeight()>doc_h){pos_top=0;}else if(pos_top+s.dragChatObject.elem.outerHeight()>doc_h-10){pos_top=doc_h-s.dragChatObject.elem.outerHeight();}else{pos_top=pos_top<10?0:pos_top}
if(s.dragChatObject.elem.outerWidth()+pos_left>doc_w){pos_left=doc_w-s.dragChatObject.elem.outerWidth();}else{pos_left=pos_left<10?0:pos_left}
if(pos_left<100&&w.window.hasClass('ws-chat-ico-bottom')){w.window.addClass('ws-chat-ico-bottom-right');}else{w.window.removeClass('ws-chat-ico-bottom-right');}
s.dragChatObject.elem.css({left:pos_left+'px',top:pos_top+'px',right:'auto',bottom:'auto'});}});if(s.chat_is_online){w.window.find('.ws-chat-resize').on('mousedown',function(e){if(e.which!==1){return;}
s.resizeChatObject.elem=w.window;s.resizeChatObject.elemMinSizeHeight=310+46+19;s.resizeChatObject.elemMinSizeHeight=s.resizeChatObject.elemMinSizeHeight+s.resizeChatObject.elem.find('.ws-chat-footer').outerHeight();s.resizeChatObject.downX=e.pageX;s.resizeChatObject.downY=e.pageY;w.window.addClass('ws-chat-no-select');});$(document).on('mouseup.ws-chat-resize',function(e){if(s.resizeChatObject.dragStarted){s.resizeChatObject.dragStarted=false;var d=new Date();d.setMinutes(d.getMinutes()+60*24);var data=JSON.stringify({top:w.window.css('top'),left:w.window.css('left'),width:w.window.css('width'),height:w.window.css('height')});wsUtil.setCookie('WidgetChat_settings_'+WBK.settings.chatWidgetId,data,d);_this.inputScroll();}
s.resizeChatObject={};w.window.removeClass('ws-chat-no-select');_this.typingPositionUpdate();});$(document).on('mousemove.ws-chat-resize',function(e){if(s.resizeChatObject.elem){var moveX=e.pageX-s.resizeChatObject.downX;var moveY=e.pageY-s.resizeChatObject.downY;if(Math.abs(moveX)<3&&Math.abs(moveY)<3){return;}
if(!s.resizeChatObject.dragStarted){s.resizeChatObject.old={width:s.resizeChatObject.elem.outerWidth(),height:s.resizeChatObject.elem.outerHeight(),left:s.resizeChatObject.elem.position().left||'',top:s.resizeChatObject.elem.position().top||''};s.resizeChatObject.shiftX=s.resizeChatObject.downX-s.resizeChatObject.elem.position().left;s.resizeChatObject.shiftY=s.resizeChatObject.downY-s.resizeChatObject.elem.position().top;s.resizeChatObject.dragStarted=true;}
s.resizeChatObject.dragStarted=true;var w_window=e.pageX-s.resizeChatObject.downX;var h_window=e.pageY-s.resizeChatObject.downY;var doc_w=$(window).width();var doc_h=window.innerHeight;var height=s.resizeChatObject.old.height+h_window;var width=s.resizeChatObject.old.width+w_window;if(s.resizeChatObject.elem.position().top+height>doc_h){var old_height=height;height=doc_h-s.resizeChatObject.elem.position().top;}
if(s.resizeChatObject.elem.position().left+width>doc_w){width=doc_w-s.resizeChatObject.elem.position().left;}
s.resizeChatObject.elem.css({width:width>338?width:338,height:height>=400?height:400});_this.scroll();}});}}else{$(window).on('scroll.ws-chat',function(){if(parseInt(s.hide_zoom)){w.btn_el.hide();}
wsUtil.setTimeout('scrollTimerChat',function(){_this.updateBtnPositionMobile();},250);});s.windowRatioChat=window.innerWidth/window.screen.availWidth;wsUtil.setInterval('mobileResizeChat',function(){if(s.windowRatioChat!==(window.innerWidth/window.screen.availWidth)){s.windowRatioChat=window.innerWidth/window.screen.availWidth;_this.updateBtnPositionMobile();}},250);}
w.window.find('.ws-file-upload').on('change',function(e){e.preventDefault();w.window.find('.ws-file-container').hide();_this.uploadFile($(this).data('type'));});w.window.find('.ws-offline-btn').on('click',function(){_this.sendOfflineMessage();});w.window.find('.ws-preform-btn-cancel').on('click',function(){_this.hidePreform();});w.window.find('.ws-preform-btn-save').on('click',function(){_this.savePreform($(this).data('type'),$(this).data('index'));});w.window.find('.ws-chat-social-vk').on('click',function(){var swidth=675;var sheight=380;var left=(screen.width-swidth)/2;var top=(screen.height-sheight)/4;open(WBK.settings.serverUrl+'/chat/auth_vk/?origin='+window.location.origin,"publish","width="+swidth+",height="+sheight+", top="+top+", left="+left+",resizable=yes,scrollbars=yes,status=yes");});w.window.find('.ws-chat-social-fb').on('click',function(){var swidth=675;var sheight=380;var left=(screen.width-swidth)/2;var top=(screen.height-sheight)/4;open(WBK.settings.serverUrl+'/chat/auth_fb/?origin='+window.location.origin,"publish","width="+swidth+",height="+sheight+", top="+top+", left="+left+",resizable=yes,scrollbars=yes,status=yes");});$(window).on('message',function(data){var data=data.originalEvent.data;if(!data){return;}
switch(data.type){case'vk_auth':_this.vkAuth(data);break;case'fb_auth':_this.fbAuth(data);break;}});w.window.find('.ws-preform-input').bind('keypress',function(e){var code=e.keyCode||e.which;if(code==13){e.preventDefault();_this.savePreform($('.ws-preform-btn-save').data('type'),$(this).data('index'));}});if(WBK.settings.phoneMasks){var listRU=$.masksSort(WBK.settings.phoneMasks,['#'],/[0-9]|#/,"mask");var optsRU={inputmask:{definitions:{'#':{validator:"[0-9]",cardinality:1}},clearIncomplete:false,showMaskOnHover:false,autoUnmask:true},match:/[0-9]/,replace:'#',list:listRU,listKey:"mask",onMaskChange:function(){$(this).attr("placeholder",$(this).inputmask("getemptymask"));}};$('.ws-offline-phone').inputmasks(optsRU);$('.ws-preform-phone').inputmasks(optsRU);$('.cbk-phone-checker').inputmasks(optsRU);}},vkAuth:function(info){s.visitor_vk_id=info.user_id;$.ajax({url:'https://api.vk.com/method/users.get?user_ids='+info.user_id+'&fields=photo_100&lang=ru&v=5.45',type:'GET',dataType:'jsonp',crossDomain:true,success:function(data){w.window.find('.ws-preform-name').val(data.response[0].first_name+' '+data.response[0].last_name);if(info.email){w.window.find('.ws-preform-email').val(info.email);}
if(data.response[0].photo_100){s.logo_visitor=data.response[0].photo_100;}
s.auth_type='vk';_this.savePreform($('.ws-preform-btn-save').data('type'),$('.ws-preform-btn-save').data('index'));}});},fbAuth:function(info){s.visitor_fb_token=info.access_token;$.ajax({url:'https://graph.facebook.com/me?fields=id,email,first_name,last_name,picture.width(100).height(100)&access_token='+info.access_token,type:'GET',dataType:'jsonp',crossDomain:true,success:function(data){s.visitor_fb_id=data.id;w.window.find('.ws-preform-name').val(data.first_name+' '+data.last_name);if(data.email){w.window.find('.ws-preform-email').val(data.email);}
if(data.picture.data.url){s.logo_visitor=data.picture.data.url;}
s.auth_type='fb';_this.savePreform($('.ws-preform-btn-save').data('type'),$('.ws-preform-btn-save').data('index'));}});},updateUser:function(){if(s.visitorData){s.auth_type=s.visitorData.type;s.logo_visitor=s.visitorData.img;s.visitorData=false;}
s.user_name=WBK.settings.visitorName?WBK.settings.visitorName:"";s.user_email=WBK.settings.visitorEmail?WBK.settings.visitorEmail:"";s.user_phone=WBK.settings.visitorPhone?WBK.settings.visitorPhone:"";if(s.chat_created){w.window.find('.ws-chat-message-user').find('.ws-chat-message-name-text').text(s.user_name);_this.logoVisitor(true);w.window.find('.ws-chat-message-user').find('.ws-chat-message-name-text').text(s.user_name);var hash=new Date();hash=hash.getTime();var message={visitor_name:s.user_name,visitor_email:s.user_email,visitor_phone:s.user_phone,auth_type:s.auth_type,image:s.logo_visitor,vk_id:s.visitor_vk_id,fb_id:s.visitor_fb_id};if(!WBK.settings.socket){WBK.initSocket(function(){WBK.settings.socket.emit('introduced',{chat_id:WBK.settings.chatId,visitor_name:s.user_name,visitor_email:s.user_email,visitor_phone:s.user_phone,hash:hash,message:JSON.stringify(message),type:'introduced'});});}else{WBK.settings.socket.emit('introduced',{chat_id:WBK.settings.chatId,visitor_name:s.user_name,visitor_email:s.user_email,visitor_phone:s.user_phone,hash:hash,message:JSON.stringify(message),type:'introduced'});}}},operatorsIsOnline:function(){var result=false;s.operators_id=[];s.operators_online_id=[];s.operators_array=[];if(s.all_operators){$.each(s.all_operators,function(index,value){if(s.all_operators[index]['user_logo']&&s.all_operators[index]['connected_at']){s.operators_array.push(s.all_operators[index]);}
s.operators_id.push(s.all_operators[index].user_id+'_'+s.all_operators[index].employee_id);if(parseInt(s.all_operators[index].status)){s.operators_online_id.push(s.all_operators[index].user_id+'_'+s.all_operators[index].employee_id);result=true;if(result){return;}}});}
return result;},addMessage:function(data){var mess_block_class="";var last_user=true;var name;var status=s.lang_text.is_received;var read=false;if(data.is_read){status=s.lang_text.is_read;read=true;}
data.user=data.user?data.user:'';data.date=_this.dateFormat(data.date);switch(data.message_type){case'introduced':case'error':case'start_download':case'open_window':case'close_window':case'auto_ended':case'not_require_answer':case'close_chat':case'crm_integration_sended':case'invite_to_chat':case'':return false;break;case'show_invitation':case'text':s.messages_quant_to_rate++;data.message=data.message.text.replace(/(?:\r\n|\r|\n)/g,'<br />');break;case'auto_reply':if(!data.auto_reply_get_contact){data.message=wsUtil.specialChars(data.message.text);}else{var text_btn=s.autoreplies[data.auto_reply_index]['text_btn']?s.autoreplies[data.auto_reply_index]['text_btn']:s.lang_text.autoreply_link;data.message=wsUtil.specialChars(data.message.text)+'<br><div class="ws-chat-autoreply-link"><a data-index="'+data.auto_reply_index+'" class="ws-chat-autoreply-btn" href="#">'+text_btn+'</a></div>';var cookieDate=new Date();cookieDate.setMinutes(cookieDate.getMinutes()+60*24*30);wsUtil.setCookie('WidgetChat_autoreply_getcontact_'+WBK.settings.chatId,true,cookieDate);}
break;case'attach_image':s.messages_quant_to_rate++;var link='';switch(data.message.img_type){case'link':link=data.message.img_url;break;case'uploaded':link=WBK.settings.serverUrl+'/chat/download/?type=image&file='+data.message.file_name_upload+'&filename='+data.message.file_name;break;}
data.message='<a class="ws-chat-message-element"  data-file-name="'+data.message.file_name+'" data-file-name-upload="'+data.message.file_name_upload+'" href="'+link+'" target="_blank">'+'<img class="ws-chat-message-img" src="'+data.message.img_url+'">'+'<div class="ws-foto-hover"></div>'+'<div class="ws-foto-hover-img"></div>'+'</a>';break;case'attach_file':s.messages_quant_to_rate++;var file='<div class="ws-file-block">'+'<div class="ws-file-el">'+'<img class="ws-icon-file" src="'+WBK.settings.staticServerUrl+"/"+data.message.file_ico_url+'"> '+'<div class="ws-file-size">'+data.message.file_size+' '+data.message.file_size_type+'</div>'+'</div>'+'<div class="ws-file-name">'+data.message.file_name+'</div>'+'</div>'+'<div class="ws-file-hover"></div>';data.message='<a class="ws-chat-message-element ws-chat-message-element-file" data-file-name="'+data.message.file_name+'" data-file-name-upload="'+data.message.file_name_upload+'" href="'+WBK.settings.serverUrl+'/chat/download/?type=doc&file='+data.message.file_name_upload+'&filename='+data.message.file_name+'" target="_blank">'+file+'</a>';break;case'connect_to_chat':var userName=data.message.user_name+(data.message.user_surname?' '+data.message.user_surname:'');if(data.date.date_line){w.window.find('.ws-chat-typing').before('<div class="ws-chat-date-block">'+data.date.date_line+'</div>');}
var profession=data.message.user_profession?data.message.user_profession:'';var join_block='<div class="ws-chat-manager-join">'+'<img src="'+WBK.settings.staticServerUrl+data.message.img_url+'" alt="" class="ws-manager-img">'+'<div class="ws-manager-name">'+userName+'</div>'+'<div class="ws-manager-position">'+profession+'</div>'+'<div class="ws-manager-event">'+s.lang_text.join_chat+'</div>'+'</div>';w.window.find('.ws-chat-typing').before(join_block);return false;break;case'disconnect_from_chat':var userName=data.message.user_name+(data.message.user_surname?' '+data.message.user_surname:'');if(data.date.date_line){w.window.find('.ws-chat-typing').before('<div class="ws-chat-date-block">'+data.date.date_line+'</div>');}
var profession=data.message.user_profession?data.message.user_profession:'';var join_block='<div class="ws-chat-manager-join">'+'<img src="'+WBK.settings.staticServerUrl+data.message.img_url+'" alt="" class="ws-manager-img">'+'<div class="ws-manager-name">'+userName+'</div>'+'<div class="ws-manager-position">'+profession+'</div>'+'<div class="ws-manager-event">'+s.lang_text.disconnect_from_chat+'</div>'+'</div>';w.window.find('.ws-chat-typing').before(join_block);return false;break;}
if(data.date.date_line){w.window.find('.ws-chat-typing').before('<div class="ws-chat-date-block">'+data.date.date_line+'</div>');}
var message='<div id="mess_'+data.hash+'" data-read="'+read+'" class="ws-chat-message">'+'<div class="ws-chat-message-source">'+data.message+'</div>'+'<div class="ws-chat-message-date">'+data.date.time+'</div>'+'</div>';var last_block=w.window.find('.ws-chat-body-content').children(":not(.ws-chat-typing,.ws-chat-uploaded-files)").last();switch(data.type){case'manager':s.last_operator_message_id=data.id?data.id:s.last_operator_message_id;mess_block_class="ws-chat-message-manager";last_user=last_block.data('user')==data.user?true:false;var op=this.getOperator(data.user);if(op){name=op.name+(op.surname?' '+op.surname:'');}
break;case'user':name=s.user_name?s.user_name:s.lang_text.default_user;mess_block_class="ws-chat-message-user";break;}
if(last_block.hasClass('ws-chat-robot-hello')||last_block.hasClass('ws-chat-manager-hello')){last_block.css('padding-bottom','10px');}
if(!data.date.new_block&&last_block.hasClass(mess_block_class)&&last_user){last_block.find('.ws-chat-message-date').remove();last_block.find('.ws-chat-message:last').after(message);if(!data.is_read&&data.type=='user'){last_block.find('.ws-chat-message-status').text(status).addClass('ws-chat-message-status');}}else{var logo_block='';var message_status_block='';var title_name='';if(data.type=='manager'){var op=this.getOperator(data.user);logo_block='<div class="ws-chat-message-logo"><img class="ws-chat-message-logo-img" src="'+WBK.settings.staticServerUrl+op.img+'"></div>'}else{var logo_visitor=_this.logoVisitor(false);logo_block='<div class="ws-chat-message-logo">'+logo_visitor+'</div>';message_status_block='<div class="ws-chat-message-status">'+status+'</div>';title_name=s.lang_text.change_name_title;}
var new_block='<div class="ws-chat-message-block '+mess_block_class+'" data-user="'+data.user+'">'+logo_block+'<div class="ws-chat-message-name"><span class="ws-chat-message-name-text" data-name="'+name+'" title="'+title_name+'">'+name+'</span></div>'+
message+
message_status_block+'</div>';w.window.find('.ws-chat-typing').before(new_block);}
if(!data.user){if((!data.is_read||!parseInt(data.is_read))){w.window.find('.ws-chat-message-status:last').addClass('ws-chat-message-status-hidden');wsUtil.setTimeout('show_message_status',function(){var el=w.window.find('.ws-chat-message-status.ws-chat-message-status-hidden');el.removeClass('ws-chat-message-status-hidden');WBK.animateOnce(el,'cbk-flipInY');},1*1000);}}
if(data.type=='manager'&&data.user){_this.updateIcoBottom(data.user);}
if(WBK.settings.chatWindowOpened&&(data.message_type=='attach_image'||data.message_type=='attach_file')){w.window.find('.ws-chat-body-content img:last').load(function(){_this.scroll();});}
_this.typingPositionUpdate();if(data.scroll){_this.scroll();}
return true;},getOperator:function(user_id){var user={img:'/img/avatars/nophoto.png',is_alias:0,name:"Оператор",surname:false,profession:"",status:0,user_logo:'/img/avatars/nophoto.png'};if(typeof s.all_operators[user_id]!='undefined'){user=s.all_operators[user_id];}
return user;},logoVisitor:function(update){var logo_visitor='<img class="ws-chat-message-logo-img" src="'+s.default_logo_visitor+'">';if((s.auth_type=='vk'||s.auth_type=='fb')&&s.logo_visitor){logo_visitor='<img class="ws-chat-message-logo-img" src="'+s.logo_visitor+'">';if(update){w.window.find('.ws-chat-message-user').find('.ws-chat-message-logo').html(logo_visitor);}}else{if(s.user_name){var first_letter=s.user_name.substr(0,1).toUpperCase();logo_visitor='<div class="ws-chat-message-logo-letter">'+first_letter+'</div>'
if(update){w.window.find('.ws-chat-message-user').find('.ws-chat-message-logo-letter').html(logo_visitor);}}}
return logo_visitor;},playSound:function(type){if(s.sound=='off'){return;}
var file='';switch(type){case'message':file='chat1';break;case'send_message':break;case'operator_join':file='chat1';break;}
WBK.Sound(file);},typing:function(data,time){var _this=this;if(time==undefined){time=5000;}
var user=data.user_id+'_'+data.employee_id;var op=this.getOperator(user);var operator_name=(op.name)?op.name:s.lang_text.operator;w.window.find('.ws-chat-typing').find('.ws-manager-name').text(operator_name);_this.typingPositionUpdate();w.window.find('.ws-chat-typing').removeClass('ws-chat-typing-removing');wsUtil.setTimeout('chatTypingActivateTimeout',function(){w.window.find('.ws-chat-typing').addClass('ws-chat-typing-active');},300);wsUtil.setTimeout('chatTypingTimeout',function(){w.window.find('.ws-chat-typing').removeClass('ws-chat-typing-active').addClass('ws-chat-typing-removing');},time);},typingPositionUpdate:function(){var bodyHeight=w.window.find('.ws-chat-body-content').height();var afterHeight=0;var beforeHeight=w.window.find('.ws-chat-typing').outerHeight()+w.window.find('.ws-chat-uploaded-files').outerHeight();w.window.find('.ws-chat-body-content').children(":not(.ws-chat-typing,.ws-chat-uploaded-files)").each(function(i,e){afterHeight+=$(e).outerHeight();if(bodyHeight<afterHeight){return false;}});var outHeight=bodyHeight-afterHeight-6;var marginTop=0;if(outHeight>beforeHeight){marginTop=outHeight-beforeHeight;}
w.window.find('.ws-chat-typing').css('marginTop',marginTop);},operatorClosed:function(){w.window.removeClass('ws-chat-ico-bottom');w.window.find('.ws-chat-ico-container').empty();s.chat_created=false;},getTimeClosedChat:function(){return wsUtil.getStorage('ws_time_closed_chat');},updateTimeClosedChat:function(){wsUtil.setStorage('ws_time_closed_chat',new Date().getTime());},operatorJoin:function(data){var user=data.user_id+'_'+data.employee_id;if(user!=s.invitation_operator_id){_this.addMessage({id:data.id,hash:data.hash,message:JSON.parse(data.message),date:data.created_at,user:user,is_read:false,message_type:data.type,scroll:true});_this.playSound('operator_join');}else{s.invitation_operator_id=false;}
if(!s.chat_operators.hasOwnProperty(user)){var op=this.getOperator(user);s.chat_operators[user]={employee_id:data.employee_id,name:op.name+(op.surname?' '+op.surname:''),user_id:data.user_id,gcm_registration_id:op.gcm_registration_id};}
_this.operatorsUpdate();s.send_autoreply=true;s.send_autoreply_first=false;_this.getAutoReply();_this.scroll();_this.sendGoal('operator_connect');},operatorExit:function(data){var user=data.user_id+'_'+data.employee_id;_this.addMessage({id:data.id,hash:data.hash,message:JSON.parse(data.message),date:data.created_at,user:user,is_read:false,message_type:data.type,scroll:true});w.window.find('.ws-chat-typing').removeClass('ws-chat-typing-active').addClass('ws-chat-typing-removing');if(s.chat_operators.hasOwnProperty(user)){delete s.chat_operators[user];}
_this.operatorsUpdate();_this.scroll();},onVisitorMessage:function(data){if(data.data.type=='show_invitation'||data.data.type=='auto_reply'){return;}
else if(data.data.type=='rating'){data.data.message=JSON.parse(data.data.message);s.chatRate=data.data.message.rate;_this.addMessageRobot(data.data);return;}
var scroll=false;if(WBK.settings.chatWindowOpened){scroll=true;}
_this.addMessage({id:data.data.id,hash:data.data.hash,type:'user',message:JSON.parse(data.data.message),date:data.data.created_at,user:false,is_read:false,message_type:data.data.type,scroll:scroll});_this.playSound('message');this.checkRatingSettings();},onVisitorMessageRead:function(){_this.messageReadVisitor(true);},socketConnected:function(data,callback){if(s.chat_created){_this.reconnect();}
else if(!s.chat_created){if(typeof callback!=='undefined'){callback(data);}}},onOperatorStatus:function(data){if(data.status==1){wsUtil.deleteTimeout('chatOperatorsUpdate');_this.operatorsUpdate(data);}
else{wsUtil.setTimeout('chatOperatorsUpdate',function(){_this.operatorsUpdate(data);},15*1000);}},onConnectToChat:function(data){s.last_operator_data={user_id:data.user_id,employee_id:data.employee_id};if(!jWS.isEmptyObject(s.autoreplies)){_this.stopAutoReply('not_connected');}
_this.operatorJoin(data);},onDisconnectFromChat:function(data){_this.operatorExit(data);if(!jWS.isEmptyObject(s.autoreplies)){_this.stopAutoReply('all');}},onCloseChat:function(data){_this.operatorClosed();_this.stopAutoReply('all');_this.updateTimeClosedChat();},onOperatorPrinting:function(data){if(!jWS.isEmptyObject(s.autoreplies)){_this.stopAutoReply('all');}
_this.typing(data);if(!jWS.isEmptyObject(s.autoreplies)){_this.stopAutoReply('not_answer_operator');}},onOperatorMessage:function(data){var user=data.user_id+'_'+data.employee_id;s.last_operator_data={user_id:data.user_id,employee_id:data.employee_id};wsUtil.deleteTimeout('chatTypingTimeout');w.window.find('.ws-chat-typing').removeClass('ws-chat-typing-active').addClass('ws-chat-typing-removing');var scroll=false;if(WBK.settings.chatWindowOpened){scroll=true;}
var addMessageResult=_this.addMessage({id:data.id,hash:data.hash,type:'manager',message:JSON.parse(data.message),date:false,user:user,is_read:false,message_type:data.type,scroll:scroll});if(addMessageResult){_this.playSound('message');_this.messageReceived(data);s.unread_messages_count+=1;}
s.unread_messages[data.hash]={id:data.id,hash:data.hash};if(w.window.find('.ws-textarea').is(':focus')){_this.messageReadVisitor(false);}else{if(addMessageResult){_this.setUnreadMessages(s.unread_messages_count);}}
if(!WBK.settings.chatWindowOpened&&!WBK.settings.windowOpened&&!WBK.settings.windowGeneratorOpened&&WBK.settings.device=='pc'){_this.showWidget();}
s.send_autoreply=true;if(!jWS.isEmptyObject(s.autoreplies)){_this.stopAutoReply('not_answer_operator');}
this.checkRatingSettings();},onOperatorUpdateMessage:function(data){var user=data.user_id+'_'+data.employee_id;wsUtil.deleteTimeout('chatTypingTimeout');w.window.find('.ws-chat-typing').removeClass('ws-chat-typing-active').addClass('ws-chat-typing-removing');data.message=JSON.parse(data.message);$('#mess_'+data.hash+' .ws-chat-message-source').html(data.message.text);},onMessageRead:function(data){_this.messageReadOperator(data.hash);},onUpdateRegistrationId:function(data){var user=data.user_id+'_'+data.employee_id;if(s.all_operators[user]){s.all_operators[user].gcm_registration_id=data.registration_id;}
if(s.chat_operators[user]){s.chat_operators[user].gcm_registration_id=data.registration_id;}},reconnect:function(){$.getJSON(WBK.settings.serverUrl+"/chat/api/",{action:'getUnreadMessages',chatId:WBK.settings.chatId,chatWidgetId:WBK.settings.chatWidgetId,visitorId:WBK.settings.visitorId,lastOperatorMessageId:(s.last_operator_message_id?s.last_operator_message_id:0)},function(result){if(result.success&&result.data.messages){var scroll=false;if(WBK.settings.chatWindowOpened){scroll=true;}
var messages=result.data.messages;var chatIsClosed=false;for(var id in messages){if(!s.unread_messages.hasOwnProperty(messages[id].hash)){_this.messageReceived(messages[id]);if(messages[id].type=='close_chat'){chatIsClosed=true;}
var user=messages[id].user_id+'_'+messages[id].employee_id;_this.addMessage({id:messages[id].id,hash:messages[id].hash,type:'manager',message:JSON.parse(messages[id].message),date:false,user:user,is_read:false,message_type:messages[id].type,scroll:scroll});s.unread_messages[messages[id].hash]={id:messages[id].id,hash:messages[id].hash};s.unread_messages_count+=1;if(w.window.find('.ws-textarea').is(':focus')){_this.messageReadVisitor(false);}else{_this.setUnreadMessages(s.unread_messages_count);}}}
if(chatIsClosed){_this.messageReadVisitor(false);_this.operatorClosed();}}});},setTemplate:function(){t='<div class="ws-chat">'+'<div class="ws-chat-container ws-chat-round">'+'<div class="ws-chat-header" style="background: '+s.color_background_chat_header+'">'+'<div class="ws-chat-logo"><i class="ws-icon-chat"></i><img src="'+s.chat_widget_logo+'" class="ws-chat-logo-img"><div class="ws-chat-status-round ws-chat-status-online"></div></div>'+'<div class="ws-chat-title" style="color: '+s.color_background_chat_header_text+'">'+s.text_button_online+'</div>'+'<a class="ws-chat-close" style="color: '+s.color_background_chat_header_text+'" href="javascript:void(0)" title="'+s.lang_text.close_title+'"><i class="ws-icon-close" style="color: '+s.color_background_chat_header_text+'"></i></a>'+'<a class="ws-chat-sound" style="color: '+s.color_background_chat_header_text+'" href="javascript:void(0)" title="'+s.lang_text.sound_off+'"><i class="ws-icon-sound-on" style="color: '+s.color_background_chat_header_text+'"></i></a>'+'</div>'+'<div class="ws-chat-body">'+'<div class="ws-chat-rating">'+
s.lang_text.rate_request+'<div class="ws-chat-rating-btns ws-chat-rating-btns-'+s.rate_chat_view+'">'+'<a class="ws-chat-rating-el ws-chat-rating-el-1" href="javascript:void(0)" data-value="1" title="'+s.lang_text.rate_text_1+'"><img src="'+WBK.settings.staticServerUrl+'/widget/img/blank.gif" alt=""></a>'+'<a class="ws-chat-rating-el ws-chat-rating-el-2" href="javascript:void(0)" data-value="2" title="'+s.lang_text.rate_text_2+'"><img src="'+WBK.settings.staticServerUrl+'/widget/img/blank.gif" alt=""></a>'+'<a class="ws-chat-rating-el ws-chat-rating-el-3" href="javascript:void(0)" data-value="3" title="'+s.lang_text.rate_text_3+'"><img src="'+WBK.settings.staticServerUrl+'/widget/img/blank.gif" alt=""></a>'+'<a class="ws-chat-rating-el ws-chat-rating-el-4" href="javascript:void(0)" data-value="4" title="'+s.lang_text.rate_text_4+'"><img src="'+WBK.settings.staticServerUrl+'/widget/img/blank.gif" alt=""></a>'+'<a class="ws-chat-rating-el ws-chat-rating-el-5" href="javascript:void(0)" data-value="5" title="'+s.lang_text.rate_text_5+'"><img src="'+WBK.settings.staticServerUrl+'/widget/img/blank.gif" alt=""></a>'+'</div>'+'</div>'+'<div class="ws-chat-shadow"></div>'+'<div class="ws-chat-body-content">'+'<div class="ws-chat-typing"><span class="ws-chat-typing-action"><i class="ws-icon-typing"></i></span><span class="ws-manager-name"></span> '+s.lang_text.typing+'...</div>'+'<div class="ws-chat-uploaded-files"></div>'+'</div>'+'</div>'+'<div class="ws-chat-body-offline" style="display: none">'+'<div class="ws-chat-offline-text">'+s.offline_text+'</div>'+'<div class="ws-chat-offline-text-success">'+s.lang_text.offline_text_success+'</div>'+'<div class="ws-offline-input-group '+(s.get_contact_offline_name=='hide'?'ws-hide':'')+'">'+'<div class="ws-offline-input-label">'+s.lang_text.form_name+'<span class="ws-input-required">'+(s.get_contact_offline_name=='yes'?' *':'')+'</span></div>'+'<input type="text" class="ws-offline-input ws-offline-name" placeholder="'+s.lang_text.form_name_placeholder+'" value="'+s.user_name+'">'+'</div>'+'<div class="ws-offline-input-group '+(s.get_contact_offline_phone=='hide'?'ws-hide':'')+'">'+'<div class="ws-offline-input-label">'+s.lang_text.form_phone+'<span class="ws-input-required">'+(s.get_contact_offline_phone=='yes'?' *':'')+'</span></div>'+'<input type="text" class="ws-offline-input ws-offline-phone" placeholder="'+s.lang_text.form_phone_placeholder+'" value="'+s.user_phone+'">'+'</div>'+'<div class="ws-offline-input-group '+(s.get_contact_offline_email=='hide'?'ws-hide':'')+'">'+'<div class="ws-offline-input-label">'+s.lang_text.form_email+'<span class="ws-input-required">'+(s.get_contact_offline_email=='yes'?' *':'')+'</span></div>'+'<input type="text" class="ws-offline-input ws-offline-email" placeholder="'+s.lang_text.form_email_placeholder+'" value="'+s.user_email+'">'+'</div>'+'<div class="ws-offline-input-group">'+'<div class="ws-offline-input-label">'+s.lang_text.form_message+'<span class="ws-input-required">'+(s.get_contact_offline_message=='yes'?' *':'')+'</span></div>'+'<div contenteditable="true" class="ws-offline-textarea"></div>'+'<div class="ws-offline-textarea-element">'+'<a class="ws-offline-textarea-btn ws-btn-smile" href="javascript:void(0)"><i class="ws-icon-smile"></i></a>'+'<div class="ws-smile-container ws-smile-container-offline"></div>'+'</div>'+'</div>'+'<div class="ws-offline-input-group'+((s.get_contact_email=='hide'||s.email_service=='off'||!parseInt(s.email_agreement))?' ws-hide':'')+'">'+'<label class="ws-offline-label-agreement">'+'<input type="checkbox" class="ws-offline-email-agreement" checked>'+'<span class="ws-offline-email-agreement-text">'+s.email_agreement_text+'</span>'+'</label>'+'</div>'+'<div class="ws-offline-input-group ws-offline-input-group-btn">'+'<a href="#" class="ws-offline-btn">'+s.lang_text.offline_btn+'</a>'+'</div>'+'</div>'+'<div class="ws-chat-body-preform" style="display: none">'+'<div class="ws-chat-preform-text"></div>'+'<div class="ws-chat-preform-social">'+'<a href="javascript:void(0)" class="ws-chat-social-el ws-chat-social-vk"><img class="ws-chat-social-img" src="'+WBK.settings.staticServerUrl+'/widget/img/vk.png'+'"></a>'+'<a href="javascript:void(0)" class="ws-chat-social-el ws-chat-social-fb"><img class="ws-chat-social-img" src="'+WBK.settings.staticServerUrl+'/widget/img/fb.png'+'"></a>'+'</div>'+'<div class="ws-preform-input-group">'+'<div class="ws-preform-input-label"></div>'+'<input type="text" class="ws-preform-input ws-preform-name" placeholder="'+s.lang_text.form_name_placeholder+'" value="'+s.user_name+'">'+'</div>'+'<div class="ws-preform-input-group">'+'<div class="ws-preform-input-label"></div>'+'<input type="text" class="ws-preform-input ws-preform-phone" placeholder="'+s.lang_text.form_phone_placeholder+'" value="'+s.user_phone+'">'+'<input type="text" class="cbk-phone-checker white-saas-generator-input-hidden"/>'+'</div>'+'<div class="ws-preform-input-group">'+'<div class="ws-preform-input-label"></div>'+'<input type="text" class="ws-preform-input ws-preform-email" placeholder="'+s.lang_text.form_email_placeholder+'" value="'+s.user_email+'">'+'</div>'+'<div class="ws-preform-input-group ws-preform-input-group-text">'+'<div class="ws-preform-input-label ws-preform-email-text">'+s.lang_text.email_exit+'</div>'+'</div>'+'<div class="ws-preform-input-group ws-preform-input-group-text">'+'<label class="ws-preform-label-agreement">'+'<input type="checkbox" class="ws-preform-email-agreement" checked>'+'<span class="ws-preform-email-agreement-text">'+s.email_agreement_text+'</span>'+'</label>'+'</div>'+'<div class="ws-preform-input-group ws-preform-input-group-btn">'+'<a href="javascript:void(0)" class="ws-preform-btn-cancel">'+s.lang_text.offline_btn_cancel+'</a>'+'<a href="javascript:void(0)" class="ws-preform-btn ws-preform-btn-save">'+s.lang_text.preform_btn+'</a>'+'</div>'+'</div>'+'<div class="ws-chat-footer">'+'<div class="ws-textarea-element">'+'<a class="ws-textarea-btn ws-btn-file" href="javascript:void(0)"><i class="ws-icon-file"></i></a>'+'<a class="ws-textarea-btn ws-btn-smile" href="javascript:void(0)"><i class="ws-icon-smile"></i></a>'+'<div class="ws-smile-container"></div>'+'<div class="ws-file-container">'+'<div class="ws-file-element ws-file-doc"><i class="ws-icon-document"></i>'+s.lang_text.file+'<input type="file" class="ws-file-upload ws-file-doc-upload" name="ws-doc" data-type="doc" accept="'+s.allow_mime_file+'"></div>'+'<div class="ws-file-element ws-file-foto"><i class="ws-icon-image"></i>'+s.lang_text.image+'<input type="file" class="ws-file-upload ws-file-img-upload" name="ws-img" data-type="img" accept="'+s.allow_mime_img+'"></div>'+'</div>'+'</div>'+'<div class="ws-textarea-group">'+'<div contenteditable="true" class="ws-textarea" placeholder="Введите текст и нажмите Enter"></div>'+'<div class="ws-textarea-send-btn" title="'+s.lang_text.send_btn_title+'"><i class="ws-icon-enter"></i></div>'+'</div>'+'</div>'+'<div class="ws-chat-copyright">'+'<a href="'+s.partnerLink+'" class="ws-chat-copyright-url" target="_blank" data-widget="chat">'+s.lang_text.text_link+'</a>'+'</div>'+'<div class="ws-chat-resize" style="color: '+s.color_background_chat_header+'"><i class="ws-icon-resize"></i></div>'+'<div class="ws-chat-ico-container"></div>'+'</div>'+'<div class="ws-chat-btn-el-container ws-chat-not-scalling">'+'<div class="ws-chat-btn-container ws-chat-btn-mini-hover">'+'<div class="ws-btn-badge"></div>'+'<div class="ws-btn-ico">'+'<div class="ws-chat-logo">'+'<i class="ws-icon-chat" style="color: '+s.color_background_button+'"></i>'+'<img src="'+s.chat_widget_logo+'" class="ws-chat-logo-img">'+'<div class="ws-chat-status-round ws-chat-status-online"></div>'+'</div>'+'</div>'+'<div class="ws-btn-title"></div>'+'</div>'+'<div class="ws-chat-invitation-container">'+'<div class="ws-chat-invitation-close"><i class="ws-icon-close"></i></div>'+'<div class="ws-chat-invitation-body">'+'<div class="ws-chat-invitation-logo"></div>'+'<div class="ws-chat-invitation-body-el">'+'<div class="ws-chat-invitation-body-text"></div>'+'</div>'+'</div>'+'<div class="ws-chat-invitation-form">'+'<input type="text" class="ws-chat-invitation-input" placeholder="'+s.lang_text.form_message_placeholder+'">'+'</div>'+'</div>'+'</div>'+'</div>'},setSettings:function(settings){var defaultSettings={dragChatObject:{},resizeChatObject:{},chat_created:false,chat_old_time:false,chat_timezone:3,unread_messages:{},unread_messages_count:0,document_title:document.title,document_favicon_href:$('link[rel="shortcut icon"]').length?$('link[rel="shortcut icon"]').attr('href'):$('link[rel="icon"]').attr('href'),new_favicon_href:'',input_scroll:false,auth_type:'default',default_logo_visitor:WBK.settings.staticServerUrl+'/widget/img/user.png',logo_visitor:false,is_first_message:false,first_message:false,bottom_body:62,height_input:56,allow_mime_file:'.pdf,.txt,.doc,.docx,.xls,.xlsm,.rar,.zip',allow_mime_img:'image/png,image/jpg,image/jpeg,image/gif',invitation_show_data:false,invitation_operator_id:false,last_operator_message_id:false,last_operator_data:false,send_autoreply:false,send_autoreply_first:false,show_one_invitation:false,fileUploaded:{},fileUploadedCount:0,chatCreating:false,scallingMobile:false,windowRatioChat:1,offline_message_sending:false,scroll_left:0,scroll_top:0,};$.extend(true,s,defaultSettings);$.extend(true,s,settings);},log:function(mess){wsUtil.log('CHAT : '+mess);}}})(jWS);"use_strict";wsKiller=(function($){var _this;var s;var t;var w;return{settings:{},templates:{},widget:{},init:function(data){_this=this;s=this.settings;t=this.templates;w=this.widget;if($.fn._frameCheck()&&typeof WBK==='undefined'){WBK=document.WBK;}
_this.loader(data);},loader:function(res){var data=res.Data.callback;_this.setDefaultText();if(data.killerLangText){s.text=data.killerLangText;}
_this.setDefaultSettings();_this.setTemplate();WBK.settings.callbackEnabled=true;WBK.settings.killerId=res.Settings.killerId;if(data.killerHasMoney){s.killerHasMoney=1;}
if(data.killerIsPayed){s.killerIsPayed=true;}
if(data.killerUseDepartment&&data.killerDepartments){s.useDepartment=parseInt(data.killerUseDepartment);s.departments=data.killerDepartments;}
if(data.killerTimezone&&data.killerTimezone!==''){s.killerTimezone=data.killerTimezone;s.killerTimezone=parseInt(s.killerTimezone.charAt(3)+s.killerTimezone.charAt(4)+s.killerTimezone.charAt(5));}
if(data.killerWorkdays){s.killerWorkdays=data.killerWorkdays;}
var now=new Date();s.timeDelta=parseInt(now.getTime()/1000)-WBK.settings.utcTime;now.setTime(WBK.settings.utcTime*1000+now.getTimezoneOffset()*60*1000+s.killerTimezone*60*60*1000);s.currentDay=now.getDay()-1;if(s.currentDay<0){s.currentDay=6;}
s.prevDay=s.currentDay-1;if(s.prevDay<0){s.prevDay=6;}
data.killerFormCall=parseInt(data.killerFormCall);if(data.killerFormCall){s.killerFormCall=data.killerFormCall;}
if(parseInt(data.killerFormCallHide)){s.killerFormCallHide=parseInt(data.killerFormCallHide);}
data.killerCallOff=parseInt(data.killerCallOff);if(data.killerCallOff){s.killerCallOff=data.killerCallOff;}
if(data.killerText){s.text.killerText=data.killerText;s.text.cbkShareTitle[0][0][0]=_this.formatText(s.text.killerText[0]['call_deferred'][0]);s.text.cbkShareTitle[0][0][1]=_this.formatText(s.text.killerText[0]['call_deferred'][1]);s.text.cbkShareTitle[0][1][0]=_this.formatText(s.text.killerText[0]['call_deferred'][0]);s.text.cbkShareTitle[0][1][1]=_this.formatText(s.text.killerText[0]['call_deferred'][1]);s.text.cbkShareTitle[1][1][0]=_this.formatText(s.text.killerText[1]['success_call'][0]);s.text.cbkShareTitle[1][1][1]=_this.formatText(s.text.killerText[1]['success_call'][1]);}
if(res.Settings.serviceName){s.text.cbkCopyright="Хочу "+WBK.settings.servicename+" на свой сайт";}
if(res.Settings.serviceDomain){s.cbkLink='http://'+WBK.settings.servicedomain+'?utm_source=widget&utm_medium=self&utm_campaign='+location.hostname+'&utm_content=killer&utm_term=';if(WBK.settings.thisIsCallbackKILLER){s.cbkLink='http://cb-killer.ru/?utm_source=widget&utm_medium=self&utm_campaign='+location.hostname+'&utm_content=killer&utm_term=';}}
if(data.partnerLink){s.cbkLink=data.partnerLink;}
if(data.killerIsPaused){s.killerIsPaused=data.killerIsPaused;}
if(data.killerPausedStart){s.killerPausedStart=data.killerPausedStart;}
if(data.killerPausedEnd){s.killerPausedEnd=data.killerPausedEnd;}
if(data.killerPausedDay){s.killerPausedDay=data.killerPausedDay;}
if(data.killerSettings){if(data.killerSettings.windowPosition){s.windowPosition=parseInt(data.killerSettings.windowPosition);}
if(data.killerSettings.killerTransparentBgr){s.killerTransparentBgr=true;}
if(data.killerLogo){s.killerLogo=data.killerLogo;}
if(data.killerBtnLogo){s.killerBtnLogo=data.killerBtnLogo;}
if(data.killerUpdatedAt){s.killerUpdatedAt=data.killerUpdatedAt;}
if(data.killerSettings.btnType){s.btnType=data.killerSettings.btnType;}
if(data.killerSettings.btnSize){s.btnSize=data.killerSettings.btnSize;}
if(data.killerSettings.btnPosition&&s.btnType==='btn'){s.btnPosition=data.killerSettings.btnPosition;}
if(data.killerSettings.btnExtendedPosition&&s.btnType==='extended_btn'){s.btnExtendedPosition=data.killerSettings.btnExtendedPosition;}
if(data.killerSettings.btnExtendedCorner&&s.btnType==='extended_btn'){s.btnExtendedCorner=data.killerSettings.btnExtendedCorner;}
if(data.killerSettings.hideBtn){s.hideBtn=parseInt(data.killerSettings.hideBtn);}
if(data.killerSettings.timerType){s.timerType=data.killerSettings.timerType;}
if(data.killerSettings.hideDefered){s.hideDefered=parseInt(data.killerSettings.hideDefered);}
if(data.killerSettings.btnText){s.btnText=data.killerSettings.btnText;}
if(data.killerSettings.btnTextAdd&&WBK.settings.device=='pc'){s.btnTextAdd=data.killerSettings.btnTextAdd;}
if(data.killerSettings.windowNoCopyright){WBK.settings.hideCopyright=true;}
if(data.killerSettings.btnNoAnimateOnScroll){s.btnNoPulse=true;}
if(data.killerSettings.btnStaticOnScroll){s.btnStaticOnScroll=true;}
if(parseInt(data.killerSettings.btnHideMobileZoom)){s.btnHideMobileZoom=true;}
if(data.killerSettings.btnHideOnMobile&&WBK.settings.device==='mobile'){s.hideBtn=1;}
if(data.killerSettings.btnHideOnTablet&&WBK.settings.device==='tablet'){s.hideBtn=1;}
if(data.killerSettings.btnRotateTimeout){s.timeouts.rotatePhoneIcons=data.killerSettings.btnRotateTimeout;}
if(data.killerSettings.btnShowTimeout){s.timeouts.btnShowTimeout=data.killerSettings.btnShowTimeout;}
if(data.killerSettings.btnShowScroll){s.btnShowScroll=data.killerSettings.btnShowScroll;}
if(data.killerSettings.windowBtnTextOnline){s.windowBtnTextOnline=data.killerSettings.windowBtnTextOnline;}
if(data.killerSettings.windowBtnTextOffline){s.windowBtnTextOffline=data.killerSettings.windowBtnTextOffline;}
if(data.killerSettings.windowNoSendRecordToVisitor){s.skipSendRecordToVisitor=true;}
if(data.killerSettings.killerManagerRatingCheck!=undefined){s.managerRatingCheck=parseInt(data.killerSettings.killerManagerRatingCheck);}
if(data.killerSettings.killerVisitorGetName!=undefined){s.killerVisitorGetName=parseInt(data.killerSettings.killerVisitorGetName);}
if(data.killerSettings.windowDisplayMode){if(data.killerSettings.windowDisplayMode===1){s.showWindowReapperanceTimeout=0;s.showOnExitReapperanceTimeout=40;}
if(data.killerSettings.windowDisplayMode===2){s.showWindowReapperanceTimeout=7;s.showOnExitReapperanceTimeout=7*24*60;}
if(data.killerSettings.windowDisplayMode===3){s.noShowWindow=true;}}
if(data.killerSettings.killerCallTimeout){s.callTimeout=parseInt(data.killerSettings.killerCallTimeout);}
if(data.killerSettings.windowMinApperanceTimeout&&data.killerSettings.windowMaxApperanceTimeout&&data.killerSettings.windowMinApperanceTimeout<data.killerSettings.windowMaxApperanceTimeout){s.showWindowApperanceTimeout=wsUtil.getRandomArbitrary(data.killerSettings.windowMinApperanceTimeout,data.killerSettings.windowMaxApperanceTimeout);}
else if(data.killerSettings.windowMinApperanceTimeout){s.showWindowApperanceTimeout=wsUtil.getRandomArbitrary(data.killerSettings.windowMinApperanceTimeout,data.killerSettings.windowMinApperanceTimeout+7);}
else if(data.killerSettings.windowMaxApperanceTimeout){s.showWindowApperanceTimeout=wsUtil.getRandomArbitrary(0,data.killerSettings.windowMaxApperanceTimeout);}
if(data.killerSettings.windowNoShowOnExit){s.noShowOnExit=true;}
if(data.killerSettings.btnColor||(data.killerSettings.btnMobileColor&&WBK.settings.device!='pc')){if(WBK.settings.device!='pc'&&data.killerSettings.btnMobileColor){s.btnColor=data.killerSettings.btnMobileColor;}else if(data.killerSettings.btnColor){s.btnColor=data.killerSettings.btnColor;}
WBK.addStyles(".ws-killer .ws-killer-btn{background-color: "+s.btnColor+"!important;} "+".ws-killer .ws-killer-btn .ws-icon-phone{color: "+s.btnColor+"!important;} "+".cbk-btn, .cbk-btn:hover {background-color: "+s.btnColor+"!important;} "+".cbk-phone .cbk-phone-bgr {background-color: "+s.btnColor+"!important;}");}
if(data.killerSettings.btnTextColor||(data.killerSettings.btnMobileTextColor&&WBK.settings.device!='pc')){if(WBK.settings.device!='pc'&&data.killerSettings.btnMobileTextColor){s.btnTextColor=data.killerSettings.btnMobileTextColor;}else if(data.killerSettings.btnTextColor){s.btnTextColor=data.killerSettings.btnTextColor;}
WBK.addStyles(".ws-killer .ws-btn-title {color: "+s.btnTextColor+"!important} "+".cbk-btn .cbk-title, .cbk-btn:hover .cbk-title {color: "+s.btnTextColor+"!important;} "+".cbk-phone .cbk-phone-phone .ws-icon-phone, .cbk-phone .cbk-phone-text, .cbk-phone .cbk-phone-text span, .cbk-phone .cbk-phone-phone.cbk-phone-with-text, .cbk-phone .cbk-phone-phone.cbk-phone-with-text span{color: "+s.btnTextColor+"!important;}");}
if(data.killerSettings.windowBackgroundColor){WBK.addStyles(".cbk-window .cbk-background div {background-color: "+data.killerSettings.windowBackgroundColor+"!important;}"+".cbk-window.callbackkiller-mobile .cbk-background, .cbk-window.callbackkiller-mobile .cbk-background div {background-color: "+data.killerSettings.windowBackgroundColor+"!important;}");}
if(data.killerSettings.windowTextColor){WBK.addStyles(".cbk-window * {color: "+data.killerSettings.windowTextColor+"!important}"+".cbk-window a, .cbk-window a:hover, .cbk-window a.cbk-button-no.cbk-button-no-dark {color: "+data.killerSettings.windowTextColor+"!important;}"+".cbk-window a.cbk-button-no.cbk-button-no-dark, .cbk-window a.cbk-button-no.cbk-button-no-dark:hover {color: "+data.killerSettings.windowTextColor+"!important;border-bottom: 1px dashed "+data.killerSettings.windowTextColor+"!important}");}
if(data.killerSettings.windowLinkColor){WBK.addStyles(".cbk-link-btn a, .cbk-link-btn a:hover, .cbk-link-btn a:active, .cbk-window a.cbk-button-no, .cbk-window a.cbk-button-no:hover{color: "+data.killerSettings.windowLinkColor+"!important; border-bottom: 1px dashed "+data.killerSettings.windowLinkColor+"!important;}");}
if(data.killerSettings.windowInputBackgroundColor){WBK.addStyles(".cbk-window .cbk-form .cbk-input, .cbk-window .cbk-form .cbk-input:focus, .cbk-window .cbk-form .cbk-input:hover, .cbk-window .cbk-form .cbk-select, .cbk-window .cbk-form .cbk-select option {background: "+data.killerSettings.windowInputBackgroundColor+"!important;}");}
if(data.killerSettings.windowInputTextColor){WBK.addStyles(".cbk-window .cbk-form .cbk-input, .cbk-window .cbk-form .cbk-input:focus, .cbk-window .cbk-form .cbk-input:hover, .cbk-window .cbk-form .cbk-select, .cbk-window .cbk-form .cbk-select option {color: "+data.killerSettings.windowInputTextColor+"!important;}");}
if(data.killerSettings.windowBtnBackgroundColor){WBK.addStyles(".cbk-window .cbk-button {background: "+data.killerSettings.windowBtnBackgroundColor.replace(',1)',',.8)')+"!important;}"+".cbk-window .cbk-button:hover, .cbk-window .cbk-button:active {background: "+data.killerSettings.windowBtnBackgroundColor+"!important;}");}
if(data.killerSettings.windowBtnTextColor){WBK.addStyles(".cbk-window .cbk-button, .cbk-window .cbk-button:hover, .cbk-window .cbk-button:active {color: "+data.killerSettings.windowBtnTextColor+"!important;}");}
if(data.killerSettings.logoShadow=='hide'){WBK.addStyles(".cbk-window-logo {box-shadow:none!important;}");}
if(data.killerSettings.btnPositionBottom||data.killerSettings.btnPositionBottom===0){s.phonePositionBottom=data.killerSettings.btnPositionBottom;}
if(data.killerSettings.btnPositionRight||data.killerSettings.btnPositionRight===0){s.phonePositionRight=data.killerSettings.btnPositionRight;}
if(data.killerSettings.btnMobilePositionHorizontal!==undefined){s.btnMobilePositionHorizontal=data.killerSettings.btnMobilePositionHorizontal;}
if(data.killerSettings.btnMobilePositionHorizontalType){s.btnMobilePositionHorizontalType=data.killerSettings.btnMobilePositionHorizontalType;}
if(data.killerSettings.btnMobilePositionVertical!==undefined){s.btnMobilePositionVertical=data.killerSettings.btnMobilePositionVertical;}
if(data.killerSettings.btnMobilePositionVerticalType){s.btnMobilePositionVerticalType=data.killerSettings.btnMobilePositionVerticalType;}}
_this.checkWorkTime();if(!s.killerWorking&&data.killerOffNoWork){s.hideBtn=1;s.noShowOnExit=true;s.noShowWindow=true;}
if(wsUtil.getCookie('WhiteCallback_callId')){s.callId=wsUtil.getCookie('WhiteCallback_callId');WBK.initSocket();}
_this.initWidget();_this.initKiller();if(window.top.location.hash==='#callbackkiller'||window.top.location.hash==='#callbackwidget'){var d=new Date();d.setMinutes(d.getMinutes()+60*24*100);wsUtil.setCookie('CallbackKiller_shownOn','onbtn',d);_this.showWindow('btn');}
if(window.top.location.hash==='#callbackkillermodal'||window.top.location.hash==='#callbackwidgetmodal'){var d=new Date();d.setMinutes(d.getMinutes()+60*24*100);wsUtil.setCookie('CallbackKiller_shownOn','onbtn',d);_this.showWindow('modal');}},showWindow:function(showOnType,noWorkTime){if(WBK.settings.windowInvaderOpened){wsInvader.widget.window.find('.cbk-support-new-message-copyright').hide();wsInvader.widget.window.hide();}
if(WBK.settings.chatEnabled){if(showOnType=='auto'){if(WBK.settings.chatBtnOpened&&!WBK.settings.chatInvitationOpened){wsChat.widget.btn.hide();wsChat.widget.invitation.hide();}}else{if(WBK.settings.chatWindowOpened){wsChat.widget.window.hide();}}
if(WBK.settings.chatBtnOpened&&showOnType!='auto'){wsChat.widget.btn.hide();wsChat.widget.invitation.hide();}}
if(showOnType==='auto'&&(WBK.settings.windowGeneratorOpened||WBK.settings.chatWindowOpened||WBK.settings.chatInvitationOpened)){if(!wsUtil.getCookie('WhiteCallback_noShowWindow')&&!s.noShowWindow){wsUtil.setTimeout('showWindowOnTimer',function(){if(!wsUtil.getCookie('WhiteCallback_noShowWindow')&&!wsUtil.getCookie('WhiteCallback_noShowOnExit')){_this.checkWorkTime();if(!WBK.settings.windowOpened){var d=new Date();d.setMinutes(d.getMinutes()+60*24*100);wsUtil.setCookie('WhiteCallback_shownOn','onshow',d);_this.showWindow('auto');}}},s.showWindowApperanceTimeout*1000);}}else{if(WBK.settings.device!='pc'&&WBK.settings.siteId!==23663){s.scrollLeft=$(window).scrollLeft();s.scrollTop=$(window).scrollTop();if(!$("meta[name=viewport]").length){w.window.data('noViewport',1);}
else{w.window.data('oldViewport',$("meta[name=viewport]").attr('content'));$("meta[name=viewport]").remove();}
$('head').append($('<meta>').attr('name','viewport').attr('content','width=device-width, user-scalable=0, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0'));$('body').addClass('cbk-body-mobile');}
WBK.settings.windowOpened=true;if(w.btn.hasClass('cbk-phone')&&WBK.settings.device=='pc'){_this.stopRotatePhoneIcons();w.btn.removeClass('cbk-pulse');}
if(w.btn.is(':visible')){if(showOnType==='exit'){w.btn.hide();}
else{var hideAnimation='cbk-fadeOutRight';if(WBK.settings.device!='pc'){hideAnimation='cbk-fadeOutDown';}
else if(s.windowPosition===1){hideAnimation='cbk-fadeOutLeft';}
WBK.animateFastOnce(w.btn,hideAnimation,function(){w.btn.hide();});}}
if(showOnType==='exit'){w.window.addClass('cbk-window-onexit');w.window.removeClass('cbk-window-modal');var cbkWindowWidth=w.window.width();var left=s.showOnExitXPosition-cbkWindowWidth/2;if(left<0){left=0;}
if((left+cbkWindowWidth)>window.innerWidth){left=window.innerWidth-cbkWindowWidth-10;}
w.window.css('left',left+'px');}
else if((s.windowPosition===2||showOnType==='modal')&&WBK.settings.device=='pc'){w.window.addClass('cbk-window-modal');w.window.removeClass('cbk-window-onexit');var cbkWindowWidth=w.window.width();var left=(window.innerWidth-cbkWindowWidth)/2;if(left<0){left=0;}
var cbkWindowHeight=w.window.height();var top=(window.innerHeight-cbkWindowHeight)/2;if(top<0){top=0;}
w.window.css('left',left+'px');w.window.css('top',top+'px');}
else{w.window.removeClass('cbk-window-onexit');if(s.windowPosition!==2){w.window.removeClass('cbk-window-modal');}
w.window.css('left','');w.window.css('top','');}
_this.initCallTimer();if(!s.killerTransparentBgr){w.windowbgr.show();}
w.window.show();if(showOnType==='modal'){showAnimation='cbk-fadeInUp';WBK.animateFastOnce(w.window,showAnimation);}
else if(showOnType!=='exit'){var showAnimation='cbk-fadeInRight';if(WBK.settings.device!='pc'){w.window.show();}
else if(s.windowPosition===1||s.windowPosition===2){showAnimation='cbk-fadeInLeft';WBK.animateFastOnce(w.window,showAnimation);}
else if(s.windowPosition!==1&&showOnType==='sm'){if(wsInvader.settings.position!='right'){showAnimation='cbk-fadeInLeft';w.window.addClass('cbk-window-left');}
WBK.animateFastOnce(w.window,showAnimation);}
else if(s.windowPosition!==1&&showOnType==='instinct'){if(wsInstinct.settings.position_x!='right'){showAnimation='cbk-fadeInLeft';w.window.addClass('cbk-window-left');}
WBK.animateFastOnce(w.window,showAnimation);}}
_this.checkWorkTime();w.window.find('div.cbk-form').hide();$('#cbkPhoneBtn').show();if(!noWorkTime&&s.killerWorking){w.window.find('div.cbk-callform .cbk-button-no').show();if(s.killerHasMoney&&!s.killerCallOff&&s.timerType!='hide'){w.window.find('.cbk-timer').show();}
else{if(s.killerCallOff||!s.killerHasMoney){showOnType='nomoney';}
w.window.find('.cbk-timer').hide();}
if(showOnType==='modal'){showOnType='auto';}
else if(showOnType==='sm'||showOnType==='instinct'){showOnType='btn';}
_this.setFormText(w.window.find('div.cbk-callform .cbk-form-title'),s.text.killerText[s.killerWorking][showOnType][WBK.settings.hasVisitorName]);_this.personalizeForms();var callForm=w.window.find('div.cbk-callform');callForm.show();WBK.animateOnce(callForm,'cbk-fadeIn',function(){if(WBK.settings.device=='pc'){WBK.animateOnce(callForm.find('div.cbk-form-title'),'cbk-bounce');}});_this.setPhoneInputFocus();}
else{_this.setWorkDays();if(!s.killerHasMoney){showOnType='nomoney';}
else if(showOnType==='modal'){showOnType='auto';}
else if(showOnType==='sm'||showOnType==='instinct'){showOnType='btn';}
_this.setFormText(w.window.find('div.cbk-cdform .cbk-form-title'),s.text.killerText[s.killerWorking][showOnType][WBK.settings.hasVisitorName]);_this.personalizeForms();var clForm=w.window.find('div.cbk-cdform');clForm.show();WBK.animateOnce(clForm,'cbk-fadeIn',function(){if(WBK.settings.device=='pc'){WBK.animateOnce(clForm.find('div.cbk-form-title'),'cbk-bounce');}});_this.setPhoneInputFocus();}
_this.onResizeWindow();s.callStarted=false;var url=WBK.settings.serverUrl+"/api?action=newshow&callback=?";$.getJSON(url,{shownOn:wsUtil.getCookie('WhiteCallback_shownOn'),device:WBK.settings.device,code:WBK.settings.whiteSaasCode,googleClientId:wsUtil.getGoogleClientId(),killerId:WBK.settings.killerId,visitorId:WBK.settings.visitorId,advertiseId:wsUtil.getAdvertiseId(),calltrackingId:wsUtil.getCalltrackingId()});}},hideWindow:function(){if(WBK.settings.device!='pc'){if(w.window.data('noViewport')){w.window.data('noViewport',0);$("meta[name=viewport]").attr('content','');}
else{$("meta[name=viewport]").attr('content',w.window.data('oldViewport'));}
$('body').removeClass('cbk-body-mobile');$(window).scrollTop(s.scrollTop);$(window).scrollLeft(s.scrollLeft);}
w.windowbgr.hide();if(WBK.settings.windowOpened){var hideAnimation='cbk-fadeOutRight';if(WBK.settings.device!='pc'){w.window.hide();w.window.find('div.cbk-form').hide();}
else if(s.windowPosition===1||w.window.hasClass('cbk-window-left')){hideAnimation='cbk-fadeOutLeft';}
if(WBK.settings.device=='pc'){WBK.animateFastOnce(w.window,hideAnimation,function(){w.window.hide();w.window.find('div.cbk-form').hide();if(s.windowPosition!==1&&w.window.hasClass('cbk-window-left')){w.window.removeClass('cbk-window-left');}});}}
if(s.hideBtn!=1&&s.btnShow){var showAnimation='cbk-fadeInRight';if(WBK.settings.device!='pc'){showAnimation='cbk-fadeInUp';w.btn.show(500);}else{w.btn.show();WBK.animateFastOnce(w.btn,showAnimation,function(){_this.updatePhonePosition();});}}
if(w.btn.hasClass('cbk-phone')&&WBK.settings.device=='pc'){_this.startRotatePhoneIcons();}
WBK.settings.windowOpened=false;if(s.showWindowReapperanceTimeout){var d=new Date();d.setDate(d.getDate()+parseInt(s.showWindowReapperanceTimeout));wsUtil.setCookie('WhiteCallback_noShowWindow',1,d);}
else{wsUtil.setCookie('WhiteCallback_noShowWindow',1);}
var d=new Date();d.setMinutes(d.getMinutes()+parseInt(s.showOnExitReapperanceTimeout));wsUtil.setCookie('WhiteCallback_noShowOnExit',1,d);WBK.settings.invaderCallbackStatId=false;if(WBK.settings.chatEnabled){if(WBK.settings.chatBtnOpened){wsChat.widget.btn.show();}
if(WBK.settings.chatWindowOpened){wsChat.widget.window.show();}}
if(WBK.settings.windowInvaderOpened){wsInvader.showWidget();}},startShakeBtn:function(){wsUtil.setInterval('shakeBtn',function(){if(s.btnType=='extended_btn'){WBK.animateOnce(w.extended_btn,'cbk-shake');}else{WBK.animateOnce(w.btn,'cbk-shake');}},s.timeouts.shakeBtn*1000);},stopShakeBtn:function(){wsUtil.deleteInterval('shakeBtn');},startRotatePhoneIcons:function(){if(w.btn.hasClass('cbk-phone')){_this.initBtnText();}
if(!w.btn.find('.cbk-phone-content div.cbk-rotate-icon').length){w.btn.find('.cbk-phone-content div:first').addClass('cbk-rotate-icon');}
wsUtil.setInterval('rotatePhoneIcons',function(){if(w.btn.hasClass('cbk-pulse')){w.btn.find('.cbk-phone-content div').removeClass('cbk-rotate-icon');}
else{var isLast=false;if(w.btn.find('.cbk-phone-content div.cbk-rotate-icon').is(':last-child')){isLast=true;}
if(isLast){w.btn.find('.cbk-phone-content div').removeClass('cbk-rotate-icon');w.btn.find('.cbk-phone-content div:first').addClass('cbk-rotate-icon');}
else{w.btn.find('.cbk-phone-content div.cbk-rotate-icon').removeClass('cbk-rotate-icon').next().addClass('cbk-rotate-icon');}}
if(w.btn.hasClass('cbk-phone')){_this.initBtnText();}},s.timeouts.rotatePhoneIcons*1000);},stopRotatePhoneIcons:function(){wsUtil.deleteInterval('rotatePhoneIcons');w.btn.find('.cbk-rotate-icon').removeClass('cbk-rotate-icon');_this.initBtnText();},getBackground:function(item){var color=item.css("background-color");var alpha=parseFloat(color.split(',')[3],10);if((isNaN(alpha)||alpha>0.8)&&color!=='transparent'){return color;}
if(item.is("body")){return false;}else{return _this.getBackground(item.parent());}},getLuma:function(color){var rgba=color.substring(4,color.length-1).split(',');var r=rgba[0];var g=rgba[1];var b=rgba[2];var luma=0.2126*r+0.7152*g+0.0722*b;return luma;},showError:function(element,errorText){if(element.is('input')){element.addClass('cbk-error');if(WBK.settings.device=='pc'){element.addClass('cbk-error').focus();}}
else{if(!element.is('select')){element=element.parent();}}
element.after('<div class="cbk-error-text">'+errorText+'</div>');},hideErorrs:function(){w.window.find('.cbk-error-text').remove();w.window.find('.cbk-error').removeClass('cbk-error');},initBtn:function(){if(s.btnType=='btn'){if(s.btnText){$('.cbk-btn .cbk-title').html(s.btnText);}}
if(s.btnType=='extended_btn'&&WBK.settings.device=='pc'){if(s.btnText){w.extended_btn.find('.ws-btn-title').html(s.btnText);}else{w.extended_btn.addClass('ws-killer-text-none');}}
_this.initBtnText();if(w.btn.hasClass('cbk-phone')){if(WBK.settings.device=='pc'){_this.startRotatePhoneIcons();w.btn.on('mouseenter.callbackkiller',function(e){wsUtil.deleteTimeout('cbkPhonePulse');w.btn.removeClass('cbk-pulse');_this.stopRotatePhoneIcons();}).on('mouseleave.callbackkiller',function(e){w.btn.find('.cbk-phone-phone').addClass('cbk-rotate-icon');_this.startRotatePhoneIcons()}).on('dragstart',function(e){e.preventDefault();}).on('mousedown.callbackkiller',function(e){if(e.which!==1){return;}
s.dragObject.elem=_this.widget.btn;s.dragObject.downX=e.pageX;s.dragObject.downY=e.pageY;}).on('mouseup.callbackkiller',function(e){if(s.dragObject.dragStarted){s.dragObject.dragStarted=false;var d=new Date();d.setSeconds(d.getSeconds()+1);wsUtil.setCookie('WhiteCallback_noClickOnPhone',1,d);}
s.dragObject={};});}
$(document).on('mouseup.callbackkiller',function(e){if(s.dragObject.dragStarted){s.dragObject.dragStarted=false;var d=new Date();d.setSeconds(d.getSeconds()+1);wsUtil.setCookie('WhiteCallback_noClickOnPhone',1,d);}
s.dragObject={};});$(document).on('mousemove.callbackkiller',function(e){if(s.dragObject.elem){var moveX=e.pageX-s.dragObject.downX;var moveY=e.pageY-s.dragObject.downY;if(Math.abs(moveX)<3&&Math.abs(moveY)<3){return;}
if(!s.dragObject.dragStarted){s.dragObject.oldPosition={left:s.dragObject.elem.position().left||'',top:s.dragObject.elem.position().top||''};s.dragObject.shiftX=s.dragObject.downX-s.dragObject.elem.position().left;s.dragObject.shiftY=s.dragObject.downY-s.dragObject.elem.position().top;s.dragObject.dragStarted=true;}
s.dragObject.elem.css({left:e.pageX-s.dragObject.shiftX+'px',top:e.pageY-s.dragObject.shiftY+'px',right:'auto',bottom:'auto'});}});}
else{if(!s.btnNoPulse){_this.startShakeBtn();}}},initBtnText:function(){if($('.cbk-phone .cbk-phone-text').length){if(s.btnText){var words=new Array();var maxLengthWord='';var size=0;var i=0;words=s.btnText.split(" ");for(i=0;i<words.length;i++){if(words[i].length>maxLengthWord.length){maxLengthWord=words[i];}}
if(s.btnSize==='sm'){if(maxLengthWord.length>10){size=70;}
else if(maxLengthWord.length>8){size=80;}
else if(maxLengthWord.length>6){size=90;}}
else if(s.btnSize==='xs'){if(maxLengthWord.length>10){size=70;}
else if(maxLengthWord.length>8){size=80;}
else if(maxLengthWord.length>6){size=90;}}
else{if(maxLengthWord.length>10){size=80;}
else if(maxLengthWord.length>8){size=90;}}
if(size){$('.cbk-phone .cbk-phone-text').html($('<span>').addClass('cbk-font-size-'+size).html(s.btnText));}
else{$('.cbk-phone .cbk-phone-text').html(s.btnText);}}
if(!$('.cbk-phone').is(':visible')){$('.cbk-phone').show();$('.cbk-phone .cbk-phone-text').css('marginTop',(($('.cbk-phone').outerHeight()-$('.cbk-phone .cbk-phone-text').outerHeight())/2));$('.cbk-phone').hide();}
else{$('.cbk-phone .cbk-phone-text').css('marginTop',(($('.cbk-phone').outerHeight()-$('.cbk-phone .cbk-phone-text').outerHeight())/2));}
if(s.btnTextAdd){var words=new Array();var maxLengthWord='';var size=0;var i=0;words=s.btnTextAdd.split(" ");for(i=0;i<words.length;i++){if(words[i].length>maxLengthWord.length){maxLengthWord=words[i];}}
if(s.btnSize==='sm'){if(maxLengthWord.length>10){size=70;}
else if(maxLengthWord.length>8){size=80;}
else if(maxLengthWord.length>6){size=90;}}
else if(s.btnSize==='xs'){if(maxLengthWord.length>10){size=70;}
else if(maxLengthWord.length>8){size=80;}
else if(maxLengthWord.length>6){size=90;}}
else{if(maxLengthWord.length>10){size=80;}
else if(maxLengthWord.length>8){size=90;}}
if(size){$('.cbk-phone .cbk-phone-phone').addClass('cbk-phone-with-text').html($('<span>').addClass('cbk-font-size-'+size).html(s.btnTextAdd));}
else{$('.cbk-phone .cbk-phone-phone').addClass('cbk-phone-with-text').html(s.btnTextAdd);;}
if(!$('.cbk-phone').is(':visible')){$('.cbk-phone').show();$('.cbk-phone .cbk-phone-phone').css('marginTop',(($('.cbk-phone').outerHeight()-$('.cbk-phone .cbk-phone-phone').outerHeight())/2));$('.cbk-phone').hide();}
else{$('.cbk-phone .cbk-phone-phone').css('marginTop',(($('.cbk-phone').outerHeight()-$('.cbk-phone .cbk-phone-phone').outerHeight())/2));}}}},initPhonePosition:function(){if(WBK.settings.device!='pc'){_this.updateBtnMobilePosition();}
else{if(s.btnType=='phone'){if(!s.btnStaticOnScroll){var windowScrollTop=$(window).scrollTop();var windowHeight=window.innerHeight;var windowWidth=$(window).width();var positionBottom=windowHeight*s.phonePositionBottom/100;var positionTop=windowHeight-positionBottom+windowScrollTop;if(s.phonePositionBottom<50){positionTop=positionTop-w.btn.outerHeight()}
w.btn.stop().css({'bottom':'auto','top':positionTop+'px','left':s.phonePositionRight>50?100-s.phonePositionRight+'%':'auto','right':s.phonePositionRight<50?s.phonePositionRight+'%':'auto',});}else{var windowWidth=$(window).width();w.btn.stop().css({'left':s.phonePositionRight>50?100-s.phonePositionRight+'%':'auto','right':s.phonePositionRight<50?s.phonePositionRight+'%':'auto','bottom':s.phonePositionBottom<50?s.phonePositionBottom+'%':'auto','top':s.phonePositionBottom>50?100-s.phonePositionBottom+'%':'auto'});}}else if(s.btnType=='btn'){var css={};if(s.btnPosition==='left'||s.btnPosition==='right'){css.bottom=s.phonePositionBottom>50?100-s.phonePositionBottom+'%':'auto';css.top=s.phonePositionBottom<50?s.phonePositionBottom+'%':'auto';if(s.phonePositionBottom<50){css.marginTop=-w.btn.outerHeight();}else{css.marginBottom=w.btn.outerWidth();};}
else{css.left=s.phonePositionRight>50?100-s.phonePositionRight+'%':'auto';css.right=s.phonePositionRight<50?s.phonePositionRight+'%':'auto';}
w.btn.stop().css(css);}else if(s.btnType=='extended_btn'){var css={bottom:s.phonePositionBottom<50?s.phonePositionBottom+'%':'auto',top:s.phonePositionBottom>50?100-s.phonePositionBottom+'%':'auto',right:s.phonePositionRight<50?s.phonePositionRight+'%':'auto',left:s.phonePositionRight>50?100-s.phonePositionRight+'%':'auto',};w.btn.show();switch(s.btnExtendedPosition){case'horizontal':if(s.phonePositionBottom==100){w.extended_btn.addClass('ws-killer-btn-attach-top');}else if(s.phonePositionBottom==0){w.extended_btn.addClass('ws-killer-btn-attach-bottom');}
break;case'vertical_left':w.extended_btn_container.addClass('ws-killer-btn-left');w.extended_btn.addClass('ws-killer-btn-attach-top');if(s.phonePositionBottom>50){css.marginTop=w.extended_btn.outerWidth();}else{css.marginBottom=-w.extended_btn.outerHeight();};break;case'vertical_right':w.extended_btn_container.addClass('ws-killer-btn-right');w.extended_btn.addClass('ws-killer-btn-attach-bottom');w.extended_btn.show();if(s.phonePositionBottom>50){css.marginTop=-w.extended_btn.outerHeight();}else{css.marginBottom=w.extended_btn.outerWidth();};break;}
w.btn.hide();w.extended_btn_container.stop().css(css);}}},updatePhonePosition:function(){if(WBK.settings.device==='mobile'&&s.hideBtn!=1&&s.btnShow){_this.updateBtnMobilePosition();}else if(WBK.settings.device==='tablet'&&s.hideBtn!=1&&s.btnShow){_this.updateBtnMobilePosition();}
else{if(s.btnType=='phone'){if(s.btnStaticOnScroll){if(!s.btnNoPulse&&WBK.settings.device=='pc'){w.btn.addClass('cbk-pulse');wsUtil.setTimeout('cbkPhonePulse',function(){w.btn.removeClass('cbk-pulse');w.btn.find('.cbk-phone-phone').addClass('cbk-rotate-icon');},s.timeouts.phonePulse*1000);}}else{var windowScrollTop=$(window).scrollTop();var windowHeight=window.innerHeight;var windowWidth=$(window).width();var positionBottom=windowHeight*s.phonePositionBottom/100;var positionTop=windowHeight-positionBottom+windowScrollTop;if(s.phonePositionBottom<50){positionTop=positionTop-w.btn.outerHeight()}
w.btn.stop().animate({'left':s.phonePositionRight>50?100-s.phonePositionRight+'%':'auto','right':s.phonePositionRight<50?s.phonePositionRight+'%':'auto','top':positionTop+'px','bottom':'auto'},350,function(){if(!s.btnNoPulse&&WBK.settings.device=='pc'){w.btn.addClass('cbk-pulse');wsUtil.setTimeout('cbkPhonePulse',function(){w.btn.removeClass('cbk-pulse');w.btn.find('.cbk-phone-phone').addClass('cbk-rotate-icon');},s.timeouts.phonePulse*1000);}});}}}},updateBtnMobilePosition:function(){var ratio=(window.innerWidth/WBK.getDeviceWidth());var ratio_screen=0.57*ratio;if(ratio!=1){s.scallingMobile=true;}else{s.scallingMobile=false;}
if(!s.scallingMobile){w.btn.addClass('cbk-not-scalling');var position={};if(s.btnMobilePositionHorizontalType==='right'){position.right=100-s.btnMobilePositionHorizontal+'%';position.left='auto';}else{position.left=s.btnMobilePositionHorizontal+'%';position.right='auto';}
if(s.btnMobilePositionVerticalType==='bottom'){position.bottom=100-s.btnMobilePositionVertical+'%';position.top='auto';}else{position.top=s.btnMobilePositionVertical+'%';position.bottom='auto';}
w.btn.css({'-webkit-transform':'scale('+ratio_screen+')','-khtml-transform':'scale('+ratio_screen+')','-moz-transform':'scale('+ratio_screen+')','-ms-transform':'scale('+ratio_screen+')','-o-transform':'scale('+ratio_screen+')','transform':'scale('+ratio_screen+')'});w.btn.css(position);}else{w.btn.removeClass('cbk-not-scalling');var rat=(120-(120*ratio_screen))/2;var positionLeft;if(s.btnMobilePositionHorizontalType==='right'){positionLeft=$(window).scrollLeft()+window.innerWidth*(s.btnMobilePositionHorizontal/100)-(ratio_screen*120)-rat;}else{positionLeft=$(window).scrollLeft()+window.innerWidth*(s.btnMobilePositionHorizontal/100)-rat;}
var positionTop;if(s.btnMobilePositionVerticalType==='bottom'){positionTop=$(window).scrollTop()+window.innerHeight*(s.btnMobilePositionVertical/100)-(ratio_screen*120)-rat;}else{positionTop=$(window).scrollTop()+window.innerHeight*(s.btnMobilePositionVertical/100)-rat;}
w.btn.css({'top':positionTop+'px','bottom':'auto','left':positionLeft+'px','right':'auto','-webkit-transform':'scale('+ratio_screen+')','-khtml-transform':'scale('+ratio_screen+')','-moz-transform':'scale('+ratio_screen+')','-ms-transform':'scale('+ratio_screen+')','-o-transform':'scale('+ratio_screen+')','transform':'scale('+ratio_screen+')'});}
if(s.hideBtn!=1&&s.btnShow){w.btn.show();}},onResizeWindow:function(){var ratio=1;if(w.window.hasClass('cbk-window-modal')){var cbkWindowWidth=w.window.width();var left=(window.innerWidth-cbkWindowWidth)/2;if(left<0){left=0;}
var cbkWindowHeight=w.window.height();var top=(window.innerHeight-cbkWindowHeight)/2;if(top<0){top=0;}
w.window.css('left',left+'px');w.window.css('top',top+'px');}
if(WBK.settings.device!='pc'){w.window.find('div.cbk-window-logo').css({margin:'20px auto 0',position:'initial'});w.window.find('div.cbk-form').css('marginTop',20);var formContainer=w.window.find('div.cbk-forms');var formHeight=w.window.find('div.cbk-form:visible').outerHeight(true);var logoHeight=w.window.find('div.cbk-window-logo:visible')?w.window.find('div.cbk-window-logo:visible').outerHeight(true):0;var marginTop=0;if(window.innerHeight>(formHeight+logoHeight)){marginTop=(window.innerHeight-formHeight-logoHeight)/2}
var copyright=w.window.find('.cbk-copyright');formContainer.css('marginTop',0);formContainer.css('marginTop',marginTop);copyright.css('margin-top',0);copyright.css('margin-top','-'+copyright.outerHeight()+'px');var heightWidget=formHeight+logoHeight+marginTop+copyright.outerHeight();if(heightWidget<window.innerHeight){heightWidget=window.innerHeight;}
w.window.find('.cbk-background').attr('style','height:'+heightWidget+'px !important');if(s.btnHideMobileZoom&&s.scallingMobile&&WBK.settings.device!='pc'){w.btn.hide();}}else{var formContainer=w.window.find('div.cbk-forms');if(!s.formHeight){s.formHeight=w.window.find('div.cbk-form:visible').height();formContainer.height(s.formHeight);w.window.find('div.cbk-forms').height(s.formHeight);}
var offsetTop=0;if(s.killerLogo&&!w.window.hasClass('cbk-window-modal')&&!w.window.hasClass('cbk-window-onexit')){offsetTop=120;}
var wHeight=0;if(w.window.hasClass('cbk-window-modal')||w.window.hasClass('cbk-window-onexit')||$.fn._frameCheck()){wHeight=formContainer.parent().height();}else{wHeight=window.innerHeight;}
formContainer.css('marginTop',(wHeight-formContainer.height()+offsetTop)/2);}
_this.updatePhonePosition();},onScroll:function(){var _this=this;if(s.hideBtn==3&&!s.btnShow){var scroll=$(window).scrollTop();var scrollH=$(document).height()-$(window).height();var scrolled=scroll/scrollH*100;if(!WBK.settings.windowOpened&&!WBK.settings.windowGeneratorOpened&&s.btnShowScroll<=scrolled){s.btnShow=true;w.btn.show();}}
if(s.btnHideMobileZoom&&WBK.settings.device!='pc'){w.btn.hide();}
wsUtil.setTimeout('scrollTimer',function(){_this.updatePhonePosition();},250);},initCallTimer:function(){if(s.timerType=='hide'){w.window.find('div.cbk-timer').hide();return;}
w.window.find('div.cbk-timer').html('<span class="cbk-number">00</span><span class="cbk-d">:</span><span class="cbk-number cbk-number-sec">'+(s.callTimeout-1)+'</span><span class="cbk-d">:</span><span class="cbk-number cbk-number-msec">99</span>');if(s.timerType=='seconds'){w.window.find('div.cbk-callform').find('.cbk-d').last().hide();w.window.find('div.cbk-departmentform').find('.cbk-d').last().hide();w.window.find('div.cbk-timer').find('.cbk-number-msec').hide();}},initWidget:function(){WBK.loadFont();var btnTemplate=t.phone;var btnClass='';var btnContainerClass='';if(WBK.settings.device=='pc'){if(s.btnType==='btn'){btnTemplate=t.btn;if(s.btnPosition==='left'){btnClass='cbk-btn-left';}
else if(s.btnPosition==='top'){btnClass='cbk-btn-top';}
else if(s.btnPosition==='right'){btnClass='cbk-btn-right';}}
if(s.btnType==='phone'){if(s.btnStaticOnScroll){btnClass='cbk-phone-fixed ';}
if(s.btnSize==='sm'){btnClass+='cbk-phone-sm';}
else if(s.btnSize==='xs'){btnClass+='cbk-phone-xs';}}
if(s.btnType==='extended_btn'){btnTemplate=t.extended_btn;switch(s.btnExtendedCorner){case'smooth':btnClass+='ws-killer-btn-mini-round';break;case'round':btnClass+='ws-killer-btn-round';break;case'flat':btnClass+='';break;default:btnClass+='ws-killer-btn-mini-round';break;}}
if(s.btnExtendedPosition=='vertical_left'){btnContainerClass+="ws-killer-btn-left";}
if(s.btnExtendedPosition=='vertical_right'){btnContainerClass+="ws-killer-btn-right";}}
w.btn=$(btnTemplate).addClass(btnClass);var btn_click=w.btn;if(s.btnType==='extended_btn'&&WBK.settings.device=='pc'){w.extended_btn=w.btn.find('.ws-killer-btn').addClass(btnClass);w.extended_btn_container=w.btn.find('.ws-killer-btn-container');w.extended_btn_container.addClass(btnContainerClass);btn_click=w.extended_btn;}
btn_click.click(function(e){if(!wsUtil.getCookie('WhiteCallback_noClickOnPhone')){s.dragObject={};var d=new Date();d.setMinutes(d.getMinutes()+60*24*100);wsUtil.setCookie('WhiteCallback_shownOn','onbtn',d);_this.showWindow('btn');_this.sendGoal('showonbtn');}
e.preventDefault();return false;});w.btn.appendTo('body');w.btn.hide();if(WBK.settings.device!='pc'){w.btn.addClass('cbk-not-scalling');}
if(s.hideBtn!=1){_this.initPhonePosition();_this.initBtn();if(s.hideBtn==2){wsUtil.setTimeout('btnShowTimeout',function(){s.btnShow=true;if(!WBK.settings.windowOpened&&!WBK.settings.windowGeneratorOpened&&!WBK.settings.chatWindowOpened&&!WBK.settings.chatInvitationOpened){w.btn.show();}},s.timeouts.btnShowTimeout*1000);}else if(s.hideBtn==0){s.btnShow=true;if(!WBK.settings.windowOpened&&!WBK.settings.windowGeneratorOpened&&!WBK.settings.chatWindowOpened&&!WBK.settings.chatInvitationOpened){w.btn.show();}}}
w.windowbgr=$(t.windowbgr).hide().click(function(e){_this.hideWindow();e.preventDefault();return false;}).appendTo('body');if(s.killerTransparentBgr){w.windowbgr.addClass('cbk-window-bgr-transparent');}
w.window=$(t.window).hide().find('a.cbk-close-window').click(function(e){_this.hideWindow();e.preventDefault();return false;}).end().appendTo('body');if(s.killerLogo){var logoDate='';if(s.killerUpdatedAt){logoDate='?v='+s.killerUpdatedAt;}
$(t.windowlogo).html($('<img/>').attr('src',WBK.settings.serverUrl+s.killerLogo+logoDate)).prependTo(w.window.find('.cbk-forms'));}
if(s.btnType=='extended_btn'&&s.killerBtnLogo&&WBK.settings.device=='pc'){w.extended_btn.addClass('ws-killer-logo-yes').find('.ws-killer-logo-img').attr('src',WBK.settings.staticServerUrl+s.killerBtnLogo+'?v='+s.killerUpdatedAt);}
if(WBK.settings.device=='pc'){if(s.windowPosition===1){w.window.addClass('cbk-window-left');}
else if(s.windowPosition===2){w.window.addClass('cbk-window-modal');}}
if(WBK.settings.hideCopyright){w.window.find('a.cbk-copyright').remove();}else{$('body').on('click','a.cbk-copyright',function(e){WBK.sendAdvertLinkStat($(this).data('widget'),$(this).attr('href'),$(this).text(),WBK.settings.killerId);});}
if(s.windowBtnTextOnline){w.window.find('#cbkPhoneBtn').html(s.windowBtnTextOnline);}
if(s.windowBtnTextOffline){w.window.find('#cbkPhoneDeferredBtn').html(s.windowBtnTextOffline);}
if(s.hideDefered){w.window.find('.cbk-link-btn').hide();}
w.window.find('div.cbk-form').hide();$('#cbkCallDeferredTime').change(function(){_this.setPhoneInputFocus();});$('#cbkPhoneBtn').click(function(e){e.preventDefault();_this.hideErorrs();var phone=$('#cbkPhoneInput').val();WBK.settings.phoneMask=$('#cbkPhoneInput').attr('placeholder');if(phone){phone=WBK.checkPhone(phone);if(phone){if(s.useDepartment){s.callToPhone=phone;s.callToPhoneIsDeferred=false;if(!$.fn._frameCheck()){var re=/\#callbackwidget\-(.*)/;var depart=window.top.location.hash.match(re);var depart_hash=depart&&depart[1]?decodeURI(depart[1]):false;if(depart_hash){var call_depart_hash=false;for(var key in s.departments){if(s.departments[key].department&&s.departments[key].department==depart_hash){call_depart_hash=true;}}
if(call_depart_hash){_this.callToPhone(s.callToPhone,depart_hash);window.top.location.hash='';return;}}}
$('#cbkDepartment').empty();for(var key in s.departments){if(s.departments[key].department&&s.departments[key].department!=''){$('#cbkDepartment').append($('<option>').val(s.departments[key].department).text(s.departments[key].department));}}
w.window.find('div.cbk-form').hide();var depForm=w.window.find('div.cbk-departmentform');if(s.timerType!='none'){depForm.find('div.cbk-timer').show();}
depForm.show();WBK.animateOnce(depForm,'cbk-fadeIn',function(){if(WBK.settings.device=='pc'){WBK.animateOnce(depForm.find('div.cbk-form-title'),'cbk-bounce');}});_this.onResizeWindow();}
else{_this.callToPhone(phone);}}
else{_this.showError($('#cbkPhoneInput'),s.text.cbkErrorNoPhone);}}
else{_this.showError($('#cbkPhoneInput'),s.text.cbkErrorNoPhone);}
return false;});$('#cbkDepartmentBtn').click(function(e){if(s.callToPhoneIsDeferred){_this.callToPhoneAt(s.callToPhone,$('#cbkCallDeferredTime option:selected').attr('data-date'),$('#cbkCallDeferredTime').val(),$('#cbkDepartment').val());}
else{_this.callToPhone(s.callToPhone,$('#cbkDepartment').val());}
e.preventDefault();return false;});w.window.find('div.cbk-callform .cbk-button-no').click(function(e){_this.hideErorrs();w.window.find('div.cbk-form').hide();_this.checkWorkTime();_this.setWorkDays();w.window.find('div.cbk-cdform .cbk-form-title').html(s.text.cbkCallLaterTitle);_this.personalizeForms();var clForm=w.window.find('div.cbk-cdform');clForm.show();WBK.animateOnce(clForm,'cbk-fadeIn',function(){if(WBK.settings.device=='pc'){WBK.animateOnce(clForm.find('div.cbk-form-title'),'cbk-bounce');}});_this.onResizeWindow();_this.setPhoneInputFocus();e.preventDefault();return false;});$('#cbkPhoneDeferredBtn').click(function(e){_this.hideErorrs();var phone=$('#cbkPhoneDeferredInput').val();WBK.settings.phoneMask=$('#cbkPhoneDeferredInput').attr('placeholder');if(phone){phone=WBK.checkPhone(phone);if(phone){if(s.useDepartment){s.callToPhone=phone;s.callToPhoneIsDeferred=true;$('#cbkDepartment').empty();for(var key in s.departments){if(s.departments[key].department&&s.departments[key].department!=''){$('#cbkDepartment').append($('<option>').val(s.departments[key].department).text(s.departments[key].department));}}
w.window.find('div.cbk-form').hide();var depForm=w.window.find('div.cbk-departmentform');depForm.find('div.cbk-timer').hide();depForm.show();WBK.animateOnce(depForm,'cbk-fadeIn',function(){if(WBK.settings.device=='pc'){WBK.animateOnce(depForm.find('div.cbk-form-title'),'cbk-bounce');}});_this.onResizeWindow();}
else{_this.callToPhoneAt(phone,$('#cbkCallDeferredTime option:selected').attr('data-date'),$('#cbkCallDeferredTime').val());}}}
else{_this.showError($('#cbkPhoneDeferredInput'),s.text.cbkErrorNoPhone);}
e.preventDefault();return false;});w.window.find('div.cbk-crqform .cbk-button-yes').click(function(e){_this.callAfterForm(true);_this.onResizeWindow();e.preventDefault();return false;});w.window.find('div.cbk-crqform .cbk-button-no').click(function(e){w.window.find('div.cbk-form').hide();_this.setFormText(w.window.find('div.cbk-naform .cbk-form-title'),s.text.killerText[1]['no_connect'][WBK.settings.hasVisitorName]);_this.personalizeForms();var naForm=w.window.find('div.cbk-naform');naForm.show();WBK.animateOnce(naForm,'cbk-fadeIn',function(){if(WBK.settings.device=='pc'){WBK.animateOnce(naForm.find('div.cbk-form-title'),'cbk-bounce');}});_this.onResizeWindow();e.preventDefault();return false;});w.window.find('div.cbk-gnform .cbk-button-yes').click(function(e){_this.hideErorrs();var name=$('#cbkNameInput').val();var agree=$('#cbkAgreement:checked').length;if(!agree){_this.showError($('#cbkAgreement').parent(),s.text.cbkErrorNoAgree);}
else{if(!name||name===''){_this.showError($('#cbkNameInput'),s.text.cbkErrorNoName);}
else{var url=WBK.settings.serverUrl+"/api?action=setname&callback=?";jWS.getJSON(url,{code:WBK.settings.whiteSaasCode,name:name,killerId:WBK.settings.killerId,visitorId:WBK.settings.visitorId},function(result){});WBK.settings.visitorName=name;_this.personalizeForms();if(s.callStarted){if(s.skipSendRecordToVisitor){w.window.find('div.cbk-geform .cbk-button-no').click();}
else{w.window.find('div.cbk-geform .cbk-form-title').html(s.text.cbkSendCallToEmailTitle2);_this.personalizeForms();w.window.find('div.cbk-form').hide();var geForm=w.window.find('div.cbk-geform');geForm.show();WBK.animateOnce(geForm,'cbk-fadeIn',function(){if(WBK.settings.device=='pc'){WBK.animateOnce(geForm.find('div.cbk-form-title'),'cbk-bounce');}});_this.onResizeWindow();}}
else{_this.showWindow('auto');}}}
e.preventDefault();return false;});w.window.find('div.cbk-gnform .cbk-button-no').click(function(e){if(s.skipSendRecordToVisitor){w.window.find('div.cbk-geform .cbk-button-no').click();}
else{w.window.find('div.cbk-geform .cbk-form-title').html(s.text.cbkSendCallToEmailTitle3);_this.personalizeForms();w.window.find('div.cbk-form').hide();var geForm=w.window.find('div.cbk-geform');geForm.show();WBK.animateOnce(geForm,'cbk-fadeIn',function(){if(WBK.settings.device=='pc'){WBK.animateOnce(geForm.find('div.cbk-form-title'),'cbk-bounce');}});_this.onResizeWindow();}
e.preventDefault();return false;});w.window.find('div.cbk-geform .cbk-button-yes').click(function(e){_this.hideErorrs();var email=$('#cbkEmailInput').val();if(!email||email===''){_this.showError($('#cbkEmailInput'),s.text.cbkErrorNoEmail);}
else{var url=WBK.settings.serverUrl+"/api?action=setemail&callback=?";jWS.getJSON(url,{code:WBK.settings.whiteSaasCode,email:email,callId:s.callId,killerId:WBK.settings.killerId,visitorId:WBK.settings.visitorId},function(result){});w.window.find('div.cbk-form').hide();var shareForm=w.window.find('div.cbk-shareform');w.window.find('div.cbk-shareform .cbk-form-title').html(s.text.cbkShareTitle[s.killerWorking][s.killerHasMoney][WBK.settings.hasVisitorName]);_this.personalizeForms();shareForm.show();WBK.animateOnce(shareForm,'cbk-fadeIn',function(){if(WBK.settings.device=='pc'){WBK.animateOnce(shareForm.find('div.cbk-form-title'),'cbk-bounce');}});_this.onResizeWindow();}
e.preventDefault();return false;});w.window.find('div.cbk-geform .cbk-button-no').click(function(e){w.window.find('div.cbk-form').hide();var shareForm=w.window.find('div.cbk-shareform');var title=s.text.cbkShareTitle[s.killerWorking][s.killerHasMoney][WBK.settings.hasVisitorName];if(s.timerType=='hide'&&s.calling){title=s.text.cbkCallTitleOnHideTimer;}
w.window.find('div.cbk-shareform .cbk-form-title').html(title);_this.personalizeForms();shareForm.show();WBK.animateOnce(shareForm,'cbk-fadeIn',function(){if(WBK.settings.device=='pc'){WBK.animateOnce(shareForm.find('div.cbk-form-title'),'cbk-bounce');}});_this.onResizeWindow();e.preventDefault();return false;});if(WBK.settings.phoneMasks){var listRU=$.masksSort(WBK.settings.phoneMasks,['#'],/[0-9]|#/,"mask");var optsRU={inputmask:{definitions:{'#':{validator:"[0-9]",cardinality:1}},clearIncomplete:false,showMaskOnHover:false,autoUnmask:true},match:/[0-9]/,replace:'#',list:listRU,listKey:"mask",onMaskChange:function(){$(this).attr("placeholder",$(this).inputmask("getemptymask"));}};$('#cbkPhoneInput').inputmasks(optsRU);$('#cbkPhoneDeferredInput').inputmasks(optsRU);$('.cbk-phone-checker').inputmasks(optsRU);}
$('#cbkPhoneInput').bind('keydown',function(e){if(e.keyCode===13){$('#cbkPhoneBtn').click();}});$('#cbkPhoneDeferredInput').bind('keydown',function(e){if(e.keyCode===13){$('#cbkPhoneDeferredBtn').click();}});if(WBK.settings.device=='pc'){$('#cbkCallDeferredDate').change(function(){var selectedDate=new Date();selectedDate.setTime(selectedDate.getTime()-s.timeDelta*1000);var date=$(this).val().split('-');selectedDate.setYear(date[0]);selectedDate.setMonth(parseInt(date[1])-1);selectedDate.setDate(date[2]);_this.setWorkTimes(selectedDate);_this.setPhoneInputFocus();});}
w.window.find('.cbk-ink-reaction').on('click',function(e){var color=_this.getBackground($(this));var inverse=(_this.getLuma(color)>183)?' inverse':'';var ink=$('<div class="cbk-ink'+inverse+'"></div>');var btnOffset=$(this).offset();var xPos=e.pageX-btnOffset.left;var yPos=e.pageY-btnOffset.top;ink.css({top:yPos,left:xPos}).appendTo($(this));wsUtil.setTimeout('cbkInkReactionTimout',function(){ink.remove();},1500);});if(!WBK.settings.hideCopyright&&WBK.settings.device=='pc'&&!WBK.settings.thisIsCallbackKILLER){wsUtil.setInterval('animateCopyright',function(){WBK.animateOnce(w.window.find('a.cbk-copyright'),'cbk-tada');},s.timeouts.animateCopyright*1000);}
$(window).on('resize.callbackkiller',function(){_this.onResizeWindow();});$(window).on('scroll.callbackkiller',function(){_this.onScroll();});wsUtil.deleteCookie('WhiteCallback_timePage');WBK.pageIdentAdd(WBK.pageIdent);if(WBK.pageIdentGetMainPage()){WBK.pageIdentObserve();}
else{WBK.pageIdentSetMainPage(WBK.pageIdent);}
if(WBK.settings.device=='pc'){if(!s.noShowOnExit){$('body').mouseleave(function(e){var pos={x:e.pageX,y:e.pageY-$(document).scrollTop()};if(pos.y<=10){if(!WBK.settings.windowOpened&&!WBK.settings.windowGeneratorOpened&&!WBK.settings.chatWindowOpened&&!WBK.settings.chatInvitationOpened&&(parseInt(wsGenerator.settings.showExit)!=1||wsUtil.getCookie('WhiteGenerator_show_'+WBK.settings.generatorId))&&!wsUtil.getCookie('WhiteCallback_noShowOnExit')&&parseInt(wsUtil.getCookie('WhiteCallback_timePage'))>parseInt(s.showOnExitApperanceTimeout)){s.showOnExitXPosition=pos.x;var d=new Date();d.setMinutes(d.getMinutes()+60*24*100);wsUtil.setCookie('WhiteCallback_shownOn','onexit',d);_this.showWindow('exit');}
if(!s.showWindowReapperanceTimeout){wsUtil.deleteCookie('WhiteCallback_noShowWindow');}}});}
if(!wsUtil.getCookie('WhiteCallback_noShowWindow')&&!s.noShowWindow){wsUtil.setTimeout('showWindowOnTimer',function(){if(!wsUtil.getCookie('WhiteCallback_noShowWindow')&&((wsUtil.getCookie('WhiteCallback_noShowOnExit')&&!s.showWindowReapperanceTimeout)||(!wsUtil.getCookie('WhiteCallback_noShowOnExit')))){_this.checkWorkTime();if(!WBK.settings.windowOpened){var d=new Date();d.setMinutes(d.getMinutes()+60*24*100);wsUtil.setCookie('WhiteCallback_shownOn','onshow',d);_this.showWindow('auto');}}},s.showWindowApperanceTimeout*1000);}
_this.checkWorkTime();}
if(WBK.settings.device!='pc'){w.btn.addClass('callbackkiller-mobile');w.window.addClass('callbackkiller-mobile');s.windowRatio=window.innerWidth/window.screen.availWidth;wsUtil.setInterval('mobileResize',function(){if(s.windowRatio!==(window.innerWidth/window.screen.availWidth)){s.windowRatio=window.innerWidth/window.screen.availWidth;_this.onResizeWindow();}},250);}
$('body').on('click.callbackwidget','a[href="#callbackwidget"], a[href="'+window.top.location.origin+'#callbackwidget"], a[href="'+window.top.location.origin+'/#callbackwidget"], a[href="#callbackkiller"], a[href="'+window.top.location.origin+'#callbackkiller"], a[href="'+window.top.location.origin+'/#callbackkiller"]',function(e){if(s.btnType=='extended_btn'){w.extended_btn.click();}else{w.btn.click();}
e.preventDefault();return false;});$('body').on('click.callbackwidget','a[href="#callbackwidgetmodal"], a[href="'+window.top.location.origin+'#callbackwidgetmodal"], a[href="'+window.top.location.origin+'/#callbackwidgetmodal"], a[href="#callbackwidgetmodal"], a[href="'+window.top.location.origin+'#callbackkillermodal"], a[href="'+window.top.location.origin+'/#callbackkillermodal"]',function(e){var d=new Date();d.setMinutes(d.getMinutes()+60*24*100);wsUtil.setCookie('WhiteCallback_shownOn','onbtn',d);_this.showWindow('modal');e.preventDefault();return false;});$('body').keyup(function(e){if(WBK.settings.windowOpened){if(e.keyCode===27){_this.hideWindow();}}});w.window.find('span.cbk-service-name').html(WBK.settings.servicename);},checkWorkTime:function(){if(s.killerWorkdays){var killerTime=new Date();killerTime.setTime(killerTime.getTime()-s.timeDelta*1000+killerTime.getTimezoneOffset()*60*1000+s.killerTimezone*60*60*1000);var timeStartArray=s.killerWorkdays.time_start[s.currentDay].split(":");var timeEndArray=s.killerWorkdays.time_end[s.currentDay].split(":");var prevTimeStartArray=s.killerWorkdays.time_start[s.prevDay].split(":");var prevTimeEndArray=s.killerWorkdays.time_end[s.prevDay].split(":");if(s.killerIsPaused&&s.killerPausedStart&&s.killerPausedEnd){var pausedStartDateArray=s.killerPausedStart.split('.');var pausedStartDate=new Date(parseInt(pausedStartDateArray[2]),(parseInt(pausedStartDateArray[1])-1),parseInt(pausedStartDateArray[0]),killerTime.getHours(),killerTime.getMinutes(),killerTime.getSeconds());pausedStartDate.setTime(pausedStartDate.getTime()-s.timeDelta*1000+killerTime.getTimezoneOffset()*60*1000+s.killerTimezone*60*60*1000);var pausedEndDateArray=s.killerPausedEnd.split('.');var pausedEndDate=new Date(parseInt(pausedEndDateArray[2]),(parseInt(pausedEndDateArray[1])-1),parseInt(pausedEndDateArray[0]),killerTime.getHours(),killerTime.getMinutes()+1,killerTime.getSeconds());pausedEndDate.setTime(pausedEndDate.getTime()-s.timeDelta*1000+killerTime.getTimezoneOffset()*60*1000+s.killerTimezone*60*60*1000);if((((killerTime.getDate()>=pausedStartDate.getDate()&&killerTime.getMonth()==pausedStartDate.getMonth())||(killerTime.getDate()<=pausedStartDate.getDate()&&killerTime.getMonth()>pausedStartDate.getMonth()))&&killerTime.getFullYear()>=pausedStartDate.getFullYear())&&(((killerTime.getDate()<=pausedEndDate.getDate()&&killerTime.getMonth()==pausedEndDate.getMonth())||(killerTime.getDate()>=pausedEndDate.getDate()&&killerTime.getMonth()<pausedEndDate.getMonth()))&&killerTime.getFullYear()<=pausedEndDate.getFullYear())){s.killerIsPausedNow=true;}}
if(s.killerWorkdays.workdays[s.currentDay]&&s.killerWorkdays.workdays[s.currentDay]!=='false'&&!s.killerIsPausedNow){var startTime=new Date(killerTime.getTime());startTime.setHours(timeStartArray[0]);startTime.setMinutes(timeStartArray[1]);startTime.setSeconds(0);var endTime=new Date(killerTime.getTime());endTime.setHours(timeEndArray[0]);if(parseInt(timeStartArray[0])>parseInt(timeEndArray[0])){endTime.setHours(endTime.getHours()+24);}
endTime.setMinutes(timeEndArray[1]);endTime.setSeconds(0);if(parseInt(timeStartArray[0])===parseInt(timeEndArray[0])&&parseInt(timeStartArray[1])===parseInt(timeEndArray[1])){s.killerWorking=1;}
else{if(killerTime>startTime){if(killerTime<endTime){s.killerWorking=1;s.killerWorkingToday=true;}
else{s.killerWorking=0;s.killerWorkingToday=false;}}
else{s.killerWorking=0;s.killerWorkingToday=true;}}}
else if(s.killerWorkdays.workdays[s.prevDay]&&s.killerWorkdays.workdays[s.prevDay]!=='false'&&parseInt(prevTimeEndArray[0])<parseInt(prevTimeStartArray[0])&&!s.killerIsPausedNow){var startTime=new Date(killerTime.getTime());startTime.setDate(startTime.getDate()-1);startTime.setHours(prevTimeStartArray[0]);startTime.setMinutes(prevTimeStartArray[1]);startTime.setSeconds(0);var endTime=new Date(killerTime.getTime());endTime.setDate(endTime.getDate()-1);endTime.setHours(prevTimeEndArray[0]);if(parseInt(prevTimeStartArray[0])>parseInt(prevTimeEndArray[0])){endTime.setHours(endTime.getHours()+24);}
endTime.setMinutes(prevTimeEndArray[1]);endTime.setSeconds(0);if(parseInt(prevTimeStartArray[0])===parseInt(prevTimeEndArray[0])&&parseInt(prevTimeStartArray[1])===parseInt(prevTimeEndArray[1])){s.killerWorking=1;}
else{if(killerTime>startTime){if(killerTime<endTime){s.killerWorking=1;s.killerWorkingToday=true;}
else{s.killerWorking=0;s.killerWorkingToday=false;}}
else{s.killerWorking=0;s.killerWorkingToday=true;}}}
else{s.killerWorkingToday=false;}}
else{s.killerWorking=0;s.killerWorkingToday=false;}},setWorkTimes:function(selectedDate){_this.checkWorkTime();$('#cbkCallDeferredTime').empty();var currentDay=selectedDate.getDay()-1;if(currentDay<0){currentDay=currentDay+7;}
var myTime=new Date();var now=new Date();now.setTime(now.getTime()-s.timeDelta*1000+now.getTimezoneOffset()*60*1000+s.killerTimezone*60*60*1000);var timeStartArray=s.killerWorkdays.time_start[currentDay].split(":");var timeEndArray=s.killerWorkdays.time_end[currentDay].split(":");s.hourDelta=-now.getTimezoneOffset()/60-s.killerTimezone;var startTime=new Date(now.getTime());startTime.setHours(timeStartArray[0]);startTime.setHours(startTime.getHours()+s.hourDelta);startTime.setMinutes(timeStartArray[1]);if(selectedDate.getDate()===now.getDate()&&s.killerWorking){startTime.setHours(myTime.getHours()+1);startTime.setMinutes(0);}
startTime.setSeconds(0);selectedDate.setHours(startTime.getHours());selectedDate.setMinutes(startTime.getMinutes());selectedDate.setSeconds(0);var endTime=new Date(now.getTime());endTime.setHours(timeEndArray[0]);endTime.setHours(endTime.getHours()+s.hourDelta);if(parseInt(timeStartArray[0])>parseInt(timeEndArray[0])){endTime.setHours(endTime.getHours()+24);}
else if(parseInt(timeStartArray[0])===parseInt(timeEndArray[0])){endTime.setHours(endTime.getHours()+12);}
endTime.setMinutes(timeEndArray[1]);endTime.setSeconds(0);if(startTime<endTime){while(startTime<endTime){var h=startTime.getHours();var m=startTime.getMinutes();if(h>=8&&h<22){if(h<10){h='0'+h;}
if(m<10){m='0'+m;}
$('#cbkCallDeferredTime').append($('<option>').val(h+':'+m).text(h+':'+m).attr('data-date',selectedDate.getFullYear()+'-'+(selectedDate.getMonth()+1)+'-'+selectedDate.getDate()));startTime.setHours(startTime.getHours()+1);selectedDate.setHours(selectedDate.getHours()+1);startTime.setMinutes(0);selectedDate.setMinutes(0);if(!(startTime<endTime)&&!(startTime>endTime)){$('#cbkCallDeferredTime').append($('<option>').val(h+':30').text(h+':30').attr('data-date',selectedDate.getFullYear()+'-'+(selectedDate.getMonth()+1)+'-'+selectedDate.getDate()));}}
else{startTime.setHours(startTime.getHours()+1);selectedDate.setHours(selectedDate.getHours()+1);}}}
else{$('#cbkCallDeferredDate option:selected').remove();var selectedDate=new Date();selectedDate.setTime(selectedDate.getTime()-s.timeDelta*1000);var date=$('#cbkCallDeferredDate option:selected').val().split('-');selectedDate.setYear(date[0]);selectedDate.setMonth(parseInt(date[1])-1);selectedDate.setDate(date[2]);_this.setWorkTimes(selectedDate);}},setWorkDays:function(){$('#cbkCallDeferredDate').empty();var dayNames={0:s.text.cbkMondayText,1:s.text.cbkTuesdayText,2:s.text.cbkWednesdayText,3:s.text.cbkThursdayText,4:s.text.cbkFridayText,5:s.text.cbkSaturdayText,6:s.text.cbkSundayText};var now=new Date();var currentDay=false,dayDiff=false;if(s.killerIsPaused&&s.killerPausedStart&&s.killerPausedEnd){var pausedStartDateArray=s.killerPausedStart.split('.');var pausedStartDate=new Date(parseInt(pausedStartDateArray[2]),(parseInt(pausedStartDateArray[1])-1),parseInt(pausedStartDateArray[0]),now.getHours(),now.getMinutes(),now.getSeconds());pausedStartDate.setTime(pausedStartDate.getTime()-s.timeDelta*1000+now.getTimezoneOffset()*60*1000+s.killerTimezone*60*60*1000);var pausedEndDateArray=s.killerPausedEnd.split('.');var pausedEndDate=new Date(parseInt(pausedEndDateArray[2]),(parseInt(pausedEndDateArray[1])-1),parseInt(pausedEndDateArray[0]),now.getHours(),now.getMinutes()+1,now.getSeconds());pausedEndDate.setTime(pausedEndDate.getTime()-s.timeDelta*1000+now.getTimezoneOffset()*60*1000+s.killerTimezone*60*60*1000);dayDiff=Math.round((pausedEndDate.getTime()-now.getTime())/(1000*60*60*24));}
if(s.killerIsPausedNow){now.setTime(pausedEndDate.getTime());currentDay=s.killerPausedDay;}else{now.setTime(now.getTime()-s.timeDelta*1000+now.getTimezoneOffset()*60*1000+s.killerTimezone*60*60*1000);currentDay=s.currentDay;dayDiff=0;}
var firstWorkDate=false,twoDayInc=2,threeDayInc=3;for(var day=0;day<4;day++){var checkDay=currentDay+day;if(checkDay>6){checkDay=checkDay-7;}
var checkDayDiff=false;if((day===0&&s.killerWorkingToday)||day>0){if(s.killerWorkdays.workdays[checkDay]&&s.killerWorkdays.workdays[checkDay]!=='false'){var date=new Date(now.getTime());var dayName=dayNames[checkDay];var showOnlyDate=false;if(day===1){date=new Date(now.getTime()+1*24*60*60*1000);if(s.killerIsPaused){if(date>=pausedStartDate&&date<pausedEndDate){date=new Date(pausedEndDate.getTime()+1*24*60*60*1000);showOnlyDate=true;}else{twoDayInc=1;threeDayInc=2;}}
if(!firstWorkDate){firstWorkDate=new Date(date.getTime());}
checkDayDiff=dayDiff+day;if(checkDayDiff>6||showOnlyDate){dayName=date.getDate()+' '+WBK.settings.months[date.getMonth()];}else{dayName=dayNames[checkDay];}}
else if(day===2){date=new Date(now.getTime()+2*24*60*60*1000);if(s.killerIsPaused){if(date>=pausedStartDate&&date<pausedEndDate){date=new Date(pausedEndDate.getTime()+twoDayInc*24*60*60*1000);showOnlyDate=true;}else{threeDayInc=twoDayInc+1;}}
if(!firstWorkDate||showOnlyDate){firstWorkDate=new Date(date.getTime());}
checkDayDiff=dayDiff+day;if(checkDayDiff>6||showOnlyDate){dayName=date.getDate()+' '+WBK.settings.months[date.getMonth()];}else{dayName=dayNames[checkDay];}}
else if(day===3){date=new Date(now.getTime()+3*24*60*60*1000);if(s.killerIsPaused){if(date>=pausedStartDate&&date<pausedEndDate){date=new Date(pausedEndDate.getTime()+threeDayInc*24*60*60*1000);showOnlyDate=true;}}
if(!firstWorkDate){firstWorkDate=new Date(date.getTime());}
checkDayDiff=dayDiff+day;if(checkDayDiff>6||showOnlyDate){dayName=date.getDate()+' '+WBK.settings.months[date.getMonth()];}else{dayName=dayNames[checkDay];}}
else{if(!firstWorkDate){firstWorkDate=new Date(now.getTime());}}
var dayValue=date.getFullYear()+'-'+(date.getMonth()+1)+'-'+date.getDate();$('#cbkCallDeferredDate').append($('<option>').val(dayValue).text(dayName));}}}
if(!firstWorkDate){date=new Date(now.getTime()+1*24*60*60*1000);firstWorkDate=new Date(now.getTime()+1*24*60*60*1000);dayName=dayNames[s.currentDay];var dayValue=date.getFullYear()+'-'+(date.getMonth()+1)+'-'+date.getDate();$('#cbkCallDeferredDate').append($('<option>').val(dayValue).text(dayName));}
_this.setWorkTimes(firstWorkDate);},initKiller:function(){_this._initKiller();wsUtil.setTimeout('cbkInitKilerTimout',function(){_this._initKiller();},3000);},_initKiller:function(){if(WBK.settings.callbackEnabled&&s.killerFormCall){if(window.location.hostname==='ru-mod.ru'&&window.location.pathname==='/emarket/cart/'){return false;}
var formSelector='form';if(s.killerFormCall===2){formSelector='form.callbackwidget-call-form, form.callbackkiller-call-form';}
console.log('Forms to check:');console.log($(document).find(formSelector));$(document).find(formSelector).off('submit.cbk').on('submit.cbk',function(){_this.checkFormOnSubmit(this);});try{$(document).find('iframe').each(function(){var _iframe=this;try{if(_iframe.contentWindow&&_iframe.contentDocument){console.log('Forms in frame to check:');console.log($(_iframe.contentWindow.document).find(formSelector));$(_iframe.contentWindow.document).find(formSelector).off('submit.cbk').on('submit.cbk',function(){_this.checkFormOnSubmit(this);});}}
catch(e){}});}
catch(e){}}
$(document).find('input, select').each(function(){var inputType=$(this).attr('type');if(inputType!=='button'&&inputType!=='submit'&&inputType!=='radio'&&inputType!=='checkbox'){$(this).off('focus.callbackkiller').on('focus.callbackkiller',function(){s.noShowWindow=true;});$(this).off('blur.callbackkiller').on('blur.callbackkiller',function(){s.noShowWindow=false;});}});$(document).find('iframe').each(function(){var _iframe=this;try{if(_iframe.contentWindow&&_iframe.contentDocument){$(_iframe.contentWindow.document).find('input, select').each(function(){var inputType=$(this).attr('type');if(inputType!=='button'&&inputType!=='submit'&&inputType!=='radio'&&inputType!=='checkbox'){$(this).off('focus.callbackkiller').on('focus.callbackkiller',function(){s.noShowWindow=true;});$(this).off('blur.callbackkiller').on('blur.callbackkiller',function(){s.noShowWindow=false;});}});}}
catch(e){}});_this.startCheckNeedToCall();},checkFormOnSubmit:function(form){console.log('Form submitted:');console.log($(form));_this.checkWorkTime();$(form).find('input').each(function(){var inputType=$(this).attr('type');if(inputType!=='button'&&inputType!=='submit'&&inputType!=='radio'&&inputType!=='checkbox'&&inputType!=='file'&&inputType!=='image'&&inputType!=='password'&&inputType!=='hidden'){var phone=$(this).val();WBK.settings.phoneMask='+_(___)___-__-__';if(phone){var phone=WBK.checkPhone($(this).val());if(phone){var d=new Date();d.setMinutes(d.getMinutes()+60*24*100);wsUtil.setCookie('WhiteCallback_shownOn','onform',d);var name=$(form).find('input.callbackwidget-name').val();var email=$(form).find('input.callbackwidget-email').val();if(name!=''||email!=''){_this.setVisitorData({name:name,email:email});}
WBK.settings.phoneMask=$('.cbk-phone-checker:first').attr('placeholder');if(s.killerWorking){wsUtil.setCookie('WhiteCallback_needcall',true);wsUtil.setCookie('WhiteCallback_needcall_phone',phone);}else{_this.setWorkDays();_this.deferredCall(phone,$('#cbkCallDeferredTime option:first').attr('data-date'),$('#cbkCallDeferredTime option:first').text());}}}}});},startCheckNeedToCall:function(){_this.checkNeedToCall();wsUtil.setInterval('checkNeedToCall',function(){_this.checkNeedToCall();},s.timeouts.needToCall*1000);},checkNeedToCall:function(){if(wsUtil.getCookie('WhiteCallback_needcall')){_this.checkWorkTime();if(s.killerWorking){if(!s.killerFormCallHide){_this.showWindow('auto');}else{if(s.showWindowReapperanceTimeout){var d=new Date();d.setDate(d.getDate()+parseInt(s.showWindowReapperanceTimeout));wsUtil.setCookie('WhiteCallback_noShowWindow',1,d);}
else{wsUtil.setCookie('WhiteCallback_noShowWindow',1);}
var d=new Date();d.setMinutes(d.getMinutes()+parseInt(s.showOnExitReapperanceTimeout));wsUtil.setCookie('WhiteCallback_noShowOnExit',1,d);}
s.callingFromForm=true;var phone=wsUtil.getCookie('WhiteCallback_needcall_phone');$('#cbkPhoneInput').val(phone);s.phoneMask=$('#cbkPhoneInput').attr('placeholder');wsUtil.deleteCookie('WhiteCallback_needcall');wsUtil.deleteCookie('WhiteCallback_needcall_phone');_this.callToPhone(phone);}}},callAfterForm:function(no_rating){if(s.managerRatingCheck&&no_rating){_this.initRating();w.window.find('div.cbk-form').hide();var crqForm=w.window.find('div.cbk-ratingform');crqForm.show();WBK.animateOnce(crqForm,'cbk-fadeIn',function(){if(WBK.settings.device=='pc'){WBK.animateOnce(crqForm.find('div.cbk-form-title'),'cbk-bounce');}});}
else if(s.killerVisitorGetName&&!WBK.settings.visitorName&&!s.callingFromForm){w.window.find('div.cbk-form').hide();if(s.managerRatingCheck){w.window.find('div.cbk-gnform .cbk-form-title').html(s.text.cbkGetNameTitle);}else{w.window.find('div.cbk-gnform .cbk-form-title').html(s.text.cbkGetNameTitle2);}
w.window.find('div.cbk-gnform .cbk-button-no').parent().show();w.window.find('div.cbk-gnform .cbk-service-name').html(WBK.settings.servicename);var gnForm=w.window.find('div.cbk-gnform');gnForm.show();WBK.animateOnce(gnForm,'cbk-fadeIn',function(){if(WBK.settings.device=='pc'){WBK.animateOnce(gnForm.find('div.cbk-form-title'),'cbk-bounce');}});if(WBK.settings.device=='pc'){$('#cbkNameInput').focus();}}
else if(!s.skipSendRecordToVisitor){w.window.find('div.cbk-form').hide();w.window.find('div.cbk-geform .cbk-form-title').html(s.text.cbkSendCallToEmailTitle2);_this.personalizeForms();var geForm=w.window.find('div.cbk-geform');geForm.show();WBK.animateOnce(geForm,'cbk-fadeIn',function(){if(WBK.settings.device=='pc'){WBK.animateOnce(geForm.find('div.cbk-form-title'),'cbk-bounce');}});if(WBK.settings.device=='pc'){$('#cbkEmailInput').focus();}}else{w.window.find('div.cbk-geform .cbk-button-no').click();}},initRating:function(){var ratingObj=w.window.find('ul.cbk-call-rating');ratingObj.find('a').unbind('mouseenter.callbackkiller').unbind('mouseleave.callbackkiller').unbind('click.callbackkiller').removeClass('cbk-marked');ratingObj.find('a').on('mouseenter.callbackkiller',function(){var value=$(this).data('value');for(var i=1;i<=value;i++){$('#cbkRating'+i).addClass('cbk-marked');}}).on('mouseleave.callbackkiller',function(){ratingObj.find('a').removeClass('cbk-marked');}).on('click.callbackkiller',function(e){var url=WBK.settings.serverUrl+"/api?action=rating&callback=?";var value=$(this).data('value');jWS.getJSON(url,{code:WBK.settings.whiteSaasCode,rating:value,callId:s.callId,killerId:WBK.settings.killerId,visitorId:WBK.settings.visitorId},function(result){});_this.callAfterForm(false);_this.onResizeWindow();e.preventDefault();return false;});},personalizeForms:function(){var _this=this;var time=s.callTimeout+'&nbsp;'+wsUtil.doEnding(s.callTimeout,s.text.cbkSecond1,s.text.cbkSecond2,s.text.cbkSecond3);w.window.find('div.cbk-form-title').each(function(){$(this).html($(this).html().replace(/\[time\]/g,time));});if(WBK.settings.visitorPhone){$('#cbkPhoneInput').val(WBK.settings.visitorPhone);$('#cbkPhoneDeferredInput').val(WBK.settings.visitorPhone);}
if(WBK.settings.visitorEmail){$('#cbkEmailInput').val(WBK.settings.visitorEmail);}
if(WBK.settings.visitorName){w.window.find('span.cbk-visitor-name').replaceWith($('<a>').addClass('cbk-change-name').addClass('cbk-button-no').addClass('cbk-button-no-dark').attr('href','javascript:void(0)').html(WBK.settings.visitorName));w.window.find('.cbk-visitor-name-no-link').text(WBK.settings.visitorName);$('#cbkNameInput').val(WBK.settings.visitorName);w.window.find('div.cbk-form-title').each(function(){$(this).html($(this).html().replace(/\[name\]/g,"<a href='javascript:void(0)' class='cbk-change-name cbk-button-no cbk-button-no-dark'>"+WBK.settings.visitorName+"</a>"));});}
else{w.window.find('.cbk-visitor-name-to-delete').remove();w.window.find('div.cbk-form-title').each(function(){$(this).html($(this).html().replace('[name]',""));});}
w.window.find('a.cbk-copyright').attr('href',s.cbkLink);if(WBK.settings.thisIsCallbackKILLER){w.window.find('a.cbk-copyright').addClass('cbk-copyright-callbackkiller').html("Хочу обратный звонок на свой сайт");}
w.window.find('.cbk-change-name').unbind('click').on('click',function(e){w.window.find('div.cbk-form').hide();w.window.find('div.cbk-gnform .cbk-form-title').html(s.text.cbkGetNameTitle3);w.window.find('div.cbk-gnform .cbk-button-no').parent().hide();_this.personalizeForms();w.window.find('div.cbk-gnform .cbk-service-name').html(WBK.settings.servicename);var gnForm=w.window.find('div.cbk-gnform');gnForm.show();WBK.animateOnce(gnForm,'cbk-fadeIn',function(){if(WBK.settings.device=='pc'){WBK.animateOnce(gnForm.find('div.cbk-form-title'),'cbk-bounce');}});if(WBK.settings.device=='pc'){$('#cbkNameInput').focus();}
_this.onResizeWindow();e.preventDefault();return false;});},setPhoneInputFocus:function(){var id='cbkPhoneInput';if($('div.cbk-cdform:visible').length){id='cbkPhoneDeferredInput';}
if(!$('#'+id).val()&&!s.calling){if(WBK.settings.phoneBase!==''){$('#'+id).val(WBK.settings.phoneBase);if(WBK.settings.device=='pc'){$('#'+id).focus();if(WBK.settings.phoneBase===7){wsUtil.setCaretPosition($('#'+id),3,3);}
if(WBK.settings.phoneBase===77){wsUtil.setCaretPosition($('#'+id),4,4);}
if(WBK.settings.phoneBase===38){wsUtil.setCaretPosition($('#'+id),3,3);}
if(WBK.settings.phoneBase===44){wsUtil.setCaretPosition($('#'+id),4,4);}}}else{if(WBK.settings.device=='pc'){wsUtil.setCaretPosition($('#'+id),2,2);}}}},setFormText:function(obj,killerText){obj.html(_this.formatText(killerText));},formatText:function(killerText){var text=killerText.title;if(killerText.title&&killerText.text){text=killerText.title+"<br/><small>"+killerText.text+"</small>";}
else if(!killerText.title&&killerText.text){text="<small>"+killerText.text+"</small>";}
return text;},sendGoal:function(type){if(s.killerIsPayed){var yaGoal,gaGoal;var yagla=false;var gaCategory='CallbackWidget';if(WBK.settings.thisIsCallbackKILLER){gaCategory='CallbackKILLER';}
switch(type){case'call':if(WBK.settings.thisIsCallbackKILLER){yaGoal='CBK_CALL';}
else{yaGoal='CBW_CALL';}
gaGoal='NewCall';yagla=true;break;case'showonbtn':if(WBK.settings.thisIsCallbackKILLER){yaGoal='CBK_SHOW_ON_BTN';}
else{yaGoal='CBW_SHOW_ON_BTN';}
gaGoal='ShowOnBtn';break;case'form':if(WBK.settings.thisIsCallbackKILLER){yaGoal='CBK_CALL_ON_FORM';}
else{yaGoal='CBW_CALL_ON_FORM';}
gaGoal='NewCallOnForm';break;}
wsUtil.sendGoal(yaGoal,gaGoal,gaCategory,yagla);}},setVisitorData:function(data){var url=WBK.settings.serverUrl+"/api?action=setVisitorData&callback=?";jWS.getJSON(url,{code:WBK.settings.whiteSaasCode,name:data.name?data.name:'',email:data.email?data.email:'',phone:data.phone?data.phone:'',visitorId:WBK.settings.visitorId},function(result){});},callToPhone:function(phone,department,customtext){phone=WBK.checkPhone(phone);if(phone&&!s.calling){s.calling=true;s.callStarted=true;var callParam={phone:phone,department:(department)?department:'',customtext:(customtext)?customtext:(($('meta[name="callbackkiller:customtext"]').length)?$('meta[name="callbackkiller:customtext"]').attr('content'):''),phoneMask:WBK.settings.phoneMask,shownOn:wsUtil.getCookie('WhiteCallback_shownOn'),url:(typeof document.URL==="string")?document.URL:'',device:WBK.settings.device,code:WBK.settings.whiteSaasCode,visitorId:WBK.settings.visitorId,visitId:WBK.settings.visitId,googleClientId:wsUtil.getGoogleClientId(),killerId:WBK.settings.killerId,generatorId:WBK.settings.generatorId,invader_id:WBK.settings.invaderId,invaderStatId:WBK.settings.invaderCallbackStatId,instinct_id:WBK.settings.instinctId,instinctStatId:WBK.settings.instinctCallbackStatId,generatorLeadId:WBK.settings.genLeadId,roistatPromo:wsUtil.getRoistatPromo(),advertiseId:wsUtil.getAdvertiseId(),calltrackingId:wsUtil.getCalltrackingId()};var url=WBK.settings.serverUrl+"/api?action=call&callback=?";$.getJSON(url,callParam,function(result){s.callingGenerator=false;WBK.settings.genLeadId=false;WBK.settings.visitorPhone=phone;WBK.settings.called=true;_this.onCall(result,callParam);});}},onCall:function(result,callParam){if(!result.Success&&result.Errors&&!s.callingFromForm){if(s.useDepartment){_this.showError($('#cbkDepartment'),result.Errors[0]);}
if(s.calling){_this.showError($('#cbkPhoneInput'),result.Errors[0]);}
else{_this.showError($('#cbkPhoneDeferredInput'),result.Errors[0]);}
s.calling=false;s.callStarted=false;}
else if(result.Success&&result.Data.noWorkTime&&!s.callingFromForm){if(result.Data.killerWorkdays){s.killerWorkdays=result.Data.killerWorkdays;}
if(result.Data.killerIsPaused){s.killerIsPaused=result.Data.killerIsPaused;}
if(result.Data.killerPausedStart){s.killerPausedStart=result.Data.killerPausedStart;}
if(result.Data.killerPausedEnd){s.killerPausedEnd=result.Data.killerPausedEnd;}
if(result.Data.killerPausedDay){s.killerPausedDay=result.Data.killerPausedDay;}
s.calling=false;s.callStarted=false;_this.showWindow('auto',true);}
else if(result.Success&&result.Data.callId){if(s.callingFromForm){if(!s.killerFormCallHide){_this.showWindow('auto',false);}
w.window.find('div.cbk-callform .cbk-form-title').html(s.text.cbkCallTitleOnFormCall);$('#cbkPhoneBtn').hide();}
if(result.Data.callId){s.callId=result.Data.callId;var d=new Date();d.setMinutes(d.getMinutes()+15);wsUtil.setCookie('WhiteCallback_callId',s.callId,d);WBK.initSocket();}
if(!s.killerHasMoney){if(s.skipSendRecordToVisitor){w.window.find('div.cbk-geform .cbk-button-no').click();}
else{w.window.find('div.cbk-form').hide();w.window.find('div.cbk-geform .cbk-form-title').html(s.text.cbkSendCallToEmailTitle3);_this.personalizeForms();var geForm=w.window.find('div.cbk-geform');geForm.show();WBK.animateOnce(geForm,'cbk-fadeIn',function(){if(WBK.settings.device=='pc'){WBK.animateOnce(geForm.find('div.cbk-form-title'),'cbk-bounce');}});if(WBK.settings.device=='pc'){$('#cbkEmailInput').focus();}
_this.onResizeWindow();}}
else{if(parseInt(result.Data.callOff)){if(s.skipSendRecordToVisitor){w.window.find('div.cbk-geform .cbk-button-no').click();}
else{w.window.find('div.cbk-form').hide();w.window.find('div.cbk-geform .cbk-form-title').html(s.text.cbkSendCallToEmailTitle3);_this.personalizeForms();var geForm=w.window.find('div.cbk-geform');geForm.show();WBK.animateOnce(geForm,'cbk-fadeIn',function(){if(WBK.settings.device=='pc'){WBK.animateOnce(geForm.find('div.cbk-form-title'),'cbk-bounce');}});if(WBK.settings.device=='pc'){$('#cbkEmailInput').focus();}
_this.onResizeWindow();}}
else{if(!w.window.find('div.cbk-callform:visible').length){w.window.find('div.cbk-form').hide();var callForm=w.window.find('div.cbk-callform');callForm.show();}
w.window.find('div.cbk-callform .cbk-link-btn .cbk-button-no').hide();s.calling=true;if(s.timerType=='hide'){_this.callAfterForm();}else{wsUtil.setInterval('callTimerAnimation',function(){var htmlSec=w.window.find('div.cbk-callform .cbk-timer .cbk-number-sec');var htmlMSec=w.window.find('div.cbk-callform .cbk-timer .cbk-number-msec');var sec=parseInt(htmlSec.text());var msec=parseInt(htmlMSec.text());msec--;if(msec<1){sec--;msec=99;}
if(sec<1){wsUtil.deleteInterval('callTimerAnimation');s.calling=false;w.window.find('div.cbk-form').hide();var crqForm=w.window.find('div.cbk-crqform');crqForm.show();WBK.animateOnce(crqForm,'cbk-fadeIn',function(){if(WBK.settings.device=='pc'){WBK.animateOnce(crqForm.find('div.cbk-form-title'),'cbk-bounce');}});_this.onResizeWindow();msec=0;sec=0;}
if(sec<10){sec='0'+sec;}
if(msec<10){msec='0'+msec;}
htmlSec.text(sec);htmlMSec.text(msec);},10);}}}
if(wsUtil.getCookie('WhiteCallback_shownOn')=='onform'&&WBK.settings.siteId==38835){_this.sendGoal('form');}else{_this.sendGoal('call');}}},newCall:function(phone,immediately){phone=WBK.checkPhone(phone);if(phone&&!s.calling){var vName,vEmail;$('.callbackwidget-name').each(function(){if($(this).val()){vName=$(this).val();}});$('.callbackwidget-email').each(function(){if($(this).val()){vEmail=$(this).val();}});if(vName||vEmail){_this.setVisitorData({name:vName,email:vEmail,phone:phone});}
WBK.settings.phoneMask=w.window.find('.cbk-phone-checker:first').attr('placeholder');_this.checkWorkTime();if(s.killerWorking||immediately){_this.callToPhone(phone);}else{_this.setWorkDays();_this.deferredCall(phone,$('#cbkCallDeferredTime option:first').attr('data-date'),$('#cbkCallDeferredTime option:first').text());}}},callToPhoneAt:function(phone,date,time,department,customtext){phone=WBK.checkPhone(phone);if(phone){s.callStarted=true;_this.deferredCall(phone,date,time,department,customtext,function(result){if(!result.Success&&result.Errors){_this.showError($('#cbkPhoneDeferredInput'),result.Errors[0]);s.calling=false;}
else if(result.Success){if(result.Data.callId){s.callId=result.Data.callId;var d=new Date();d.setMinutes(d.getMinutes()+15);wsUtil.setCookie('WhiteCallback_callId',s.callId,d);}
if(!WBK.settings.visitorName){w.window.find('div.cbk-form').hide();w.window.find('div.cbk-gnform .cbk-form-title').html(s.text.cbkGetNameTitle2);_this.personalizeForms();w.window.find('div.cbk-gnform .cbk-service-name').html(WBK.settings.servicename);var gnForm=w.window.find('div.cbk-gnform');gnForm.show();WBK.animateOnce(gnForm,'cbk-fadeIn',function(){if(WBK.settings.device=='pc'){WBK.animateOnce(gnForm.find('div.cbk-form-title'),'cbk-bounce');}});if(WBK.settings.device=='pc'){$('#cbkNameInput').focus();}}
else{if(s.skipSendRecordToVisitor){w.window.find('div.cbk-geform .cbk-button-no').click();}
else{w.window.find('div.cbk-form').hide();w.window.find('div.cbk-geform .cbk-form-title').html(s.text.cbkSendCallToEmailTitle3);_this.personalizeForms();var geForm=w.window.find('div.cbk-geform');geForm.show();WBK.animateOnce(geForm,'cbk-fadeIn',function(){if(WBK.settings.device=='pc'){WBK.animateOnce(geForm.find('div.cbk-form-title'),'cbk-bounce');}});if(WBK.settings.device=='pc'){$('#cbkEmailInput').focus();}}}
_this.onResizeWindow();if(wsUtil.getCookie('WhiteCallback_shownOn')=='onform'&&WBK.settings.siteId==38835){_this.sendGoal('form');}else{_this.sendGoal('call');}}});}},deferredCall:function(phone,date,time,department,customtext,callback){var _this=this;phone=WBK.checkPhone(phone);if(phone){var url=WBK.settings.serverUrl+"/api?action=calldeferred&callback=?";jWS.getJSON(url,{phone:phone,department:(department)?department:'',customtext:(customtext)?customtext:(($('meta[name="callbackkiller:customtext"]').length)?$('meta[name="callbackkiller:customtext"]').attr('content'):''),phoneMask:WBK.settings.phoneMask,shownOn:wsUtil.getCookie('WhiteCallback_shownOn'),url:(typeof document.URL==="string")?document.URL:'',device:WBK.settings.device,code:WBK.settings.whiteSaasCode,visitorId:WBK.settings.visitorId,visitId:WBK.settings.visitId,googleClientId:wsUtil.getGoogleClientId(),killerWorking:s.killerWorking,hourDelta:s.hourDelta,date:date,time:time,killerId:WBK.settings.killerId,generatorId:WBK.settings.generatorId,generatorLeadId:WBK.settings.genLeadId,invader_id:WBK.settings.invaderId,invaderStatId:WBK.settings.invaderCallbackStatId,instinct_id:WBK.settings.instinctId,instinctStatId:WBK.settings.instinctCallbackStatId,roistatPromo:wsUtil.getRoistatPromo(),advertiseId:wsUtil.getAdvertiseId(),calltrackingId:wsUtil.getCalltrackingId()},function(result){if(typeof(callback)!=='undefined'){callback(result);}
WBK.settings.genLeadId=false;WBK.settings.called=true;});}},onCallStatus:function(data){if(parseInt(data.site_id)===WBK.settings.siteId&&(parseInt(data.call_id)===s.callId)){if(parseInt(data.call_status)===1&&s.timerType!='hide'){if(!WBK.settings.windowOpened){if(!s.callingFromForm||(s.callingFromForm&&!s.killerFormCallHide)){_this.showWindow('auto');}}
if(w.window.find('div.cbk-callform').is(':visible')){w.window.find('div.cbk-callform .cbk-form-title').html(s.text.cbkCallTitleCalling);_this.personalizeForms();if(WBK.settings.device=='pc'){var callForm=w.window.find('div.cbk-callform');WBK.animateOnce(callForm.find('div.cbk-form-title'),'cbk-bounce');}}}
else if(parseInt(data.call_status)===2){if(!WBK.settings.windowOpened){if(!s.callingFromForm||(s.callingFromForm&&!s.killerFormCallHide)){_this.showWindow('auto');}}
wsUtil.deleteInterval('callTimerAnimation');s.calling=false;_this.callAfterForm();_this.onResizeWindow();}
else if(parseInt(data.call_status)===4){if(!WBK.settings.windowOpened){if(!s.callingFromForm||(s.callingFromForm&&!s.killerFormCallHide)){_this.showWindow('auto');}}
wsUtil.deleteInterval('callTimerAnimation');w.window.find('.cbk-timer').hide();s.calling=false;w.window.find('div.cbk-form').hide();var callForm=w.window.find('div.cbk-callform');callForm.find('div.cbk-form-title').html(s.text.cbkCallTitleFail);_this.personalizeForms();callForm.show();if(WBK.settings.device=='pc'){WBK.animateOnce(callForm.find('div.cbk-form-title'),'cbk-bounce');}}}},setDefaultText:function(){s.text={cbkBtnTitle:"Закажите звонок",cbkCopyright:"Хочу <span class='cbk-service-name'></span> на свой сайт",cbkCallTitleCalling:"<span class='cbk-visitor-name'>Мы</span><span class='cbk-visitor-name-to-delete'>, мы</span> уже звоним Вам, возьмите трубку!",cbkCallTitleFail:"Мы не можем до вас дозвониться, давайте проверим ваш номер!",cbkCallTitleNoTariff:"Здравствуйте<span class='cbk-visitor-name-to-delete'>, </span><span class='cbk-visitor-name'></span>!<br/>Оставьте номер, и мы Вам перезвоним!",cbkCallTitleNoTariffOnExit:"<span class='cbk-visitor-name'>Не</span><span class='cbk-visitor-name-to-delete'>, не</span> нашли что искали? Оставьте номер, и мы Вам перезвоним!",cbkCallTitleOnFormCall:"Спасибо!<br/><small>Мы сейчас с Вами свяжемся!</small>",cbkCallTitleOnHideTimer:"Спасибо за заказ звонка,<br/><small> мы свяжемся с Вами в ближайшее время!</small>",cbkDepartmentTitle:"Выберите с кем хотите связаться.",cbkDepartmentBtnTitle:"Выбрать",cbkPhoneBtnTitle:"Позвоните мне!",cbkPhoneDeferredBtnTitle:"Жду звонка!",cbkCallLaterBtnTitle:"Выбрать удобное время звонка",cbkCallResultQuestionTitle:"<span class='cbk-visitor-name'>Скажите</span>,<br/><small>Вам удалось начать разговор с менеджером?</small>",cbkYes:"Да",cbkNo:"Нет",cbkRatingTitle:"Оцените<br/><small>на сколько Вам понравилось общение с менеджером</small>",cbkSendCallToEmailTitle:"<span class='cbk-visitor-name'>Спасибо</span>,<br/><small>учтем оценку. Еще могу выслать Вам на email запись этого разговора через <span class='cbk-service-name'>"+WBK.settings.servicename+"</span>.</small>",cbkSendCallToEmailTitle2:"<span class='cbk-visitor-name'>Еще могу</span><span class='cbk-visitor-name-to-delete'>,</span><br/><small><span class='cbk-visitor-name-to-delete'>еще могу </span>выслать Вам на email запись этого разговора через <span class='cbk-service-name'>"+WBK.settings.servicename+"</span>.</small>",cbkSendCallToEmailTitle3:"<span class='cbk-visitor-name'>Я отправил</span><span class='cbk-visitor-name-to-delete'>,</span><br/><small><span class='cbk-visitor-name-to-delete'>я отправил</span> заявку менеджеру. Также могу выслать Вам на email запись будущего разговора.</small>",cbkEmailPlaceholder:"Ваш email",cbkSendEmail:"Получить аудиозапись!",cbkNoThanks:"Нет, спасибо",cbkGetNameTitle:"Учтем оценку.<br/><small>Хотите в следующий раз мы будем обращаться к Вам по имени?</small>",cbkGetNameTitle2:"Хорошо,<br/><small>хотите в следующий раз мы будем обращаться к Вам по имени?</small>",cbkGetNameTitle3:"<span class='cbk-visitor-name-no-link'></span>,<br/><small>если вы не <span class='cbk-visitor-name-no-link'></span>, а представились шутливым именем, тогда укажите настоящее имя :)</small>",cbkGetNamePlaceholder:"Ваше имя и отчество",cbkAcceptAgreement:"Я принимаю <a target='_blank' href='"+WBK.settings.serviceoferta+"'>соглашение</a>",cbkSendName:"Будем знакомы!",cbkSkip:"Пропустить &gt;&gt;",cbkShareTitle:{0:{0:{0:"Спасибо!<br/><small>Мы Вам перезвоним в указанное время.</small>",1:"[name], спасибо!<br/><small>Мы Вам перезвоним в указанное время.</small>"},1:{0:"Спасибо!<br/><small>Мы Вам перезвоним в указанное время.</small>",1:"[name], спасибо!<br/><small>Мы Вам перезвоним в указанное время.</small>"}},1:{0:{0:"Спасибо за заявку!",1:"[name], спасибо за заявку!"},1:{0:"Спасибо за звонок!",1:"[name], спасибо за звонок!"}}},cbkYesAgree:"Да, согласен!",cbkCallLaterTitle:"Выберите<br/><small>удобное время звонка.</small>",cbkCallLaterTitle3:"Не нашли что искали?<br/><small>Хотите мы Вам позвоним и поможем?</small>",cbkErrorNoPhone:"Пожалуйста, введите свой номер!",cbkErrorNoAgree:"Вы должны принять соглашение!",cbkErrorNoName:"Пожалуйста, введите свое имя!",cbkErrorNoEmail:"Пожалуйста, введите свой email!",cbkSecond1:"секунду",cbkSecond2:"секунды",cbkSecond3:"секунд",cbkMondayText:"Понедельник",cbkTuesdayText:"Вторник",cbkWednesdayText:"Среда",cbkThursdayText:"Четверг",cbkFridayText:"Пятница",cbkSaturdayText:"Суббота",cbkSundayText:"Воскресенье"};},setDefaultSettings:function(){var settings={timeouts:{socketReconnect:2,needToCall:1,shakeBtn:5,rotatePhoneIcons:1.5,phonePulse:1.5,animateCopyright:5,btnShowTimeout:0},btnShowScroll:0,btnShow:false,callTimeout:24,btnColor:false,btnTextColor:false,btnNoPulse:false,btnPosition:false,btnExtendedPosition:false,btnExtendedCorner:false,btnSize:false,btnStaticOnScroll:false,btnText:false,btnTextAdd:false,btnType:'phone',calling:false,callingGenerator:false,callingFromForm:false,callId:false,callStarted:false,callToPhoneIsDeferred:false,currentDay:0,departments:false,hideBtn:0,hourDelta:0,killerId:false,killerCallOff:false,killerFormCall:false,killerFormCallHide:0,killerIsPayed:false,killerLogo:false,killerBtnLogo:false,killerUpdatedAt:false,killerTimezone:3,killerTransparentBgr:false,killerWorkdays:false,killerWorking:0,killerWorkingToday:true,killerHasMoney:0,killerIsPaused:false,killerPausedStart:false,killerPausedEnd:false,killerPausedDay:false,killerIsPausedNow:false,noShowOnExit:false,noShowWindow:false,phonePositionRight:20,phonePositionBottom:5,prevDay:0,showWindowApperanceTimeout:27,showWindowReapperanceTimeout:1,showOnExitApperanceTimeout:8,showOnExitReapperanceTimeout:24*60,skipSendRecordToVisitor:false,managerRatingCheck:true,killerVisitorGetName:true,timeDelta:0,useDepartment:'',sockjs:false,cbkLink:'https://whitesaas.com?utm_source=widget&utm_medium=self&utm_campaign='+location.hostname+'&utm_content=&utm_term=',cssUrl:'//saas-support.com/widget/cbk.css',btnMobilePositionHorizontal:40,btnMobilePositionHorizontalType:'left',btnMobilePositionVertical:95,btnMobilePositionVerticalType:'bottom',mobileViewPort:false,timerType:"millisecond",windowPosition:0,dragObject:{},btnHideMobileZoom:false,scallingMobile:false,formHeight:false,hideDefered:0,scrollLeft:0,scrollTop:0,};$.extend(true,s,settings);},setTemplate:function(){t={btn:'<a class="callbackkiller cbk-btn" href="javascript:void(0)">'+'<span class="cbk-title">'+s.text.cbkBtnTitle+'</span>'+'</a>',phone:'<a class="callbackkiller cbk-phone" href="javascript:void(0)">'+'<div class="cbk-phone-bgr"></div>'+'<div class="cbk-phone-content">'+'<div class="cbk-phone-phone cbk-rotate-icon"><i class="ws-icon-phone"></i></div>'+'<div class="cbk-phone-text">'+s.text.cbkBtnTitle+'</div>'+'</div>'+'</a>',extended_btn:'<div class="ws-killer">'+'<div class="ws-killer-btn-container">'+'<div class="ws-killer-btn">'+'<div class="ws-killer-btn-ico">'+'<div class="ws-killer-btn-logo">'+'<i class="ws-icon-phone"></i>'+'<img src="" class="ws-killer-logo-img">'+'</div>'+'</div>'+'<div class="ws-btn-title">'+s.text.cbkBtnTitle+'</div>'+'</div>'+'</div>'+'</div>',windowbgr:'<div class="cbk-window-bgr"></div>',windowlogo:'<div class="cbk-window-logo"></div>',window:'<div class="callbackkiller cbk-window">'+'<div class="cbk-background"><div></div></div>'+'<a class="cbk-close-window" href="javascript:void(0)">&times;</a>'+'<a class="cbk-copyright" target="_blank" href="'+s.cbkLink+'" data-widget="callback">'+s.text.cbkCopyright+'</a>'+'<div class="cbk-forms">'+'<div class="cbk-form cbk-callform">'+'<div class="cbk-form-title"></div>'+'<input type="tel" id="cbkPhoneInput" class="cbk-input" maxlength="22"/>'+'<input type="text" class="cbk-phone-checker cbk-input-hidden"/>'+'<button type="button" id="cbkPhoneBtn" class="cbk-button cbk-button-lg cbk-ink-reaction">'+s.text.cbkPhoneBtnTitle+'</button>'+'<div class="cbk-timer"></div>'+'<br/><div class="cbk-link-btn"><a href="javascript:void(0)" class="cbk-button-no">'+s.text.cbkCallLaterBtnTitle+'</a></div>'+'</div>'+'<div class="cbk-form cbk-cdform">'+'<div class="cbk-form-title"></div>'+'<div class="cbk-deferred"><select id="cbkCallDeferredDate" class="cbk-select cbk-deferred-date"></select> <div>в</div> <select id="cbkCallDeferredTime" class="cbk-select cbk-deferred-time"></select></div>'+'<input type="tel" id="cbkPhoneDeferredInput" class="cbk-input" maxlength="22"/>'+'<button type="button" id="cbkPhoneDeferredBtn" class="cbk-button cbk-button-lg cbk-ink-reaction">'+s.text.cbkPhoneDeferredBtnTitle+'</button>'+'</div>'+'<div class="cbk-form cbk-departmentform">'+'<div class="cbk-form-title">'+s.text.cbkDepartmentTitle+'</div>'+'<select id="cbkDepartment" class="cbk-select"></select>'+'<button type="button" id="cbkDepartmentBtn" class="cbk-button cbk-button-lg cbk-ink-reaction">'+s.text.cbkDepartmentBtnTitle+'</button>'+'<div class="cbk-timer"></div>'+'</div>'+'<div class="cbk-form cbk-crqform">'+'<div class="cbk-form-title">'+s.text.cbkCallResultQuestionTitle+'</div>'+'<button type="button" class="cbk-button cbk-button-yes">'+s.text.cbkYes+'</button>'+'<button type="button" class="cbk-button cbk-button-no">'+s.text.cbkNo+'</button>'+'</div>'+'<div class="cbk-form cbk-ratingform">'+'<div class="cbk-form-title">'+s.text.cbkRatingTitle+'</div>'+'<ul class="cbk-call-rating"><li><a id="cbkRating1" href="javascript:void(0)" data-value="1">1</a></li><li><a id="cbkRating2" href="javascript:void(0)" data-value="2">2</a></li><li><a id="cbkRating3" href="javascript:void(0)" data-value="3">3</a></li><li><a id="cbkRating4" href="javascript:void(0)" data-value="4">4</a></li><li><a id="cbkRating5" href="javascript:void(0)" data-value="5">5</a></li></ul>'+'</div>'+'<div class="cbk-form cbk-gnform">'+'<div class="cbk-form-title">'+s.text.cbkGetNameTitle+'</div>'+'<input type="text" id="cbkNameInput" class="cbk-input" placeholder="'+s.text.cbkGetNamePlaceholder+'"/>'+'<div><label class="cbk-label"><input type="checkbox" checked name="oferta" id="cbkAgreement" class="cbk-input-checkbox">'+s.text.cbkAcceptAgreement+'</label></div>'+'<button type="button" class="cbk-button cbk-button-yes">'+s.text.cbkSendName+'</button>'+'<div class="cbk-link-btn"><a href="javascript:void(0)" class="cbk-button-no">'+s.text.cbkSkip+'</a></div>'+'</div>'+'<div class="cbk-form cbk-geform">'+'<div class="cbk-form-title">'+s.text.cbkSendCallToEmailTitle+'</div>'+'<input type="text" id="cbkEmailInput" class="cbk-input" placeholder="'+s.text.cbkEmailPlaceholder+'"/>'+'<button type="button" class="cbk-button cbk-button-yes">'+s.text.cbkSendEmail+'</button>'+'<div class="cbk-link-btn"><a href="javascript:void(0)" class="cbk-button-no">'+s.text.cbkNoThanks+'</a></div>'+'</div>'+'<div class="cbk-form cbk-shareform">'+'<div class="cbk-form-title"></div>'+'</div>'+'<div class="cbk-form cbk-naform">'+'<div class="cbk-form-title"></div>'+'</div>'+'</div>'+'</div>'+'</div>'};}}})(jWS);"use_strict";wsInstinct=(function($){var _this;var s;var t;var w;var _debug;return{settings:{},templates:{},widget:{},init:function(data){_this=this;s=this.settings;t=this.templates;w=this.widget;if($.fn._frameCheck()&&typeof WBK==='undefined'){WBK=document.WBK;}
_debug=WBK.checkDebug();_this.loader(data);},loader:function(res){var data=res.Data.instinct;_this.setSettings(data);WBK.settings.instinctId=parseInt(res.Settings.instinctId);_this.clearStorageData();s.checked_variants_id=_this.checkVariants();if(!s.checked_variants_id.length){_this.log('Нет подходящих вариантов');return;}
_this.setTemplate();_this.initWidget();},clearStorageData:function(){wsUtil.checkStorageTime(['ws_instinct_close_'+WBK.settings.instinctId,'ws_instinct_click_'+WBK.settings.instinctId,'ws_instinct_show_count_time_'+WBK.settings.instinctId]);if(!wsUtil.getStorage('ws_instinct_show_count_time_'+WBK.settings.instinctId)){wsUtil.deleteStorage('ws_instinct_show_data_'+WBK.settings.instinctId);}},initWidget:function(){w.window=$(t);w.window.hide().appendTo('body');w.window.find('span.service-name').html(WBK.settings.servicename);_this.loadWindowEvents();_this.initPosition();_this.initTimer();},startShow:function(){if(!_this.checkShow()||s.started==true){return;}
if(_debug)_this.log('Начинаем показы');_this.sendEvents('show','','');s.started=true;_this.generateVariant();},getCount:function(){var data;var showData={shows:0,max_show:s.show_count};if(wsUtil.getStorage('ws_instinct_show_data_'+WBK.settings.instinctId)){data=JSON.parse(wsUtil.getStorage('ws_instinct_show_data_'+WBK.settings.instinctId));if(showData.max_show!=data.max_show){if(_debug)_this.log('Изменилось максимальное количество показов; было: '+data.max_show+' стало: '+showData.max_show);data.max_show=showData.max_show;wsUtil.setStorage('ws_instinct_show_data_'+WBK.settings.instinctId,JSON.stringify(data));wsUtil.deleteStorage('ws_instinct_show_count_time_'+WBK.settings.instinctId);}}else{data=showData;}
return data;},updateCount:function(){var data=_this.getCount();data.shows=data.shows+1;wsUtil.setStorage('ws_instinct_show_data_'+WBK.settings.instinctId,JSON.stringify(data));if(data.shows>=data.max_show){var date=new Date();if(s.repeat_show_count_type=='minutes'){date.setMinutes(date.getMinutes()+parseInt(s.repeat_show_count_time));}else if(s.repeat_show_count_type=='days'){date.setDate(date.getDate()+parseInt(s.repeat_show_count_time));}
wsUtil.setStorage('ws_instinct_show_count_time_'+WBK.settings.instinctId,date.getTime());}},generateVariant:function(){s.show_variant=false;if(!_this.checkShow()){return;}
if(_debug)_this.log('Генерируем вариант');var variant_id=s.checked_variants_id[wsUtil.getRandomArbitrary(0,s.checked_variants_id.length-1)];var url=WBK.settings.serverUrl+"/api?action=instinctGenerate&callback=?";$.getJSON(url,{instinctId:WBK.settings.instinctId,variantId:variant_id,code:WBK.settings.whiteSaasCode,visitId:WBK.settings.visitId,visitorId:WBK.settings.visitorId},function(result){if(result.Success==true){wsUtil.setInterval('WidgetInstinctShowTimer',function(){if(WBK.checkWidgetOpened('instinct')){wsUtil.deleteInterval('WidgetInstinctShowTimer');_this.showVariant(result.Data.variant);}},3000);}});},showVariant:function(variant){s.show_variant=variant;w.window.find('.inst-title').html(WBK.formatText(variant.title));w.window.find('.inst-text').html(WBK.formatText(variant.text));w.window.find('span.inst-sum').each(function(){$(this).html(wsUtil.humanizeNumber($(this).html()));});if(variant.img_src){w.window.removeClass('inst-no-image');w.window.find('.inst-logo-img').attr('src',WBK.settings.staticServerUrl+'/uploaded/instinct_variants/'+variant.id+'/'+variant.img_src);}else{w.window.addClass('inst-no-image');}
_this.showWidget();if(s.show_count_enabled){_this.updateCount();}
wsUtil.setTimeout('WidgetInstinctCloseTimer',function(){wsUtil.deleteInterval('WidgetInstinctCloseTimer');_this.hideWidget();var time_generate=_this.getTimeGenerate();wsUtil.setStorage('ws_instinct_time_generate',time_generate);var d=new Date();d.setSeconds(d.getSeconds()+time_generate);wsUtil.setStorage('ws_instinct_time_showed',d.getTime());wsUtil.setTimeout('WidgetInstinctGenerateTimer',function(){wsUtil.deleteInterval('WidgetInstinctGenerateTimer');_this.generateVariant();},time_generate*1000);},s.show_time*1000);},getTimeGenerate:function(){var time_generate=1;switch(s.interval_show){case'time':time_generate=s.interval_show_time;break;case'behavioral':time_generate=wsUtil.getRandomArbitrary(3,20);break;case'interval':time_generate=wsUtil.getRandomArbitrary(s.interval_show_start,s.interval_show_end);break;}
return time_generate;},checkShow:function(){var res=true;if(wsUtil.getStorage('ws_instinct_close_'+WBK.settings.instinctId)||wsUtil.getStorage('ws_instinct_click_'+WBK.settings.instinctId)){if(_debug)_this.log('Виджет был закрыт или выполнилось целевое действие');return false;}
if(s.show_count_enabled){var data=_this.getCount();if(s.started&&_debug)_this.log('Включен лимит показов; показано: '+data.shows+'; Макс. показов: '+data.max_show);if(wsUtil.getStorage('ws_instinct_show_count_time_'+WBK.settings.instinctId)){if(_debug)_this.log('Исчерпано количество показов');res=false;}}else{wsUtil.deleteStorage('ws_instinct_show_data_'+WBK.settings.instinctId);wsUtil.deleteStorage('ws_instinct_show_count_time_'+WBK.settings.instinctId);}
return res;},checkVariants:function(){var variants_ids=[];$.each(s.variants,function(index,value){var check=false;switch(value.action){case'killer':if(value.action_value==WBK.settings.killerId){check=true;}
break;case'generator':if(value.action_value==WBK.settings.generatorId){check=true;}
break;case'chat':if(value.action_value==WBK.settings.chatWidgetId){check=true;}
break;case'url':case'javascript':case'other_widget':case'none':check=true;break;}
if(check){variants_ids.push(index);}});return variants_ids;},initPosition:function(){var css={};switch(s.position_x){case'left':css.left=s.position_x_value+'%';css.right='auto';break;case'right':css.right=s.position_x_value+'%';css.left='auto';break;}
switch(s.position_y){case'bottom':css.bottom=s.position_y_value+'%';css.top='auto';break;case'top':css.top=s.position_y_value+'%';css.bottom='auto';break;}
w.window.css(css);},initTimer:function(){if(s.start_show=='disabled'||s.start_show=='scroll'){return;}
var open_seconds=1;if(s.start_show=='paused'){open_seconds=s.show_paused_time;}
if(s.start_show=='behavioral'){open_seconds=wsUtil.getRandomArbitrary(3,27);}
var time_generate=_this.getTimeGenerate();var time_generate_storage=wsUtil.getStorage('ws_instinct_time_generate');var time_showed=wsUtil.getStorage('ws_instinct_time_showed');if(time_generate_storage&&time_showed&&time_generate_storage==time_generate){time_showed=new Date().setTime(time_showed);time_showed=(time_showed-new Date().getTime())/1000;if(time_showed>0){if(_debug)_this.log('Используем время генерации нового варианта из предыдущей сессии: '+time_showed);open_seconds=time_showed;}}
wsUtil.setInterval('WidgetInstinctTimer',function(){if(WBK.checkWidgetOpened('instinct')){wsUtil.deleteInterval('WidgetInstinctTimer');_this.startShow();}},open_seconds*1000);},loadWindowEvents:function(){w.window.find('.inst-close').on('click',function(e){e.preventDefault();_this.stopWidget();});w.window.on('click',function(e){if($(e.target).hasClass('inst-close')||$(e.target).hasClass('service-name')||$(e.target).hasClass('inst-copyright-url')){return;}
_this.clickWidget();});if(s.start_show=='scroll'){$(window).on('scroll.inst-container',function(){var scroll=$(window).scrollTop();var scrollH=$(document).height()-$(window).height();var scrolled=scroll/scrollH*100;if(s.show_scroll_percent<=scrolled){_this.startShow();$(window).off('scroll.inst-container');}});}},clickWidget:function(){_this.hideWidget();switch(s.show_variant.action){case'killer':var d=new Date();d.setMinutes(d.getMinutes()+60*24*100);wsUtil.setCookie('WhiteCallback_shownOn','on_instinct',d);wsKiller.showWindow('instinct');break;case'generator':wsGenerator.showWidget('instinct');break;case'chat':wsChat.showWidget();break;case'url':if(parseInt(s.show_variant.open_window)){window.location.href=s.show_variant.action_value;}else{window.open(s.show_variant.action_value,'_blank');}
break;case'javascript':case'other_widget':eval(s.show_variant.action_value);break;}
var date=new Date();if(s.repeat_show_click_type=='minutes'){date.setMinutes(date.getMinutes()+parseInt(s.repeat_show_click_time));}else if(s.repeat_show_click_type=='days'){date.setDate(date.getDate()+parseInt(s.repeat_show_click_time));}
wsUtil.setStorage('ws_instinct_click_'+WBK.settings.instinctId,date.getTime());_this.sendEvents('click',s.show_variant.action,s.show_variant.action_value);_this.sendGoal('click');},stopWidget:function(){var date=new Date();if(s.repeat_show_close_type=='minutes'){date.setMinutes(date.getMinutes()+parseInt(s.repeat_show_close_time));}else if(s.repeat_show_close_type=='days'){date.setDate(date.getDate()+parseInt(s.repeat_show_close_time));}
wsUtil.setStorage('ws_instinct_close_'+WBK.settings.instinctId,date.getTime());_this.hideWidget();_this.sendEvents('close',s.show_variant.action,s.show_variant.action_value);_this.sendGoal('close');},showWidget:function(){w.window.show();if(s.animation_type!='none'){WBK.animateElTime(w.window,s.animation_type,false,500);}
if(s.show_sound!='disabled'){WBK.Sound('instinct/'+s.show_sound);}},hideWidget:function(){w.window.fadeOut();},sendEvents:function(type,widget,value){var url=WBK.settings.serverUrl+"/api?action=instinctEvent&callback=?";$.getJSON(url,{event:type,widgetType:widget,widgetId:parseInt(value)?parseInt(value):0,instinctId:WBK.settings.instinctId,instinctStatId:WBK.settings.instinctStatId,code:WBK.settings.whiteSaasCode,visitId:WBK.settings.visitId,visitorId:WBK.settings.visitorId},function(result){if(typeof result.Data.id!="undefined"){if(type==='click'){switch(widget){case'killer':WBK.settings.instinctCallbackStatId=result.Data.id;break;case'generator':WBK.settings.instinctGeneratorStatId=result.Data.id;break;}}
if(type==='show'){WBK.settings.instinctStatId=result.Data.id;}}});},sendGoal:function(type){var yaGoal,gaGoal,mailGoal;var gaCategory='Instinct';switch(type){case'click':yaGoal='INST_CLICK';gaGoal=mailGoal='ClickInstinct';break;case'close':yaGoal='INST_CANCEL';gaGoal=mailGoal='ClickInstinct';break;}
wsUtil.sendGoal(yaGoal,gaGoal,gaCategory);},setTemplate:function(){t='<div class="inst-container inst-no-image inst-corner-'+s.corner_type+' inst-shadow-'+s.container_shadow+'" style="background: '+s.color_background+';color: '+s.color_text+'">'+'<div class="inst-logo">'+'<img class="inst-logo-img">'+'</div>'+'<div class="inst-body">'+'<div class="inst-title"></div>'+'<div class="inst-text"></div>'+'</div>'+'<div class="inst-close '+(s.hide_close?' ws-hide':'')+'">×</div>'+'</div>';},setSettings:function(settings){var defaultSettings={checked_variants_id:[],show_variant:false,started:false};$.extend(true,s,defaultSettings);$.extend(true,s,settings);},log:function(mess){wsUtil.log('INSTINCT : '+mess);}}})(jWS);(function($){$.ajaxSetup({async:true});$.fn.WBK=function(options){if(typeof options==='object'||!options){if(options.hasOwnProperty('whiteSaasCode')){if(jWS.fn._frameCheck()){if(typeof document.WBK==='object'){console.log('Only one instance of WhiteSaas can be run');return;}
document.WBK=new WhiteSaas(options);return document.WBK;}else{if(typeof window.top.WBK==='object'){console.log('Only one instance of WhiteSaas can be run');return;}
window.top.WBK=new WhiteSaas(options);return window.top.WBK;}}}else if(typeof options==='string'){return;}
return this;};$.fn._frameCheck=function(){try{return window!=window.top||document!=top.document||self.location!=top.location;}catch(e){return true}};var WhiteSaas=function(options){if(/mtproxy\.yandex\.net/.test(document.URL)){return false;}
var _this=this;_this.setDefaultSettings();_this.pageIdent=_this.pageIdentGen();$.extend(_this.settings,options);if(document.referrer&&document.referrer!=''&&!wsUtil.getCookie('WhiteSaas_referrer')){var d=new Date();d.setHours(d.getHours()+1);wsUtil.setCookie('WhiteSaas_referrer',document.referrer,d);}
if(!this.settings.whiteSaasCode){return false;}
var url=_this.settings.serverUrl+"/api?action=load&callback=?";var siteUrl='';if(document.URL){siteUrl=encodeURIComponent(document.URL);}
jWS.getJSON(url,{code:_this.settings.whiteSaasCode,url:siteUrl,referrer:encodeURIComponent(wsUtil.getCookie('WhiteSaas_referrer')),cookie:_this.clearServiceCookie(document.cookie),visit_count:_this.getVisitCount()},function(result){try{if(!JSON.stringify&&typeof JSON.encode!=='undefined')JSON.stringify=JSON.encode;if(!JSON.parse&&typeof JSON.decode!=='undefined')JSON.parse=JSON.decode;}catch(e){}
_this.onLoad(result);});if(jWS.fn._frameCheck()){document.WhiteSaas=this;document.WhiteCallback=this;document.CallbackKiller=this;}else{window.top.WhiteSaas=this;window.top.WhiteCallback=this;window.top.CallbackKiller=this;}};WhiteSaas.prototype.clearServiceCookie=function(cookie){var _c=cookie.split("; ");var _r=[];var c=0;for(var i=0;i<_c.length;i++){if(typeof _c[i]==='string'){if(_c[i].search(/WhiteCallback_openedpage/)===0||_c[i].search(/sw_openedpage/)===0){}else{var _str=_c[i];_r.push(_str.substring(0,64));}}}
return _r.join("; ");};WhiteSaas.prototype.onLoad=function(result){var _this=this;if(result.Success&&result.Data&&result.Settings){_this.settings.device=result.Settings.device;if(result.Settings.visitorId){_this.settings.visitorId=result.Settings.visitorId;}
else{return false;}
if(result.Settings.visitId){_this.settings.visitId=result.Settings.visitId;wsUtil.setCookie('WhiteCallback_visit',result.Settings.visitId);_this.updateVisit();}
if(result.Settings.visitorName&&result.Settings.visitorName!==''){_this.settings.visitorName=result.Settings.visitorName;_this.settings.hasVisitorName=1;}
if(result.Settings.visitorPhone&&result.Settings.visitorPhone!==''){_this.settings.visitorPhone=result.Settings.visitorPhone;}
if(result.Settings.visitorEmail&&result.Settings.visitorEmail!==''){_this.settings.visitorEmail=result.Settings.visitorEmail;}
if(result.Settings.thisIsCallbackKILLER){_this.settings.thisIsCallbackKILLER=true;}
if(result.Settings.serviceName){_this.settings.servicename=result.Settings.serviceName;}
if(result.Settings.serviceOferta){_this.settings.serviceoferta=result.Settings.serviceOferta;}
if(result.Settings.serviceDomain){_this.settings.servicedomain=result.Settings.serviceDomain;}
if(result.Settings.serviceId){_this.settings.serviceid=result.Settings.serviceId;}
if(result.Settings.siteId){_this.settings.siteId=parseInt(result.Settings.siteId);}
if(result.Settings.phoneBase||result.Settings.phoneBase===''){if(result.Settings.phoneBase===''){_this.settings.phoneBase='';}else{_this.settings.phoneBase=parseInt(result.Settings.phoneBase);}}
if(result.Settings.phoneMasks){_this.settings.phoneMasks=result.Settings.phoneMasks;}
if(result.Settings.windowNoCopyright){_this.settings.hideCopyright=true;}
var now=new Date();if(result.Settings.utcTime){_this.settings.utcTime=result.Settings.utcTime;}
else{_this.settings.utcTime=parseInt(now.getTime()/1000);}
if(result.Settings.siteCode){_this.settings.whiteSaasCode=result.Settings.siteCode;}
wsUtil.initTimeouts();wsUtil.initIntervals();_this.initStyles();_this.updatePageShowCount();wsUtil.deleteCookie('CallbackKiller_timePage');_this.pageIdentAdd(_this.pageIdent);if(_this.pageIdentGetMainPage()){_this.pageIdentObserve();}
else{_this.pageIdentSetMainPage(_this.pageIdent);}
_this.loadWidgets(result);}};WhiteSaas.prototype.loadWidgets=function(result){var _this=this;try{if(result.Data.callback&&result.Settings.killerId){wsKiller.init(result);}}catch(e){wsUtil.log('KILLER : '+e.stack);}
try{if(result.Data.chat&&result.Settings.chatWidgetId){wsChat.init(result);}}catch(e){wsUtil.log('CHAT : '+e.stack);}
if(_this.settings.device!=='mobile'){try{if(result.Data.generator&&result.Settings.generatorId){wsGenerator.init(result);}}catch(e){wsUtil.log('GENERATOR : '+e.stack);}
try{if(result.Data.invader&&result.Settings.invaderId){wsInvader.init(result);}}catch(e){wsUtil.log('INVADER : '+e.stack);}
try{if(result.Data.instinct&&result.Settings.instinctId){wsInstinct.init(result);}}catch(e){wsUtil.log('INSTINCT : '+e.stack);}}};WhiteSaas.prototype.getVisitCount=function(){return parseInt(wsUtil.getStorage('ws_visit_count'))?parseInt(wsUtil.getStorage('ws_visit_count')):0;},WhiteSaas.prototype.updateVisit=function(){var _this=this;var oldVisitId=wsUtil.getStorage('ws_visit_id');if(oldVisitId!=_this.settings.visitId){wsUtil.setStorage('ws_visit_id',_this.settings.visitId);_this.updateVisitCount();}},WhiteSaas.prototype.updateVisitCount=function(){var _this=this;var oldVisitCount=_this.getVisitCount();var visitCount=oldVisitCount?oldVisitCount+1:1;wsUtil.setStorage('ws_visit_count',visitCount);},WhiteSaas.prototype.getPageShowCount=function(){return parseInt(wsUtil.getStorage('ws_page_show_count'))?parseInt(wsUtil.getStorage('ws_page_show_count')):0;},WhiteSaas.prototype.updatePageShowCount=function(){var _this=this;var oldPageShowCount=_this.getPageShowCount();var pageShowCount=oldPageShowCount?oldPageShowCount+1:1;wsUtil.setStorage('ws_page_show_count',pageShowCount);},WhiteSaas.prototype.initStyles=function(){$('body').append("<style id='whitesaas_style'></style>");};WhiteSaas.prototype.addStyles=function(css){$("#whitesaas_style").append(css);};WhiteSaas.prototype.showInvader=function(){if(window['wsInvader']){wsInvader.showWidget();}};WhiteSaas.prototype.showWidgetGenerator=function(type){if(window['wsGenerator']){wsGenerator.showWidget(type);}};WhiteSaas.prototype.showWidgetChat=function(){if(window['wsChat']){wsChat.showWidget();}};WhiteSaas.prototype.showWindow=function(showOnType,noWorkTime){if(window['wsKiller']){wsKiller.showWindow(showOnType,noWorkTime);}};WhiteSaas.prototype.newCall=function(phone,immediately){if(window['wsKiller']){wsKiller.newCall(phone,immediately);}};WhiteSaas.prototype.checkFormOnSubmit=function(form){if(window['wsKiller']){wsKiller.checkFormOnSubmit(form);}};WhiteSaas.prototype.callToPhone=function(phone,department,customtext){if(window['wsKiller']){wsKiller.callToPhone(phone,department,customtext);}};WhiteSaas.prototype.setCookie=function(name,value,expires,path,domain,secure){if(window['wsUtil']){wsUtil.setCookie(name,value,expires,path,domain,secure);}};WhiteSaas.prototype.getCookie=function(name){if(window['wsUtil']){wsUtil.getCookie(name);}};WhiteSaas.prototype.setPhoneInputFocusForm=function(el){var _this=this;if(!el.val()){if(_this.settings.phoneBase!==''){el.val(_this.settings.phoneBase);if(_this.settings.device!=='mobile'){el.focus();if(_this.settings.phoneBase===7){wsUtil.setCaretPosition(el,3,3);}
if(_this.settings.phoneBase===38||_this.settings.phoneBase===47){wsUtil.setCaretPosition(el,3,3);}
if(_this.settings.phoneBase===358||_this.settings.phoneBase===992||_this.settings.phoneBase===375||_this.settings.phoneBase===77){wsUtil.setCaretPosition(el,4,4);}}}else{if(_this.settings.device!=='mobile'){wsUtil.setCaretPosition(el,2,2);}}}};WhiteSaas.prototype.initSocket=function(callbackDone){var _this=this;$.getScript(_this.settings.serverUrl+'/widget/socket.io.js',function(){if(!_this.settings.socket){var socketioUrl=_this.settings.socketioUrl+'?type=visitor&site_id='+_this.settings.siteId+'&id='+_this.settings.visitorId;var socket=new io.connect(socketioUrl);var cases={disconnect:function(data){_this.settings.socket=false;},sync:function(data){switch(data.event){case'onVisitorMessage':wsChat.onVisitorMessage(data);break;case'onVisitorMessageRead':wsChat.onVisitorMessageRead();break;}},connected:function(data){_this.settings.socket=socket;if(!_this.settings.socketConnected){if(typeof callbackDone!=='undefined'){callbackDone(data);}}else{if(WBK.settings.chatEnabled){wsChat.socketConnected(data,callbackDone);}}
_this.settings.socketConnected=1;},onOperatorStatus:function(data){wsChat.onOperatorStatus(data);},onConnectToChat:function(data){wsChat.onConnectToChat(data);},onDisconnectFromChat:function(data){wsChat.onDisconnectFromChat(data);},onCloseChat:function(data){wsChat.onCloseChat(data);},onOperatorPrinting:function(data){wsChat.onOperatorPrinting(data);},onOperatorMessage:function(data){wsChat.onOperatorMessage(data);},onOperatorUpdateMessage:function(data){wsChat.onOperatorUpdateMessage(data);},onMessageReceived:function(data){},onMessageRead:function(data){wsChat.onMessageRead(data);},onUpdateRegistrationId:function(data){wsChat.onUpdateRegistrationId(data);},onCallStatus:function(data){wsKiller.onCallStatus(data);}};Object.keys(cases).forEach(function(key){socket.on(key,function(data){cases[key].call(_this,data);});});}});};WhiteSaas.prototype.updateTimeAll=function(){var d=new Date();d.setDate(d.getDate()+1);wsUtil.setCookie('WhiteCallback_timeAll',(parseInt(wsUtil.getCookie('WhiteCallback_timeAll'))+1||1),d);wsUtil.setCookie('WhiteCallback_timePage',(parseInt(wsUtil.getCookie('WhiteCallback_timePage'))+1||1),d);};WhiteSaas.prototype.pageIdentAdd=function(ident){var _this=this;var d=new Date();d.setFullYear(d.getFullYear()+1);var cop=wsUtil.getCookie('WhiteCallback_openedPages');var val=cop?cop+'.'+ident:ident;wsUtil.setCookie('WhiteCallback_openedPages',val,d);wsUtil.setInterval('incrementPageTime',function(){_this.incrementPageTime.apply(_this,[ident]);},1000);$(window).on('beforeunload',function(){_this.pageIdentRemove.apply(_this,[ident]);wsUtil.deleteInterval('incrementPageTime');});};WhiteSaas.prototype.incrementPageTime=function(ident){var d=new Date();var now=parseInt(new Date().getTime()/1000);d.setFullYear(d.getFullYear()+1);wsUtil.setCookie('WhiteCallback_openedpage_'+ident,now,d);};WhiteSaas.prototype.pageIdentRemove=function(ident){var ret=[];var str=wsUtil.getCookie('WhiteCallback_openedPages')||'';var arr=str.split('.');wsUtil.deleteCookie('WhiteCallback_openedpage_'+ident);if(arr.length==0){return wsUtil.deleteCookie('WhiteCallback_openedPages');}
for(var key in arr){if(arr.hasOwnProperty(key)){if(arr[key]!==ident){ret.push(arr[key]);}}}
if(ret.length>0){var d=new Date();d.setFullYear(d.getFullYear()+1);wsUtil.setCookie('WhiteCallback_openedPages',ret.join("."),d);this.pageIdentSetUpdateMainPage(ret[0]);}else{wsUtil.deleteCookie('WhiteCallback_openedPages');wsUtil.deleteCookie('WhiteCallback_mainPage');wsUtil.deleteCookie('WhiteCallback_updateMainPage');}};WhiteSaas.prototype.pageIdentSetMainPage=function(ident){var _this=this;var d=new Date();d.setFullYear(d.getFullYear()+1);wsUtil.setCookie('WhiteCallback_mainPage',ident,d);wsUtil.setInterval('updateTimeAll',function(){_this.updateTimeAll.call(_this);},1000);};WhiteSaas.prototype.pageIdentObserve=function(){var _this=this;wsUtil.setInterval('pageIdentObserve',function(){var updatePage=wsUtil.getCookie('WhiteCallback_updateMainPage');if(updatePage===_this.pageIdent){_this.pageIdentSetMainPage.apply(_this,[_this.pageIdent]);wsUtil.deleteInterval('pageIdentObserve');wsUtil.deleteCookie('WhiteCallback_updateMainPage');}
var now=parseInt(new Date().getTime()/1000);var main_page=wsUtil.getCookie('WhiteCallback_mainPage');var main_page_time=wsUtil.getCookie('WhiteCallback_openedpage_'+main_page);main_page_time=parseInt(main_page_time);if(main_page_time+3<now||isNaN(main_page_time)){_this.pageIdentRemove.apply(_this,[main_page]);}},1000);};WhiteSaas.prototype.pageIdentSetUpdateMainPage=function(ident){if(ident.length>0){var d=new Date();d.setFullYear(d.getFullYear()+1);wsUtil.setCookie('WhiteCallback_updateMainPage',ident,d);}else{wsUtil.deleteCookie('WhiteCallback_updateMainPage');}};WhiteSaas.prototype.pageIdentGetMainPage=function(){return wsUtil.getCookie('WhiteCallback_mainPage');};WhiteSaas.prototype.pageIdentGen=function(){var gen='',list="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(var i=0;i<5;i++)
gen+=list.charAt(Math.floor(Math.random()*list.length));return gen;};WhiteSaas.prototype.animateOnce=function(element,animation,callback){element.addClass('cbk-animated').addClass(animation);setTimeout(function(){element.removeClass('cbk-animated').removeClass(animation);if(callback&&$.isFunction(callback)){callback();}},1000);};WhiteSaas.prototype.animateFastOnce=function(element,animation,callback){element.addClass('cbk-animated').addClass('cbk-animated-fast').addClass(animation);setTimeout(function(){element.removeClass('cbk-animated').removeClass('cbk-animated-fast').removeClass(animation);if(callback&&$.isFunction(callback)){callback();}},250);};WhiteSaas.prototype.animateElTime=function(element,animation,callback,time){element.addClass('cbk-animated').addClass('cbk-animated-fast').addClass(animation);setTimeout(function(){element.removeClass('cbk-animated').removeClass('cbk-animated-fast').removeClass(animation);if(callback&&$.isFunction(callback)){callback();}},time);};WhiteSaas.prototype.sendAdvertLinkStat=function(type,adverturl,adverttext,widgetId){var _this=this;var url=_this.settings.serverUrl+"/api?action=advertlinkstat&callback=?";jWS.getJSON(url,{code:_this.settings.whiteSaasCode,widget:type,widgetId:widgetId,adverturl:adverturl,adverttext:adverttext,visitId:_this.settings.visitId,visitorId:_this.settings.visitorId},function(result){});};WhiteSaas.prototype.Sound=function(filename){var _this=this;if(!filename){return false;}
var audioSupport=false;var audio=document.createElement('audio');audioSupport=!!(audio.canPlayType);if(audio.canPlayType('audio/mpeg'!='')&&(audio.canPlayType('audio/mpeg')!='no')){ext='.mp3';}else if(audio.canPlayType('audio/ogg; codecs="vorbis"')!='no'&&audio.canPlayType('audio/ogg; codecs="vorbis"')!=''){ext='.ogg';}else{audioSupport=false;}
if(audioSupport){var path=_this.settings.staticServerUrl+'/widget/audio/'+filename+ext;audio.src=path;audio.load();audio.play();}};WhiteSaas.prototype.checkPhone=function(phone){var result=false;if(phone){phone=phone.toString();phone=phone.replace(/\D/g,'');if(phone.length===12&&phone.charAt(0)==='3'&&phone.charAt(1)==='8'){if(phone.indexOf('380',0)!==0){phone=false;}
result=$('.cbk-phone-checker:first').val(phone).blur().val();if(!result||result===''){result=false;}}
else if(phone.length===11&&phone.charAt(0)==='3'&&phone.charAt(1)==='8'&&phone.charAt(2)==='0'){result=false;}
else if(phone.length===10&&phone.charAt(0)==='0'){if(phone.length===10){phone='38'+phone;}
result=$('.cbk-phone-checker:first').val(phone).blur().val();if(!result||result===''){result=false;}}
else if(phone.length>=13&&phone.charAt(0)==='8'&&phone.charAt(1)==='6'){result=$('.cbk-phone-checker:first').val(phone).blur().val();if(!result||result===''){result=false;}}
else if(phone.length===11&&phone.charAt(0)==='3'&&phone.charAt(1)==='8'&&phone.charAt(2)==='6'){result=$('.cbk-phone-checker:first').val(phone).blur().val();if(!result||result===''){result=false;}}
else if(phone.length===12&&phone.charAt(0)==='4'&&phone.charAt(1)==='4'){result=$('.cbk-phone-checker:first').val(phone).blur().val();if(!result||result===''){result=false;}}
else if((phone.length===10||phone.length===11)&&phone.charAt(0)==='6'&&phone.charAt(1)==='6'){result=$('.cbk-phone-checker:first').val(phone).blur().val();if(!result||result===''){result=false;}}
else if(phone.charAt(0)==='3'&&phone.charAt(1)==='5'&&phone.charAt(2)==='8'){result=$('.cbk-phone-checker:first').val(phone).blur().val();if(!result||result===''){result=false;}}
else if(phone.length===12&&phone.charAt(0)==='3'&&phone.charAt(1)==='7'&&phone.charAt(2)==='5'){result=$('.cbk-phone-checker:first').val(phone).blur().val();if(!result||result===''){result=false;}}
else if((phone.length===10||phone.length===14)&&phone.charAt(0)==='4'&&phone.charAt(1)==='7'){result=$('.cbk-phone-checker:first').val(phone).blur().val();if(!result||result===''){result=false;}}
else if(phone.length===12&&phone.charAt(0)==='9'&&phone.charAt(1)==='9'&&phone.charAt(2)==='2'){result=$('.cbk-phone-checker:first').val(phone).blur().val();if(!result||result===''){result=false;}}
else{if((phone.length===10&&phone.charAt(0)!=='0')||phone.length===11){if(phone.length===10){phone='7'+phone;}
if(phone.length===11&&phone.charAt(0)==='8'){phone=phone.substring(0,0)+'7'+phone.substring(1);}
result=$('.cbk-phone-checker:first').val(phone).blur().val();if(!result||result===''){result=false;}}
else if(phone.lenght>=11&&phone.charAt(0)!=='0'&&(phone.charAt(0)==='8'||phone.charAt(0)==='7')&&(phone.charAt(1)==='3'||phone.charAt(1)==='4'||phone.charAt(1)==='8'||phone.charAt(1)==='9')){if(phone.charAt(0)==='8'){phone='7'+phone.substring(1);}
phone=phone.substring(0,11);result=$('.cbk-phone-checker:first').val(phone).blur().val();if(!result||result===''){result=false;}}}}
return result;};WhiteSaas.prototype.checkWidgetOpened=function(widget){var _this=this;var result=true;switch(widget){case'instinct':if(_this.settings.windowGeneratorOpened||_this.settings.windowOpened||_this.settings.chatWindowOpened){result=false;}
break;}
return result;};WhiteSaas.prototype.checkDebug=function(){var _this=this;var result=false;if(wsUtil.getStorage('ws_debug')==1){result=true;}
return result;};WhiteSaas.prototype.getDeviceWidth=function(){var deviceWidth=window.orientation==0?window.screen.width:window.screen.height;if(navigator.userAgent.indexOf('Android')>=0){deviceWidth=window.screen.width;}
return deviceWidth;};WhiteSaas.prototype.formatText=function(text){if(!text){return'';}
text=this.replaceTagVariant(text);text=this.replaceGetParamText(text);return text;},WhiteSaas.prototype.replaceGetParamText=function(text){if(!text){return'';}
var regexp=/\[get:([-\w]+)\]/;while(_res=regexp.exec(text)){var paramValue=this.urlParam(_res[1]);text=text.replace(_res[0],paramValue?decodeURIComponent(paramValue):'');}
return text;},WhiteSaas.prototype.replaceTagVariant=function(text){if(!text){return'';}
var regexp=/\[\#([-\w]+)\]/;while(_result=regexp.exec(text)){var regx=new RegExp('\\[\\#'+_result[1]+'\\]','gi');text=text.replace(regx,$('#'+_result[1]).text());}
return text;},WhiteSaas.prototype.urlParam=function(name){var results=new RegExp('[\?&]'+name+'=([^&#]*)').exec(window.location.href);if(results==null){return null;}
else{return results[1]||0;}},WhiteSaas.prototype.loadFont=function(){if(this.fontLoaded){return;}
this.fontLoaded=true;var versionFont=8;WBK.addStyles("@font-face{font-family: 'whitesaas';src: url('"+WBK.settings.staticServerUrl+"/widget/fonts/whitesaas.eot?"+versionFont+"');src: url('"+WBK.settings.staticServerUrl+"/widget/fonts/whitesaas.eot?"+versionFont+"#iefix') format('embedded-opentype'),url('"+WBK.settings.staticServerUrl+"/widget/fonts/whitesaas.woff2?"+versionFont+"') format('woff2'),url('"+WBK.settings.staticServerUrl+"/widget/fonts/whitesaas.woff?"+versionFont+"') format('woff'),url('"+WBK.settings.staticServerUrl+"/widget/fonts/whitesaas.ttf?"+versionFont+"') format('truetype'),url('"+WBK.settings.staticServerUrl+"/widget/fonts/whitesaas.svg?"+versionFont+"#font3435') format('svg');font-weight: normal;font-style: normal;}");},WhiteSaas.prototype.setDefaultSettings=function(){this.settings={thisIsCallbackKILLER:false,servicename:"WhiteSaaS",servicedomain:"whitesaas.com",serviceoferta:"https://whitesaas.com/img/oferta.pdf",serviceid:0,partnerLink:'https://whitesaas.com?utm_source=widget&utm_medium=self&utm_campaign='+location.hostname+'&utm_content=&utm_term=',whiteSaasCode:0,utcTime:false,visitorId:false,visitId:false,siteId:0,visitorName:false,visitorPhone:false,visitorEmail:false,hasVisitorName:0,phoneBase:7,phoneMasks:false,device:'pc',phoneMask:'+_(___)___-__-__',language:'ru',months:{0:'января',1:'февраля',2:'марта',3:'апреля',4:'мая',5:'июня',6:'июля',7:'августа',8:'сентября',9:'октрября',10:'ноября',11:'декабря'},domain:document.domain,serverUrl:'https://whitesaas.com',staticServerUrl:'https://cdn.saas-support.com',socketioUrl:'https://chat.callbackkiller.com/cbk',socketConnected:0,windowOpened:false,windowGeneratorOpened:false,windowInvaderOpened:false,callbackEnabled:false,generatorEnabled:false,chatEnabled:false,chatBtnOpened:false,chatWindowOpened:false,chatInvitationOpened:false,chatInvitationShown:false,hideCopyright:false,invaderStatId:false,invaderCallbackStatId:false,invaderGeneratorStatId:false,instinctStatId:false,instinctCallbackStatId:false,instinctGeneratorStatId:false,generatorStatId:false,genLeadId:false,called:false,fontLoaded:false};};})(jWS);jWS(document).ready(function(){if(!window.whitesaas_code&&window.callbackkiller_code){window.whitesaas_code=window.callbackkiller_code;}
jWS().WBK({whiteSaasCode:window.whitesaas_code});});if(!window.whitesaas_code){function parseQuery(query){var Params=new Object();if(!query)return Params;var Pairs=query.split(/[;&]/);for(var i=0;i<Pairs.length;i++){var KeyVal=Pairs[i].split('=');if(!KeyVal||KeyVal.length!==2)continue;var key=unescape(KeyVal[0]);var val=unescape(KeyVal[1]);val=val.replace(/\+/g,' ');Params[key]=val;}
return Params;}
var scripts=document.getElementsByTagName('script');for(var i=scripts.length;i--;i>=0){if(!window.whitesaas_code){var whitecallbackScript=scripts[i];var whitecallbackScriptQueryString=whitecallbackScript.src.replace(/^[^\?]+\??/,'');var whitecallbackScriptParams=parseQuery(whitecallbackScriptQueryString);if(whitecallbackScriptParams.wcb_code){window.whitesaas_code=whitecallbackScriptParams.wcb_code;}
else if(whitecallbackScriptParams.cbk_code){window.whitesaas_code=whitecallbackScriptParams.cbk_code;}}}}
if(!window.whitesaas_code&&window.callbackkiller_code){window.whitesaas_code=window.callbackkiller_code;}})();